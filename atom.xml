<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Thun888</title>
  
  <subtitle>夏日当空，心如深渊 | Thun888&#39;s Blog</subtitle>
  <link href="https://blog.hzchu.top/atom.xml" rel="self"/>
  
  <link href="https://blog.hzchu.top/"/>
  <updated>2024-07-18T20:22:42.000Z</updated>
  <id>https://blog.hzchu.top/</id>
  
  <author>
    <name>thun888</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>搭建一个外置登陆且互通的MC服务器</title>
    <link href="https://blog.hzchu.top/2024/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%A4%96%E7%BD%AE%E7%99%BB%E9%99%86%E4%B8%94%E4%BA%92%E9%80%9A%E7%9A%84Minecraft%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://blog.hzchu.top/2024/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%A4%96%E7%BD%AE%E7%99%BB%E9%99%86%E4%B8%94%E4%BA%92%E9%80%9A%E7%9A%84Minecraft%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2024-07-18T20:22:42.000Z</published>
    <updated>2024-07-18T20:22:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>我服务器是离线登录的，一直以来都是本地打mod来实现显示皮肤。昨天有人折腾了半天，仔细想想要不整个外置登录吧，然后一步一个坑<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsaitama.png"/></span>，记录一下</p><h2 id="搭建"><a class="markdownIt-Anchor" href="#搭建"></a> 搭建</h2><h3 id="blessing-skin"><a class="markdownIt-Anchor" href="#blessing-skin"></a> Blessing Skin</h3><h4 id="修改环境配置"><a class="markdownIt-Anchor" href="#修改环境配置"></a> 修改环境配置</h4><p>官方不建议用面板类程序部署，因为会禁用某些php函数，启用就好。在<code>禁用函数</code>或在<code>php.ini</code>里面的<code>disable_functions</code>里去掉以下函数</p><ul><li><code>symlink</code></li><li><code>readlink</code></li><li><code>putenv</code></li><li><code>realpath</code></li></ul><p>同时，安装必需的 PHP （&lt;8.2）扩展：</p><div class="tag-plugin colorful folders" ><details class="folder" index="0"><summary><span>折叠啦</span></summary><div class="body"><ul><li>OpenSSL &gt;= 1.1.1 (TLS 1.3)</li><li>PDO</li><li>Mbstring</li><li>Tokenizer</li><li>GD</li><li>XML</li><li>Ctype</li><li>JSON</li><li>fileinfo</li><li>zip</li></ul></div></details></div><h4 id="本体"><a class="markdownIt-Anchor" href="#本体"></a> 本体</h4><p>从<a href="https://github.com/bs-community/blessing-skin-server/releases">Releases</a>下载程序包并解压，设置<code>运行目录</code>为<code>/public</code>，或在配置文件里设置<code>root /&#123;yourwebsitespath&#125;/public;</code></p><p>设置伪静态：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">      <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$query_string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若开启了防跨站安全设置需关闭</p><h4 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h4><p>配置完伪静态后，直接访问对应的域名就能跳转到安装页面了，在完成基本的安装后，在插件市场里安装<code>Yggdrasil API</code>并启用</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a07c0d161d.png?fmt=avif" alt="image-20240719142918745" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719142918745" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a07c0d161d.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719142918745</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a07d69727e.png?fmt=avif" alt="image-20240719142941137" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719142941137" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a07d69727e.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719142941137</span></div></div><p>最后可以尝试访问<code>//&#123;yourwebsites&#125;/api/yggdrasil</code>看看有无类似以下输出</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a085710b06.png?fmt=avif" alt="image-20240719143149605" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719143149605" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a085710b06.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719143149605</span></div></div><h4 id="扩展"><a class="markdownIt-Anchor" href="#扩展"></a> 扩展</h4><p>为更方便的管理玩家，可以在安装邀请码插件来避免多次/外部人员注册</p><h4 id="常见问题"><a class="markdownIt-Anchor" href="#常见问题"></a> 常见问题</h4><ol><li><p>图片无法显示/页面混乱</p><p>请检查你的 Nginx 规则配置中是否有这类控制浏览器缓存的规则，删除即可：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ .*\.(gif|jpg|jpeg|png|bmp|swf|flv|ico)$</span> &#123;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">30d</span>;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>插件市场无法使用</p><p>在<code>.env</code>里添加<code>PLUGINS_REGISTRY=https://d2jw1l0ullrzt6.cloudfront.net/registry_&#123;lang&#125;.json</code></p></li><li><p>验证邮箱地址报403 Forbidden，无效的链接：参阅<a href="https://github.com/bs-community/blessing-skin-server/issues/636">验证邮箱地址报403 Forbidden，无效的链接</a></p></li><li><p>报错：<code>Lcobucci\JWT\Signer\Key\InMemory::plainText(): Argument #1 ($contents) must #21 10.08 be of type string, null given</code>：</p><p>在<code>.env</code>里添加<code>JWT_SECRET=...</code>值与<code>APP_KEY</code>一致</p></li></ol><h3 id="游戏服务端"><a class="markdownIt-Anchor" href="#游戏服务端"></a> 游戏服务端</h3><p>这是原本的游玩路径</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a0b070bc7f.png?fmt=avif" alt="image-20240719144316520" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719144316520" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a0b070bc7f.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719144316520</span></div></div><p>可见有一些不足：玩家每一次登录都要敲密码，新玩家还要手动加白名单，但使用了外置登陆后这些都可以丢掉了。<code>authlib-injector</code>通过“劫持”官方的正版验证接口，实现了一种特殊的认证，与正版无异。只需要一个账户就可以畅玩服务器。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a0c508209b.png?fmt=avif" alt="image-20240719144846911" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719144846911" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a0c508209b.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719144846911</span></div></div><h4 id="游戏服务端-2"><a class="markdownIt-Anchor" href="#游戏服务端-2"></a> 游戏服务端</h4><p>下载<a href="https://authlib-injector.yushi.moe/">authlib-injector</a>到服务端同级目录</p><p>在启动命令的<code>-jar</code>参数前加上<code>-javaagent:authlib-injector-1.xx.xx.jar=https://&#123;yourwebsites&#125;/api/yggdrasil</code>，注意更改版本号和网站为对应的</p><p>由于是“劫持”官方的正版验证接口，还需要开启正版验证（<code>online-mode</code>设置为<code>true</code>）</p><p>尝试启动看看日志输出类似文本即可</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a0e8284223.png?fmt=avif" alt="image-20240719145808855" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719145808855" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a0e8284223.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719145808855</span></div></div><p>尝试连接吧~</p><h4 id="常见问题-2"><a class="markdownIt-Anchor" href="#常见问题-2"></a> 常见问题</h4><ol><li>无效对话：设置<code>prevent-proxy-connections = false</code></li><li>无法使用游戏内聊天，由于个人信息公钥丢失，聊天已被禁用。请尝试重新连接：设置<code>enforce-secure-profile=false</code></li><li>无法验证玩家用户名：检查皮肤站是否正常运行，在<code>.env</code>中打开调试模式（APP_DEBUG），检查<code>./storage/logs</code>中的日志内容</li></ol><h4 id="geyser"><a class="markdownIt-Anchor" href="#geyser"></a> Geyser</h4><p>由于是“劫持”官方的正版验证接口（梅花三弄），对于独立版同样需要外挂<code>authlib-injector</code>，</p><p>只需要找到对应的下载下来，参考游戏服务端的运行方式就可以了…吗？</p><p>在高版本的Geyser中，已经<a href="https://github.com/GeyserMC/Geyser/commit/7983448ce637656db1fca95eb65344a8c6d90de3">移除了Mojang账户的登录接口</a>，很不巧的是这里就要用到它，所以你还要把它加回来。</p><blockquote><p>如果只需要最新版看这里就好：<a href="https://github.com/Shanwer/Geyser">Shanwer/Geyser</a></p></blockquote><ol><li><p>fork <a href="https://github.com/GeyserMC/Geyser">Geyser</a> 到自己账号，再clone到本地</p></li><li><p>因为我的服务器版本不是最新的，还要找到适合的版本，可以在<a href="https://github.com/GeyserMC/Geyser/commits/master/core/src/main/java/org/geysermc/geyser/network/GameProtocol.java">GameProtocol.java</a>里面找，如我要编译适合1.20.1的版本，先找到drop掉的前一个commit，复制commit id</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a15cc38e84.png?fmt=avif" alt="image-20240719152914544" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719152914544" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a15cc38e84.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719152914544</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a15eddee91.png?fmt=avif" alt="image-20240719152948254" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719152948254" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a15eddee91.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719152948254</span></div></div></li><li><p>执行 <div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_8" value="git checkout {CommitId}"><button class="copy-btn" onclick="util.copy(&quot;copy_8&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div>切换到对应版本，新建一个分支，如<code>build</code></p><div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_9" value="git checkout -b build"><button class="copy-btn" onclick="util.copy(&quot;copy_9&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></li><li><p>参考<a href="https://github.com/thun888/Geyser/pull/1/files">这里</a>来进行修改代码，修改完毕后推送到新分支</p><blockquote><p>本地化处理：</p><p>原仓库对于外置登录做了些文本上的调整，运行以下命令切换</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">rm</span> --cached <span class="string">&quot;core/src/main/resources/languages&quot;</span></span><br><span class="line">git submodule add https://github.com/Silverteal/geyser-languages-for-custom-yggdrasil.git core/src/main/resources/languages</span><br></pre></td></tr></table></figure></blockquote><div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_10" value="git push --set-upstream origin build"><button class="copy-btn" onclick="util.copy(&quot;copy_10&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></li><li><p>随后启用action并在action选择对应的分支构建</p></li></ol><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a174387943.png?fmt=avif" alt="image-20240719153529593" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240719153529593" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a174387943.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240719153529593</span></div></div><ol start="6"><li><p>在构建完成后下载（我这里是独立版，插件版操作类似</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669b1140da0bb.png?fmt=avif" alt="在action页面里找到刚刚完成的构建" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="在action页面里找到刚刚完成的构建" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669b1140da0bb.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">在action页面里找到刚刚完成的构建</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a198d353ed.png?fmt=avif" alt="下载到本地" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="下载到本地" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a198d353ed.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">下载到本地</span></div></div></li><li><p>运行并调整配置即可</p></li></ol><h4 id="常见问题-3"><a class="markdownIt-Anchor" href="#常见问题-3"></a> 常见问题</h4><ol><li>此服务器需要一个付费的Java账号：因为 Geyser 本身的问题，无法使用有多角色的外置登录解决方案，也就是说皮肤站内有多个角色时无法登录</li></ol><h2 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h2><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669a29db14036.png?fmt=avif" alt="皮肤共通" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="皮肤共通" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669a29db14036.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">皮肤共通</span></div></div><h2 id="后"><a class="markdownIt-Anchor" href="#后"></a> 后</h2><p>一天啊，总算整好了~</p><p>文章看起来顺风顺水的，天都不知道我试多少条破路<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsadreach.png"/></span></p>]]></content>
    
    
    <summary type="html">我服务器是离线登录的，一直以来都是本地打mod来实现显示皮肤。昨天有人折腾了半天，仔细想想要不整个外置登录吧，然后一步一个坑，记录一下。</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="MC" scheme="https://blog.hzchu.top/tags/MC/"/>
    
  </entry>
  
  <entry>
    <title>火绒6.0似乎不太适合开发人员使用——记一次离奇的git错误</title>
    <link href="https://blog.hzchu.top/2024/%E7%81%AB%E7%BB%926-0%E4%BC%BC%E4%B9%8E%E6%9C%89%E4%B8%80%E5%AE%9A%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/"/>
    <id>https://blog.hzchu.top/2024/%E7%81%AB%E7%BB%926-0%E4%BC%BC%E4%B9%8E%E6%9C%89%E4%B8%80%E5%AE%9A%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/</id>
    <published>2024-07-16T22:36:25.000Z</published>
    <updated>2024-07-16T22:36:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="如题何出此言"><a class="markdownIt-Anchor" href="#如题何出此言"></a> 如题，何出此言？</h2><p>早上我看了篇文章，讲电脑中了毛制病毒痛失数百，我一寻思我电脑上的火绒5报错已经好久了，索性直接升到最新版，看看怎么样。</p><p>然后啪的一下就发现事情不对劲了，在许多使用场景下，系统显著卡顿。如<u>打开浏览器卡顿数秒，打开vscode终端要差不多10秒才加载的出来</u>。</p><p>欸，又不是不能用，凑合着用吧<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcoffee.png"/></span></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669687380e66e.webp?fmt=avif" alt="罗老师" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="罗老师" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669687380e66e.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">罗老师</span></div></div><p>忙完事了去整别的，回来再开电脑时，发现<u>开机都慢了差不多5秒的样子，进桌面哐哐报错</u></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/6696879c51e94.png?fmt=avif" alt="Snipaste" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste" href="https://onep.hzchu.top/mount/pic/myself/2024/07/6696879c51e94.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669687a5395f1.png?fmt=avif" alt="v2" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="v2" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669687a5395f1.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">v2</span></div></div><p>没事，手动搞一下还是能用，然后<u>连git都用不了</u>（<mark class="tag-plugin colorful mark" color="orange">error launching git:</mark> ），这下我真我绷不住了，先是试了一下重装git，结果没卵用</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669687bae2c2c.png?fmt=avif" alt="Snipaste_2024-07-16_22-29-37" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-07-16_22-29-37" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669687bae2c2c.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-07-16_22-29-37</span></div></div><p>关了火绒以后立竿见影</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669687cd5665f.png?fmt=avif" alt="Snipaste_2024-07-16_22-30-46" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-07-16_22-30-46" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669687cd5665f.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-07-16_22-30-46</span></div></div><h2 id="再见"><a class="markdownIt-Anchor" href="#再见"></a> 再见</h2><p>也许对于大部分办公人士来讲又没广告又省心，但对我来说纯粹就是个花瓶<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatfacepalm.png"/></span>（别说，这卸装页面有点WIN11安装的味道</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/669688a30612c.png?fmt=avif" alt="byebye" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="byebye" href="https://onep.hzchu.top/mount/pic/myself/2024/07/669688a30612c.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">byebye</span></div></div><p>当然，关掉某些保护后可能会正常很多吧，但看在平时的性能影响上我也不敢用了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/cdn-x/emoji/aru-l/7080.gif"/></span></p>]]></content>
    
    
    <summary type="html">从兴奋安装到提桶跑路</summary>
    
    
    
    <category term="瞎折腾" scheme="https://blog.hzchu.top/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="火绒" scheme="https://blog.hzchu.top/tags/%E7%81%AB%E7%BB%92/"/>
    
  </entry>
  
  <entry>
    <title>搭建一个可记录使用量的谷歌翻译反代网站</title>
    <link href="https://blog.hzchu.top/2024/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8F%AF%E8%AE%B0%E5%BD%95%E4%BD%BF%E7%94%A8%E9%87%8F%E7%9A%84%E8%B0%B7%E6%AD%8C%E7%BF%BB%E8%AF%91%E5%8F%8D%E4%BB%A3%E7%BD%91%E7%AB%99/"/>
    <id>https://blog.hzchu.top/2024/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8F%AF%E8%AE%B0%E5%BD%95%E4%BD%BF%E7%94%A8%E9%87%8F%E7%9A%84%E8%B0%B7%E6%AD%8C%E7%BF%BB%E8%AF%91%E5%8F%8D%E4%BB%A3%E7%BD%91%E7%AB%99/</id>
    <published>2024-07-11T20:02:05.000Z</published>
    <updated>2024-07-11T20:02:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>之前有一台闲置的服务器，刚好又在b站上刷到了谷歌生草机，一时心血来潮整了个反代。但为了减少潜在的滥用情况，我后来用flask写了一个中继，一直以来运行良好（刨掉因服务器自身问题boom的）。但目前谷歌生草机已经集成了对于谷歌翻译的IP优选功能，并移除了镜像网站的相关配置<del>（就算你想用都用不了咯）</del>，加上该服务器已经过期，现决定关闭此服务，节约资源。</p><p>以下是本站的部署方法，如果有需要可以自己部署玩玩（虽然自用直接nginx反代就完事了</p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/gt-proxy"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=gt-proxy&&show_owner=true"/></a></div><h2 id="init"><a class="markdownIt-Anchor" href="#init"></a> Init</h2><ol><li><p>clone仓库到本地</p><div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_6" value="git clone https://github.com/thun888/gt-proxy.git"><button class="copy-btn" onclick="util.copy(&quot;copy_6&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></li><li><p>运行<code>main.py</code></p></li><li><p>根据报错安装相关依赖，缺啥装啥（懒得导<code>requirements.txt</code><span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcomfy.png"/></span></p><blockquote><p>安装<code>ipdb</code>使用<div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_7" value="pip install ipip-ipdb"><button class="copy-btn" onclick="util.copy(&quot;copy_7&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></p></blockquote></li><li><p>导入<code>sql</code>文件到数据库中</p></li><li><p>进入<code>main.py</code>中修改程序配置（包括数据库连接配置及<code>turnstile</code>配置）</p></li><li><p>配置cookies：使用<code>Cookie Editor</code>导出，存储到同目录下<code>cookies.json</code>里</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/668fdc1c1571b.png?fmt=avif" alt="image-20240711212026907" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240711212026907" href="https://onep.hzchu.top/mount/pic/myself/2024/07/668fdc1c1571b.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240711212026907</span></div></div></li><li><p>enjoy it!<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/ablobcatrainbow.png"/></span></p></li></ol><h2 id="photo"><a class="markdownIt-Anchor" href="#photo"></a> photo</h2><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/668fdcb035983.png?fmt=avif" alt="image-20240711212254995" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240711212254995" href="https://onep.hzchu.top/mount/pic/myself/2024/07/668fdcb035983.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240711212254995</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/668fdcee3126e.png?fmt=avif" alt="image-20240711212356924" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240711212356924" href="https://onep.hzchu.top/mount/pic/myself/2024/07/668fdcee3126e.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240711212356924</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/668fdce2378a9.png?fmt=avif" alt="image-20240711212344936" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20240711212344936" href="https://onep.hzchu.top/mount/pic/myself/2024/07/668fdce2378a9.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20240711212344936</span></div></div><h2 id="不足"><a class="markdownIt-Anchor" href="#不足"></a> 不足</h2><p>设计之初是运行在一台闲置的服务器上的，没有性能制约，优化方面确实是能跑就行，每一次请求会多次读/写数据库，如果想要改进势必得在内存缓存一下<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatbox.png"/></span></p>]]></content>
    
    
    <summary type="html">关掉gt.hzchu.top后，总不能把这些东西“烂”在库里吧</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="python" scheme="https://blog.hzchu.top/tags/python/"/>
    
    <category term="web" scheme="https://blog.hzchu.top/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>对博客来一场“复习提纲式”的打印优化</title>
    <link href="https://blog.hzchu.top/2024/%E5%AF%B9%E5%8D%9A%E5%AE%A2%E6%9D%A5%E4%B8%80%E5%9C%BA%E2%80%9C%E5%A4%8D%E4%B9%A0%E6%8F%90%E7%BA%B2%E5%BC%8F%E2%80%9D%E7%9A%84%E6%89%93%E5%8D%B0%E4%BC%98%E5%8C%96/"/>
    <id>https://blog.hzchu.top/2024/%E5%AF%B9%E5%8D%9A%E5%AE%A2%E6%9D%A5%E4%B8%80%E5%9C%BA%E2%80%9C%E5%A4%8D%E4%B9%A0%E6%8F%90%E7%BA%B2%E5%BC%8F%E2%80%9D%E7%9A%84%E6%89%93%E5%8D%B0%E4%BC%98%E5%8C%96/</id>
    <published>2024-06-29T19:06:13.000Z</published>
    <updated>2024-06-29T19:37:13.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>虽然说过暂时不写技术类的文章，不过嘛Stellar针对打印样式<psw>完全没有优化</psw>，无论纵向还是横向都是相当炸裂，只能再研究下了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatthink.png"/></span></p><p>不过话说回来，最近几次文章其实都是围绕编写笔记而写的，再加一篇吧<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatmeltthumb.png"/></span></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/667feaec4d622.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/667feaec4d622.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/667feaf21561f.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/667feaf21561f.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><h2 id="方法"><a class="markdownIt-Anchor" href="#方法"></a> 方法</h2><p>使用<code>@media print</code> 媒体查询调整css样式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> print &#123;</span><br><span class="line">  <span class="comment">/* 隐藏元素 */</span></span><br><span class="line">  <span class="selector-class">.l_left</span>,</span><br><span class="line">  <span class="selector-class">.l_right</span>,</span><br><span class="line">  <span class="selector-class">.top</span><span class="selector-class">.bread-nav</span><span class="selector-class">.footnote</span>,</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#read-next</span>,</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#post-ai</span>,</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#related-posts</span>,</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#comments</span>,</span><br><span class="line">  <span class="selector-tag">section</span><span class="selector-id">#license</span>,</span><br><span class="line">  <span class="selector-tag">section</span><span class="selector-id">#share</span>,</span><br><span class="line">  <span class="selector-tag">footer</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.md-text</span> psw &#123;</span><br><span class="line">    <span class="attribute">color</span>: unset;</span><br><span class="line">    <span class="attribute">background</span>: unset;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">3px</span> dashed <span class="number">#ccc</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 隐藏锚点 */</span></span><br><span class="line">  <span class="selector-class">.markdownIt-Anchor</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none; <span class="comment">/* 隐藏原始链接内容 */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 修改背景和边框 */</span></span><br><span class="line">  <span class="selector-class">.article</span><span class="selector-class">.banner</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: none;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> dashed <span class="number">#ccc</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 调整边框圆角和内边距 */</span></span><br><span class="line">  <span class="selector-class">.banner</span>,</span><br><span class="line">  <span class="selector-class">.banner</span><span class="selector-class">.top</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.banner</span> <span class="selector-class">.bottom</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 取消grid布局 */</span></span><br><span class="line">  <span class="selector-id">#start</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: unset;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 调整字的上下边距 */</span></span><br><span class="line">  <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 调整标题的上外边距 */</span></span><br><span class="line">  <span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>, <span class="selector-tag">h6</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 限制图片高度 */</span></span><br><span class="line">  <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">max-height</span>: <span class="number">100vh</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="成果"><a class="markdownIt-Anchor" href="#成果"></a> 成果</h2><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/667ff2cf8ebd8.png?fmt=avif" alt="同时使用了故事类文章类型" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="同时使用了故事类文章类型" href="https://onep.hzchu.top/mount/pic/myself/2024/06/667ff2cf8ebd8.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">同时使用了故事类文章类型</span></div></div><blockquote><p>对于某些影响打印后阅读的标签没有更多更改，毕竟我写笔记只需要从源头遏制住，不使用这些标签就行了（￣︶￣）↗</p></blockquote>]]></content>
    
    
    <summary type="html">创建一个打印友好型的提纲</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="Blog" scheme="https://blog.hzchu.top/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>关于论坛上出现广告言论的解释</title>
    <link href="https://blog.hzchu.top/2024/%E5%85%B3%E4%BA%8E%E8%AE%BA%E5%9D%9B%E4%B8%8A%E5%87%BA%E7%8E%B0%E5%B9%BF%E5%91%8A%E8%A8%80%E8%AE%BA%E7%9A%84%E8%A7%A3%E9%87%8A/"/>
    <id>https://blog.hzchu.top/2024/%E5%85%B3%E4%BA%8E%E8%AE%BA%E5%9D%9B%E4%B8%8A%E5%87%BA%E7%8E%B0%E5%B9%BF%E5%91%8A%E8%A8%80%E8%AE%BA%E7%9A%84%E8%A7%A3%E9%87%8A/</id>
    <published>2024-06-10T08:26:14.000Z</published>
    <updated>2024-06-10T08:26:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>前几天我在学校无意中看了看电报，发现有人找我买v2ex激活码啊。我当时就懵逼了，然后看他发了一个<code>nodeseek</code>的截图过来。我登上账号一看，好家伙，还真的有啊。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664a7d6109b.png?fmt=avif" data-fancybox="true"/></div></div><p><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664f367d41f.png" alt="image-20240610085621544" /></p><p>结合之前有人在电报上找我买rn来着，这…肯定是被哪个混账给盗了号<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcry.png"/></span>。回溯到几个月前，不小心在<code>crackskit.com</code>上下了个软件，结果…就是个病毒，不仅挖矿，应该还能读取浏览器内保存的账号密码，我当时是星期天下的，我回学校没过几天看着我邮箱里面一大堆登录提醒啊，我真的是…。一直以来也改了不少密码，<strong>但是对于有些没有邮件通知的平台没有更改，毕竟太多了</strong></p><div class="tag-plugin gallery grid-box" size="mix" ratio="square"><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664cea83107.png" alt="image-20240610084633370"/><div class="image-meta"><span class="image-caption">image-20240610084633370</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664cf657c67.png" alt="image-20240610084645355"/><div class="image-meta"><span class="image-caption">image-20240610084645355</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664d05005d7.png" alt="image-20240610084659725"/><div class="image-meta"><span class="image-caption">image-20240610084659725</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664d0d9364c.png" alt="image-20240610084708465"/><div class="image-meta"><span class="image-caption">image-20240610084708465</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664d179bd04.png" alt="image-20240610084718780"/><div class="image-meta"><span class="image-caption">image-20240610084718780</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664d204e6e7.png" alt="image-20240610084727231"/><div class="image-meta"><span class="image-caption">image-20240610084727231</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664d2e73575.png" alt="image-20240610084741417"/><div class="image-meta"><span class="image-caption">image-20240610084741417</span></div></div></div><blockquote><p>2024/02/24记于<code>notes.hzchu.top</code></p></blockquote><p>现在看来，背后应该也是个中国人。这世道，中国人专坑中国人<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsaitama.png"/></span>。联系管理停用了，存档作证据</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664dbec0dfc.png?fmt=avif" alt="我的号啊" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">我的号啊</span></div></div><p>ip：</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66664e19a86b3.png?fmt=avif" alt="广西佬" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">广西佬</span></div></div><p>总而言之，我自己都用着别人家的服务器，我一个脆皮高中生还跑去卖服务器了？<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/cdn-x/emoji/aru/162.png"/></span>我看他发帖/评论比我在家里这么多年都多，效率真高。<strong>只能说希望大家明辨是非</strong>，如果发生金钱纠纷，那我也没办法<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatfacepalm.png"/></span></p>]]></content>
    
    
    <summary type="html">被盗号了</summary>
    
    
    
    <category term="生活小事" scheme="https://blog.hzchu.top/categories/%E7%94%9F%E6%B4%BB%E5%B0%8F%E4%BA%8B/"/>
    
    
    <category term="公告" scheme="https://blog.hzchu.top/tags/%E5%85%AC%E5%91%8A/"/>
    
  </entry>
  
  <entry>
    <title>过去与未来</title>
    <link href="https://blog.hzchu.top/2024/%E8%BF%87%E5%8E%BB%E4%B8%8E%E6%9C%AA%E6%9D%A5/"/>
    <id>https://blog.hzchu.top/2024/%E8%BF%87%E5%8E%BB%E4%B8%8E%E6%9C%AA%E6%9D%A5/</id>
    <published>2024-06-09T21:03:23.000Z</published>
    <updated>2024-06-09T21:03:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="话"><a class="markdownIt-Anchor" href="#话"></a> 话</h2><p><strong>春去秋来，寒去暑至</strong>。不经意间24年已悄然过半，今天，今年的高考结束了，我也彻底是个准高三学生了。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsipsweat.png"/></span></p><p>回望过去，22年，我参加的应该是广东省上史上数学最简单的中考，好像语文也有新题型，<del>着实为难我这个语文拉胯的数学一哥了。</del><span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatflip.png"/></span>不过因为和学校签了就读高中部的合约，干脆直接开摆，考试那几天晚上各种玩，终于三分之差错失一中线。现在想想还有点后悔，不过也无所谓了。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcomfy.png"/></span></p><p>上了高中，高一倒也没什么，因为实行月休，每个星期也就是在北大楼看着初/小学部放假回家，加上新来的校长们个个带着湖北特产，<strong>抓教育教学，提升办学质量</strong>，这破生活实在是够无聊的。带了部小相机，开始了我的摆烂生活，然后嘛，因为摆的太狠，被分到了第二层次的班。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsadreach.png"/></span><del>唉，这小事小事继续摆。</del><span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatt.png"/></span>总而言之，高一还是蛮充实的嘛。</p><p>高二倒也没什么，上学期组建了「峰间云海」，写了「MRUI」。下学期写了点小东西，算是为社区做点贡献，然后还考了个「云学考」，帮了半个班的人考过体育（15米折返跑）和信息技术，好像倒也没什么了。不对，怎么越写越压抑啊？<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatflip.png"/></span>情感有正有负，正向的更多是父母，老师同学之间的，不过生活琐事也展开不了，学校也没什么活动，只能在文中留空了。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatflower.png"/></span></p><details class="tag-plugin colorful folding" ><summary><span>云学考</span></summary><div class="body"><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/lfiles/IMG_20240609_0001.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/lfiles/IMG_20240609_0001.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/lfiles/IMG_20240609_0002.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/lfiles/IMG_20240609_0002.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div></div></details><p><strong>立足当下</strong>，前不久，我们结束了5月月考，年级有个20名吧，这几次考试考的还行，一方面同学的翻译笔充电的时候被收了，没法嫖笔看小说了。另一方面下学期要分班，总不能考太差吧<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatfacepalm.png"/></span>，按目前的情况在第一层次班应该没什么问题。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatbox.png"/></span></p><p><strong>放眼未来</strong>，上一届的学长们已然跃过了龙门，明年的我能跌过哪条杠仍是一个未知数，抛开试卷难度不谈，现在上个915，211还是ok的，不过好不好这是另外一回事了，广东省内有不少名校，像哈工大，华工，中大，浅浅定个目标：<psw>AjoLBwo/ADICAzY7CwYKAwE0BBw+Aw8iAyoAAg8sDyw3DRMyAxYcCSA2AwYyAAgJAzE6Dx0/DwUkDA4gAQUJDB4K2Yq0CSgyARQtARIaAwENATcCDA4Z04+jASgsAAAAAx4UAhYnAxYAAxc+ XOR</psw></p><h2 id="行"><a class="markdownIt-Anchor" href="#行"></a> 行</h2><p><strong>一些调整</strong>：</p><ol><li>暂停所有的开发活动</li><li>非特殊情况，暂停对所有服务的维护(难绷，刚说完服务器nginx配置被篡改了，好像是宝塔的漏洞<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsaitama.png"/></span>)</li><li>对于一些评论/issues中的技术性问题，如果短时间内无法解决那只能委屈一下了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatpeekaboo.png"/></span></li><li>以后可能会写点生活类文章吧</li></ol><p><strong>关于自己：</strong></p><ol><li>在放假时间要巩固复习，练习英语听说</li><li>加强锻炼</li><li>戒掉一些不良习惯</li></ol><p>简单来说，要把更多时间投入到学习中，补上我之前摆烂欠下的风流债<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatnotlikethis.png"/></span></p><h2 id="后"><a class="markdownIt-Anchor" href="#后"></a> 后</h2><p>本文写于24/6/3-5，于9号修订完毕。本来想拍个蓝天白云作头图的，没想到连着下了几天的雨<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsadreach.png"/></span>，只能拿出去年在金沙湾拍的图了。</p><p>祝今年学长学姐们考个好成绩，也祝我自己明年给高中生涯画上一个完美的句号，大家有缘再见。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatheart.png"/></span></p>]]></content>
    
    
    <summary type="html">对过去三年的总结和对未来的规划</summary>
    
    
    
    <category term="生活小事" scheme="https://blog.hzchu.top/categories/%E7%94%9F%E6%B4%BB%E5%B0%8F%E4%BA%8B/"/>
    
    
    <category term="yearreport" scheme="https://blog.hzchu.top/tags/yearreport/"/>
    
  </entry>
  
  <entry>
    <title>一键检查我的世界MOD共有版本，快速构建整合包</title>
    <link href="https://blog.hzchu.top/2024/%E4%B8%80%E9%94%AE%E6%A3%80%E6%9F%A5%E6%88%91%E7%9A%84%E4%B8%96%E7%95%8Cmod%E5%85%B1%E6%9C%89%E7%89%88%E6%9C%AC%EF%BC%8C%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E6%95%B4%E5%90%88%E5%8C%85/"/>
    <id>https://blog.hzchu.top/2024/%E4%B8%80%E9%94%AE%E6%A3%80%E6%9F%A5%E6%88%91%E7%9A%84%E4%B8%96%E7%95%8Cmod%E5%85%B1%E6%9C%89%E7%89%88%E6%9C%AC%EF%BC%8C%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E6%95%B4%E5%90%88%E5%8C%85/</id>
    <published>2024-06-09T12:22:53.000Z</published>
    <updated>2024-06-09T12:22:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="起因"><a class="markdownIt-Anchor" href="#起因"></a> 起因</h2><p>之前看了下我的世界版本已经更新到1.20.6，自己服务器还在1.20.1，遂写一物查看能否更新<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatt.png"/></span></p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/check_mc_mods_update"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=check_mc_mods_update&&show_owner=true"/></a></div>    <div class="tag-plugin ds-coding" id="coding-e8ixvdoye"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-e8ixvdoye' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-e8ixvdoye');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fcheck_mc_mods_update%2Fmain%2Fmain.py&lang=python&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-e8ixvdoye');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        <h2 id="使用方法"><a class="markdownIt-Anchor" href="#使用方法"></a> 使用方法</h2><p><strong>配置文件</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">modrinth:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tabtps</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">easyauth</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Debugify</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">carpet</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">......</span> <span class="comment"># 一行一个名称，须在modrinth里面找，进入mod页面后在链接中截取</span></span><br><span class="line"></span><br><span class="line"><span class="attr">curseforge:</span></span><br><span class="line">  <span class="attr">smoothchunk:</span> <span class="number">582327</span></span><br><span class="line">  <span class="attr">chunksending-fabric:</span> <span class="number">831663</span> </span><br><span class="line">  <span class="string">......</span> <span class="comment"># curseforge 通过id获取，需要进入mod页面后在页面右侧获取。为提高辨识度，采用kv形式</span></span><br><span class="line"><span class="attr">special:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">github.com/MCTeamPotato/MCMOD</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">commandspy</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">......</span> <span class="comment"># 特殊类，起到提示作用</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">curseforgeApiKey:</span> <span class="string">$2a****************************************************Kv6sq</span></span><br><span class="line">  <span class="attr">showAlpha:</span> <span class="literal">true</span> <span class="comment">#匹配测试版本 </span></span><br></pre></td></tr></table></figure><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/6665313f438d6.png?fmt=avif" alt="获取Modrinth项目名" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="获取Modrinth项目名" href="https://onep.hzchu.top/mount/pic/myself/2024/06/6665313f438d6.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">获取Modrinth项目名</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/6665312991e6a.png?fmt=avif" alt="获取Curseforge项目ID" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="获取Curseforge项目ID" href="https://onep.hzchu.top/mount/pic/myself/2024/06/6665312991e6a.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">获取Curseforge项目ID</span></div></div><p>获取CurseforgeApiKey：<a href="https://console.curseforge.com/?#/api-keys">CurseForge for Studios</a></p><p>配置完成后运行py文件即可</p><h2 id="输出"><a class="markdownIt-Anchor" href="#输出"></a> 输出</h2><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/666532128d166.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/666532128d166.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>好好好，一个没有<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/cdn-x/emoji/aru-l/0171.gif"/></span></p><h2 id="不足"><a class="markdownIt-Anchor" href="#不足"></a> 不足</h2><ol><li>部分mod不规范，可能出现误判</li><li>Curseforge无法获取支持的所有版本，只能获取最近的版本，可能出现误判</li><li>不支持下载，<psw>我k我当时写完一运行直接沉默了，直接摆了</psw></li><li>对于某个mod不支持时无法定位。可以添加输入期望版本然后输出不支持的mod</li></ol>]]></content>
    
    
    <summary type="html">从Modrinth和Curseforge获取mod版本，取交集查看共有版本</summary>
    
    
    
    <category term="瞎折腾" scheme="https://blog.hzchu.top/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="python" scheme="https://blog.hzchu.top/tags/python/"/>
    
    <category term="MC" scheme="https://blog.hzchu.top/tags/MC/"/>
    
  </entry>
  
  <entry>
    <title>Go中使用ImageMagick转换图片格式，实现全站图片“Avif”</title>
    <link href="https://blog.hzchu.top/2024/Go%E4%B8%AD%E4%BD%BF%E7%94%A8ImageMagick%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%85%A8%E7%AB%99%E5%9B%BE%E7%89%87Avif/"/>
    <id>https://blog.hzchu.top/2024/Go%E4%B8%AD%E4%BD%BF%E7%94%A8ImageMagick%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%85%A8%E7%AB%99%E5%9B%BE%E7%89%87Avif/</id>
    <published>2024-06-08T13:58:16.000Z</published>
    <updated>2024-06-08T13:58:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>前几天不经意间看了<a href="https://blog.zhheo.com/p/6a933575.html">实现全站图片使用avif格式，替代臃肿的webp教程 | 张洪Heo (zhheo.com)</a>，才发现现在BiliBili全部是avif格式的图片了</p><p>我：<div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/6663fa70369ee.jpg?fmt=avif" data-fancybox="true"/></div></div></p><p>哇，这压缩率真的炸裂。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatyandere.png"/></span></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/6664331d1bd30.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/6664331d1bd30.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>如今，各大浏览器基本都支持avif图像格式了，可以考虑一下跟上时代的步伐了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatbox.png"/></span></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/6664289b4a3b0.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/6664289b4a3b0.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>在开始之前，先看看目前的图片上传&amp;用户访问路径</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66642e26bf612.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66642e26bf612.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p><strong>可见有三个问题</strong>：</p><ol><li><code>lsky pro </code> <strong>不支持</strong>avif格式，使用avif无法与之前的框架完美契合</li><li>当用户的浏览器不支持webp格式时，无法查看图片<del>（包劝退的</del></li><li>对于已上传的图片无法平滑过渡</li></ol><p>因此，不如将转换格式的任务交由节点处理，保存图片源文件，随用随转<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcoffee.png"/></span></p><h2 id="思路"><a class="markdownIt-Anchor" href="#思路"></a> 思路</h2><p>我站图片存储的架构可参考<a href="https://blog.hzchu.top/2023/photoononedrive/">基于Onedrive的高可用性图床</a>，不过因为我后来装依赖装吐了遂用go重写了整个程序。因此，我要面临的问题是，我要怎么在go中完成图片格式的转换？<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatthink.png"/></span></p><p>为了偷懒，我直接用Imagick了，反正它发行了apt软件包，安装也不费事<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatbox.png"/></span></p><ul><li>为与外部Imagick交互，我使用了<a href="https://github.com/gographics/imagick">gographics/imagick</a>库来处理</li><li>为与之前的程序兼容，我打算在「返回本地文件」处做文章</li></ul><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/666432881daf3.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/666432881daf3.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><h2 id="完善程序"><a class="markdownIt-Anchor" href="#完善程序"></a> 完善程序</h2><figure class="highlight go"><figcaption><span>图片转换函数</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TransformImage</span><span class="params">(inputPath <span class="type">string</span>, outputFormat <span class="type">string</span>, quality <span class="type">uint</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"><span class="comment">// logrus.Info(inputPath, outputFormat)</span></span><br><span class="line"><span class="keyword">if</span> outputFormat == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> inputPath, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造新的文件路径</span></span><br><span class="line">    <span class="comment">// 文件命名：原始文件名_质量.格式</span></span><br><span class="line">newPath := filepath.Join(<span class="string">&quot;transformed&quot;</span>, strings.Replace(inputPath, filepath.Ext(inputPath), <span class="string">&quot;_&quot;</span>+strconv.Itoa(<span class="type">int</span>(quality))+<span class="string">&quot;.&quot;</span>+outputFormat, <span class="number">1</span>))</span><br><span class="line">dir := filepath.Dir(newPath)</span><br><span class="line">err := os.MkdirAll(dir, <span class="number">0755</span>)</span><br><span class="line">checkErr(err)</span><br><span class="line"><span class="comment">// 如果文件已经存在，返回现有的路径</span></span><br><span class="line"><span class="keyword">if</span> _, err := os.Stat(newPath); err == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> newPath, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">imagick.Initialize()</span><br><span class="line"><span class="keyword">defer</span> imagick.Terminate()</span><br><span class="line">mw := imagick.NewMagickWand()</span><br><span class="line"><span class="keyword">defer</span> mw.Destroy()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取原始图像</span></span><br><span class="line">err = mw.ReadImage(inputPath)</span><br><span class="line">checkErr(err)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取原始图像的色彩空间和色彩深度</span></span><br><span class="line"><span class="comment">//originalColorspace := mw.GetImageColorspace()</span></span><br><span class="line"><span class="comment">//originalDepth := mw.GetImageDepth()</span></span><br><span class="line"><span class="comment">//logrus.Info(&quot;originalColorspace:&quot;, originalColorspace, &quot;originalDepth:&quot;, originalDepth)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 设置新的格式</span></span><br><span class="line">err = mw.SetImageFormat(outputFormat)</span><br><span class="line">checkErr(err)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在转换格式后，恢复原始图像的色彩空间和色彩深度</span></span><br><span class="line"><span class="comment">// err = mw.SetImageColorspace(originalColorspace)</span></span><br><span class="line"><span class="comment">// checkErr(err)</span></span><br><span class="line"><span class="comment">// err = mw.SetImageDepth(originalDepth)</span></span><br><span class="line"><span class="comment">// checkErr(err)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置图片质量</span></span><br><span class="line">err = mw.SetImageCompressionQuality(quality)</span><br><span class="line">checkErr(err)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入新图像</span></span><br><span class="line">err = mw.WriteImage(newPath)</span><br><span class="line">checkErr(err)</span><br><span class="line"><span class="comment">// logrus.Info(newPath)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> newPath, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tag-plugin colorful note" color="red"><div class="title">注意</div><div class="body"><p>需开启CGO</p></div></div><figure class="highlight go"><figcaption><span>清除缓存函数</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">delCache</span><span class="params">()</span></span> &#123;</span><br><span class="line">tmp_size := getDirectorySize(<span class="string">&quot;tmp&quot;</span>)</span><br><span class="line">transformedtmp_size := getDirectorySize(<span class="string">&quot;transformed&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> tmp_size &gt; <span class="number">5368709120</span> &#123;</span><br><span class="line">clearOldFiles(<span class="string">&quot;tmp&quot;</span>, <span class="number">60</span>)</span><br><span class="line">logrus.Info(<span class="string">&quot;tmp folder cleaned&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> transformedtmp_size &gt; <span class="number">5368709120</span> &#123;</span><br><span class="line">clearOldFiles(<span class="string">&quot;transformed&quot;</span>, <span class="number">30</span>)</span><br><span class="line">logrus.Info(<span class="string">&quot;transformed folder cleaned&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><figcaption><span>主路由函数</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nodeReturnFile</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">fmt := c.Query(<span class="string">&quot;fmt&quot;</span>)</span><br><span class="line">quality, _ := strconv.ParseUint(c.Query(<span class="string">&quot;q&quot;</span>), <span class="number">10</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> quality == <span class="number">0</span> &#123;</span><br><span class="line">quality = <span class="number">95</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">transformedpath, err := TransformImage(cachePath, fmt, <span class="type">uint</span>(quality))</span><br><span class="line">checkErr(err)</span><br><span class="line">extstatus, extype := getContentType(filepath.Ext(transformedpath))</span><br><span class="line"><span class="keyword">if</span> extstatus &#123;</span><br><span class="line">c.Header(<span class="string">&quot;Content-Type&quot;</span>, extype)</span><br><span class="line">&#125;</span><br><span class="line">c.File(transformedpath)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="效果对比"><a class="markdownIt-Anchor" href="#效果对比"></a> 效果对比</h2><p>右下查看源文件</p><div class="tag-plugin grid" bg="card" style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>原图（jpg,3.32MB）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg" alt="压缩比：100%(～￣▽￣)～" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：100%(～￣▽￣)～" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：100%(～￣▽￣)～</span></div></div>    </div>    <div class="cell" style="">    <p><strong>AVIF（185KB,avif时质量参数无效）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=avif" alt="压缩比：5.52%" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：5.52%" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=avif"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：5.52%</span></div></div>    </div>    <div class="cell" style="">    <p><strong>WEBP（925KB,q=95%）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=webp" alt="压缩比：27.26%" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：27.26%" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：27.26%</span></div></div>    </div>    <div class="cell" style="">    <p><strong>WEBP（925KB,q=50%）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=webp&q=50" alt="压缩比：7.28%" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：7.28%" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=webp&q=50"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：7.28%</span></div></div>    </div>    <div class="cell" style="">    <p><strong>HEIF（1.43MB,q=95%）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=heif" alt="压缩比：43.24%" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：43.24%" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=heif"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：43.24%</span></div></div>    </div>    <div class="cell" style="">    <p><strong>HEIF（402KB,q=50%）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=heif&q=50" alt="压缩比：11.86%" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：11.86%" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66640ec45f704.jpg?fmt=heif&q=50"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：11.86%</span></div></div>    </div>    </div><div class="tag-plugin grid" bg="card" style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>原图（WEBP,334KB,q=100%）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/16/64b3d29485703.webp" alt="压缩比：100%(～￣▽￣)～" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：100%(～￣▽￣)～" href="https://onep.hzchu.top/mount/pic/2023/07/16/64b3d29485703.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：100%(～￣▽￣)～</span></div></div>    </div>    <div class="cell" style="">    <p><strong>AVIF（120KB,avif时质量参数无效）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/16/64b3d29485703.webp?fmt=avif" alt="压缩比：36.90%" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：36.90%" href="https://onep.hzchu.top/mount/pic/2023/07/16/64b3d29485703.webp?fmt=avif"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：36.90%</span></div></div>    </div>    <div class="cell" style="">    <p><strong>WEBP（130KB,q=50%）</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/16/64b3d29485703.webp?fmt=webp&q=50" alt="压缩比：39.28%" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="压缩比：39.28%" href="https://onep.hzchu.top/mount/pic/2023/07/16/64b3d29485703.webp?fmt=webp&q=50"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">压缩比：39.28%</span></div></div>    </div>    </div><h2 id="前端处理"><a class="markdownIt-Anchor" href="#前端处理"></a> 前端处理</h2><p>为了照顾不支持avif的浏览器，我打算直接在前端处理，替换为.webp或原始文件</p><figure class="highlight javascript"><figcaption><span>不太漂亮，大佬轻喷</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 从页面中提取第一个AVIF图片链接</span></span><br><span class="line">    <span class="comment">// function getFirstPictureUrl(type) &#123;</span></span><br><span class="line">    <span class="comment">//   const images = document.querySelectorAll(&#x27;img&#x27;);</span></span><br><span class="line">    <span class="comment">//   for (let img of images) &#123;</span></span><br><span class="line">    <span class="comment">//     if (img.getAttribute(&quot;data-src&quot;) &amp;&amp; img.getAttribute(&quot;data-src&quot;).includes(&#x27;fmt=&#x27;,type)) &#123;</span></span><br><span class="line">    <span class="comment">//       return img.getAttribute(&quot;data-src&quot;);</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">//   return null;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 检测浏览器是否支持AVIF格式</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">supportCheck</span>(<span class="params">type, url</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 先从localStorage中获取结果</span></span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;support_&quot;</span> + type);</span><br><span class="line">        <span class="keyword">if</span> (result !== <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="comment">// 如果结果存在，就直接返回</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(type, <span class="string">&quot;support status loaded from localStorage:&quot;</span>, result === <span class="string">&quot;true&quot;</span>);</span><br><span class="line">          <span class="title function_">resolve</span>(result === <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 如果结果不存在，就进行检测</span></span><br><span class="line">          <span class="keyword">const</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">          image.<span class="property">src</span> = url;</span><br><span class="line">          image.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(type, <span class="string">&quot;supported&quot;</span>);</span><br><span class="line">            <span class="comment">// 将结果保存到localStorage</span></span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;support_&quot;</span> + type, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">          &#125;;</span><br><span class="line">          image.<span class="property">onerror</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(type, <span class="string">&quot;not supported&quot;</span>);</span><br><span class="line">            <span class="comment">// 将结果保存到localStorage</span></span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;support_&quot;</span> + type, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">            <span class="comment">// 显示提示消息</span></span><br><span class="line">            hud.<span class="title function_">toast</span>(<span class="string">`当前浏览器不支持使用<span class="subst">$&#123;type&#125;</span>，已降级为使用其他格式`</span>, <span class="number">2500</span>);</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">false</span>);</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 替换图片URL中的avif为webp</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">replacepicture</span>(<span class="params"><span class="keyword">from</span>, to</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> images = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">      images.<span class="title function_">forEach</span>(<span class="function"><span class="params">img</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> attr = img.<span class="property">src</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;data&#x27;</span>) ? <span class="string">&#x27;data-src&#x27;</span> : <span class="string">&#x27;src&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (img.<span class="title function_">getAttribute</span>(attr) &amp;&amp; img.<span class="title function_">getAttribute</span>(attr).<span class="title function_">includes</span>(<span class="string">&#x27;fmt=&#x27;</span> + <span class="keyword">from</span>)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (to == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Replacing &quot;</span>, <span class="keyword">from</span>, <span class="string">&quot; with origin ext for image:&quot;</span>, img.<span class="title function_">getAttribute</span>(attr));</span><br><span class="line">            img.<span class="title function_">setAttribute</span>(attr, img.<span class="title function_">getAttribute</span>(attr).<span class="title function_">replace</span>(<span class="string">&#x27;fmt=&#x27;</span> + <span class="keyword">from</span>, <span class="string">&#x27;&#x27;</span>));</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Replacing &quot;</span>, <span class="keyword">from</span>, <span class="string">&quot; with &quot;</span>, to, <span class="string">&quot; for image:&quot;</span>, img.<span class="title function_">getAttribute</span>(attr));</span><br><span class="line">            img.<span class="title function_">setAttribute</span>(attr, img.<span class="title function_">getAttribute</span>(attr).<span class="title function_">replace</span>(<span class="string">&#x27;fmt=&#x27;</span> + <span class="keyword">from</span>, <span class="string">&#x27;fmt=&#x27;</span> + to));</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> firstAvifUrl = <span class="string">&quot;/img/check/status.avif&quot;</span>; <span class="comment">// 第一个AVIF图片链接</span></span><br><span class="line">    <span class="keyword">if</span> (firstAvifUrl) &#123;</span><br><span class="line">      <span class="comment">// 使用第一个AVIF图片链接进行检测</span></span><br><span class="line">      <span class="title function_">supportCheck</span>(<span class="string">&quot;AVIF&quot;</span>,firstAvifUrl).<span class="title function_">then</span>(<span class="function"><span class="params">supported</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!supported) &#123;</span><br><span class="line">            <span class="title function_">replacepicture</span>(<span class="string">&quot;avif&quot;</span>,<span class="string">&quot;webp&quot;</span>);</span><br><span class="line">            <span class="keyword">const</span> firstWebpUrl = <span class="string">&quot;/img/check/status.webp&quot;</span>; <span class="comment">// 第一个WEBP图片链接</span></span><br><span class="line">            <span class="title function_">supportCheck</span>(<span class="string">&quot;WEBP&quot;</span>,firstWebpUrl).<span class="title function_">then</span>(<span class="function"><span class="params">supported</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!supported) &#123;</span><br><span class="line">                    <span class="comment">// hud.toast(&quot;当前浏览器不支持使用webp，已降级为使用原始图片&quot;, 2500);</span></span><br><span class="line">                    <span class="comment">// replacepicture(&quot;webp&quot;,&quot;&quot;);</span></span><br><span class="line">                    <span class="title function_">replacepicture</span>(<span class="string">&quot;webp&quot;</span>,<span class="string">&quot;png&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Webp images will be used.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;AVIF images will be used.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;No AVIF images found on the page.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>基于<a href="https://blog.zhheo.com/p/6a933575.html">@Heo</a>修改，支持了懒加载及stellar的toast，facybox还有点问题<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatfacepalm.png"/></span></p><h2 id="迁移工作"><a class="markdownIt-Anchor" href="#迁移工作"></a> 迁移工作</h2><p>使用vscode进行正则替换：<code>(https://onep\.hzchu\.top/.*\.webp)</code>，<code>$1?fmt=avif</code></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66652b99e69be.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66652b99e69be.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><h2 id="优缺"><a class="markdownIt-Anchor" href="#优缺"></a> 优缺</h2><h3 id="优点"><a class="markdownIt-Anchor" href="#优点"></a> 优点</h3><ol><li>契合先前架构，对以往图片可以直接迁移</li><li>提升了使用旧设备访客的体验</li><li>配合stellar支持直接查看原图</li><li><del>by the way，因为缤纷云也使用`fmt=*`的格式，故该前端代码也可以作用于缤纷云上的图片</del>大意了，它自己支持自动降级导致程序出错<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatfacepalm.png"/></span></li></ol><h3 id="缺点"><a class="markdownIt-Anchor" href="#缺点"></a> 缺点</h3><ol><li><p>增加存储成本。主要是<wavy>节点端</wavy>（OD可以忽略不计），按目前的来流程一张图片可能会在本地产生多个副本，使<u>存储占用翻几番</u></p></li><li><p>需要外部安装ImageMagick组件，程序不再轻量</p></li><li><p>在转换为avif过程中，部分图片可观测到部分色彩丢失。不过也可以使用webp替代</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66646dd4657ab.png?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66646dd4657ab.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div></li><li><p>缓存命名不具备可复用性。但目前不计划添加任何参数，加上数据量小倒也没影响<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatt.png"/></span></p></li></ol><h2 id="实际测试"><a class="markdownIt-Anchor" href="#实际测试"></a> 实际测试</h2><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66650d94031f6.png?fmt=avif" alt="Safari15.5(thx appetize.io)" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Safari15.5(thx appetize.io)" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66650d94031f6.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Safari15.5(thx appetize.io)</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/06/66651159c2473.png?fmt=avif" alt="Chrome69" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Chrome69" href="https://onep.hzchu.top/mount/pic/myself/2024/06/66651159c2473.png"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Chrome69</span></div></div><p>在旧版本中，程序均能正常运行，但在chrome的旧版本中因stellar的原因无法加载<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsadreach.png"/></span></p><div class="tag-plugin colorful note" color="red"><div class="title">注</div><div class="body"><p>小心<a href="https://github.com/gographics/imagick/issues/136">内存泄漏</a></p></div></div>]]></content>
    
    
    <summary type="html">改进了下之前写的“CDN”程序，使其支持在边缘转换图片格式</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="Go" scheme="https://blog.hzchu.top/tags/Go/"/>
    
    <category term="网站" scheme="https://blog.hzchu.top/tags/%E7%BD%91%E7%AB%99/"/>
    
  </entry>
  
  <entry>
    <title>使用Typora_plugin增强Stellar写作体验</title>
    <link href="https://blog.hzchu.top/2024/%E4%BD%BF%E7%94%A8Typora-plugin%E5%A2%9E%E5%BC%BAStellar%E5%86%99%E4%BD%9C%E4%BD%93%E9%AA%8C/"/>
    <id>https://blog.hzchu.top/2024/%E4%BD%BF%E7%94%A8Typora-plugin%E5%A2%9E%E5%BC%BAStellar%E5%86%99%E4%BD%9C%E4%BD%93%E9%AA%8C/</id>
    <published>2024-05-02T12:47:19.000Z</published>
    <updated>2024-05-02T12:47:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>我觉得<code>Stellar</code>有一个极强的优势——丰富的标签组件，<mark class="tag-plugin colorful mark" color="red">但</mark>有个<wavy>小问题</wavy>——所有标签加起来30多个，而且重复手打<code>&#123;% ... %&#125;</code>多多少少有点难受。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcry.png"/></span></p><p>早上翻issue突然发现<code>Typora Plugin</code>这个好东西，这不直接用起来<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatnomblobcat.png"/></span></p><div class="tag-plugin link dis-select"><a class="link-card plain" title="" href="https://github.com/obgnail/typora_plugin" target="_blank" rel="external nofollow noopener noreferrer" cardlink api="https://siteinfo-api.hzchu.top/api/v1?url=https://github.com/obgnail/typora_plugin" autofill="title,icon"><div class="left"><span class="title">https://github.com/obgnail/typora_plugin</span><span class="cap link footnote">https://github.com/obgnail/typora_plugin</span></div><div class="right"><div class="lazy img" data-bg="https://static.hzchu.top/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><h2 id="安装typora-plugin"><a class="markdownIt-Anchor" href="#安装typora-plugin"></a> 安装Typora Plugin</h2><p><code>Typora Plugin</code>仓库里写的已经很详细了，这里略过<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatpeek2.png"/></span></p><h2 id="添加配置"><a class="markdownIt-Anchor" href="#添加配置"></a> 添加配置</h2><p>现阶段主要用的是<code>slash_commands</code>来实现<code>快捷插入片段</code>。</p><p>修改<code>settings.user.toml</code>：</p><figure class="highlight toml"><figcaption><span>Typora\resources\plugin\global\settings\settings.user.toml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[slash_commands]</span></span><br><span class="line"><span class="comment"># 命令列表</span></span><br><span class="line"><span class="comment">#  - enable:    是否启用</span></span><br><span class="line"><span class="comment">#  - type:      snippet/command。前者表示在调用时插入文字片段，后者表示在调用时执行逻辑命令</span></span><br><span class="line"><span class="comment">#  - icon(可选): 使用emoji作为图标</span></span><br><span class="line"><span class="comment">#  - hint(可选): 提示信息</span></span><br><span class="line"><span class="comment">#  - keyword:   关键词</span></span><br><span class="line"><span class="comment">#  - callback:  若type=snippet，则填入需要插入的文字片段，若type=command，则填入回调函数的字符串</span></span><br><span class="line"><span class="attr">COMMANDS</span> = [</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;😺&quot;</span>, hint = <span class="string">&quot;插入表情标签&quot;</span>, keyword = <span class="string">&quot;emoji&quot;</span>, callback = <span class="string">&quot;&#123;% emoji  %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🪄&quot;</span>, hint = <span class="string">&quot;插入标记标签&quot;</span>, keyword = <span class="string">&quot;mark&quot;</span>, callback = <span class="string">&quot;&#123;% mark  color: %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🏷️&quot;</span>, hint = <span class="string">&quot;插入hashtag标签&quot;</span>, keyword = <span class="string">&quot;hashtag&quot;</span>, callback = <span class="string">&quot;&#123;% hashtag  color: %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📷&quot;</span>, hint = <span class="string">&quot;插入image图片标签&quot;</span>, keyword = <span class="string">&quot;image&quot;</span>, callback = <span class="string">&quot;&#123;% image  download: width: padding: bg: %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🧇&quot;</span>, hint = <span class="string">&quot;插入quot引用标签&quot;</span>, keyword = <span class="string">&quot;quot&quot;</span>, callback = <span class="string">&quot;&#123;% quot  icon:hashtag %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🦉&quot;</span>, hint = <span class="string">&quot;插入poetry诗词标签&quot;</span>, keyword = <span class="string">&quot;poetry&quot;</span>, callback = <span class="string">&quot;&#123;% poetry 游山西村 author:陆游 footer:诗词节选 %&#125;\n&#123;% endpoetry %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📃&quot;</span>, hint = <span class="string">&quot;插入note备注块标签&quot;</span>, keyword = <span class="string">&quot;note&quot;</span>, callback = <span class="string">&quot;&#123;% note [title] content color: %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔗&quot;</span>, hint = <span class="string">&quot;插入link链接卡片标签&quot;</span>, keyword = <span class="string">&quot;link&quot;</span>, callback = <span class="string">&quot;&#123;% link href [title] [icon:src] [desc:true/false] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;▶&quot;</span>, hint = <span class="string">&quot;插入button按钮标签&quot;</span>, keyword = <span class="string">&quot;button&quot;</span>, callback = <span class="string">&quot;&#123;% button text url [icon:key/src] [color:color] [size:xs] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🎯&quot;</span>, hint = <span class="string">&quot;插入okr目标管理标签&quot;</span>, keyword = <span class="string">&quot;okr&quot;</span>, callback = <span class="string">&quot;&#123;% okr o1 %&#125;\n&#123;% endokr %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📚&quot;</span>, hint = <span class="string">&quot;插入copy复制行标签&quot;</span>, keyword = <span class="string">&quot;copy&quot;</span>, callback = <span class="string">&quot;&#123;% copy [code] prefix:$ %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔘&quot;</span>, hint = <span class="string">&quot;插入radio单选标签&quot;</span>, keyword = <span class="string">&quot;radio&quot;</span>, callback = <span class="string">&quot;&#123;% radio checked:true [name] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;☑️&quot;</span>, hint = <span class="string">&quot;插入checkbox复选标签&quot;</span>, keyword = <span class="string">&quot;radio&quot;</span>, callback = <span class="string">&quot;&#123;% checkbox symbol: color: checked: [name] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🎶&quot;</span>, hint = <span class="string">&quot;插入audio音频标签&quot;</span>, keyword = <span class="string">&quot;audio&quot;</span>, callback = <span class="string">&quot;&#123;% audio  %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📽️&quot;</span>, hint = <span class="string">&quot;插入video视频标签&quot;</span>, keyword = <span class="string">&quot;video&quot;</span>, callback = <span class="string">&quot;&#123;% video  %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🧭&quot;</span>, hint = <span class="string">&quot;插入navbar导航栏标签&quot;</span>, keyword = <span class="string">&quot;navbar&quot;</span>, callback = <span class="string">&quot;&#123;% navbar active:/wiki/ [文章](/) [项目](/wiki/) %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📅&quot;</span>, hint = <span class="string">&quot;插入timeline时间线标签&quot;</span>, keyword = <span class="string">&quot;timeline&quot;</span>, callback = <span class="string">&quot;&#123;% timeline %&#125;\n&lt;!-- node [text] --&gt;\n&#123;% endtimeline %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📁&quot;</span>, hint = <span class="string">&quot;插入folders文件夹/折叠容器标签&quot;</span>, keyword = <span class="string">&quot;folders&quot;</span>, callback = <span class="string">&quot;&#123;% folders %&#125;\n&lt;!-- folder 题目1 --&gt;\n&#123;% endfolders %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;👥&quot;</span>, hint = <span class="string">&quot;插入friends友链标签&quot;</span>, keyword = <span class="string">&quot;friends&quot;</span>, callback = <span class="string">&quot;&#123;% friends [name] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🌐&quot;</span>, hint = <span class="string">&quot;插入sites站点标签&quot;</span>, keyword = <span class="string">&quot;sites&quot;</span>, callback = <span class="string">&quot;&#123;% sites 分组名 %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📝&quot;</span>, hint = <span class="string">&quot;插入md标签,渲染外部 markdown 文件&quot;</span>, keyword = <span class="string">&quot;md&quot;</span>, callback = <span class="string">&quot;&#123;% md [url] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📚&quot;</span>, hint = <span class="string">&quot;插入toc文档目录树标签&quot;</span>, keyword = <span class="string">&quot;toc&quot;</span>, callback = <span class="string">&quot;&#123;% toc wiki:xxx [open:true] [display:mobile] title %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📦&quot;</span>, hint = <span class="string">&quot;插入box盒子容器标签&quot;</span>, keyword = <span class="string">&quot;box&quot;</span>, callback = <span class="string">&quot;&#123;% box [title] [color:color] [child:codeblock/tabs] %&#125;\n&#123;% endbox %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔖&quot;</span>, hint = <span class="string">&quot;插入tabs分栏容器标签&quot;</span>, keyword = <span class="string">&quot;tabs&quot;</span>, callback = <span class="string">&quot;&#123;% tabs active: align:center %&#125;\n&lt;!-- tab [name] --&gt;\n&#123;% endtabs %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔲&quot;</span>, hint = <span class="string">&quot;插入grid标签&quot;</span>, keyword = <span class="string">&quot;grid&quot;</span>, callback = <span class="string">&quot;&#123;% grid bg:box/card %&#125;\n&lt;!-- cell --&gt;\n&#123;% endgrid %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🖼️&quot;</span>, hint = <span class="string">&quot;插入gallery图库容器标签&quot;</span>, keyword = <span class="string">&quot;gallery&quot;</span>, callback = <span class="string">&quot;&#123;% gallery %&#125;\n&#123;% endgallery %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📚&quot;</span>, hint = <span class="string">&quot;插入albums专辑容器标签&quot;</span>, keyword = <span class="string">&quot;albums&quot;</span>, callback = <span class="string">&quot;&#123;% albums [group_id] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🖼️&quot;</span>, hint = <span class="string">&quot;插入posters海报容器标签&quot;</span>, keyword = <span class="string">&quot;posters&quot;</span>, callback = <span class="string">&quot;&#123;% posters [group_id] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🖼️&quot;</span>, hint = <span class="string">&quot;插入banner横幅容器标签&quot;</span>, keyword = <span class="string">&quot;banner&quot;</span>, callback = <span class="string">&quot;&#123;% banner [name] bg: %&#125;\n&#123;% endbanner %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;📸&quot;</span>, hint = <span class="string">&quot;插入swiper轮播容器标签&quot;</span>, keyword = <span class="string">&quot;swiper&quot;</span>, callback = <span class="string">&quot;&#123;% swiper effect:cards %&#125;\n\n&#123;% endswiper %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;👤&quot;</span>, hint = <span class="string">&quot;插入ghcard标签&quot;</span>, keyword = <span class="string">&quot;ghcard&quot;</span>, callback = <span class="string">&quot;&#123;% ghcard [name] %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🌙&quot;</span>, hint = <span class="string">&quot;插入ghcard标签（暗黑主题）&quot;</span>, keyword = <span class="string">&quot;ghcard-dark&quot;</span>, callback = <span class="string">&quot;&#123;% ghcard [name] theme:dark %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔐&quot;</span>, hint = <span class="string">&quot;插入psw密码标签&quot;</span>, keyword = <span class="string">&quot;psw&quot;</span>, callback = <span class="string">&quot;&#123;% psw 密码 %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔽&quot;</span>, hint = <span class="string">&quot;插入u下划线标签&quot;</span>, keyword = <span class="string">&quot;u&quot;</span>, callback = <span class="string">&quot;&#123;% u 下划线 %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔆&quot;</span>, hint = <span class="string">&quot;插入emp着重号标签&quot;</span>, keyword = <span class="string">&quot;emp&quot;</span>, callback = <span class="string">&quot;&#123;% emp 着重号 %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🌊&quot;</span>, hint = <span class="string">&quot;插入wavy波浪线标签&quot;</span>, keyword = <span class="string">&quot;wavy&quot;</span>, callback = <span class="string">&quot;&#123;% wavy 波浪线 %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;❌&quot;</span>, hint = <span class="string">&quot;插入del删除线标签&quot;</span>, keyword = <span class="string">&quot;del&quot;</span>, callback = <span class="string">&quot;&#123;% del 删除线 %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔺&quot;</span>, hint = <span class="string">&quot;插入sup上角标标签&quot;</span>, keyword = <span class="string">&quot;sup&quot;</span>, callback = <span class="string">&quot;&#123;% sup 上角标 %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;🔻&quot;</span>, hint = <span class="string">&quot;插入sub下角标标签&quot;</span>, keyword = <span class="string">&quot;sub&quot;</span>, callback = <span class="string">&quot;&#123;% sub 下角标 %&#125;&quot;</span> &#125;,</span><br><span class="line">    &#123; enable = <span class="literal">true</span>, type = <span class="string">&quot;snippet&quot;</span>, icon = <span class="string">&quot;⌨️&quot;</span>, hint = <span class="string">&quot;插入kbd键盘样式标签&quot;</span>, keyword = <span class="string">&quot;kbd&quot;</span>, callback = <span class="string">&quot;&#123;% kbd ⌘ %&#125;&quot;</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><div class="tag-plugin colorful note" color="yellow"><div class="title">Tips</div><div class="body"><p>如有需要，可自行调整顺序</p></div></div><h2 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h2><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/05/66331f9949059.gif" data-fancybox="true"/></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/05/66331fa8bd7a7.gif" data-fancybox="true"/></div></div><h2 id="更进一步"><a class="markdownIt-Anchor" href="#更进一步"></a> 更进一步</h2><p><code>Typora Plugin</code>远不止于此，<s>但我不会了</s>，研究下先，试试看能否实现以下功能<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcoffee.png"/></span>：</p><div class="tag-plugin colorful checkbox" ><input type="checkbox"/><span>实时渲染Stellar自有标签</span></div><div class="tag-plugin colorful checkbox" color="green" symbol="plus"><input type="checkbox" checked="true"/><span>表情标签支持直接从列表里选择输入</span></div><p>进度：</p><div class="tag-plugin timeline"><div class="timenode" index="0"><div class="header">完成表情面板</div><div class="body fs14"><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/05/66358cab33787.gif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/myself/2024/05/66358cab33787.gif"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div></div></div></div>]]></content>
    
    
    <summary type="html">打标签打累了？试试自动补齐</summary>
    
    
    
    <category term="瞎折腾" scheme="https://blog.hzchu.top/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="Stellar" scheme="https://blog.hzchu.top/tags/Stellar/"/>
    
    <category term="Typora" scheme="https://blog.hzchu.top/tags/Typora/"/>
    
  </entry>
  
  <entry>
    <title>这是...动态代码框？</title>
    <link href="https://blog.hzchu.top/2024/%E4%BD%BF%E7%94%A8pygments%E5%AF%B9%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E9%AB%98%E4%BA%AE%EF%BC%8C%E5%B9%B6%E6%8F%92%E5%85%A5%E4%BB%BB%E6%84%8F%E7%BD%91%E9%A1%B5/"/>
    <id>https://blog.hzchu.top/2024/%E4%BD%BF%E7%94%A8pygments%E5%AF%B9%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E9%AB%98%E4%BA%AE%EF%BC%8C%E5%B9%B6%E6%8F%92%E5%85%A5%E4%BB%BB%E6%84%8F%E7%BD%91%E9%A1%B5/</id>
    <published>2024-04-21T14:20:02.000Z</published>
    <updated>2024-04-21T14:20:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>一直以来我都面临着一个问题：我要在文章中引用一段大几百行的代码，一眼看去md文件里5/6都是英文，要是有改动还得找到代码快开始的地方从头覆盖到尾。</p><p>前一阵子发现gist，对他的Embed爱不释手，但是我所引用的文件大部分都是在Github仓库上的，而对于普通文件并没有Embed功能。如果说直接用gist的话文件发生改动时我又要手动将更改覆盖到gist上，屮，太痛了。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcomftears.png"/></span></p><h2 id="思路"><a class="markdownIt-Anchor" href="#思路"></a> 思路</h2><p>从解决痛点问题出发，我认为需要具备以下功能。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatthink.png"/></span></p><ol><li><p>类似gist可以嵌入到页面中</p></li><li><p>自动同步改动</p></li></ol><p>对gist提供嵌入的js分析了一下，发现它包括两部分：</p><ol><li><p>插入代码区，这部分包括已进行高亮的代码</p></li><li><p>引入css</p></li></ol><p>那接下来就好办了，我们只需要将文件内容获取下来，进行高亮后显示即可。</p><p>然后从网上搜了一下，能进行代码高亮的库，发现了<code>highlight(js)</code>以及<code>pygments(py)</code>。 对于纯静态博客而言，肯定是使用<code>highlight</code>直接在前端处理好，但是这可能产生跨域问题以及因为网络问题无法获取到文件内容。况且现在无服务器函数遍地走了，那就直接pass掉吧。翻了下<code>pygments</code>的文档，嗯，懂了，开整。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatbox.png"/></span></p><h2 id="写code"><a class="markdownIt-Anchor" href="#写code"></a> 写code</h2><p>这简单，跳过了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsnapped.png"/></span></p><h2 id="部署"><a class="markdownIt-Anchor" href="#部署"></a> 部署🎇</h2><p>因为我是直接用Vercel的cli进行部署的，所以这一步需要先安装一下</p><blockquote><p>也可以直接部署: <a href="https://vercel.com/import/project?template=https://github.com/thun888/hightlight-code-api">Develop To Vercel</a></p></blockquote><div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_1" value="npm install -g vercel"><button class="copy-btn" onclick="util.copy(&quot;copy_1&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>然后登录</p><div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_2" value="vercel login"><button class="copy-btn" onclick="util.copy(&quot;copy_2&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>再clone下仓库到本地，你可以打开<code>api\main.py</code>来修改一下/删除提供者信息</p><div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_3" value="git clone https://github.com/thun888/hightlight-code-api.git"><button class="copy-btn" onclick="util.copy(&quot;copy_3&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66249b3e5bb80.webp?fmt=avif" data-fancybox="true"/></div></div><p>如有需要，可在<code>vercel.json</code>里配置可信来源，防止滥用</p><p>部署到生产环境</p><div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_4" value="vercel --prod"><button class="copy-btn" onclick="util.copy(&quot;copy_4&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><blockquote><p>若出现Vercel报错<code>Error: Unable to find any supported Python versions.</code>记得把项目的node版本改成 <code>18.x</code></p></blockquote><p>随后引用即可</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://&#123;yourdomain&#125;/api/v1/generate?url=&#123;fileurl&#125;&amp;lang=&#123;language&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>{fileurl}为所需引入文件的链接，{language}为对应语言（自动识别我试了下精准度堪忧，只好手动指定</p></blockquote><p>可传入参数：</p><table><thead><tr><th>参数名</th><th>默认值</th><th>解释</th></tr></thead><tbody><tr><td><em>code</em></td><td>\</td><td>需要的高亮的代码</td></tr><tr><td><em>url</em></td><td>\</td><td>需要的高亮的代码的链接</td></tr><tr><td><em>lang</em></td><td>[为空时根据后缀名判断]</td><td>语言</td></tr><tr><td><em>withcss</em></td><td>true</td><td>是否附带css</td></tr><tr><td>json</td><td>false</td><td>是否以json形式返回({“result”: “…”})</td></tr></tbody></table><h2 id="扩展"><a class="markdownIt-Anchor" href="#扩展"></a> 扩展</h2><h3 id="更便捷的使用"><a class="markdownIt-Anchor" href="#更便捷的使用"></a> 更便捷的使用</h3><p>受<a href="https://weekdaycare.cn/">@星日语</a>的启发，我做了个插件：<code>hexo-dynamic-codeblock</code></p><p>安装：<div class="tag-plugin copy"><span>$</span><input class="copy-area" id="copy_5" value="npm install hexo-dynamic-codeblock"><button class="copy-btn" onclick="util.copy(&quot;copy_5&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></p><p>配置：</p><figure class="highlight yaml"><figcaption><span>_config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dynamic_codeblock:</span></span><br><span class="line">  <span class="attr">loading:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">showsupporter:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">api:</span> <span class="string">https://&#123;yourdomain&#125;/api/v1/generate</span></span><br><span class="line">  <span class="attr">css:</span> <span class="string">https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>loading只针对Stellar主题</strong>。同时，为使copycode正常工作，你需要将/js/plugins/copycode.js修改为<a href="/js/plugins/copycode.js">这样</a></p></blockquote><p>使用：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% coding [url] [lang] %&#125;</span><br></pre></td></tr></table></figure><p>在其它主题中的表现：</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/05/6632074ebf0a9.webp?fmt=avif" alt="landscape" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="landscape" href="https://onep.hzchu.top/mount/pic/myself/2024/05/6632074ebf0a9.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">landscape</span></div></div><p>从传统方式迁移：</p><p>​使用正则表达式，将<code>&lt;script src=&quot;https://hightlight-code-api\.hzchu\.top/api/v1/generate\?url=(.*)&amp;lang=(.*)&quot;&gt;&lt;/script&gt;</code>替换为<code>&#123;% coding $1 $2 %&#125;</code></p><h2 id="todo"><a class="markdownIt-Anchor" href="#todo"></a> Todo</h2><ul><li>[ ] 添加 <code>/preview</code></li></ul><h2 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h2><p>该处引用本程序代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/hightlight-code-api/main/api/main.py&amp;lang=python&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>    <div class="tag-plugin ds-coding" id="coding-qoqlniccw"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-qoqlniccw' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-qoqlniccw');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fhightlight-code-api%2Fmain%2Fapi%2Fmain.py&lang=python&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-qoqlniccw');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        ]]></content>
    
    
    <summary type="html">使用pygments对代码进行高亮，将长段代码Embed到你的博客里吧</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="python" scheme="https://blog.hzchu.top/tags/python/"/>
    
    <category term="Vercel" scheme="https://blog.hzchu.top/tags/Vercel/"/>
    
  </entry>
  
  <entry>
    <title>为小米路由器加上屏幕</title>
    <link href="https://blog.hzchu.top/2024/%E4%B8%BA%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8A%A0%E4%B8%8A%E5%B1%8F%E5%B9%95-%E7%94%A8%E5%B0%8F%E7%94%B5%E8%A7%86-SD2-%E7%9B%91%E6%8E%A7%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    <id>https://blog.hzchu.top/2024/%E4%B8%BA%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8A%A0%E4%B8%8A%E5%B1%8F%E5%B9%95-%E7%94%A8%E5%B0%8F%E7%94%B5%E8%A7%86-SD2-%E7%9B%91%E6%8E%A7%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8/</id>
    <published>2024-04-20T15:11:40.000Z</published>
    <updated>2024-04-20T15:11:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>之前在<code>bbs.hzchu.top</code>写过，不过没多少人看，迁回博客里</p><h2 id="流程"><a class="markdownIt-Anchor" href="#流程"></a> 流程</h2><h3 id="搭建mrui"><a class="markdownIt-Anchor" href="#搭建mrui"></a> 搭建MRUI</h3><p>顺手集成到自己项目里了，自己用起来也方便<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcoffee.png"/></span></p><p>搭建参阅<a href="/2023/howtorunmrui/">Mirouterui简要部署指南</a></p><h3 id="修改部分程序代码"><a class="markdownIt-Anchor" href="#修改部分程序代码"></a> 修改部分程序代码</h3><p>由于默认获取一次信息间隔太短，会对路由器造成不小的负担，最好改为5s获取一次</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/01/12/65a10d998d683.webp?fmt=avif" alt="1705053582589.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1705053582589.webp" href="https://onep.hzchu.top/mount/pic/2024/01/12/65a10d998d683.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1705053582589.webp</span></div></div><p>同时程序不支持http0.1,要把发送请求处代码修改为http1.1</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/12/31/6590caaa36915.webp?fmt=avif" alt="1703987881404.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1703987881404.webp" href="https://onep.hzchu.top/mount/pic/2023/12/31/6590caaa36915.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1703987881404.webp</span></div></div><h2 id="展示"><a class="markdownIt-Anchor" href="#展示"></a> 展示</h2><div class="tag-plugin swiper fancybox" id="swiper-api" effect="cards"><div class="swiper-wrapper"><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2023/12/31/6590c9dc1e6f1.webp?fmt=avif" alt="IMG_20231230_103045.webp" data-fancybox="true"/></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2023/12/31/6590cbaed9f8a.webp" alt="IMG_20231230_103045.webp" data-fancybox="true"/></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2023/12/31/6590cb5e87c0b.webp?fmt=avif" alt="1703988060977.webp" data-fancybox="true"/></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev blur"></div><div class="swiper-button-next blur"></div></div><h2 id="扩展"><a class="markdownIt-Anchor" href="#扩展"></a> 扩展</h2><h3 id="自定义显示"><a class="markdownIt-Anchor" href="#自定义显示"></a> 自定义显示</h3><p>你可以参照下面的图片中的“传感器”名称，对代码中获取传感器数据的地方进行修改。如我就将温度改为了在线设备数</p><h3 id="ha"><a class="markdownIt-Anchor" href="#ha"></a> HA</h3><p>同时兼容HA的netdata集成</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/01/01/659222d20746e.webp?fmt=avif" alt="1704075984628.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1704075984628.webp" href="https://onep.hzchu.top/mount/pic/2024/01/01/659222d20746e.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1704075984628.webp</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/01/01/659223056c85c.webp?fmt=avif" alt="1704076036821.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1704076036821.webp" href="https://onep.hzchu.top/mount/pic/2024/01/01/659223056c85c.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1704076036821.webp</span></div></div><p>示例配置：</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/01/01/6592231bdd188.webp?fmt=avif" alt="1704076059450.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1704076059450.webp" href="https://onep.hzchu.top/mount/pic/2024/01/01/6592231bdd188.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1704076059450.webp</span></div></div><h2 id="后记"><a class="markdownIt-Anchor" href="#后记"></a> 后记</h2><p>感觉他程序有点不如人意，特别是我照着readme写完时发现用的api已经弃用了，重写完发现每秒发送5个请求直接把路由器的cpu占用干到80%+的时候<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatneutral.png"/></span></p><p>当然也有我的锅，现在调用netdata的api默认会有两秒的缓存</p>]]></content>
    
    
    <summary type="html">通过MRUI构造网络请求来用小电视(SD2)监控小米路由器</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="Mirouterui" scheme="https://blog.hzchu.top/tags/Mirouterui/"/>
    
  </entry>
  
  <entry>
    <title>为小米MIX2s更换音量排线及电池的最优方法</title>
    <link href="https://blog.hzchu.top/2024/%E4%B8%BA%E5%B0%8F%E7%B1%B3MIX2s%E6%9B%B4%E6%8D%A2%E9%9F%B3%E9%87%8F%E6%8E%92%E7%BA%BF%E5%8F%8A%E7%94%B5%E6%B1%A0%E7%9A%84%E6%9C%80%E4%BC%98%E6%96%B9%E6%B3%95/"/>
    <id>https://blog.hzchu.top/2024/%E4%B8%BA%E5%B0%8F%E7%B1%B3MIX2s%E6%9B%B4%E6%8D%A2%E9%9F%B3%E9%87%8F%E6%8E%92%E7%BA%BF%E5%8F%8A%E7%94%B5%E6%B1%A0%E7%9A%84%E6%9C%80%E4%BC%98%E6%96%B9%E6%B3%95/</id>
    <published>2024-04-20T09:57:40.000Z</published>
    <updated>2024-04-20T09:57:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>两三个月前吧，我发现音量下键和开关键时灵时不灵的，特别是开关键软趴趴的，时不时卡住就循环重启。直到半个月前，它终于圆满的离开了—彻底按不动了，锁屏都得下滑通知栏，点按钮才关得上。然后一寻思，反正都要拆开了，顺便换个电池吧（软件统计剩余容量2000多毫安时，待机一晚上都挺不过去<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatfacepalm.png"/></span>）</p><h2 id="买零件"><a class="markdownIt-Anchor" href="#买零件"></a> 买零件</h2><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>我这里买的是中电的扩容电池，因为电池配着工具包所以音量排线买一个三块钱左右的也够了（虽然我忘了这茬<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatt.png"/></span></p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66236c3bdeec7.webp?fmt=avif" alt="IMG_20240420_101135.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240420_101135.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/66236c3bdeec7.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240420_101135.webp</span></div></div>    </div>    </div><h2 id="准备材料"><a class="markdownIt-Anchor" href="#准备材料"></a> 准备材料</h2><ol><li>热风枪</li><li>耐热垫板</li><li>镊子</li></ol><blockquote><p>若没有热风枪，可使用电吹风</p></blockquote><p>零件全家福：</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/6623725117296.webp?fmt=avif" alt="IMG_20240419_171503.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_171503.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/6623725117296.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_171503.webp</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662378a301bac.webp?fmt=avif" alt="IMG_20240419_171523.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_171523.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/662378a301bac.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_171523.webp</span></div></div><h2 id="准备工作"><a class="markdownIt-Anchor" href="#准备工作"></a> 准备工作</h2><ol><li>将手机电量用尽</li><li>关机</li></ol><h2 id="开始"><a class="markdownIt-Anchor" href="#开始"></a> 开始</h2><ol><li>取出卡托</li></ol><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="2"><li>将手机背面朝上放置在隔热垫板上，使用热风枪来回加热尾部边缘地区</li></ol><p>我比较暴力啊直接500°C吹了40多秒，一开始用电吹风折腾了十几分钟没搞开<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatdead.png"/></span></p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662379e57f7ba.webp?fmt=avif" alt="1713600995917.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1713600995917.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/662379e57f7ba.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1713600995917.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="3"><li>放好热风枪，迅速将吸盘吸在尾部（确认吸盘完全吸附，尽量不要探到手机外部），右手食指和拇指按住手机两侧尾部（中框处），往外拉吸盘</li><li>拉开缝后就容易了，用附赠的卡片卡住即可（如果来不及可以先用指甲顶上<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatmeltthumb.png"/></span>）</li></ol>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66237c258bed3.webp?fmt=avif" alt="IMG_20240419_174028.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_174028.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/66237c258bed3.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_174028.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="5"><li>在这基础上，可以尝试直接使用划开，如果不行就用拨片。如果划不动不妨翘一翘</li></ol><div class="tag-plugin colorful note" color="red"><div class="title">注意</div><div class="body"><p>最好逆时针刮，毕竟指纹排线在音量键旁边</p></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66237e34a5c81.webp?fmt=avif" alt="跑焦了" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="跑焦了" href="https://onep.hzchu.top/mount/pic/myself/2024/04/66237e34a5c81.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">跑焦了</span></div></div>    </div>    </div><div class="tag-plugin colorful note" color="yellow"><div class="title">注意</div><div class="body"><p>为防止摄像头进灰，最好拿胶布贴一下</p></div></div><p><strong>打开后</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66237f27423c3.webp?fmt=avif" alt="IMG_20240419_174441.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_174441.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/66237f27423c3.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_174441.webp</span></div></div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <blockquote><p>顺便提一嘴，无线充电是放在电池上的，没有下胶水，感动~</p></blockquote>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66237fcc8d7d8.webp?fmt=avif" alt="IMG_20240419_174550.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_174550.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/66237fcc8d7d8.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_174550.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="6"><li>拆下标记处螺丝，取下无线充&amp;NFC线圈</li></ol>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/6623803f65b52.webp?fmt=avif" alt="IMG_20240419_174614.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_174614.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/6623803f65b52.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_174614.webp</span></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662380f394c47.webp?fmt=avif" alt="IMG_20240419_174801.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_174801.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/662380f394c47.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_174801.webp</span></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662382eb16441.webp?fmt=avif" alt="IMG_20240419_174810.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_174810.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/662382eb16441.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_174810.webp</span></div></div>    </div>    </div><h3 id="拆音量排线"><a class="markdownIt-Anchor" href="#拆音量排线"></a> 拆音量排线🪡</h3><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="7"><li>因为换音量排线要拆主板，先拆下所有排线&amp;螺丝，取出主板</li></ol><blockquote><p>中间铜箔注意取下</p><p>对于细微操作建议使用镊子</p></blockquote><div class="tag-plugin colorful note" color="yellow"><div class="title">要不你试试：</div><div class="body"><p>事后复盘时看图片好像也不用拆主板，可以试试看</p></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/6623883f1d521.webp?fmt=avif" alt="1713604675750.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1713604675750.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/6623883f1d521.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1713604675750.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="8"><li>由内向外顶出音量排线底板，取出来后将替换件的底板上的胶撕开放进去，再用螺丝刀从外向内顶一下，使底板的胶与手机充分接触</li><li>将主板装回即可</li></ol>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66238c7e4e319.webp?fmt=avif" alt="IMG_20240419_182603.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_182603.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/66238c7e4e319.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_182603.webp</span></div></div>    </div>    </div><h3 id="拆电池"><a class="markdownIt-Anchor" href="#拆电池"></a> 拆电池🪄</h3><p>我看中电官方的视频教程里电池胶一抽就出来了，我的可能比较腼腆啊一抽就断<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcat0_0.png"/></span></p><p>那没办法了，只能上螺丝刀了</p><div class="tag-plugin colorful note" color="red"><div class="title">警告</div><div class="body"><p>还记得准备工作中的放电吗，该操作100%破坏电池，若电量充足可能会造成不堪设想的后果</p></div></div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>因为下面有排线，建议在图中圈圈处入刀，然后沿着上部分滑动，“挤开”电池</p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662393045e7b1.webp?fmt=avif" alt="1713607423583.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1713607423583.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/662393045e7b1.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1713607423583.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>拆下来的电池</p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662394407ef95.webp?fmt=avif" alt="IMG_20240419_180328.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_180328.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/662394407ef95.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_180328.webp</span></div></div>    </div>    </div><p>随后安装新电池，因为是扩容电池的原因，排线有亿点难走，最好先大致掰一掰形状，再接上排线，最后装到电池槽内</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66239559f35fe.webp?fmt=avif" alt="IMG_20240419_180423.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_180423.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/66239559f35fe.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_180423.webp</span></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662394ac4c87f.webp?fmt=avif" alt="IMG_20240419_180512.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_20240419_180512.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/662394ac4c87f.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_20240419_180512.webp</span></div></div>    </div>    </div><p>到这一步了可以试下能不能开机了，测试完成后复原所有排线，螺丝及无线充电模块</p><h3 id="打胶"><a class="markdownIt-Anchor" href="#打胶"></a> 打胶🧪</h3><p>先用镊子清理残胶，随后用附赠的b7000涂一圈，把后壳扣好。家里没有橡皮筋我干脆就拿手肘压了十几分钟，反正都是带手机套用的也不在意那点缝隙。</p><h2 id="主观体验"><a class="markdownIt-Anchor" href="#主观体验"></a> 主观体验</h2><p>一个字——沉。不带手机套净重219g，差不多半斤了，<s>虽然按照百度百科的数据才重了30g</s></p><p>续航方面大大提升，原本要一直插着电用（防止要带着走时没电），现在电力自由了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatphoto.png"/></span></p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662399124e3c2.webp?fmt=avif" alt="IMG_1.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_1.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/662399124e3c2.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_1.webp</span></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/6623990c31570.webp?fmt=avif" alt="IMG_2.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="IMG_2.webp" href="https://onep.hzchu.top/mount/pic/myself/2024/04/6623990c31570.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">IMG_2.webp</span></div></div>    </div>    </div><h2 id="不足"><a class="markdownIt-Anchor" href="#不足"></a> 不足</h2><ol><li>用吸盘吸时没抓好，受力点集中在屏幕上，直接让我屏幕又碎了几条小裂纹</li><li>看到有一个教程一个劲的从里面推音量排线的底板，害得我直接把电源键上的塑料垫整掉了，费了半天劲才给他塞回去，还搞得现在还是软趴趴的手感</li><li>撬电池的时候没看见下面有排线，直接创到屏幕排线上了，幸好没有坏</li></ol>]]></content>
    
    
    <summary type="html">被网上的视频坑了好几回，总结下过程</summary>
    
    
    
    <category term="瞎折腾" scheme="https://blog.hzchu.top/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="DIY" scheme="https://blog.hzchu.top/tags/DIY/"/>
    
  </entry>
  
  <entry>
    <title>主题改动小记</title>
    <link href="https://blog.hzchu.top/2024/%E4%B8%BB%E9%A2%98%E6%94%B9%E5%8A%A8%E5%B0%8F%E8%AE%B0/"/>
    <id>https://blog.hzchu.top/2024/%E4%B8%BB%E9%A2%98%E6%94%B9%E5%8A%A8%E5%B0%8F%E8%AE%B0/</id>
    <published>2024-04-19T21:05:29.000Z</published>
    <updated>2024-04-20T08:05:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>很久之前，为了在主题中新增功能还是改主题文件实现的，不过因为没有用Git进行管理，后面带来一个很严重的问题：<mark class="tag-plugin colorful mark" color="blue">升级十分困难</mark>。</p><p>当然，即便早已摆脱了那种想升级又不敢升级的困境，我还是不喜欢对主题进行过多的侵入式修改，在前几个月我陆陆续续将主题中一些自定义的部分阉掉或通过外部注入实现，但随之而来又有一个问题：<mark class="tag-plugin colorful mark" color="blue">可自定义程度低</mark>。</p><p>罢了罢了，我自己写一篇文章来记录改动吧，免得以后出现问题时不知道怎么改回来。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatnotlikethis.png"/></span></p><div class="tag-plugin colorful note" color="red"><div class="title">叠甲</div><div class="body"><p>本文仅用作记录，不具备任何教程性质，仅供参考</p></div></div><h2 id="非直接修改主题"><a class="markdownIt-Anchor" href="#非直接修改主题"></a> 非直接修改主题</h2><h3 id="杂项"><a class="markdownIt-Anchor" href="#杂项"></a> 杂项</h3><p>包括：烟花特效，运行时间，复制提醒，超链接图标等等，以注释为准</p>    <div class="tag-plugin ds-coding" id="coding-hbtcnprlv"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-hbtcnprlv' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-hbtcnprlv');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fmyblog%2Fmain%2Fsource%2Fjs%2Fextra.js&lang=js&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-hbtcnprlv');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        <p><code>烟花特效&amp;运行时间</code>来自网络</p><h3 id="加载动画"><a class="markdownIt-Anchor" href="#加载动画"></a> 加载动画</h3><p>通过<code>injector</code>实现</p>    <div class="tag-plugin ds-coding" id="coding-4sny1bc3h"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-4sny1bc3h' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-4sny1bc3h');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fmyblog%2Fmain%2Fscripts%2Fheadend.js&lang=js&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-4sny1bc3h');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        <p>对应的js</p>    <div class="tag-plugin ds-coding" id="coding-8jy5f0b59"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-8jy5f0b59' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-8jy5f0b59');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fmyblog%2Fmain%2Fsource%2Fjs%2Fload.js&lang=js&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-8jy5f0b59');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        <h3 id="哔哔广场"><a class="markdownIt-Anchor" href="#哔哔广场"></a> 哔哔广场</h3><p>与其说是广场，<s>不如说是个人独秀</s>（毕竟我这也不是正经的Memos</p><p>魔改自<a href="https://immmmm.com/bbs/">哔哔广场-木木木木木 (immmmm.com)</a></p>    <div class="tag-plugin ds-coding" id="coding-ac95lpcwm"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-ac95lpcwm' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-ac95lpcwm');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fmyblog%2Fmain%2Fsource%2Fbb%2Findex.md&lang=markdown&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-ac95lpcwm');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        <p>对应的js</p>    <div class="tag-plugin ds-coding" id="coding-goow1ttdm"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-goow1ttdm' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-goow1ttdm');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fmyblog%2Fmain%2Fsource%2Fjs%2Fmemos.js&lang=js&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-goow1ttdm');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        <h3 id="配色方案"><a class="markdownIt-Anchor" href="#配色方案"></a> 配色方案</h3><figure class="highlight yaml"><figcaption><span>_config.stellar.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######## Article ########</span></span><br><span class="line"><span class="attr">article:</span></span><br><span class="line">  <span class="attr">category_color:</span></span><br><span class="line">    <span class="string">&#x27;生活小事&#x27;</span><span class="string">:</span> <span class="string">&#x27;#bf9936&#x27;</span></span><br><span class="line">    <span class="string">&#x27;技术类&#x27;</span><span class="string">:</span> <span class="string">&#x27;#2196f3&#x27;</span></span><br><span class="line">    <span class="string">&#x27;瞎折腾&#x27;</span><span class="string">:</span> <span class="string">&#x27;#ef613f&#x27;</span></span><br><span class="line"><span class="attr">style:</span></span><br><span class="line">  <span class="attr">color:</span></span><br><span class="line">    <span class="comment"># 动态颜色（会根据明暗主题重设明度值，只用关心色相和饱和度即可）</span></span><br><span class="line">    <span class="attr">background:</span> <span class="string">&#x27;hsl(212 16% 98%)&#x27;</span> <span class="comment"># 浅色背景颜色</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">&#x27;hsl(212 8% 95%)&#x27;</span> <span class="comment"># 块背景颜色</span></span><br><span class="line">    <span class="attr">code:</span> <span class="string">&#x27;hsl(220 20% 10%)&#x27;</span> <span class="comment"># &#x27;hsl(14 100% 48%)&#x27; # 行内代码颜色</span></span><br><span class="line">    <span class="attr">text:</span> <span class="string">&#x27;hsl(0 0% 20%)&#x27;</span> <span class="comment"># 文本颜色</span></span><br><span class="line">    <span class="comment"># 主题色配置（不会根据明暗动态调整，请设置为通用的颜色）</span></span><br><span class="line">    <span class="comment"># theme: &#x27;hsl(192 98% 55%)&#x27; # 主题色</span></span><br><span class="line">    <span class="attr">theme:</span> <span class="string">&#x27;hsl(88 76% 40%)&#x27;</span> <span class="comment"># 主题色</span></span><br><span class="line">    <span class="attr">accent:</span> <span class="string">&#x27;hsl(14 100% 57%)&#x27;</span> <span class="comment"># 强调色</span></span><br><span class="line">    <span class="attr">link:</span> <span class="string">&#x27;hsl(88 76% 40%)&#x27;</span> <span class="comment"># 超链接颜色</span></span><br><span class="line">    <span class="attr">hover:</span> <span class="string">&#x27;hsl(14 100% 57%)&#x27;</span> <span class="comment"># 按钮高亮颜色</span></span><br></pre></td></tr></table></figure><h2 id="超链接样式调整"><a class="markdownIt-Anchor" href="#超链接样式调整"></a> 超链接样式调整</h2><p>文章内链接：加粗并下移下划线。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 文章内链接：为链接使用荧光笔下划线效果 */</span></span><br><span class="line"><span class="selector-tag">li</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[class]</span>) <span class="selector-tag">a</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[class]</span>),</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[class]</span>) <span class="selector-tag">a</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[class]</span>),</span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">a</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[class]</span>) &#123;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">0.1rem</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">0</span>, <span class="built_in">var</span>(--theme-link-opa), <span class="built_in">var</span>(--theme-link-opa)) no-repeat center bottom / <span class="number">100%</span> <span class="number">40%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="直接修改主题"><a class="markdownIt-Anchor" href="#直接修改主题"></a> 直接修改主题</h2><h3 id="字数统计"><a class="markdownIt-Anchor" href="#字数统计"></a> 字数统计</h3><figure class="highlight js"><figcaption><span>themes\stellar\layout\_partial\main\footer.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// footer</span></span><br><span class="line">  el += <span class="string">&#x27;&lt;div class=&quot;text&quot;&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (content) &#123;</span><br><span class="line">      el += <span class="title function_">markdown</span>(content)</span><br><span class="line">    &#125;</span><br><span class="line">    el += <span class="string">&#x27;&lt;script&gt; var allpostscount = &quot;&#x27;</span> + site.<span class="property">posts</span>.<span class="property">length</span> + <span class="string">&#x27;&quot; ;var allpostswords = &quot;&#x27;</span> + <span class="title function_">totalcount</span>(site) + <span class="string">&#x27;&quot;;gtime_days = Math.floor((new Date() - new Date(&#x27;</span> + page.<span class="property">updated</span> + <span class="string">&#x27;)) / 1000 / 60 / 60 / 24);&lt;/script&gt;&#x27;</span></span><br><span class="line">    el += <span class="string">&#x27;&lt;/div&gt;&lt;/footer&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> el</span><br><span class="line">  &#125;</span><br><span class="line">  %&gt;</span><br><span class="line">  &lt;%- <span class="title function_">layoutDiv</span>() %&gt;</span><br></pre></td></tr></table></figure><p>将字数信息引入到变量中供调用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;timeDate&quot;</span>&gt;</span>载入天数...<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>&amp;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;times&quot;</span>&gt;</span>载入时分秒...<span class="tag">&lt;/<span class="name">span</span>&gt;</span>，共发表了<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;all-posts-count&quot;</span>&gt;</span>load<span class="tag">&lt;/<span class="name">span</span>&gt;</span>篇文章，总计<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;all-post-words&quot;</span>&gt;</span>load<span class="tag">&lt;/<span class="name">span</span>&gt;</span>字</span><br></pre></td></tr></table></figure><p>相关js参阅<a href="#%E6%9D%82%E9%A1%B9">#杂项</a></p><p><strong>文章内字数统计&amp;阅读时长</strong></p><figure class="highlight js"><figcaption><span>themes\stellar\layout\_partial\main\navbar\article_banner.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="comment">// 3.left.bottom</span></span><br><span class="line">  el += <span class="title function_">partial</span>(<span class="string">&#x27;dateinfo&#x27;</span>)</span><br><span class="line">  <span class="comment">//字数显示</span></span><br><span class="line">  el += <span class="string">&#x27;&lt;div class=&quot;flex-row&quot; id=&quot;page-words&quot;&gt;&lt;span style=&quot;padding: 4px;&quot;&gt;本文字数：&#x27;</span> + <span class="title function_">wordcount</span>(page.<span class="property">content</span>) + <span class="string">&#x27;字&lt;/span&gt;&lt;span class=&quot;sep updated&quot; style=&quot;padding: 4px;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;text updated&quot; style=&quot;padding: 4px;&quot;&gt;阅读时长：&#x27;</span> + <span class="title function_">min2read</span>(page.<span class="property">content</span>) + <span class="string">&#x27;分&lt;/span&gt;&lt;/div&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>css:</p><figure class="highlight css"><figcaption><span>source\mcss\mcss.css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bread-nav</span> <span class="selector-tag">div</span><span class="selector-id">#page-words</span> <span class="selector-tag">span</span><span class="selector-class">.sep</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bread-nav</span> <span class="selector-tag">div</span><span class="selector-id">#page-words</span> <span class="selector-tag">span</span><span class="selector-class">.updated</span> &#123;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bread-nav</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">div</span><span class="selector-id">#page-words</span> <span class="selector-tag">span</span><span class="selector-class">.updated</span> &#123;</span><br><span class="line">  <span class="attribute">visibility</span>: visible;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="文章内过期提醒"><a class="markdownIt-Anchor" href="#文章内过期提醒"></a> 文章内过期提醒</h3><p>变量获取一并放在<code>footer</code>里了</p><figure class="highlight js"><figcaption><span>themes\stellar\layout\page.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  el += <span class="string">`&lt;article class=&quot;<span class="subst">$&#123;articleClass()&#125;</span>&quot;&gt;`</span></span><br><span class="line">  <span class="comment">//过期提醒容器</span></span><br><span class="line">  el +=<span class="string">`&lt;div id=&quot;gtime&quot;&gt;&lt;/div&gt;`</span></span><br></pre></td></tr></table></figure><p>相关js参阅<a href="#%E6%9D%82%E9%A1%B9">#杂项</a></p><h3 id="文章内标签显示"><a class="markdownIt-Anchor" href="#文章内标签显示"></a> 文章内标签显示</h3><p>紧跟在<code>文章内字数统计</code>下方</p><figure class="highlight js"><figcaption><span>themes\stellar\layout\_partial\main\navbar\article_banner.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//标签显示</span></span><br><span class="line"><span class="keyword">if</span> (page.<span class="property">layout</span> == <span class="string">&quot;post&quot;</span> &amp;&amp; page.<span class="property">tags</span> &amp;&amp; page.<span class="property">tags</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  el += <span class="string">&#x27;&lt;div class=&quot;flex-row&quot; id=&quot;tag&quot;&gt;&#x27;</span>; <span class="comment">// 将标签容器的创建移动到条件内部</span></span><br><span class="line">  el += <span class="string">&#x27; &lt;span&gt;&amp;nbsp标签：&lt;/span&gt;&#x27;</span>;</span><br><span class="line">  el += <span class="title function_">list_categories</span>(page.<span class="property">tags</span>, &#123;</span><br><span class="line">    <span class="attr">class</span>: <span class="string">&quot;cap breadcrumb&quot;</span>,</span><br><span class="line">    <span class="attr">show_count</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">separator</span>: <span class="string">&#x27;&amp;nbsp; &#x27;</span>,</span><br><span class="line">    <span class="attr">style</span>: <span class="string">&quot;none&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  el += <span class="string">&#x27;&amp;nbsp&lt;/div&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="显示artalk最近评论"><a class="markdownIt-Anchor" href="#显示artalk最近评论"></a> 显示Artalk最近评论</h3>    <div class="tag-plugin ds-coding" id="coding-co96ee7ir"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-co96ee7ir' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-co96ee7ir');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fhexo-theme-stellar%2Fmyself%2Fsource%2Fjs%2Fservices%2Fartalk.js&lang=js&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-co96ee7ir');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        <blockquote><p>注释部分为头像获取</p></blockquote><p>css:</p><figure class="highlight css"><figcaption><span>source\mcss\mcss.css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.tag-plugin</span><span class="selector-class">.timeline</span> <span class="selector-class">.body</span> <span class="selector-tag">img</span><span class="selector-attr">[atk-emoticon]</span> &#123;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">display</span>: initial;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tag-plugin</span><span class="selector-class">.timeline</span> <span class="selector-class">.body</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注册为数据服务：</p><figure class="highlight yaml"><figcaption><span>_config.stellar.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内置服务，按需加载（页面内用到了就会加载，没有用到就不会加载）</span></span><br><span class="line"><span class="attr">data_services:</span></span><br><span class="line">  <span class="attr">artalk:</span></span><br><span class="line">    <span class="attr">js:</span> <span class="string">/js/services/artalk.js</span></span><br></pre></td></tr></table></figure><p>组件引入：</p><figure class="highlight yaml"><figcaption><span>source\_data\widgets.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">new_comment:</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="string">timeline</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">最新评论</span></span><br><span class="line">  <span class="attr">api:</span> <span class="string">https://artalk.hzchu.top/api/v2/stats/latest_comments?site_name=Thun888</span> <span class="comment"># 此处为 Artalk API 地址，末尾为站点名称</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">artalk</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10</span> <span class="comment"># 限制获取数量，默认为 10</span></span><br></pre></td></tr></table></figure><h3 id="部分用语改动"><a class="markdownIt-Anchor" href="#部分用语改动"></a> 部分用语改动</h3><figure class="highlight yaml"><figcaption><span>themes\stellar\languages\zh-CN.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meta:</span></span><br><span class="line">  <span class="attr">related_posts:</span> <span class="string">这些怎么样（￣︶￣）↗</span>　</span><br><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">search:</span> <span class="string">搜搜看</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">记录下更改</summary>
    
    
    
    <category term="瞎折腾" scheme="https://blog.hzchu.top/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="Blog" scheme="https://blog.hzchu.top/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>用Gemini，实现AI摘要</title>
    <link href="https://blog.hzchu.top/2024/%E7%94%A8Gemini%E5%AE%9E%E7%8E%B0AI%E6%91%98%E8%A6%81/"/>
    <id>https://blog.hzchu.top/2024/%E7%94%A8Gemini%E5%AE%9E%E7%8E%B0AI%E6%91%98%E8%A6%81/</id>
    <published>2024-03-09T19:31:16.000Z</published>
    <updated>2024-03-09T19:31:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>很久之前，我网上surfing的时候发现好多网站都有「AI摘要」，了解了一下发现是「<a href="https://docs_s.tianli0.top/">TianliGPT</a>」，好是好，<s>但两位数的价格还是打动不了我当时勉强三位数的存款。<s>本着能省就省的原则，我使用了一种笨方法</s>（为了撑场子没考虑太多）</s>，手动向「BingAI」发送摘要文本，获取摘要后存储在kv中，通过cfw返回。可行，但太痛苦了（这也是它叫DolGPT的原因之一），前几天看到Gemini开放了api可以免费调用，这不直接起飞<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/ablobcatrainbow.png"/></span></p><h2 id="获取gemini_key"><a class="markdownIt-Anchor" href="#获取gemini_key"></a> 获取GEMINI_KEY</h2><p>首先登录<a href="https://ai.google.dev/">ai.google.dev</a>，左上角点击<code>Get API key</code>，再在中间点<code>Create API key</code>，随便选个项目即可</p><details class="tag-plugin colorful folding" color="yellow"><summary><span>没听懂就看图片吧</span></summary><div class="body"><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523988ddc.webp?fmt=avif" alt="Snipaste_2024-03-09_10-17-37.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-09_10-17-37.webp" href="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523988ddc.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-09_10-17-37.webp</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523fecbfa.webp?fmt=avif" alt="Snipaste_2024-03-09_10-18-14.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-09_10-18-14.webp" href="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523fecbfa.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-09_10-18-14.webp</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523933f1c.webp?fmt=avif" alt="Snipaste_2024-03-09_10-22-37.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-09_10-22-37.webp" href="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523933f1c.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-09_10-22-37.webp</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523a4e8b3.webp?fmt=avif" alt="Snipaste_2024-03-09_10-23-59.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-09_10-23-59.webp" href="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523a4e8b3.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-09_10-23-59.webp</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec52371bf18.webp?fmt=avif" alt="Snipaste_2024-03-09_10-22-25.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-09_10-22-25.webp" href="https://onep.hzchu.top/mount/pic/2024/03/09/65ec52371bf18.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-09_10-22-25.webp</span></div></div></div></details><h2 id="后端程序"><a class="markdownIt-Anchor" href="#后端程序"></a> 后端程序</h2><p>因为Stellar已经配置了TianliGPT的css了，所以我也懒得另起炉灶，直接按TianliGPT的格式返回，所以理论上讲和其它的使用TianliGPT的服务也兼容</p><p>仓库：<a href="https://github.com/thun888/ai-summary/">thun888/ai-summary</a></p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/ai-summary"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=ai-summary&&show_owner=true"/></a></div><p>新建一个<code>Cloudflare Worker</code>，复制<a href="https://github.com/thun888/ai-summary/blob/master/src/index.js">/src/index.js</a>的代码粘贴进去</p><p>随后修改环境变量，填入可信来源（即只有这个域名才能调用ai摘要，如不需要可设置为<code>*</code>）（<code>ALLOWED_ORIGINS</code>）以及你的key（<code>GEMINI_KEY</code>）</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec508eb0684.webp?fmt=avif" alt="1709985925369.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1709985925369.webp" href="https://onep.hzchu.top/mount/pic/2024/03/09/65ec508eb0684.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1709985925369.webp</span></div></div><p>接着新建一个kv，并绑定到程序上</p><blockquote><p>kv的名字随意，但<strong>Variable name</strong> 必须为 <code>KV</code></p></blockquote><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec565254bdb.webp?fmt=avif" alt="1709987402272.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1709987402272.webp" href="https://onep.hzchu.top/mount/pic/2024/03/09/65ec565254bdb.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1709987402272.webp</span></div></div><p>最后可以尝试访问，有输出且刷新不变即为成功</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec54a03e7a9.webp?fmt=avif" alt="1709986972903.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1709986972903.webp" href="https://onep.hzchu.top/mount/pic/2024/03/09/65ec54a03e7a9.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1709986972903.webp</span></div></div><div class="tag-plugin colorful note" color="yellow"><div class="body"><p>该程序只实现了ai摘要生成，对于其他网站矩阵之类的功能，其实自己用哪里要得上这么多功能嘛</p></div></div><h2 id="前端程序修改"><a class="markdownIt-Anchor" href="#前端程序修改"></a> 前端程序修改</h2><p>理论上，直接替换summary.tianli0.top为你对应域名即可，但在很多情况下，你还需要额外删减一些无关api调用，如openid生成</p><p>这是我修改后的程序，可以参考</p>    <div class="tag-plugin ds-coding" id="coding-evg2dyxqb"></div>    <script>    addEventListener("load",function(){      console.log('[hexo-dynamic-codeblock]start load：coding-evg2dyxqb' );      utils.jq(() => {        $(function () {          const el = document.getElementById('coding-evg2dyxqb');            utils.request(el, "https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2Fmyblog%2Fmain%2Fsource%2Fjs%2Fchuckle-post-ai.js&lang=js&usejson=true", function (data) {              $(el).append(data.result);              addCopyButtons('coding-evg2dyxqb');            });          });      });    });    </script>    <link rel="stylesheet" href="https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css">        <p>修改完后引入到主题</p><blockquote><p>以下为针对Stellar主题</p></blockquote><figure class="highlight yaml"><figcaption><span>config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AI 摘要</span></span><br><span class="line"><span class="comment"># https://github.com/qxchuckle/Post-Summary-AI</span></span><br><span class="line"><span class="attr">tianli_gpt:</span> </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">js:</span> <span class="string">/js/chuckle-post-ai.js</span> <span class="comment">#改为对应路径</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span> </span><br><span class="line">  <span class="attr">key:</span> <span class="string">5Q5mpqRK5DkwT1X9Gi5e</span></span><br><span class="line">  <span class="attr">total_length:</span> <span class="number">3500</span> </span><br><span class="line">  <span class="attr">typewriter:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">summary_directly:</span> <span class="literal">true</span> </span><br><span class="line">  <span class="attr">rec_method:</span> <span class="string">all</span> </span><br><span class="line">  <span class="attr">hide_shuttle:</span> <span class="literal">true</span> </span><br><span class="line">  <span class="attr">summary_toggle:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">interface:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">AI摘要</span></span><br><span class="line">    <span class="attr">introduce:</span> <span class="string">&#x27;我是文章辅助AI: Gemini，点击下方的按钮，让我生成本文简介、推荐相关文章等。&#x27;</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">Gemini</span></span><br><span class="line">    <span class="attr">button:</span> [<span class="string">&quot;介绍自己&quot;</span>, <span class="string">&quot;推荐文章&quot;</span>, <span class="string">&quot;生成摘要&quot;</span>, <span class="string">&quot;矩阵穿梭&quot;</span>]</span><br></pre></td></tr></table></figure><blockquote><p>如果无效可以自己在<code>\stellar\layout\_partial\plugins\tianli_gpt.ejs</code>里修改</p></blockquote><h2 id="效果演示"><a class="markdownIt-Anchor" href="#效果演示"></a> 效果演示</h2><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/04/05/660f969dca9d3.webp?fmt=avif" alt="1712297627948.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1712297627948.webp" href="https://onep.hzchu.top/mount/pic/2024/04/05/660f969dca9d3.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1712297627948.webp</span></div></div><h2 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h2><p>其表现我个人感觉跌宕起伏，有时不如ChatGPT，有时有吊打Bing，反正免费的要什么自行车<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatmeltthumb.png"/></span></p><p>记得之前看还叫Bard，还不支持中文，没想到现在这么厉害了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/ablobcatreachrev.png"/></span></p>]]></content>
    
    
    <summary type="html">使用Cloudflare Worker，借助Gemini，平替TianliGPT</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="Blog" scheme="https://blog.hzchu.top/tags/Blog/"/>
    
    <category term="Stellar" scheme="https://blog.hzchu.top/tags/Stellar/"/>
    
    <category term="CFW" scheme="https://blog.hzchu.top/tags/CFW/"/>
    
  </entry>
  
  <entry>
    <title>记一次排查js文件后门</title>
    <link href="https://blog.hzchu.top/2024/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%8E%92%E6%9F%A5js%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8/"/>
    <id>https://blog.hzchu.top/2024/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%8E%92%E6%9F%A5js%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8/</id>
    <published>2024-03-08T20:49:57.000Z</published>
    <updated>2024-03-08T20:49:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="起因"><a class="markdownIt-Anchor" href="#起因"></a> 起因</h2><p>今天调试博客时猛地发现电脑卡的不像样，排除后发现是控制台的问题，再一看控制台里全是网络请求，这可不是好事啊</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0a705f003.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0a705f003.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0a8cca150.webp?fmt=avif" alt="Snipaste_2024-03-08_20-40-38.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-08_20-40-38.webp" href="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0a8cca150.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-08_20-40-38.webp</span></div></div><h2 id="过程"><a class="markdownIt-Anchor" href="#过程"></a> 过程</h2><p>起初，因为我回档了所有更改依然有这种情况，我猜是浏览器插件问题，但关闭了所有插件后依然如此</p><p>然后，我查看了异常js引入的时间点，并往上挨个检查</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0b8bee889.webp?fmt=avif" alt="Snipaste_2024-03-08_20-37-33.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-08_20-37-33.webp" href="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0b8bee889.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-08_20-37-33.webp</span></div></div><p>最初的异常引入在<code>sdk.html</code>，随后在js文件里依次搜索，最后定位到<code>lazyload.min.js</code></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c1adbc32.webp?fmt=avif" alt="Snipaste_2024-03-08_20-37-04.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-08_20-37-04.webp" href="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c1adbc32.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-08_20-37-04.webp</span></div></div><p>但是嘛，当我<code>在新标签页里打开</code>时，显示的又是正常的js，对比发现请求ip不同，在改hosts后成功获取到带后门的js文件</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>不正常的</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c872af1b.webp?fmt=avif" alt="Snipaste_2024-03-08_20-39-35.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-08_20-39-35.webp" href="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c872af1b.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-08_20-39-35.webp</span></div></div>    </div>    <div class="cell" style="">    <p><strong>正常的</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c89ba6b9.webp?fmt=avif" alt="Snipaste_2024-03-08_20-39-25.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-08_20-39-25.webp" href="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c89ba6b9.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-08_20-39-25.webp</span></div></div>    </div>    </div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c88232e2.webp?fmt=avif" alt="Snipaste_2024-03-08_20-42-50.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-08_20-42-50.webp" href="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c88232e2.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-08_20-42-50.webp</span></div></div><h2 id="解决方法"><a class="markdownIt-Anchor" href="#解决方法"></a> 解决方法</h2><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>将<code>https://cdn.bootcdn.net/ajax/libs</code>全部替换为<code>https://cdn.staticfile.net</code></p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0d141a263.webp?fmt=avif" alt="Snipaste_2024-03-08_20-48-17.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="Snipaste_2024-03-08_20-48-17.webp" href="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0d141a263.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">Snipaste_2024-03-08_20-48-17.webp</span></div></div>    </div>    </div>]]></content>
    
    
    <summary type="html">被bootcdn捅了一刀</summary>
    
    
    
    
    <category term="Blog" scheme="https://blog.hzchu.top/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>把Tg Channel接入到Stellar时间线</title>
    <link href="https://blog.hzchu.top/2024/%E6%8A%8ATg-Channel%E6%8E%A5%E5%85%A5%E5%88%B0Stellar%E6%97%B6%E9%97%B4%E7%BA%BF/"/>
    <id>https://blog.hzchu.top/2024/%E6%8A%8ATg-Channel%E6%8E%A5%E5%85%A5%E5%88%B0Stellar%E6%97%B6%E9%97%B4%E7%BA%BF/</id>
    <published>2024-02-25T13:19:01.000Z</published>
    <updated>2024-02-25T14:43:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>之前调CW时发现<a href="https://blog.eurekac.cn/">Cyan</a>加上了TG频道说说，因为已经有<code>Memos</code>了所以没有在意，昨天在<a href="https://xaoxuu.com/wiki/stellar/articles.html">Stellar 探索号</a>看到有<a href="https://blog.lvbyte.top/posts/11214/">stellar主题集成Telegram Channel说说</a>的教程，忽然灵光一闪，这拿来放草稿/想法挺合适的嘛</p><h2 id="正文"><a class="markdownIt-Anchor" href="#正文"></a> 正文</h2><p>首先新建一个频道，并记下频道ID</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/25/65dad341bacfd.webp?fmt=avif" alt="1708839745065.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708839745065.webp" href="https://onep.hzchu.top/mount/pic/2024/02/25/65dad341bacfd.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708839745065.webp</span></div></div><p>新建一个<code>Cloudflare Worker</code>，复制下面的代码粘贴进去</p><blockquote><p>为了兼容Stellar的时间线，我在lvbyte的基础上改了点代码</p></blockquote><script src="https://faster-gist.hzchu.top/thun888/67d8cdf1296d8dc252e9fc5607e4daf6.js"></script><p>并修改顶部配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ChannelNameList</span> = [<span class="string">&#x27;thun888sthinks&#x27;</span>]; <span class="comment">//频道ID，可添加多个</span></span><br><span class="line"><span class="keyword">const</span> deniedRegion = [<span class="string">&quot;&quot;</span>]; 屏蔽区域，如<span class="variable constant_">CN</span>,<span class="variable constant_">US</span></span><br><span class="line"><span class="keyword">const</span> baseproxyurl=<span class="string">&quot;https://get-tg-channel-api.hzchu.top/?proxy=&quot;</span> <span class="comment">//将中间域名替换为你为worker绑定的域名</span></span><br></pre></td></tr></table></figure><p>随后按照使用Memos时间线形式使用即可</p><h2 id="可传入参数"><a class="markdownIt-Anchor" href="#可传入参数"></a> 可传入参数</h2><table><thead><tr><th>参数</th><th>参数名</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>cid</td><td>频道id</td><td>0</td><td>指在代码里配置的第n个频道，并不是上文所述频道id</td></tr><tr><td>mid</td><td>信息id</td><td>/</td><td>指定后只返回该信息，信息id可在发送后查看</td></tr><tr><td><strong>tag</strong></td><td>标签名</td><td>DefaultTag</td><td>筛选传入的标签返回</td></tr><tr><td>limit</td><td>获取条数</td><td>/</td><td>/</td></tr><tr><td>offset</td><td>获取信息偏移量</td><td>/</td><td>如果有一条信息<code>id</code>为<code>80</code>的信息，那么当传入<code>80</code>时将返回这条信息之前的所有信息</td></tr><tr><td>showtag</td><td>是否展示标签</td><td>true</td><td>/</td></tr><tr><td>showview</td><td>是否展示访问量</td><td>false</td><td>启用时会在末尾附上(views:number)</td></tr><tr><td>usemd</td><td>是否使用Markdown</td><td>true</td><td>开启后返回未被tg解析过的md语法</td></tr><tr><td>usetgclassification</td><td>是否使用tg自带的分类</td><td>false</td><td>开启后使用tg自带的分类来进行标签筛选，防止过久导致无法显示。但注意会有缓存</td></tr></tbody></table><blockquote><p>众所周知，<code>0</code>是第一个自然数，所以cid传入<code>0</code>时表示获取第1个频道</p><p>tag为空时默认返回#DefaultTag的数据，可在代码中自行更改</p><p><code>tag</code>原版是<code>#SFCN</code>,一开始没想明白是什么意思，现在明白了：Suitable For China，可以有别的玩法o(￣▽￣)ｄ</p></blockquote><h2 id="在stellar中的使用"><a class="markdownIt-Anchor" href="#在stellar中的使用"></a> 在Stellar中的使用</h2><div class="tag-plugin tabs" align="center"id="tab_7"><div class="nav-tabs"><div class="tab active"><a href="#tab_7-1">在独立页面内使用</a></div><div class="tab"><a href="#tab_7-2">添加为小部件</a></div><div class="tab"><a href="#tab_7-3">进阶（使用数据服务插件）</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_7-1"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?tag=DTA&limit=3" user="thun888sthinks"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:thun888sthinks api:https://get-tg-channel-api.hzchu.top/?tag=DTA&amp;limit=3 type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><p>user为频道ID，api为你为CFW绑定的域名，type填memos</p><p>碍于篇幅限制，只展示前3条</p>    </div>    </div></div><div class="tab-pane" id="tab_7-2"><figure class="highlight yaml"><figcaption><span>/source/_data/widgets.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">timeline:</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="string">timeline</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">近期动态</span></span><br><span class="line">  <span class="attr">api:</span> <span class="string">https://get-tg-channel-api.hzchu.top/?tag=DTA&amp;limit=3</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">memos</span></span><br><span class="line">  <span class="attr">hide:</span> <span class="string">user,footer</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_7-3"><p>有一些功能在默认的设计下不能很好的实现，但是通过数据插件就可以实现了，比如动态加载更多内容，回应显示，访问量显示等</p><p>有空再写（挖坑.webp</p></div></div></div><h2 id="其它用法"><a class="markdownIt-Anchor" href="#其它用法"></a> 其它用法</h2><div class="tag-plugin tabs" align="center"id="tab_8"><div class="nav-tabs"><div class="tab active"><a href="#tab_8-1">获取其它频道</a></div><div class="tab"><a href="#tab_8-2">指定获取某条信息</a></div><div class="tab"><a href="#tab_8-3">展示访问量</a></div><div class="tab"><a href="#tab_8-4">使用Markdown</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_8-1"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?cid=1&tag=DTA&limit=3" user="Thun888sDraftArticles"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:Thun888sDraftArticles api:https://get-tg-channel-api.hzchu.top/?cid=1&amp;tag=DTA&amp;limit=3 type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure>    </div>    </div></div><div class="tab-pane" id="tab_8-2"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?cid=1&tag=Test&mid=52&showtag=false" user="Thun888sDraftArticles"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:Thun888sDraftArticles api:https://get-tg-channel-api.hzchu.top/?cid=1&amp;tag=Test&amp;mid=52&amp;showtag=false type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><p>可以用在很多地方获取某些信息，作为某种接口来使用。在这一基础上，你甚至可以修改代码，改为只返回图片，在某种意义上实现图床的效果，不过滥用可不太好啊<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatpolice.png"/></span></p>    </div>    </div></div><div class="tab-pane" id="tab_8-3"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?cid=1&tag=Test&showview=true" user="Thun888sDraftArticles"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:Thun888sDraftArticles api:https://get-tg-channel-api.hzchu.top/?cid=1&amp;tag=Test&amp;showview=true type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure>    </div>    </div></div><div class="tab-pane" id="tab_8-4"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?cid=1&tag=Test&usemd=true" user="Thun888sDraftArticles"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:Thun888sDraftArticles api:https://get-tg-channel-api.hzchu.top/?cid=1&amp;tag=Test&amp;usemd=true type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><p>在默认情况下，tg会解析md语法，对于不支持的语法会转义，从而导致前端无法正常解析md语法，在使用该参数后程序会将解析后的文本还原为正常md语法并返回。默认开启</p>    </div>    </div></div></div></div><p>相关配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ChannelNameList</span> = [<span class="string">&#x27;thun888sthinks&#x27;</span>,<span class="string">&#x27;Thun888sDraftArticles&#x27;</span>];</span><br></pre></td></tr></table></figure><h2 id="变体"><a class="markdownIt-Anchor" href="#变体"></a> 变体</h2><h3 id="反向筛选"><a class="markdownIt-Anchor" href="#反向筛选"></a> 反向筛选</h3><p>将<code>if (MessageTextMatch &amp;&amp; (!denied &amp;&amp; MessageTextMatch[0].includes('#' + tagname))) &#123;</code>修改为<code>if (MessageTextMatch &amp;&amp; (!denied || MessageTextMatch[0].includes('#' + tagname))) &#123;</code></p><h3 id="文本筛选"><a class="markdownIt-Anchor" href="#文本筛选"></a> 文本筛选</h3><p>将<code>MessageTextMatch[0].includes('#' + tagname)</code>修改为<code>MessageTextMatch[0].includes('yourtext')</code></p><h2 id="todo"><a class="markdownIt-Anchor" href="#todo"></a> Todo</h2><ul><li>[x] 可在请求时选择过滤哪个tag</li><li>[x] 完善Emoji支持</li><li>[x] 前端传入标签名</li><li>[x] 可选显示标签名及访问量</li><li>[x] 获取指定信息</li><li>[x] 多频道支持</li><li>[ ] 表情包标签解析</li><li>[ ] 自定义是否显示引用</li><li>[ ] 可传入需要返回的名称</li><li>[x] 可选使用tg自带分类</li></ul><h2 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h2><p>它可以使静态博客进一步动态化，加强可玩性，也可在很多地方使用。</p><p>如果你有一些像<code>多频道融合</code>，<code>多标签获取</code>的功能建议，那就大可不必了，毕竟它一开始只是一个说说程序啊<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/ablobcatrainbow.png"/></span></p>]]></content>
    
    
    <summary type="html">使用Cloudflare Worker，获取Tg频道内容，并接入到Stellar时间线</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="Stellar" scheme="https://blog.hzchu.top/tags/Stellar/"/>
    
  </entry>
  
  <entry>
    <title>使用Homebox实现家用物品管理</title>
    <link href="https://blog.hzchu.top/2024/%E4%BD%BF%E7%94%A8Homebox%E5%AE%9E%E7%8E%B0%E5%AE%B6%E7%94%A8%E7%89%A9%E5%93%81%E7%AE%A1%E7%90%86/"/>
    <id>https://blog.hzchu.top/2024/%E4%BD%BF%E7%94%A8Homebox%E5%AE%9E%E7%8E%B0%E5%AE%B6%E7%94%A8%E7%89%A9%E5%93%81%E7%AE%A1%E7%90%86/</id>
    <published>2024-02-12T22:41:07.000Z</published>
    <updated>2024-02-17T09:30:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>很久之前，家里面有三把电动螺丝刀，然而前些阵子我想找一把来用都得找半天……  <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcaged.png"/></span></p><p>假期回家，桌面太乱了一直被我妈批斗…… <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatflip.png"/></span></p><p>思来想去这样也不行啊，上网找一下，发现了「<a href="https://d.hzchu.top/9x7up">Homebox</a>」这个程序，开始干活吧。</p><h2 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h2><p>仓库中也有二进制文件，我这里直接用Docker部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run the image</span></span><br><span class="line">$ docker run -d \</span><br><span class="line">  --name homebox \</span><br><span class="line">  --restart unless-stopped \</span><br><span class="line">  --publish 3100:7745 \</span><br><span class="line">  --<span class="built_in">env</span> TZ=Europe/Bucharest \</span><br><span class="line">  --volume /path/to/data/folder/:/data \</span><br><span class="line">  ghcr.io/hay-kot/homebox:latest</span><br></pre></td></tr></table></figure><p>或用<code>Docker-Compose</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.4&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">homebox:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/hay-kot/homebox:latest</span></span><br><span class="line"><span class="comment">#   image: ghcr.io/hay-kot/homebox:latest-rootless</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">homebox</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HBOX_LOG_LEVEL=info</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HBOX_LOG_FORMAT=text</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HBOX_WEB_MAX_UPLOAD_SIZE=10</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">homebox-data:/data/</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3100</span><span class="string">:7745</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">   <span class="attr">homebox-data:</span></span><br><span class="line">     <span class="attr">driver:</span> <span class="string">local</span></span><br></pre></td></tr></table></figure><p>因为还有可能给家里人用，干脆就nginx一条龙服务安排上，搭配家里面ADG上dns重写，家里人直接访问<code>wms.hzchu.top</code>就ok了</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0304ed4e06.webp?fmt=avif" alt="1708142670501.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708142670501.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0304ed4e06.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708142670501.webp</span></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d039c6a395f.webp?fmt=avif" alt="1708145094118.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708145094118.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d039c6a395f.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708145094118.webp</span></div></div>    </div>    </div><blockquote><p>部署完成进去后注册一个账号登录即可</p></blockquote><h2 id="homebox简单介绍"><a class="markdownIt-Anchor" href="#homebox简单介绍"></a> HomeBox简单介绍</h2><p>知道它的功能才好干活嘛</p><p>相比于「GreaterWMS」，「ModernWMS」等专门用于仓库管理的软件，「<a href="https://github.com/hay-kot/homebox">Homebox</a>」主打一个家用，因此它的操作也简单不少，在进去后可以看到这样的页面</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0714ba9aca.webp?fmt=avif" alt="1708159306854.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708159306854.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0714ba9aca.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708159306854.webp</span></div></div><h3 id="create创建"><a class="markdownIt-Anchor" href="#create创建"></a> Create–创建</h3><p>在点开那个<mark class="tag-plugin colorful mark" color="green">抹茶绿</mark>的按钮后，可以看到里面包括 <code>Item/Asset</code>,<code>Location</code>,<code>Label</code> 三个选项</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>Item/Asset：</strong><code>新建物品</code>，即存入物品相关信息到程序里，里面包括以下填充项</p><blockquote><p>在填写完成后，若只新建单个物品，则会跳转至对应物品详情，可以做详细修改</p></blockquote>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d079ec36954.webp?fmt=avif" alt="1708161509640.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708161509640.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d079ec36954.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708161509640.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>Location：</strong> <code>新建位置</code>，即存入某个物品存放处（如书桌）的相关信息到程序里，里面包括以下填充项</p><p>在“父位置”中，可以设置其它已新建的”位置“，表示该位置属于某位置，比如这样</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d07cd0526a0.webp?fmt=avif" alt="1708162255778.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708162255778.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d07cd0526a0.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708162255778.webp</span></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d07c7458c53.webp?fmt=avif" alt="1708162163736.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708162163736.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d07c7458c53.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708162163736.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>Label：</strong><code>新建类别</code>，即存入某个物品类别（如电子产品）的相关信息到程序里，里面包括以下填充项</p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d07d6a352db.webp?fmt=avif" alt="1708162409464.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708162409464.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d07d6a352db.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708162409464.webp</span></div></div>    </div>    </div><h3 id="home主页"><a class="markdownIt-Anchor" href="#home主页"></a> Home–主页</h3><p>在加载完成时便是主页了，图片上面有，主要显示了<code>物品总金额</code>，<code>物品、位置、类别总数</code>，<code>近期添加的5个物品</code>，<code>位置、类别列表</code></p><h3 id="locations位置树"><a class="markdownIt-Anchor" href="#locations位置树"></a> Locations–位置（树）</h3><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>根据创建物品/位置时的父位置，程序会构建出一个层级树，简明地展现出它们之间的从属关系</p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0897a5f3d3.webp?fmt=avif" alt="1708165497793.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708165497793.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0897a5f3d3.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708165497793.webp</span></div></div>    </div>    </div><h3 id="search搜索"><a class="markdownIt-Anchor" href="#search搜索"></a> Search–搜索</h3><p>顾名思义</p><h3 id="profile用户设置"><a class="markdownIt-Anchor" href="#profile用户设置"></a> Profile–用户设置</h3><p>直接上图片</p><div class="tag-plugin swiper fancybox" id="swiper-api" ><div class="swiper-wrapper"><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0910f6ac67.webp?fmt=avif" alt="1708167438646.webp" data-fancybox="true"/></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d092acdc522.webp?fmt=avif" alt="1708167851852.webp" data-fancybox="true"/></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev blur"></div><div class="swiper-button-next blur"></div></div><h3 id="tools工具"><a class="markdownIt-Anchor" href="#tools工具"></a> Tools–工具</h3><p>包括<code>标签生成器</code>，<code>生成BOM表</code>，导<code>入导出CSV</code>及一些<code>修复工具</code></p><p>我主要用的是<code>标签生成器</code>，可以直接生成二维码贴在物品表面</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0cc5ba2019.webp?fmt=avif" alt="1708182617875.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708182617875.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0cc5ba2019.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708182617875.webp</span></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d094a2d831a.webp?fmt=avif" alt="1708168353440.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708168353440.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d094a2d831a.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708168353440.webp</span></div></div>    </div>    </div><blockquote><p>调好参数右键打印即可</p></blockquote><h3 id="物品详情"><a class="markdownIt-Anchor" href="#物品详情"></a> 物品详情</h3><p>很详细，但我除了数量和描述都用不上</p><div class="tag-plugin swiper fancybox" id="swiper-api" ><div class="swiper-wrapper"><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0d75c667cc.webp?fmt=avif" alt="1708185435353.webp" data-fancybox="true"/></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0d762bef44.webp?fmt=avif" alt="1708185441662.webp" data-fancybox="true"/></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0d76b8cc90.webp?fmt=avif" alt="1708185450333.webp" data-fancybox="true"/></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev blur"></div><div class="swiper-button-next blur"></div></div><blockquote><p>存在页面切换bug，刷新即可解决</p></blockquote><h2 id="基本逻辑"><a class="markdownIt-Anchor" href="#基本逻辑"></a> 基本逻辑</h2><p>为了能准确快速地找到对应存放处，我定了一套基本原则：</p><ol><li>将几个房间用A/B…大写英文字母命名</li><li>存放处使用所属房间加数字命名</li><li>以房间门为起点，向右统计入库</li><li>对应垂直堆叠的存放处，从上往下（优先）</li></ol><p>对应物品本体：</p><ol><li>对与中等大小物品，使用上文提到的二维码标签，</li><li>小物品用一维码标签，</li><li>再小就不贴标签，改用荧光笔加胶布或直接跳过</li><li>整理时从俯视角度，按入库顺序从左往右，从上到下排列（可选）</li><li>对已有唯一标识码（sn码）的物品直接使用</li></ol><p>程序内列了四个类别（感觉除了日后忘了物品名称关键词，用来筛选物品外其实没啥用）：大物件，小物件，收纳盒，电子产品</p><h2 id="实际实施"><a class="markdownIt-Anchor" href="#实际实施"></a> 实际实施</h2><p>因为一开始没发现自带的<code>标签生成器</code>，所以用了「<a href="https://d.hzchu.top/d4a5q">E-Label</a>」来生成一维码，单页85个标签</p><p>其中，A/B…表示该物品原属房间</p><p>标签内容填入物品描述中</p><div class="tag-plugin link dis-select"><a class="link-card rich" title="相关文件" href="https://pan.hzchu.top/s/q8SJ" target="_blank" rel="external nofollow noopener noreferrer" cardlink api="https://siteinfo-api.hzchu.top/api/v1?url=https://pan.hzchu.top/s/q8SJ" autofill="icon,desc"><div class="top"><div class="lazy img" data-bg="https://static.hzchu.top/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div><span class="cap link footnote">https://pan.hzchu.top/s/q8SJ</span></div><div class="bottom"><span class="title">相关文件</span><span class="cap desc footnote"></span></div></a></div><blockquote><p>还可以把文字缩掉，但考虑到一维码水平方向易被损坏还是留着吧</p></blockquote><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0bf9185724.webp?fmt=avif" alt="1708179344734.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708179344734.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0bf9185724.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708179344734.webp</span></div></div>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c4802d0ff.webp?fmt=avif" alt="1708180607272.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708180607272.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c4802d0ff.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708180607272.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>打印完标签贴到物品上，我这里先用胶布凑合以下，注意要同时覆盖字符及一部分条形码（如图片荧光标准所示）</p><blockquote><p>注：图示条形码为第一版</p></blockquote>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c2b702e65.webp?fmt=avif" alt="1708179885315.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708179885315.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c2b702e65.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708179885315.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>不过还是太麻烦，所以我打算用这种带有不干胶的纸替代，不过因为春节还没到货<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcry.png"/></span></p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c6028e723.webp?fmt=avif" alt="1708180983135.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708180983135.webp" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c6028e723.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708180983135.webp</span></div></div>    </div>    </div><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><p>​那么，工期呢？要对小到一颗纽扣电池进行统计本身就不是一件快事，整理一个小时才勉强整理完一张桌子，想全部整理完必然是一个大工程，慢慢来。但全部整理一次确实大有益处，比如我就找到了8年前在某购物广场办的会员卡（前一天才因为没有实体会员卡不给兑积分<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatangry.png"/></span>，这波雪中送炭），因为中途方案改变，要等这个打印纸，就先搁置下来了，<s>才不是因为帕鲁太好玩了</s></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0cbae30c5d.webp?fmt=avif" alt="导弹喵" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="导弹喵" href="https://onep.hzchu.top/mount/pic/2024/02/17/65d0cbae30c5d.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">导弹喵</span></div></div><h2 id="续"><a class="markdownIt-Anchor" href="#续"></a> 续</h2><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>自带的标签生成器中页面中仍有大量留白，实用性欠佳，有空想办法搓个更好用的</p><blockquote><p>打印机过个回南天病情恶化了，不是不能用（</p></blockquote>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/24/65d9e74ecd25b.webp?fmt=avif" alt="1708779215832.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708779215832.webp" href="https://onep.hzchu.top/mount/pic/2024/02/24/65d9e74ecd25b.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708779215832.webp</span></div></div>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>可根据物品大小裁剪，在默认情况下规格约为48x21mm</p>    </div>    <div class="cell" style="">    <div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/02/24/65d9e756bd973.webp?fmt=avif" alt="1708779215823.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1708779215823.webp" href="https://onep.hzchu.top/mount/pic/2024/02/24/65d9e756bd973.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1708779215823.webp</span></div></div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"></div>    </div>    <div class="cell" style="">    <p>实际使用</p>    </div>    <div class="cell" style="">    <div id="player_6cc3e893806c4850"></div><script type="text/javascript" src="https://player.dogecloud.com/js/loader"></script><script type="text/javascript">var player = new DogePlayer({    container: document.getElementById('player_6cc3e893806c4850'),    userId: 4322,    vcode: '6cc3e893806c4850',    autoPlay: false});</script>    </div>    </div>]]></content>
    
    
    <summary type="html">唉，家里太乱了，该整理一下了</summary>
    
    
    
    <category term="生活小事" scheme="https://blog.hzchu.top/categories/%E7%94%9F%E6%B4%BB%E5%B0%8F%E4%BA%8B/"/>
    
    
    <category term="Homebox" scheme="https://blog.hzchu.top/tags/Homebox/"/>
    
    <category term="家用" scheme="https://blog.hzchu.top/tags/%E5%AE%B6%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>峰间云海服务器技术分析</title>
    <link href="https://blog.hzchu.top/2024/%E5%B3%B0%E9%97%B4%E4%BA%91%E6%B5%B7%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90/"/>
    <id>https://blog.hzchu.top/2024/%E5%B3%B0%E9%97%B4%E4%BA%91%E6%B5%B7%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90/</id>
    <published>2024-02-08T22:00:12.000Z</published>
    <updated>2024-02-12T22:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>​2023年的暑假，在我百般聊赖之际，网上冲浪时刷到了一个 mc服务器的视频。于是呼，心里萌发了一个想法——建立一个属于自己的服务器。在考虑的各种因素后，我选择了“纯生存”这个主题（之前都是玩命令的，很少沉下心来好好玩玩生存，也算是圆个心愿吧）。然后嘛，路走窄了，因为<code>时机不恰当，稳定性欠佳，玩法单调</code>等致命负面因素，好嘛，<s>它没了</s>（还活着，但在线玩家数量≤3罢了）。毕竟玩家数量跟投入的预算完全不成正比，没啥动力开，让我不禁想起了之前和酷安上一个老哥「<a href="https://d.hzchu.top/yhe5t">Ifkn_271</a>」合作，结果也是这样消失在互联网茫茫大海之中。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatumm.png"/></span></p><p>​不过话说回来，还是有投入了很多精力在上面的，时至今日，随着「go-cqhttp」项目寿终正寝，加上自己硬盘爆炸带来的数据库丢失，目前只剩下核心的游戏服务端还能用了，今天写一篇文章来<s>追悼</s>怀念一下吧。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatread.png"/></span></p><h2 id="内容索引"><a class="markdownIt-Anchor" href="#内容索引"></a> 内容索引</h2><ol><li><a href="#%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF">MCDR插件及部分服务端配置</a></li><li><a href="#Dynmap">Dynmap设置MySQL存储及使用独立Web服务器</a></li><li><a href="#%E5%9C%A8%E7%BA%BF%E6%9C%8D%E5%8A%A1">在线服务平台程序解析及部分代码片段</a></li><li><a href="#QQ-BOT">QQ机器人中自动添加离线用户白名单、聊天信息同步及图片上传</a></li><li><a href="#%E6%9D%82%E9%A1%B9">杂项</a></li></ol><h2 id="介绍"><a class="markdownIt-Anchor" href="#介绍"></a> 介绍</h2><p>​关于服务器的信息在<a href="/wiki/fcloud/">这里</a>可以看<br />​当然，在上面没有涉及到技术部分。总的来说，一共涉及到了「服务端主体及相应插件」，「网页前端、后端」 ，「QQ机器人」， 「Dynmap」这几个部分，大体架构如下</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c60196f2896.webp?fmt=avif" alt="Snipaste_2024-02-09_11-13-44.webp" /></p><p>以上，听我慢慢道来</p><h2 id="游戏服务端"><a class="markdownIt-Anchor" href="#游戏服务端"></a> 游戏服务端</h2><p>这方面大家各有不同，我这也不是最优选，就一笔带过</p><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">外围服务</span><span class="empty"></span></p></div><p>​由于当时没找到使用于fabric的登录插件，被迫增加了BC和一个独立的登录服务端。在前者我用了「Geyser」和「PixelMOTD」，一个用于转换be版于java版的通信协议，另一个用来处理motd请求，看起来更加高大上。后者用了雪之樱的整合包，并加了<code>BungeeAutoJoinServer</code>模组，在<code>Authme</code>登录事件结束后自动进入服务器。</p><p>​虽然臃肿了点，但也有好处，比如<code>防假人压测，motd攻击</code>之类。</p><a class="tag-plugin colorful hashtag" color="orange" href="https://d.hzchu.top/libmr"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>Geyser</span></a><a class="tag-plugin colorful hashtag" color="yellow" href="https://d.hzchu.top/cwlew"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>PixelMOTD</span></a><a class="tag-plugin colorful hashtag" color="green" href="https://d.hzchu.top/i8gan"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>BungeeAutoJoinServer</span></a><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">MCDR</span><span class="empty"></span></p></div><p>不懂Java，但又得对服务端运行做出干涉，这就得请出<code>MCDReforged</code>了</p><a class="tag-plugin colorful hashtag" color="cyan" href="https://d.hzchu.top/uumvr"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>MCDReforged</span></a><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c5cd66b7da9.webp?fmt=avif" alt="1707461988568.webp" /></p><ol><li>清除掉落物</li></ol><figure class="highlight python"><figcaption><span>\mcdr_server\plugins\cleandrops.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PLUGIN_METADATA = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;cleanitem&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;1.0.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;扫地僧&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mcdreforged.api.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clear_drops</span>(<span class="params">server: PluginServerInterface</span>):</span><br><span class="line">    server.execute(<span class="string">&#x27;tellraw @a &#123;&quot;text&quot;:&quot;30秒后清除掉落物&quot;,&quot;color&quot;:&quot;yellow&quot;&#125;&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">30</span>)</span><br><span class="line">    server.execute(<span class="string">&#x27;kill @e[type=item]&#x27;</span>)</span><br><span class="line">    server.execute(<span class="string">&#x27;tellraw @a &#123;&quot;text&quot;:&quot;掉落物已清除!&quot;,&quot;color&quot;:&quot;yellow&quot;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_info</span>(<span class="params">server: PluginServerInterface, info: Info</span>):</span><br><span class="line">    <span class="keyword">if</span> info.content == <span class="string">&#x27;!!cleardrops&#x27;</span>:</span><br><span class="line">        clear_drops(server)</span><br><span class="line"></span><br><span class="line"><span class="meta">@new_thread(<span class="params">PLUGIN_METADATA[<span class="string">&#x27;id&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_load</span>(<span class="params">server, old</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        clear_drops(server)</span><br><span class="line">        time.sleep(<span class="number">86400</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>插件运行在新的线程中，<s>可以放心睡</s>。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/ablobcatreachrev.png"/></span>当然，最好还是用「<a href="https://modrinth.com/mod/cleardespawn">ClearDespawn</a>」</p><ol start="2"><li>聊天记录统计</li></ol><figure class="highlight python"><figcaption><span>\mcdr_server\plugins\talk.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">PLUGIN_METADATA = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;talksave&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;1.0.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;记录玩家聊天记录&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置区域</span></span><br><span class="line">DATABASE = &#123;</span><br><span class="line">    <span class="string">&#x27;host&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database&#x27;</span>: <span class="string">&#x27;database&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"><span class="keyword">from</span> mcdreforged.api.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># def on_load(server, old):</span></span><br><span class="line"><span class="comment">#     server.logger.info(&#x27;Hello world!&#x27;)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_user_info</span>(<span class="params">server: PluginServerInterface, info: Info</span>):</span><br><span class="line">    <span class="comment"># 获取玩家名和聊天消息内容</span></span><br><span class="line">    player = info.player</span><br><span class="line">    message = info.content</span><br><span class="line">    <span class="comment">#server.logger.info(f&#x27;&#123;player&#125; 发送了消息：&#123;message&#125;&#x27;)</span></span><br><span class="line">    <span class="keyword">if</span> player <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> message <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> message.startswith(<span class="string">&#x27;!!MCDR&#x27;</span>) <span class="keyword">or</span> message.startswith(<span class="string">&#x27;!!plp&#x27;</span>) <span class="keyword">or</span> message.startswith(<span class="string">&#x27;!!day&#x27;</span>) <span class="keyword">or</span> message ==<span class="string">&quot;stop&quot;</span> <span class="keyword">or</span> message ==<span class="string">&quot;&quot;</span> <span class="keyword">or</span> message.startswith(<span class="string">&#x27;!!qb&#x27;</span>) <span class="keyword">or</span> message.startswith(<span class="string">&#x27;tellraw&#x27;</span>) <span class="keyword">or</span> message.startswith(<span class="string">&#x27;list&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># 此部分判断是否为MCDR命令，可根据自己插件不同调整</span></span><br><span class="line">    <span class="comment"># 也可与nb联动，同步信息到qq，不过我手抖把代码删了</span></span><br><span class="line">    conn= mysql.connector.connect(**DATABASE)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    sql = <span class="string">&quot;INSERT INTO chat (playername, msg, time) VALUES (%s, %s, NOW())&quot;</span></span><br><span class="line">    val = (player, message)</span><br><span class="line">    cursor.execute(sql, val)</span><br><span class="line">    conn.commit()</span><br><span class="line">    cursor.close()</span><br></pre></td></tr></table></figure><blockquote><p>使用<code>sudo pip install mysql-connector-python </code>安装依赖</p></blockquote><p><img src="https://onep.hzchu.top/mount/pic/myself/2024/07/66961677a8d46.png?fmt=avif" alt="表结构" /></p><p>记录聊天记录到数据库，日后可以查询</p><ol start="3"><li>「银行」</li></ol><p>用下界合金为货币，存储到数据库中，本想和商店搭配使用的，没写完就不放了</p><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">服务端本体</span><span class="empty"></span></p></div><ol><li>既然是生存，必然绕不开一些生电类机器，<s>无脑投入carpet的怀抱</s></li></ol><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c5f68769fba.webp?fmt=avif" alt="已修改的Carpet选项" /></p><ol start="2"><li>Tab玩家列表用<code>styledplayerlist</code>微调了下</li></ol><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c5f7ea88e5e.webp?fmt=avif" alt="还行吧" /></p><figure class="highlight json"><figcaption><span>\server\config\styledplayerlist\styles\default.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;style_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Default&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;update_tick_time&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;list_header&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;&lt;gr:#ff6c00:#ff6c00&gt;&lt;bold&gt;峰间云海&lt;/bold&gt;&lt;/gr&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;&lt;color:#555555&gt;&lt;strikethrough&gt;        &lt;/strikethrough&gt;[ &lt;/color&gt;&lt;color:#FF5555&gt;%server:online%&lt;color:#6666676&gt;/&lt;/color&gt;%server:max_players%&lt;/color&gt;&lt;color:#555555&gt; ]&lt;strikethrough&gt;        &lt;/strikethrough&gt;&lt;/color&gt;&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;list_footer&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;&lt;color:#555555&gt;&lt;strikethrough&gt;                          &lt;/strikethrough&gt;&lt;/color&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;&lt;gray&gt;TPS: %server:tps_colored% &lt;dark_gray&gt;|&lt;/dark_gray&gt;&lt;gray&gt; MSPT: %server:mspt_colored% &lt;dark_gray&gt;|&lt;/dark_gray&gt; &lt;gray&gt;RAM: &lt;color:#54fc54&gt;%server:used_ram%/%server:max_ram%MB&lt;/color&gt; &lt;dark_gray&gt;|&lt;/dark_gray&gt; &lt;gray&gt;Ping: &lt;color:#ffba26&gt;%player:ping%ms&lt;/color&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;&lt;gray&gt;游戏时间：%world:time% &lt;dark_gray&gt;|&lt;/dark_gray&gt; &lt;gray&gt;现实时间：%server:time% &lt;dark_gray&gt;|&lt;/dark_gray&gt; &lt;gray&gt;实体数量：%world:mob_count%&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hidden_in_commands&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>Simple Voice Chat</li></ol><p>平时还有几条frp线路备用，而SVC默认使用<code>当前连接的ip+24454</code>进行连接，导致使用frp线路时无法使用，只好在配置里指定连接host</p><figure class="highlight properties"><figcaption><span>\config\voicechat\voicechat-server.properties:29</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The host name that clients should use to connect to the voice chat</span></span><br><span class="line"><span class="comment"># This may also include a port, e.g. &#x27;example.com:24454&#x27;</span></span><br><span class="line"><span class="comment"># Don&#x27;t change this value if you don&#x27;t know what you are doing</span></span><br><span class="line"><span class="attr">voice_host</span>=<span class="string">mcvoice.hzchu.top\:24454</span></span><br><span class="line"><span class="comment"># 其它设置无需调整</span></span><br></pre></td></tr></table></figure><blockquote><p>需开放UDP协议！</p></blockquote><p>其它就没什么改动了，添加的插件列表在<a href="/wiki/fcloud/">这里</a></p><h2 id="外围应用"><a class="markdownIt-Anchor" href="#外围应用"></a> 外围应用</h2><div class="tag-plugin quot"><h3 class="content" id="Dynmap" type="icon"><img class="icon prefix" src="https://onep.hzchu.top/mount/pic/2024/02/09/65c648ae99185.webp?fmt=avif" /><span class="text">Dynmap</span><span class="empty"></span></h3></div><p>如官方简介里说的一样，这是一个<code>Google Maps-like map for your Minecraft server</code>，可以把服务器存档渲染成像谷歌地图般的在线网页供其他人查看</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c64a1aabf74.webp?fmt=avif" alt="无奖竞猜生物群落" /></p><p>通常情况下，大部分人装好就直接用了，可能再反代一下默认的8123端口，定个自定义路径访问。不过聪明的你从上面的架构图中应该已经发现了不同。没看清？再看一次</p><pre class="mermaid">flowchart LR    A[User] <-->|visit or talk| B[Dynmap Forestage]    B <--> C(MySQL)    C <--> D[Dynmap Backstage]</pre><p>为了实现上述访问流程，需要对原有设置做出一定调整</p><p>我参考了这篇文章，国内好像还没人写过，我就当个搬运工，<s>绝对不是水字数</s>。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/cdn-x/emoji/tieba/滑稽.png"/></span></p><div class="tag-plugin link dis-select"><a class="link-card rich" title="" href="https://bleepcoder.com/cn/dynmap/493645860/tutorial-setting-up-a-standalone-web-server-with-mysql" target="_blank" rel="external nofollow noopener noreferrer" cardlink api="https://siteinfo-api.hzchu.top/api/v1?url=https://bleepcoder.com/cn/dynmap/493645860/tutorial-setting-up-a-standalone-web-server-with-mysql" autofill="title,desc"><div class="top"><div class="lazy img" data-bg="https://onep.hzchu.top/mount/pic/2024/02/17/65d0215f11a29.webp?fmt=avif"></div><span class="cap link footnote">https://bleepcoder.com/cn/dynmap/493645860/tutorial-setting-up-a-standalone-web-server-with-mysql</span></div><div class="bottom"><span class="title">https://bleepcoder.com/cn/dynmap/493645860/tutorial-setting-up-a-standalone-web-server-with-mysql</span><span class="cap desc footnote"></span></div></a></div><ol><li><p>首先先新建一个数据库，如果能设置允许访问范围的话最好只包括本机和服务端的ip</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c6d4d801cf7.webp?fmt=avif" alt="1707529430723.webp" /></p></li><li><p>修改以下配置</p></li></ol><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>更改前</strong></p><div class="tag-plugin colorful note" color="red" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:28</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="comment"># Filetree storage (standard tree of image files for maps)</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">filetree</span></span><br><span class="line">  <span class="comment"># SQLite db for map storage (uses dbfile as storage location)</span></span><br><span class="line">  <span class="comment">#type: sqlite</span></span><br><span class="line">  <span class="comment">#dbfile: dynmap.db</span></span><br><span class="line">  <span class="comment"># MySQL DB for map storage (at &#x27;hostname&#x27;:&#x27;port&#x27; with flags &quot;flags&quot; in database &#x27;database&#x27; using user &#x27;userid&#x27; password &#x27;password&#x27; and table prefix &#x27;prefix&#x27;)</span></span><br><span class="line">  <span class="comment">#type: mysql</span></span><br><span class="line">  <span class="comment">#hostname: localhost</span></span><br><span class="line">  <span class="comment">#port: 3306</span></span><br><span class="line">  <span class="comment">#database: dynmap</span></span><br><span class="line">  <span class="comment">#userid: dynmap</span></span><br><span class="line">  <span class="comment">#password: dynmap</span></span><br><span class="line">  <span class="comment">#prefix: &quot;&quot;</span></span><br></pre></td></tr></table></figure></div></div>    </div>    <div class="cell" style="">    <p><strong>更改后</strong></p><div class="tag-plugin colorful note" color="green" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:28</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="comment"># Filetree storage (standard tree of image files for maps)</span></span><br><span class="line">  <span class="comment">#type: filetree &lt;- DONT FORGET TO COMMENT THIS OUT</span></span><br><span class="line">  <span class="comment"># SQLite db for map storage (uses dbfile as storage location)</span></span><br><span class="line">  <span class="comment">#type: sqlite</span></span><br><span class="line">  <span class="comment">#dbfile: dynmap.db</span></span><br><span class="line">  <span class="comment"># MySQL DB for map storage (at &#x27;hostname&#x27;:&#x27;port&#x27; with flags &quot;flags&quot; in database &#x27;database&#x27; using user &#x27;userid&#x27; password &#x27;password&#x27; and table prefix &#x27;prefix&#x27;)</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">hostname:</span> <span class="string">&lt;mysql_ip&gt;</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">&lt;mysql_port&gt;</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">&lt;mysql_database&gt;</span></span><br><span class="line">  <span class="attr">userid:</span> <span class="string">&lt;dynmap_mysql_user&gt;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&lt;dynmap_mysql_password&gt;</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">&quot;&quot;</span> <span class="comment"># Can add prefix for tables if you want</span></span><br></pre></td></tr></table></figure></div></div>    </div>    </div><div class="tag-plugin colorful note" color="blue"><div class="body"><p>如果使用SQLite取消对应注释即可，路径可写绝对路径，把数据库放到硬盘空间充足的地方</p></div></div><p>随后，注释掉<code>- class: org.dynmap.InternalClientUpdateComponent</code>所有内容并<strong>取消</strong>注释<code>- class: org.dynmap.JsonFileClientUpdateComponent</code>所有内容</p><details class="tag-plugin colorful folding" ><summary><span>所修改内容</span></summary><div class="body"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>更改前</strong></p><div class="tag-plugin colorful note" color="red" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:54</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">class:</span> <span class="string">org.dynmap.InternalClientUpdateComponent</span></span><br><span class="line">  <span class="attr">sendhealth:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sendposition:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">allowwebchat:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">webchat-interval:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">hidewebchatip:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">trustclientname:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">includehiddenplayers:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># (optional) if true, color codes in player display names are used</span></span><br><span class="line">  <span class="attr">use-name-colors:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># (optional) if true, player login IDs will be used for web chat when their IPs match</span></span><br><span class="line">  <span class="attr">use-player-login-ip:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># (optional) if use-player-login-ip is true, setting this to true will cause chat messages not matching a known player IP to be ignored</span></span><br><span class="line">  <span class="attr">require-player-login-ip:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># (optional) block player login IDs that are banned from chatting</span></span><br><span class="line">  <span class="attr">block-banned-player-chat:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Require login for web-to-server chat (requires login-enabled: true)</span></span><br><span class="line">  <span class="attr">webchat-requires-login:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If set to true, users must have dynmap.webchat permission in order to chat</span></span><br><span class="line">  <span class="attr">webchat-permissions:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Limit length of single chat messages</span></span><br><span class="line">  <span class="attr">chatlengthlimit:</span> <span class="number">256</span></span><br><span class="line"><span class="comment">#  # Optional - make players hidden when they are inside/underground/in shadows (#=light level: 0=full shadow,15=sky)</span></span><br><span class="line"><span class="comment">#  hideifshadow: 4</span></span><br><span class="line"><span class="comment">#  # Optional - make player hidden when they are under cover (#=sky light level,0=underground,15=open to sky)</span></span><br><span class="line"><span class="comment">#  hideifundercover: 14</span></span><br><span class="line"><span class="comment">#  # (Optional) if true, players that are crouching/sneaking will be hidden </span></span><br><span class="line">  <span class="attr">hideifsneaking:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If true, player positions/status is protected (login with ID with dynmap.playermarkers.seeall permission required for info other than self)</span></span><br><span class="line">  <span class="attr">protected-player-info:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If true, hide players with invisibility potion effects active</span></span><br><span class="line">  <span class="attr">hide-if-invisiblity-potion:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If true, player names are not shown on map, chat, list</span></span><br><span class="line">  <span class="attr">hidenames:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#- class: org.dynmap.JsonFileClientUpdateComponent</span></span><br><span class="line"><span class="comment">#  writeinterval: 1</span></span><br><span class="line"><span class="comment">#  sendhealth: true</span></span><br><span class="line"><span class="comment">#  sendposition: true</span></span><br><span class="line"><span class="comment">#  allowwebchat: true</span></span><br><span class="line"><span class="comment">#  webchat-interval: 5</span></span><br><span class="line"><span class="comment">#  hidewebchatip: false</span></span><br><span class="line"><span class="comment">#  includehiddenplayers: false</span></span><br><span class="line"><span class="comment">#  use-name-colors: false</span></span><br><span class="line"><span class="comment">#  use-player-login-ip: false</span></span><br><span class="line"><span class="comment">#  require-player-login-ip: false</span></span><br><span class="line"><span class="comment">#  block-banned-player-chat: true</span></span><br><span class="line"><span class="comment">#  hideifshadow: 0</span></span><br><span class="line"><span class="comment">#  hideifundercover: 0</span></span><br><span class="line"><span class="comment">#  hideifsneaking: false</span></span><br><span class="line"><span class="comment">#  # Require login for web-to-server chat (requires login-enabled: true)</span></span><br><span class="line"><span class="comment">#  webchat-requires-login: false</span></span><br><span class="line"><span class="comment">#  # If set to true, users must have dynmap.webchat permission in order to chat</span></span><br><span class="line"><span class="comment">#  webchat-permissions: false</span></span><br><span class="line"><span class="comment">#  # Limit length of single chat messages</span></span><br><span class="line"><span class="comment">#  chatlengthlimit: 256</span></span><br><span class="line"><span class="comment">#  hide-if-invisiblity-potion: true</span></span><br><span class="line"><span class="comment">#  hidenames: false</span></span><br></pre></td></tr></table></figure></div></div>    </div>    <div class="cell" style="">    <p><strong>更改后</strong></p><div class="tag-plugin colorful note" color="green" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:54</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - class: org.dynmap.InternalClientUpdateComponent</span></span><br><span class="line">   <span class="comment">#sendhealth: true</span></span><br><span class="line">   <span class="comment">#sendposition: true</span></span><br><span class="line">   <span class="comment">#allowwebchat: true</span></span><br><span class="line">   <span class="comment">#webchat-interval: 5</span></span><br><span class="line">   <span class="comment">#hidewebchatip: false</span></span><br><span class="line">   <span class="comment">#trustclientname: false</span></span><br><span class="line">   <span class="comment">#includehiddenplayers: false</span></span><br><span class="line">   <span class="comment"># (optional) if true, color codes in player display names are used</span></span><br><span class="line">   <span class="comment">#use-name-colors: false</span></span><br><span class="line">   <span class="comment"># (optional) if true, player login IDs will be used for web chat when their IPs match</span></span><br><span class="line">   <span class="comment">#use-player-login-ip: true</span></span><br><span class="line">   <span class="comment"># (optional) if use-player-login-ip is true, setting this to true will cause chat messages not matching a known player IP to be ignored</span></span><br><span class="line">   <span class="comment">#require-player-login-ip: false</span></span><br><span class="line">   <span class="comment"># (optional) block player login IDs that are banned from chatting</span></span><br><span class="line">   <span class="comment">#block-banned-player-chat: true</span></span><br><span class="line">   <span class="comment"># Require login for web-to-server chat (requires login-enabled: true)</span></span><br><span class="line">   <span class="comment">#webchat-requires-login: false</span></span><br><span class="line">   <span class="comment"># If set to true, users must have dynmap.webchat permission in order to chat</span></span><br><span class="line">   <span class="comment">#webchat-permissions: false</span></span><br><span class="line">   <span class="comment"># Limit length of single chat messages</span></span><br><span class="line">   <span class="comment">#chatlengthlimit: 256</span></span><br><span class="line"> <span class="comment">#  # Optional - make players hidden when they are inside/underground/in shadows (#=light level: 0=full shadow,15=sky)</span></span><br><span class="line"> <span class="comment">#  hideifshadow: 4</span></span><br><span class="line"> <span class="comment">#  # Optional - make player hidden when they are under cover (#=sky light level,0=underground,15=open to sky)</span></span><br><span class="line"> <span class="comment">#  hideifundercover: 14</span></span><br><span class="line"> <span class="comment">#  # (Optional) if true, players that are crouching/sneaking will be hidden </span></span><br><span class="line">   <span class="comment">#hideifsneaking: false</span></span><br><span class="line">   <span class="comment"># If true, player positions/status is protected (login with ID with dynmap.playermarkers.seeall permission required for info other than self)</span></span><br><span class="line">   <span class="comment">#protected-player-info: false</span></span><br><span class="line">   <span class="comment"># If true, hide players with invisibility potion effects active</span></span><br><span class="line">   <span class="comment">#hide-if-invisiblity-potion: true</span></span><br><span class="line">   <span class="comment"># If true, player names are not shown on map, chat, list</span></span><br><span class="line">   <span class="comment">#hidenames: false</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">org.dynmap.JsonFileClientUpdateComponent</span></span><br><span class="line">   <span class="attr">writeinterval:</span> <span class="number">1</span></span><br><span class="line">   <span class="attr">sendhealth:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">sendposition:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">allowwebchat:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">webchat-interval:</span> <span class="number">5</span></span><br><span class="line">   <span class="attr">hidewebchatip:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">includehiddenplayers:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">use-name-colors:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">use-player-login-ip:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">require-player-login-ip:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">block-banned-player-chat:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">hideifshadow:</span> <span class="number">0</span></span><br><span class="line">   <span class="attr">hideifundercover:</span> <span class="number">0</span></span><br><span class="line">   <span class="attr">hideifsneaking:</span> <span class="literal">false</span></span><br><span class="line"> <span class="comment">#  # Require login for web-to-server chat (requires login-enabled: true)</span></span><br><span class="line">   <span class="attr">webchat-requires-login:</span> <span class="literal">false</span></span><br><span class="line"> <span class="comment">#  # If set to true, users must have dynmap.webchat permission in order to chat</span></span><br><span class="line">   <span class="attr">webchat-permissions:</span> <span class="literal">false</span></span><br><span class="line"> <span class="comment">#  # Limit length of single chat messages</span></span><br><span class="line">   <span class="attr">chatlengthlimit:</span> <span class="number">256</span></span><br><span class="line">   <span class="attr">hide-if-invisiblity-potion:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">hidenames:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></div></div>    </div>    </div></div></details><p>然后找到<code>disable-webserver</code>并将值从<code>false</code>更改为 <code>true</code> 以禁用内部网页服务器</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c6dcbe8e7e7.webp?fmt=avif" alt="1707531452723.webp" /></p><p>再修改相应的请求地址（<code>url:</code>）</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>更改前</strong></p><div class="tag-plugin colorful note" color="red" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:441</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url:</span></span><br><span class="line">    <span class="comment"># configuration URL</span></span><br><span class="line">    <span class="comment">#configuration: &quot;up/configuration&quot;</span></span><br><span class="line">    <span class="comment"># update URL</span></span><br><span class="line">    <span class="comment">#update: &quot;up/world/&#123;world&#125;/&#123;timestamp&#125;&quot;</span></span><br><span class="line">    <span class="comment"># sendmessage URL</span></span><br><span class="line">    <span class="comment">#sendmessage: &quot;up/sendmessage&quot;</span></span><br><span class="line">    <span class="comment"># login URL</span></span><br><span class="line">    <span class="comment">#login: &quot;up/login&quot;</span></span><br><span class="line">    <span class="comment"># register URL</span></span><br><span class="line">    <span class="comment">#register: &quot;up/register&quot;</span></span><br><span class="line">    <span class="comment"># tiles base URL</span></span><br><span class="line">    <span class="comment">#tiles: &quot;tiles/&quot;</span></span><br><span class="line">    <span class="comment"># markers base URL</span></span><br><span class="line">    <span class="comment">#markers: &quot;tiles/&quot;</span></span><br></pre></td></tr></table></figure></div></div>    </div>    <div class="cell" style="">    <p><strong>MySQL</strong></p><div class="tag-plugin colorful note" color="green" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:441</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url:</span></span><br><span class="line">    <span class="comment"># configuration URL</span></span><br><span class="line">    <span class="attr">configuration:</span> <span class="string">&quot;standalone/MySQL_configuration.php&quot;</span></span><br><span class="line">    <span class="comment"># update URL</span></span><br><span class="line">    <span class="attr">update:</span> <span class="string">&quot;standalone/MySQL_update.php?world=&#123;world&#125;&amp;ts=&#123;timestamp&#125;&quot;</span></span><br><span class="line">    <span class="comment"># sendmessage URL</span></span><br><span class="line">    <span class="attr">sendmessage:</span> <span class="string">&quot;standalone/MySQL_sendmessage.php&quot;</span></span><br><span class="line">    <span class="comment"># login URL</span></span><br><span class="line">    <span class="attr">login:</span> <span class="string">&quot;standalone/MySQL_login.php&quot;</span></span><br><span class="line">    <span class="comment"># register URL</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">&quot;standalone/MySQL_register.php&quot;</span></span><br><span class="line">    <span class="comment"># tiles base URL</span></span><br><span class="line">    <span class="attr">tiles:</span> <span class="string">&quot;standalone/MySQL_tiles.php?tile=&quot;</span></span><br><span class="line">    <span class="comment"># markers base URL</span></span><br><span class="line">    <span class="attr">markers:</span> <span class="string">&quot;standalone/MySQL_markers.php?marker=&quot;</span></span><br></pre></td></tr></table></figure></div></div>    </div>    <div class="cell" style="">    <p><strong>SQLite</strong></p><div class="tag-plugin colorful note" color="green" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:441</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url:</span></span><br><span class="line">    <span class="comment"># configuration URL</span></span><br><span class="line">    <span class="attr">configuration:</span> <span class="string">&quot;standalone/configuration.php&quot;</span></span><br><span class="line">    <span class="comment"># update URL</span></span><br><span class="line">    <span class="attr">update:</span> <span class="string">&quot;standalone/update.php?world=&#123;world&#125;&amp;ts=&#123;timestamp&#125;&quot;</span></span><br><span class="line">    <span class="comment"># sendmessage URL</span></span><br><span class="line">    <span class="attr">sendmessage:</span> <span class="string">&quot;standalone/sendmessage.php&quot;</span></span><br><span class="line">    <span class="comment"># login URL</span></span><br><span class="line">    <span class="attr">login:</span> <span class="string">&quot;standalone/login.php&quot;</span></span><br><span class="line">    <span class="comment"># register URL</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">&quot;standalone/register.php&quot;</span></span><br><span class="line">    <span class="comment"># tiles base URL</span></span><br><span class="line">    <span class="attr">tiles:</span> <span class="string">&quot;standalone/tiles.php?tile=&quot;</span></span><br><span class="line">    <span class="comment"># markers base URL</span></span><br><span class="line">    <span class="attr">markers:</span> <span class="string">&quot;standalone/markers.php?marker=&quot;</span></span><br></pre></td></tr></table></figure></div></div>    </div>    </div><div class="tag-plugin colorful note" color="blue"><div class="title">Dynmap还支持MariaDB、PostgreSQL及S3存储。使用MariaDB的话将</div><div class="body"><p><code>type: mysql</code> 改为 <code>type: mariadb</code> ，PostgreSQL 改为 <code>type: postgres</code> 并将 <code>url:</code> 中的 <code>MySQL_</code> 替换为 <code>PostgreSQL_</code> 。至于S3，太豪气了应该没人用吧，自建当我没说（小声bb</p></div></div><p>最后修改一下配置文件中前端的地址（会在游戏中显示）</p><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:478</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Published public URL for Dynmap server (allows users to use &#x27;dynmap url&#x27; command to get public URL usable to access server</span></span><br><span class="line"><span class="comment"># If not set, &#x27;dynmap url&#x27; will not return anything.  URL should be fully qualified (e.g. https://mc.westeroscraft.com/)</span></span><br><span class="line"><span class="attr">publicURL:</span> <span class="string">https://yourdomain.com/</span></span><br></pre></td></tr></table></figure><ol start="3"><li>安装用于MySQL的java驱动包</li></ol><div class="tag-plugin colorful note" color="yellow"><div class="body"><p>非MySQL存储可跳过</p></div></div><div class="tag-plugin link dis-select"><a class="link-card plain" title="MySQL_JDBC_(Fabric/Forge)" href="https://www.curseforge.com/minecraft/mc-mods/mysql-jdbc/files" target="_blank" rel="external nofollow noopener noreferrer" cardlink api="https://siteinfo-api.hzchu.top/api/v1?url=https://www.curseforge.com/minecraft/mc-mods/mysql-jdbc/files" autofill=""><div class="left"><span class="title">MySQL_JDBC_(Fabric/Forge)</span><span class="cap link footnote">https://www.curseforge.com/minecraft/mc-mods/mysql-jdbc/files</span></div><div class="right"><div class="lazy img" data-bg="https://static-beta.curseforge.com/images/favicon.ico"></div></div></a></div><p>下载后放入 <code>mods</code> 文件夹</p><ol start="4"><li>试运行</li></ol><p>​开启服务端，观察日志输出中有无报错，同时检查数据库中是否有数据表生成</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c6f4896779f.webp?fmt=avif" alt="1707537542036.webp" /></p><ol start="5"><li>成功运行后配置网页前端。先安装PHP-7.4（实测8.0会存在bug无法登录），将<code>...\dynmap\web</code>下所有文件复制到网页根目录即可。（模组在启动后会自动完成配置，以配置mysql为存储为例，配置会写入 <code>\standalone\config.js</code>和 <code>\web\standalone\MySQL_config.php</code>）如果数据库无法访问可尝试手动设置<code>$dbhost</code>为<code>127.0.0.1</code></li></ol><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c7326a8ff9a.webp?fmt=avif" alt="1707553384528.webp" /></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c7327ca274f.webp?fmt=avif" alt="1707553403171.webp" /></p><ol start="6"><li>打开看看吧~ 哦？一片漆黑，因为这时候还没有执行渲染命令，dynmap还没工作<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatcoffee.png"/></span>，因此我们可以执行 <code>/dynmap radiusrender world 0 0 10</code>来对主世界出生点周围进行渲染，并查看中有无数据写入到<code>tiles</code>表中</li></ol><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c7349bafa98.webp?fmt=avif" alt="例子" /></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c735c561384.webp?fmt=avif" alt="1707554242561.webp" /></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c7382b5d84f.webp?fmt=avif" alt="出来了" /></p><p>初步测试完成后就可以执行 <code>/dynmap fullrender world</code> 渲染整个世界了。</p><p>前端我做了一定修改，有兴趣可以下载看看：</p><div class="tag-plugin link dis-select"><a class="link-card rich" title="" href="https://pan.hzchu.top/s/MWU7?password=uzyj8y" target="_blank" rel="external nofollow noopener noreferrer" cardlink api="https://siteinfo-api.hzchu.top/api/v1?url=https://pan.hzchu.top/s/MWU7?password=uzyj8y" autofill="title,icon,desc"><div class="top"><div class="lazy img" data-bg="https://static.hzchu.top/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div><span class="cap link footnote">https://pan.hzchu.top/s/MWU7?password=uzyj8y</span></div><div class="bottom"><span class="title">https://pan.hzchu.top/s/MWU7?password=uzyj8y</span><span class="cap desc footnote"></span></div></a></div><div class="tag-plugin colorful note" color="yellow"><div class="body"><p>注意：该地图会对性能及带宽占用上造成一定影响，请参考网上其他调优资料，根据自身实际情况调整</p></div></div><div class="tag-plugin quot"><h3 class="content" id="在线服务" type="icon"><img class="icon prefix" src="https://fclouds.hzchu.top/assets/favicon.ico" /><span class="text">在线服务</span><span class="empty"></span></h3></div><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c73dfd4c862.webp?fmt=avif" alt="相关图片" /></p><blockquote><p><a href="https://d.hzchu.top/xznnj">峰间云海 (hzchu.top)</a></p></blockquote><p>与其叫做官网，倒不如说是一个 <code>综合服务平台</code> ， 当初想着与其整个花里胡哨的页面，不如整个有用的。虽然事实证明还是花哨的好。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatsadreach.png"/></span></p><ol><li>前端</li></ol><p>因为当时赶工期， 从头学各种框架来不及，用Py写了个拼凑html的程序，基本能用，后面MRUI也延续了这套，后续如果有空改进下。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatpeek2.png"/></span></p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/mcweb"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=mcweb&&show_owner=true"/></a></div><p>基本是开箱即用了</p><p>功能在后面混着讲</p><ol start="2"><li>后端</li></ol><p>**首页：**状态检测使用了<code>mcstatus</code>库，具体操作可以参考<a href="https://d.hzchu.top/a4zaw">mcstatus · PyPI</a>。公告用了Artalk，<s>歪门邪道</s></p><p><strong>聊天记录：</strong></p><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/msg&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getmsg</span>():</span><br><span class="line">    num = request.args.get(<span class="string">&#x27;num&#x27;</span>, default=<span class="number">0</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    <span class="comment"># 限制访问前200条记录</span></span><br><span class="line">    <span class="keyword">if</span> num &gt; <span class="number">160</span>:</span><br><span class="line">        messages = []</span><br><span class="line">        message = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;playername&#x27;</span>: <span class="string">&quot;Null&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;200条后不予查看&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;time&#x27;</span>: <span class="string">&quot;Null&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        messages.append(message)</span><br><span class="line">        <span class="keyword">return</span> jsonify(messages), <span class="number">200</span></span><br><span class="line">    conn= mysql.connector.connect(**DATABASE)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    sql = <span class="string">&quot;SELECT id, playername, msg, time FROM chat ORDER BY id DESC LIMIT %s, %s&quot;</span></span><br><span class="line">    cursor.execute(sql, (num, <span class="number">40</span>))</span><br><span class="line">    result = cursor.fetchall()</span><br><span class="line">    cursor.close()</span><br><span class="line"></span><br><span class="line">    messages = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> result:</span><br><span class="line">        message = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: row[<span class="number">0</span>],</span><br><span class="line">            <span class="string">&#x27;playername&#x27;</span>: row[<span class="number">1</span>],</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>: row[<span class="number">2</span>],</span><br><span class="line">            <span class="string">&#x27;time&#x27;</span>: row[<span class="number">3</span>].strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        messages.append(message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(messages), <span class="number">200</span></span><br></pre></td></tr></table></figure><p>在前端页面中，我是直接用了表格的形式显示，不够好看，原草稿大概是这样，<s>可惜没时间</s></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/11/65c8dc3376bd8.webp?fmt=avif" alt="1707662385052.webp" /></p><p>用于当时忘了xss处理，要在前端补上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// msg.textContent = dexss(player.msg);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dexss</span>(<span class="params">str, kwargs</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">&#x27;&#x27;</span> + str)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&amp;/g</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>) <span class="comment">// DEC=&gt; &amp;#60; HEX=&gt; &amp;#x3c; Entity=&gt; &amp;lt;</span></span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&quot;/g</span>, <span class="string">&#x27;&amp;quot;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&#x27;/g</span>, <span class="string">&#x27;&amp;#x27;&#x27;</span>) <span class="comment">// &amp;apos; 不推荐，因为它不在HTML规范中</span></span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/\//g</span>, <span class="string">&#x27;&amp;#x2F;&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>相册：</strong></p><p>这部分与前者差不多，前端网上随便找了个改了改，现在想想直接用Lsky pro的画廊就行了</p><blockquote><p>此部分仅为读取，写入的部分由QQ机器人负责</p></blockquote><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/photo&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    num = request.args.get(<span class="string">&#x27;num&#x27;</span>, default=<span class="number">0</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    </span><br><span class="line">    conn= mysql.connector.connect(**DATABASE)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        query = <span class="string">&quot;SELECT id, nickname, author, time, url FROM photo ORDER BY id DESC LIMIT %s, %s&quot;</span></span><br><span class="line">        cursor.execute(query, (num, <span class="number">24</span>))</span><br><span class="line">        results = cursor.fetchall()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 将查询结果转换为字典列表</span></span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> results:</span><br><span class="line">            data.append(&#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: row[<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;nickname&#x27;</span>: row[<span class="number">1</span>],</span><br><span class="line">                <span class="string">&#x27;author&#x27;</span>: row[<span class="number">2</span>],</span><br><span class="line">                <span class="string">&#x27;time&#x27;</span>: row[<span class="number">3</span>],</span><br><span class="line">                <span class="string">&#x27;url&#x27;</span>: row[<span class="number">4</span>]</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jsonify(data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="built_in">str</span>(e)&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        cursor.close()</span><br><span class="line">        conn.close()</span><br></pre></td></tr></table></figure><p><strong>坐标&amp;反馈：</strong> 缩水了，用Artalk替代了，只能说与我计划中差的有亿点多</p><p><strong>排行榜：</strong></p><p>​这就有点意思了，为了实现这些数据统计，我在游戏中新建了<code>若干的计分板</code>+一些在常加载区块里的<code>命令方块</code>，随后每隔一段时间读取存档里的存储着计分板数据的文件（\world\data\scoreboard.dat），将数值计入数据库。（起初使用Rcon执行命令显示该玩家所有计分板数据并使用正则表达式提取再存入，前期还好，到后来对性能影响太大被迫改进）</p><p>​游戏里的命令就不说了，需求也不一定相同，网上一大把教程</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="" href="https://www.bilibili.com/read/cv12839156/" target="_blank" rel="external nofollow noopener noreferrer" cardlink api="https://siteinfo-api.hzchu.top/api/v1?url=https://www.bilibili.com/read/cv12839156/" autofill="title,icon"><div class="left"><span class="title">https://www.bilibili.com/read/cv12839156/</span><span class="cap link footnote">https://www.bilibili.com/read/cv12839156/</span></div><div class="right"><div class="lazy img" data-bg="https://static.hzchu.top/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><p>​在实际程序中，为了简化主程序的复杂程度（拉侧边滚动条都拉出火花了），我把新定义的函数放在<code>extra.py</code>里</p><figure class="highlight python"><figcaption><span>extra.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"><span class="keyword">import</span> python_nbt.nbt <span class="keyword">as</span> nbt</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_scoreboard</span>(<span class="params">scoreboard_name</span>):</span><br><span class="line"><span class="comment"># 将字符串转换为 Python 对象</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    file = nbt.read_from_nbt_file(<span class="string">&quot;D:\MCC\mcdr_server\server\world\data\scoreboard.dat&quot;</span>)</span><br><span class="line">    string_data = <span class="built_in">str</span>(file)</span><br><span class="line">    <span class="comment"># print(string_data)</span></span><br><span class="line">    python_object = ast.literal_eval(string_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将 Python 对象转换为 JSON 字符串</span></span><br><span class="line">    json_data = json.dumps(python_object)</span><br><span class="line">    data = json.loads(json_data)</span><br><span class="line">    <span class="comment"># print(json_data)</span></span><br><span class="line">    <span class="comment"># print(data[&quot;value&quot;][&quot;data&quot;][&quot;value&quot;][&quot;PlayerScores&quot;][&quot;value&quot;])</span></span><br><span class="line">    data = data[<span class="string">&quot;value&quot;</span>][<span class="string">&quot;data&quot;</span>][<span class="string">&quot;value&quot;</span>][<span class="string">&quot;PlayerScores&quot;</span>][<span class="string">&quot;value&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="string">&quot;Objective&quot;</span>][<span class="string">&quot;value&quot;</span>] == scoreboard_name:</span><br><span class="line">            name = i[<span class="string">&quot;Name&quot;</span>][<span class="string">&quot;value&quot;</span>]</span><br><span class="line">            score = i[<span class="string">&quot;Score&quot;</span>][<span class="string">&quot;value&quot;</span>]</span><br><span class="line">            <span class="comment">#print(name,&quot;:&quot;,score)</span></span><br><span class="line">            conn= mysql.connector.connect(**DATABASE)</span><br><span class="line">            cursor = conn.cursor()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                insert_query = <span class="string">&quot;INSERT INTO scoreboard (player, &#123;&#125;) VALUES (%s, %s) ON DUPLICATE KEY UPDATE &#123;&#125; = %s&quot;</span>.<span class="built_in">format</span>(scoreboard_name, scoreboard_name)</span><br><span class="line">                data = (name, score, score)</span><br><span class="line">                cursor.execute(insert_query, data)</span><br><span class="line"></span><br><span class="line">                conn.commit()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(e))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                cursor.close()</span><br><span class="line">                conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 记录结束时间</span></span><br><span class="line">    end_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算执行时间</span></span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打印执行时间</span></span><br><span class="line">    <span class="keyword">return</span>(execution_time)</span><br></pre></td></tr></table></figure><p>​该函数回返回执行时间，不过没用错误处理，虽然一般情况下不会发生错误，不过最好也改进下再用</p><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> extra</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">updatabase</span>():</span><br><span class="line">    time_used = extra.get_scoreboard(<span class="string">&quot;pickaxe_total&quot;</span>)</span><br><span class="line">    time_used = time_used + extra.get_scoreboard(<span class="string">&quot;gametime&quot;</span>)</span><br><span class="line">    time_used = time_used + extra.get_scoreboard(<span class="string">&quot;Kills&quot;</span>)</span><br><span class="line">    time_used = time_used + extra.get_scoreboard(<span class="string">&quot;fish&quot;</span>)</span><br><span class="line">    time_used = time_used + extra.get_scoreboard(<span class="string">&quot;xp&quot;</span>)</span><br><span class="line">    time_used =<span class="string">&quot; &#123;:.3f&#125;&quot;</span>.<span class="built_in">format</span>(time_used)</span><br><span class="line">    <span class="comment">#msg_type = &quot;System-AutoTasks&quot;</span></span><br><span class="line">    <span class="comment">#msg_value = &quot;计分板同步成功，耗时:&quot; + str(time_used) + &quot;秒&quot;</span></span><br><span class="line">    <span class="comment">#extra.eventssave(msg_type,msg_value)</span></span><br><span class="line">    <span class="comment"># 用于日志保存，可去掉</span></span><br><span class="line">                          </span><br><span class="line">                  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_timer</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 每2h执行一次</span></span><br><span class="line">        <span class="comment"># 简单粗暴，实际使用请使用schedule库</span></span><br><span class="line">        time.sleep(<span class="number">2</span>* <span class="number">60</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="comment"># 在后台线程中执行需要定时执行的函数</span></span><br><span class="line">        threading.Thread(target=updatabase).start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过以下路由返回数据</p><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/scoreboard&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_scoreboard</span>():</span><br><span class="line">    cnx = mysql.connector.connect(**DATABASE)</span><br><span class="line">    cursor = cnx.cursor()</span><br><span class="line">    query = <span class="string">&quot;SELECT * FROM scoreboard&quot;</span></span><br><span class="line">    cursor.execute(query)</span><br><span class="line">    data = [&#123;<span class="string">&#x27;playername&#x27;</span>: row[<span class="number">0</span>], <span class="string">&#x27;pickaxe_total&#x27;</span>: row[<span class="number">1</span>], <span class="string">&#x27;gametime&#x27;</span>: row[<span class="number">2</span>], <span class="string">&#x27;Kills&#x27;</span>: row[<span class="number">3</span>], <span class="string">&#x27;fish&#x27;</span>: row[<span class="number">4</span>], <span class="string">&#x27;xp&#x27;</span>: row[<span class="number">5</span>]&#125; <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall()]</span><br><span class="line">    cursor.close()</span><br><span class="line">    <span class="keyword">return</span> jsonify(data)</span><br></pre></td></tr></table></figure><p>前端用了AI帮忙，太折磨人了。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatumm.png"/></span></p><details class="tag-plugin colorful folding" ><summary><span>默认折叠</span></summary><div class="body"><figure class="highlight javascript"><figcaption><span>list.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scoreboardUrl = <span class="string">&#x27;https://***************/user/scoreboard&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyPickaxe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-pickaxe&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyKills = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-kills&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyFish = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-fish&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyGametime = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-gametime&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyxp = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-xp&#x27;</span>);</span><br><span class="line"><span class="title function_">fetch</span>(scoreboardUrl)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">scoreboard</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//定义一个比较函数，按照pickaxe_total的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByPickaxe</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">pickaxe_total</span> - a.<span class="property">pickaxe_total</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个比较函数，按照Kills的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByKills</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">Kills</span> - a.<span class="property">Kills</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个比较函数，按照fish的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByFish</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">fish</span> - a.<span class="property">fish</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个比较函数，按照gametime的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByGametime</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">gametime</span> - a.<span class="property">gametime</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个比较函数，按照xp的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByxp</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">xp</span> - a.<span class="property">xp</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉pickaxe_total为0的玩家</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByPickaxe</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">pickaxe_total</span> &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉Kills为null的玩家</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByKills</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">Kills</span> != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉fish为null的玩家</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByFish</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">fish</span> != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉gametime为null的玩家</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByGametime</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">gametime</span> != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉xp为null的玩家 </span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByxp</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">xp</span> != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//对scoreboard数组进行过滤</span></span><br><span class="line">        scoreboard = scoreboard.<span class="title function_">filter</span>(filterByPickaxe);</span><br><span class="line">        <span class="comment">// 参照最初版重写！！！！</span></span><br><span class="line">        <span class="comment">//创建一个副本数组，按照pickaxe_total排序</span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByPickaxe = [...scoreboard];</span><br><span class="line">        scoreboardByPickaxe.<span class="title function_">sort</span>(compareByPickaxe);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(scoreboardByPickaxe)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个副本数组，按照Kills排序，并过滤掉null值</span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByKills = [...scoreboard];</span><br><span class="line">        scoreboardByKills.<span class="title function_">sort</span>(compareByKills);</span><br><span class="line">        scoreboardByKills = scoreboardByKills.<span class="title function_">filter</span>(filterByKills);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个副本数组，按照fish排序，并过滤掉null值</span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByFish = [...scoreboard];</span><br><span class="line">        scoreboardByFish.<span class="title function_">sort</span>(compareByFish);</span><br><span class="line">        scoreboardByFish = scoreboardByFish.<span class="title function_">filter</span>(filterByFish);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个副本数组，按照gametime排序，并过滤掉null值</span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByGametime = [...scoreboard];</span><br><span class="line">        scoreboardByGametime.<span class="title function_">sort</span>(compareByGametime);</span><br><span class="line">        scoreboardByGametime = scoreboardByGametime.<span class="title function_">filter</span>(filterByGametime);</span><br><span class="line">        <span class="comment">//创建一个副本数组，按照xp排序，并过滤掉null值 </span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByXp = [...scoreboard];</span><br><span class="line">        scoreboardByXp.<span class="title function_">sort</span>(compareByxp);</span><br><span class="line">        scoreboardByXp = scoreboardByXp.<span class="title function_">filter</span>(filterByxp);</span><br><span class="line">        <span class="comment">//遍历按照pickaxe_total排序的数组，创建表格行和单元格，并添加到对应的表格中</span></span><br><span class="line">        scoreboardByPickaxe.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> pickaxeTotal = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            pickaxeTotal.<span class="property">textContent</span> = player.<span class="property">pickaxe_total</span>;</span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(pickaxeTotal);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyPickaxe.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历按照Kills排序的数组，创建表格行和单元格，并添加到对应的表格中</span></span><br><span class="line">        scoreboardByKills.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> kills = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            kills.<span class="property">textContent</span> = player.<span class="property">Kills</span>;</span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(kills);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyKills.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历按照fish排序的数组，创建表格行和单元格，并添加到对应的表格中</span></span><br><span class="line">        scoreboardByFish.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> fish = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            fish.<span class="property">textContent</span> = player.<span class="property">fish</span>;</span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(fish);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyFish.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历按照gametime排序的数组，创建表格行和单元格，并添加到对应的表格中</span></span><br><span class="line">        scoreboardByGametime.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> gametime = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            gametime.<span class="property">textContent</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(player.<span class="property">gametime</span> / <span class="number">60</span> / <span class="number">60</span>) + <span class="string">&quot;h&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(gametime);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyGametime.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//遍历按照xp排序的数组，创建表格行和单元格，并添加到对应的表格中 </span></span><br><span class="line">        scoreboardByXp.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> xp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            xp.<span class="property">textContent</span> = <span class="title function_">getLevel</span>(player.<span class="property">xp</span>);</span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(xp);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyxp.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">// 定义一个函数，参数为原始经验值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLevel</span>(<span class="params">exp</span>) &#123;</span><br><span class="line">    <span class="comment">// 定义一个变量，存储经验等级</span></span><br><span class="line">    <span class="keyword">let</span> level = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 定义一个变量，存储升级所需的经验值</span></span><br><span class="line">    <span class="keyword">let</span> expToNext = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 使用循环，不断更新经验等级和升级所需的经验值，直到原始经验值不足以升级为止</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 根据公式，计算升级所需的经验值</span></span><br><span class="line">        <span class="keyword">if</span> (level &lt;= <span class="number">15</span>) &#123;</span><br><span class="line">            expToNext = <span class="number">2</span> * level + <span class="number">7</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (level &lt;= <span class="number">30</span>) &#123;</span><br><span class="line">            expToNext = <span class="number">5</span> * level - <span class="number">38</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            expToNext = <span class="number">9</span> * level - <span class="number">158</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断原始经验值是否足够升级</span></span><br><span class="line">        <span class="keyword">if</span> (exp &gt;= expToNext) &#123;</span><br><span class="line">            <span class="comment">// 如果足够，减去升级所需的经验值，增加经验等级</span></span><br><span class="line">            exp -= expToNext;</span><br><span class="line">            level++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果不足，跳出循环</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回经验等级</span></span><br><span class="line">    <span class="keyword">return</span> level;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></details><p><strong>管理：</strong></p><p>如果内建账号密码登录，要增加一些工作量，所以我借鉴了一下之前某个AIGC平台的做法，向qq机器人发信息以获取有效期一周的token用于登录，这样安全性大大提高，而且写起来也不用顾虑太多。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/cdn-x/emoji/aru-l/0120.gif"/></span>在初次打开时网页会发送鉴权请求判断是否有效，后续请求也都带上这个token。以下是部分代码片段</p><figure class="highlight python"><figcaption><span>封禁玩家</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/banplayer&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">banplayer</span>():</span><br><span class="line">    playername = request.json.get(<span class="string">&#x27;playername&#x27;</span>)</span><br><span class="line">    reason = request.json.get(<span class="string">&#x27;reason&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">if</span> reason == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        reason = <span class="string">&quot;未记录原因的封禁，请联系管理员&quot;</span></span><br><span class="line"></span><br><span class="line">    command = <span class="string">&#x27;kick &#x27;</span> + playername + <span class="string">&#x27; &#x27;</span> + reason</span><br><span class="line">    response = extra.sendcommand(command)</span><br><span class="line">    command = <span class="string">&#x27;ban &#x27;</span> + playername + <span class="string">&#x27; &#x27;</span> + reason</span><br><span class="line">    response = extra.sendcommand(command)</span><br><span class="line">    conn = mysql.connector.connect(**DATABASE)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;response&#x27;</span>: response&#125;), <span class="number">200</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>extra.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mcrcon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主机 密码 端口</span></span><br><span class="line">client = mcrcon.MCRcon(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;*-*-*-*&#x27;</span>, <span class="number">2</span>****<span class="number">5</span>)</span><br><span class="line">client.connect()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendcommand</span>(<span class="params">command</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> command:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;No command provided&#x27;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    response = client.command(command)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>解除封禁</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/debanplayer&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debanplayer</span>():</span><br><span class="line">    playername = request.json.get(<span class="string">&#x27;playername&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">    command = <span class="string">&#x27;pardon &#x27;</span> + playername</span><br><span class="line">    response = extra.sendcommand(command)</span><br><span class="line">    conn = mysql.connector.connect(**DATABASE)</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;response&#x27;</span>: response&#125;), <span class="number">200</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>获取用户信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ipdb</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/getaccount&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getaccount</span>():</span><br><span class="line">    accountinfo = request.json.get(<span class="string">&#x27;accountinfo&#x27;</span>)</span><br><span class="line">    mode = <span class="built_in">int</span>(request.json.get(<span class="string">&#x27;mode&#x27;</span>))</span><br><span class="line">...</span><br><span class="line">    conn = mysql.connector.connect(**DATABASE)</span><br><span class="line">    c = conn.cursor()</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="number">1</span>:</span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `qq_user` where qq_id = %s&quot;</span>, (accountinfo,))</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="number">2</span>:</span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `qq_user` where user_name = %s&quot;</span>, (accountinfo,))</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="number">3</span>:</span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `qq_user` where be_name = %s&quot;</span>, (accountinfo,))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `qq_user` where qq_id = %s&quot;</span>, (accountinfo,))</span><br><span class="line">    acc_result = c.fetchall()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> acc_result:</span><br><span class="line">        <span class="keyword">if</span> acc_result[<span class="number">0</span>][<span class="number">5</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            be_name = <span class="string">&quot;!未绑定!&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            be_name = acc_result[<span class="number">0</span>][<span class="number">5</span>]</span><br><span class="line">        playername = acc_result[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># 用的MySQL数据库，Authme和该服务共用一个数据库，因此直接调用其获取IP</span></span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `authme` where realname = %s or username = %s&quot;</span>, (playername,playername,))</span><br><span class="line">        ip_result = c.fetchall()</span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="comment">#嵌套有点多，整活部分可以改掉</span></span><br><span class="line">        <span class="keyword">if</span> ip_result:</span><br><span class="line">            ip = ip_result[<span class="number">0</span>][<span class="number">4</span>]</span><br><span class="line">            <span class="keyword">if</span> ipaddress.ip_address(ip).is_private:</span><br><span class="line">                ip = <span class="string">&quot;内网地址&quot;</span></span><br><span class="line">                country=<span class="string">&quot;南极洲&quot;</span></span><br><span class="line">                city=<span class="string">&quot;中山站&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ipinfo=db.find_map(ip, <span class="string">&quot;CN&quot;</span>)</span><br><span class="line">                country=ipinfo[<span class="string">&quot;country_name&quot;</span>]</span><br><span class="line">                city= ipinfo[<span class="string">&quot;region_name&quot;</span>]+<span class="string">&quot;，&quot;</span>+ipinfo[<span class="string">&quot;city_name&quot;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ip = <span class="string">&quot;!未记录在数据库!&quot;</span></span><br><span class="line">            country=<span class="string">&quot;北极点&quot;</span></span><br><span class="line">            city=<span class="string">&quot;鹦鹉螺号&quot;</span></span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;qq&#x27;</span>: acc_result[<span class="number">0</span>][<span class="number">0</span>],<span class="string">&#x27;user_name&#x27;</span>: playername,<span class="string">&#x27;bind_time&#x27;</span>: acc_result[<span class="number">0</span>][<span class="number">2</span>],<span class="string">&#x27;group&#x27;</span>: acc_result[<span class="number">0</span>][<span class="number">3</span>],<span class="string">&#x27;status&#x27;</span>: acc_result[<span class="number">0</span>][<span class="number">4</span>],<span class="string">&#x27;be_name&#x27;</span>: be_name,<span class="string">&#x27;ip&#x27;</span>: ip,<span class="string">&#x27;country&#x27;</span>:country,<span class="string">&#x27;city&#x27;</span>:city&#125;), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">1000</span>,<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;没有相应玩家消息&#x27;</span>&#125;), <span class="number">200</span></span><br></pre></td></tr></table></figure><div class="tag-plugin quot"><h3 class="content" id="QQ-BOT" type="icon"><img class="icon prefix" src="https://onep.hzchu.top/mount/pic/2024/02/11/65c8e5059a363.webp?fmt=avif" /><span class="text">QQ-BOT</span><span class="empty"></span></h3></div><p>在整个规划中，它承担了相当重要的责任，譬如自动添加白名单（绑定）</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/11/65c8e69a32833.webp?fmt=avif" alt="绑定与解绑" /></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/12/65c9acd876283.webp?fmt=avif" alt="目录结构" /></p><p>**绑定：**一开始我使用了一个极为简单的绑定方式：通过Rcon连接到服务器执行 <code>whitelist add playername</code>，按理来说这没问题，但是后面来的玩家基本都在抱怨进不去服务器。错误截图都一样，不在白名单内。最后发现uuid不一致，有些人的离线用户名与某些正版用户名重复了，导致服务端直接沿用正版用户的uuid，过不去后续校验。所以我这里就直接计算离线用户的uuid写入到<code>whitelist.json</code>内</p><figure class="highlight python"><figcaption><span>mchelper\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@bind.handle()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_first_receive</span>(<span class="params">matcher: Matcher, args: Message = CommandArg(<span class="params"></span>)</span>):</span><br><span class="line">    plain_text = args.extract_plain_text()  <span class="comment"># 首次发送命令时跟随的参数，例：/绑定 username，则args为username</span></span><br><span class="line">    <span class="keyword">if</span> plain_text:</span><br><span class="line">        matcher.set_arg(<span class="string">&quot;username&quot;</span>, args)  <span class="comment"># 如果用户发送了参数则直接赋值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@bind.got(<span class="params"><span class="string">&quot;username&quot;</span>, prompt=<span class="string">&quot;请输入你的用户名&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_username</span>(<span class="params">event: GroupMessageEvent, username: Message = Arg(<span class="params"></span>), username_str: <span class="built_in">str</span> = ArgPlainText(<span class="params"><span class="string">&quot;username&quot;</span></span>)</span>):</span><br><span class="line">    username = <span class="built_in">str</span>(username)</span><br><span class="line">    user_id = event.user_id</span><br><span class="line"></span><br><span class="line">    pattern = <span class="string">r&#x27;^[a-zA-Z0-9_]+$&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> re.<span class="keyword">match</span>(pattern, username):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        extra.settimeout()</span><br><span class="line">        <span class="keyword">await</span> bind.finish(<span class="string">f&quot;用户名只可以包括英文字母，数字，下划线&quot;</span>)</span><br><span class="line">...</span><br><span class="line">    binduser(username)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> bind.finish(<span class="string">f&quot;<span class="subst">&#123;username&#125;</span> 绑定成功（若仍无法进入服务器，可尝试发送“正常流程绑定”）&quot;</span>)</span><br><span class="line">    <span class="comment"># 即用whitelist add</span></span><br><span class="line">            </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binduser</span>(<span class="params">playername</span>):</span><br><span class="line">    offline_uuid = <span class="built_in">str</span>(extra.touuid(playername))</span><br><span class="line">    <span class="comment">#offline_uuid = offline_uuid_raw[:8] + &quot;-&quot; + offline_uuid_raw[8:12] + &quot;-&quot; + offline_uuid_raw[12:16] + &quot;-&quot; + offline_uuid_raw[16:20] + &quot;-&quot; + offline_uuid_raw[20:]</span></span><br><span class="line">    <span class="comment">#读取 ***\whitelist.json,找到playername对应的uuid，用offline_uuid替换</span></span><br><span class="line">    whitelist_file_path = <span class="string">r&quot;Z:\server\whitelist.json&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(whitelist_file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 先尝试是否能找到对应玩家名称的条目，并替换uuid字段，如果没有，则新增</span></span><br><span class="line">    found = <span class="literal">False</span> <span class="comment"># 定义一个变量，用来标记是否找到了对应的玩家条目</span></span><br><span class="line">    <span class="keyword">for</span> player <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> player[<span class="string">&quot;name&quot;</span>] == playername:</span><br><span class="line">            player[<span class="string">&quot;uuid&quot;</span>] = offline_uuid <span class="comment"># 替换uuid字段</span></span><br><span class="line">            found = <span class="literal">True</span> <span class="comment"># 将变量设为True，表示找到了对应的玩家条目</span></span><br><span class="line">            <span class="keyword">break</span> <span class="comment"># 跳出循环，不再继续查找</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found: <span class="comment"># 如果变量为False，表示没有找到对应的玩家条目</span></span><br><span class="line">        data.append(&#123;<span class="string">&quot;name&quot;</span>: playername, <span class="string">&quot;uuid&quot;</span>: offline_uuid&#125;) <span class="comment"># 在data列表中添加一个新的字典，包含玩家的名字和uuid</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将修改后的内容写回whitelist.json文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(whitelist_file_path, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(data, f)</span><br><span class="line">    <span class="comment"># 调用外部命令来重载白名单</span></span><br><span class="line">    client.connect()</span><br><span class="line">    command = <span class="string">&quot;whitelist reload&quot;</span></span><br><span class="line">    response = client.command(command)</span><br><span class="line">    client.disconnect()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>mchelper\extra.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="comment">#该函数用于计算离线用户的uuid</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">touuid</span>(<span class="params">name</span>):</span><br><span class="line">    name = <span class="string">&quot;OfflinePlayer:&quot;</span> + name</span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(name.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    md5_bytes = md5.digest()</span><br><span class="line"></span><br><span class="line">    md5_bytes = <span class="built_in">bytearray</span>(md5_bytes) </span><br><span class="line"></span><br><span class="line">    md5_bytes[<span class="number">6</span>] &amp;= <span class="number">0x0f</span></span><br><span class="line">    md5_bytes[<span class="number">6</span>] |= <span class="number">0x30</span></span><br><span class="line">    md5_bytes[<span class="number">8</span>] &amp;= <span class="number">0x3f</span></span><br><span class="line">    md5_bytes[<span class="number">8</span>] |= <span class="number">0x80</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> uuid.UUID(<span class="built_in">bytes</span>=<span class="built_in">bytes</span>(md5_bytes))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>**解绑：**其实差不了多少</p><figure class="highlight python"><figcaption><span>mchelper\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">debinduser</span>(<span class="params">playername</span>):</span><br><span class="line">    offline_uuid = <span class="built_in">str</span>(extra.touuid(playername))</span><br><span class="line">    whitelist_file_path = <span class="string">r&quot;Z:\server\whitelist.json&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(whitelist_file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> player <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> player[<span class="string">&quot;name&quot;</span>] == playername:</span><br><span class="line">            data.remove(player) <span class="comment"># 移除该条目</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将修改后的内容写回whitelist.json文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(whitelist_file_path, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(data, f)</span><br><span class="line">    <span class="comment"># 调用外部命令来重载白名单</span></span><br><span class="line">    client.connect()</span><br><span class="line">    command = <span class="string">&quot;whitelist reload&quot;</span></span><br><span class="line">    response = client.command(command)</span><br><span class="line">    client.disconnect()</span><br></pre></td></tr></table></figure><p><strong>图片上传：</strong></p><pre class="mermaid">flowchart LR    A[User] -->|"@BOT+图片"| B["nb2-mchelper"]    B <-->|"upgit"| C("pic.hzchu.top(lysk pro)")    B --> D["MySQL"]</pre><figure class="highlight python"><figcaption><span>mchelper\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">upphoto = on_message(rule=to_me(), priority=<span class="number">5</span>, block=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@upphoto.handle()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_upphoto</span>(<span class="params">bot: Bot, event: GroupMessageEvent, state: T_State</span>):</span><br><span class="line">    user_id = event.user_id</span><br><span class="line">    message = <span class="built_in">str</span>(event.get_message())</span><br><span class="line">    conn = mysql.connector.connect(**DATABASE)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(message)</span></span><br><span class="line">    <span class="keyword">if</span> message:</span><br><span class="line">        <span class="keyword">if</span> matches:</span><br><span class="line">            pattern = <span class="string">r&quot;\[CQ:image,file=\w+\.image,subType=\d+,url=(https?://\S+?)]&quot;</span></span><br><span class="line">            matches = re.findall(pattern, message)</span><br><span class="line">            current_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime(time.time()))</span><br><span class="line">            <span class="comment"># print(matches)</span></span><br><span class="line">            <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">                <span class="comment"># print(match)</span></span><br><span class="line">                </span><br><span class="line">                file_name =  <span class="built_in">str</span>(user_id) + <span class="built_in">str</span>(time.time() * <span class="number">1000</span>)+<span class="string">&quot;.jpg&quot;</span></span><br><span class="line">                save_path = <span class="string">&#x27;./tmp/&#x27;</span> + file_name</span><br><span class="line">                response = requests.get(<span class="keyword">match</span>, stream=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(save_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                        <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(<span class="number">1024</span>):</span><br><span class="line">                            file.write(chunk)</span><br><span class="line">                    path = <span class="string">&quot;Z:\\nb2\\mc\\tmp\\&quot;</span> + file_name</span><br><span class="line">                    response = extra.upload_image(path)</span><br><span class="line">                    <span class="keyword">if</span> response.startswith(<span class="string">&quot;https://&quot;</span>):</span><br><span class="line">                        url = response</span><br><span class="line">                        c = conn.cursor()</span><br><span class="line">                        c.execute(<span class="string">&quot;INSERT INTO photo VALUES (%s,%s,%s,%s,%s)&quot;</span>, (<span class="literal">None</span>, <span class="built_in">str</span>(event.sender.card),user_id, current_time, url))</span><br><span class="line">                        conn.commit()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        conn.disconnect()</span><br><span class="line">                        <span class="keyword">await</span> upphoto.finish(<span class="string">&quot;上传失败（调用上传工具错误）&quot;</span>)</span><br><span class="line">                    os.remove(path)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    conn.disconnect()</span><br><span class="line">                    <span class="keyword">await</span> upphoto.finish(<span class="string">&quot;上传失败(请求图片错误)&quot;</span>)</span><br><span class="line">            conn.disconnect()</span><br><span class="line">            <span class="keyword">await</span> upphoto.finish(<span class="string">&quot;上传成功&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            conn.disconnect()</span><br><span class="line">            <span class="keyword">return</span>  <span class="comment"># 没有图片链接，不执行回复操作</span></span><br></pre></td></tr></table></figure><p><strong>聊天记录同步：</strong></p><figure class="highlight python"><figcaption><span>send\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nonebot <span class="keyword">import</span> on_message, logger</span><br><span class="line"><span class="keyword">from</span> nonebot.adapters.onebot.v11 <span class="keyword">import</span> GroupMessageEvent, Bot,MessageSegment</span><br><span class="line"><span class="keyword">from</span> nonebot.rule <span class="keyword">import</span> startswith</span><br><span class="line"><span class="keyword">from</span> nonebot <span class="keyword">import</span> get_driver</span><br><span class="line"><span class="keyword">import</span> mcrcon</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msg_matcher = on_message(priority=<span class="number">10</span>, block=<span class="literal">False</span>)</span><br><span class="line">client = mcrcon.MCRcon(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;******&#x27;</span>, <span class="number">2</span>***<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendcommand</span>(<span class="params">command</span>):</span><br><span class="line">    response = client.command(command)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@msg_matcher.handle()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_</span>(<span class="params">bot: Bot, event: GroupMessageEvent</span>):</span><br><span class="line">    <span class="keyword">if</span> event.group_id == <span class="number">790118052</span>:</span><br><span class="line">        nick = <span class="built_in">str</span>(event.sender.card)</span><br><span class="line">        <span class="keyword">if</span> nick == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            nick = <span class="built_in">str</span>(event.sender.nickname)</span><br><span class="line">        msg = nick+<span class="string">&quot;:&quot;</span>+replace(event.message)</span><br><span class="line">        qqqq = <span class="string">&quot;[Q群]&quot;</span></span><br><span class="line">        msg =<span class="string">f&#x27;[&#123;&#123;&quot;text&quot;:&quot;<span class="subst">&#123;qqqq&#125;</span>&quot;,&quot;color&quot;:&quot;gold&quot;&#125;&#125;,&#123;&#123;&quot;text&quot;:&quot;<span class="subst">&#123;msg&#125;</span>&quot;,&quot;color&quot;:&quot;white&quot;&#125;&#125;]&#x27;</span></span><br><span class="line">        command=<span class="string">f&quot;tellraw @a [<span class="subst">&#123;msg&#125;</span>]&quot;</span></span><br><span class="line">        <span class="comment"># print(command)</span></span><br><span class="line">        sendcommand(command)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个函数，接受一个文本参数，返回替换后的文本</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">replace</span>(<span class="params">text</span>):</span><br><span class="line">  text = <span class="built_in">str</span>(text)</span><br><span class="line"></span><br><span class="line">  image_pattern = <span class="string">r&quot;\[CQ:image,file=.+?image,subType=0,url=.+?\]&quot;</span></span><br><span class="line"></span><br><span class="line">  at_pattern = <span class="string">r&quot;\[CQ:at,qq=\d+\]&quot;</span></span><br><span class="line"></span><br><span class="line">  picface_pattern = <span class="string">r&quot;\[CQ:image,file=.+?image,subType=1,url=.+?\]&quot;</span></span><br><span class="line">  face_pattern = <span class="string">r&quot;\[CQ:face,id=.+?]&quot;</span></span><br><span class="line"></span><br><span class="line">  record_pattern = <span class="string">r&quot;\[CQ:record,file=.+?amr,url=.+?\]&quot;</span></span><br><span class="line">  redbag_pattern = <span class="string">r&quot;\[CQ:redbag,title=.+?\]&quot;</span></span><br><span class="line">  shit_pattern = <span class="string">r&quot;请使用最新版手机QQ体验新功能&quot;</span></span><br><span class="line"></span><br><span class="line">  result = re.sub(image_pattern, <span class="string">&quot;[图片]&quot;</span>, text)</span><br><span class="line"></span><br><span class="line">  result = re.sub(picface_pattern, <span class="string">&quot;[图片表情]&quot;</span>, result)</span><br><span class="line">  result = re.sub(face_pattern, <span class="string">&quot;[表情]&quot;</span>, result)</span><br><span class="line">  result = re.sub(at_pattern, <span class="string">&quot;@&quot;</span>, result)</span><br><span class="line"></span><br><span class="line">  result = re.sub(record_pattern, <span class="string">&quot;[语音]&quot;</span>, result)</span><br><span class="line"></span><br><span class="line">  result = re.sub(redbag_pattern, <span class="string">&quot;[红包]&quot;</span>, result)</span><br><span class="line"></span><br><span class="line">  result = re.sub(shit_pattern, <span class="string">&quot;不支持的信息类型&quot;</span>, result)</span><br><span class="line">  result = result.replace(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;《&quot;</span>).replace(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;》&quot;</span>)</span><br><span class="line">  <span class="comment"># 返回替换后的结果</span></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connectagain</span>():</span><br><span class="line">    client.connect()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_timer</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 每5分钟执行一次</span></span><br><span class="line">        time.sleep(<span class="number">5</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="comment"># 在后台线程中执行需要定时执行的函数</span></span><br><span class="line">        threading.Thread(target=connectagain).start()</span><br><span class="line"><span class="comment"># 避免重复执行使得后台刷屏</span></span><br><span class="line">connectagain()</span><br><span class="line">timer_thread = threading.Thread(target=run_timer)</span><br><span class="line">timer_thread.daemon = <span class="literal">True</span></span><br><span class="line">timer_thread.start()</span><br></pre></td></tr></table></figure><div class="tag-plugin quot"><h3 class="content" id="杂项" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">杂项</span><span class="empty"></span></h3></div><ol><li>备份相关：</li></ol><p>由于之前存档炸过一次，相关的备份措施也随之建立起来。可分为主动式和被动式。主动式嘛，好说，不就是手动关掉自动保存然后压缩到一个独立硬盘嘛</p><p>被动的话就是用Syncthing进行单向同步，目前，我设置了2台设备用于备份</p><pre class="mermaid">flowchart LR    A[Game Server] -->|"有更改时同步"| B("B Server")    A[Game Server] -->|"2h全部同步"| C    C("A Server")-->|"有更改时同步"|B</pre><p>也用过git，但同步太耗性能了，遂放弃</p><ol start="2"><li>自动节能</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> mcstatus <span class="keyword">import</span> JavaServer</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">BALANCE = <span class="string">&#x27;381b4222-f694-41f0-9685-ff5bb260df2e&#x27;</span></span><br><span class="line">HIGH_PERFORMANCE = <span class="string">&#x27;8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c&#x27;</span></span><br><span class="line">ENERGY_SAVER = <span class="string">&#x27;a1841308-3541-4fab-bc81-f71556f20b4a&#x27;</span></span><br><span class="line">redis_client = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">server = JavaServer.lookup(<span class="string">&quot;127.0.0.1:26565&quot;</span>)</span><br><span class="line">people = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_power_plan</span>(<span class="params">plan</span>):</span><br><span class="line">    subprocess.run(<span class="string">f&#x27;powercfg /S <span class="subst">&#123;plan&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_power_plan</span>():</span><br><span class="line">    output = subprocess.run(<span class="string">&quot;powercfg /GETACTIVESCHEME&quot;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE).stdout.decode(<span class="string">&quot;GBK&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> output.split(<span class="string">&quot; &quot;</span>)[-<span class="number">3</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">what_power_plan</span>(<span class="params">plan</span>):</span><br><span class="line">    <span class="keyword">if</span> plan == BALANCE:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BALANCE&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> plan == ENERGY_SAVER:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ENERGY_SAVER&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> plan == HIGH_PERFORMANCE:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HIGH_PERFORMANCE&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">what_power_planid</span>(<span class="params">plan</span>):</span><br><span class="line">    <span class="keyword">if</span> plan == <span class="string">&quot;BALANCE&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> BALANCE</span><br><span class="line">    <span class="keyword">elif</span> plan == <span class="string">&quot;ENERGY_SAVER&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> ENERGY_SAVER</span><br><span class="line">    <span class="keyword">elif</span> plan == <span class="string">&quot;HIGH_PERFORMANCE&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> HIGH_PERFORMANCE</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    current_time = time.strftime(<span class="string">&quot;%H:%M:%S&quot;</span>, time.localtime())</span><br><span class="line">    plan = get_power_plan()</span><br><span class="line">    mcserve_plan = redis_client.get(<span class="string">&#x27;powerplan&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> mcserve_plan <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        cpu_percent = psutil.cpu_percent()</span><br><span class="line">        status = server.status()</span><br><span class="line">        hour = <span class="built_in">int</span>(current_time.split(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> hour &gt;= <span class="number">0</span> <span class="keyword">and</span> hour &lt;= <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">if</span> plan != ENERGY_SAVER:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：切换到节能模式&quot;</span>)</span><br><span class="line">                change_power_plan(ENERGY_SAVER)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> status.players.online &gt; <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> plan != HIGH_PERFORMANCE:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：多人，切换到高性能模式&quot;</span>)</span><br><span class="line">                change_power_plan(HIGH_PERFORMANCE)</span><br><span class="line">        <span class="keyword">elif</span> status.players.online &gt; people:</span><br><span class="line">            <span class="keyword">if</span> plan != BALANCE:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：有人，切换到平衡模式&quot;</span>)</span><br><span class="line">                change_power_plan(BALANCE)</span><br><span class="line">        <span class="keyword">elif</span> cpu_percent &gt; <span class="number">70</span>:</span><br><span class="line">            <span class="keyword">if</span> plan != HIGH_PERFORMANCE:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：CPU占用过高，切换到平衡模式&quot;</span>)</span><br><span class="line">                change_power_plan(BALANCE)</span><br><span class="line">        <span class="keyword">elif</span> status.players.online &lt;= people:</span><br><span class="line">            <span class="keyword">if</span> plan != ENERGY_SAVER:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：无人，切换到节能模式&quot;</span>)</span><br><span class="line">                change_power_plan(ENERGY_SAVER)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> plan != BALANCE:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：切换到平衡模式&quot;</span>)</span><br><span class="line">                change_power_plan(BALANCE)</span><br><span class="line">    <span class="keyword">if</span> mcserve_plan <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        decoded_mcserve_plan = mcserve_plan.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> what_power_plan(plan) == decoded_mcserve_plan:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            power_plan_id = what_power_planid(decoded_mcserve_plan)</span><br><span class="line">            change_power_plan(power_plan_id)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：MCSERVE覆盖配置，切换到&quot;</span> + decoded_mcserve_plan + <span class="string">&quot;计划&quot;</span>)</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">300</span>)</span><br></pre></td></tr></table></figure><pre class="mermaid">graph TB    A["开始"]    B{"获取mcserve_plan"}    C{"mcserve_plan为空"}    D["获取当前时间、电源计划、CPU占用率和服务器状态"]    E{"时间在0-5点"}    F{"在线人数大于3"}    G{"在线人数大于1"}    H{"CPU占用率大于70%"}    I{"在线人数小于等于1"}    J["切换到节能模式"]    K["切换到高性能模式"]    L["切换到平衡模式"]    M["切换到节能模式"]    N["切换到平衡模式"]    O{"mcserve_plan不为空"}    Q["根据mcserve_plan切换电源计划"]    R["结束"]    A-->B    B-->C    C--是-->D    D-->E    E--是-->J    E--否-->F    F--是-->K    F--否-->G    G--是-->L    G--否-->H    H--"是（后来临时修改）"-->L    H--否-->I    I--是-->M    I--否-->N    C--否-->O    O--是-->R    O--否-->Q    Q-->R</pre><blockquote><p>注：在部分情况下（如E5）使用高性能模式会使单核最高睿频下降，反而不利，可自行抉择</p></blockquote><ol start="3"><li>未开发完成功能</li></ol><ul><li><strong>[WEB]小黑屋：</strong> 在实行<code>白名单</code>后破坏性外挂直接绝迹，直接鸽了。</li><li>**[WEB]假人管理：**后来人也绝迹了，鸽</li><li>**[WEB]成就：**鸽</li><li><strong>[WEB]自检：</strong> 用于检查一开始结构图中各个部分的运行情况，后来发现都正常的很，遂鸽.</li><li>**[MCDR]实体追踪器：**鸽</li></ul><h2 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h2><p>​逝去的事物，只是换了个形式陪伴在你我身边。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatheart.png"/></span></p><p>​<strong>相册（多图预警）</strong></p><div class="tag-plugin gallery grid-box" size="mix" ratio="square"><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/06/22/6494658d39c93.webp?fmt=avif" alt="THEOSMANTHUSWINE()_1687446921569.9314.webp"/><div class="image-meta"><span class="image-caption">THEOSMANTHUSWINE()_1687446921569.9314.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/06/22/6494678037ccc.webp?fmt=avif" alt="H_Skippy（原Yangyyx）()_1687447421090.0547.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447421090.0547.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/06/22/649467851b891.webp?fmt=avif" alt="H_Skippy（原Yangyyx）()_1687447425470.0432.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447425470.0432.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/06/22/649467889d7bc.webp?fmt=avif" alt="H_Skippy（原Yangyyx）()_1687447430099.4773.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447430099.4773.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/06/22/6494678b7dfa4.webp?fmt=avif" alt="H_Skippy（原Yangyyx）()_1687447433416.5522.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447433416.5522.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/06/22/6494678e5d823.webp?fmt=avif" alt="H_Skippy（原Yangyyx）()_1687447436391.867.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447436391.867.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/06/22/649467915a61f.webp?fmt=avif" alt="H_Skippy（原Yangyyx）()_1687447439140.172.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447439140.172.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/06/22/64946794e9347.webp?fmt=avif" alt="H_Skippy（原Yangyyx）()_1687447442236.669.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447442236.669.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9ed6c50c22.webp?fmt=avif" alt="2644.webp"/><div class="image-meta"><span class="image-caption">2644.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9ed9c3ad38.webp?fmt=avif" alt="726.webp"/><div class="image-meta"><span class="image-caption">726.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9ed9f54362.webp?fmt=avif" alt="821.webp"/><div class="image-meta"><span class="image-caption">821.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9eda62b4d3.webp?fmt=avif" alt="192.webp"/><div class="image-meta"><span class="image-caption">192.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9eda98c3bd.webp?fmt=avif" alt="1228.webp"/><div class="image-meta"><span class="image-caption">1228.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/09/64aa6b4872aab.webp?fmt=avif" alt="5107.webp"/><div class="image-meta"><span class="image-caption">5107.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/09/64aa6b4e18551.webp?fmt=avif" alt="2917.webp"/><div class="image-meta"><span class="image-caption">2917.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/09/64aa966c95dda.webp?fmt=avif" alt="8945.webp"/><div class="image-meta"><span class="image-caption">8945.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/16/64b3d29485703.webp?fmt=avif" alt="1045.webp"/><div class="image-meta"><span class="image-caption">1045.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-2" src="https://onep.hzchu.top/mount/pic/2023/07/18/64b6a0da75e70.webp?fmt=avif" alt="9756.webp"/><div class="image-meta"><span class="image-caption">9756.webp</span></div></div></div>]]></content>
    
    
    <summary type="html">纪念一下~</summary>
    
    
    
    <category term="技术类" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E7%B1%BB/"/>
    
    
    <category term="python" scheme="https://blog.hzchu.top/tags/python/"/>
    
    <category term="MC" scheme="https://blog.hzchu.top/tags/MC/"/>
    
  </entry>
  
  <entry>
    <title>Mirouterui简要部署指南</title>
    <link href="https://blog.hzchu.top/2023/howtorunmrui/"/>
    <id>https://blog.hzchu.top/2023/howtorunmrui/</id>
    <published>2023-08-28T15:25:56.000Z</published>
    <updated>2023-08-28T15:25:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>该项目是由于我厌倦了管理后台和APP的卡顿而写的，因此项目开发之初就<strong>不考虑集成在管理后台</strong>，做成一个<strong>独立</strong>的页面，并实现跨平台。</p><p>并且，调用的都是小米路由器<strong>独有</strong>的api接口，与Openwrt<strong>完全不兼容</strong>。</p><p>用于测试的只有r1d和r4a，对于别的型号的支持，还得看大家的反馈才能完善。</p><p>感谢<code>YSC6666，黑衣剑士z，Super丶聪(@bilibili)</code>的帮助</p><p>代码开源在 <a href="https://github.com/Mirouterui/">https://github.com/Mirouterui/</a> ，欢迎 star&amp;提prヾ(≧▽≦*)o</p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/Mirouterui/mirouter-ui"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=Mirouterui&repo=mirouter-ui&theme=white&show_owner=true"/></a></div><blockquote><p>碍于实际需求，拿一台瘦客户机装了个ikuai，这个项目先鸽了</p></blockquote><h2 id="面板展示"><a class="markdownIt-Anchor" href="#面板展示"></a> 面板展示</h2><div class="tag-plugin tabs" align="center"id="tab_1"><div class="nav-tabs"><div class="tab active"><a href="#tab_1-1">首页</a></div><div class="tab"><a href="#tab_1-2">路由器详情</a></div><div class="tab"><a href="#tab_1-3">设备列表</a></div><div class="tab"><a href="#tab_1-4">设备详情</a></div><div class="tab"><a href="#tab_1-5">温度显示（仅支持部分设备）</a></div><div class="tab"><a href="#tab_1-6">历史数据统计</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_1-1"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda7065545f.webp?fmt=avif" alt="首页" /></p></div><div class="tab-pane" id="tab_1-2"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda5d44eefa.webp?fmt=avif" alt="路由器详情" /></p></div><div class="tab-pane" id="tab_1-3"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda5d0ed93e.webp?fmt=avif" alt="设备列表" /></p></div><div class="tab-pane" id="tab_1-4"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda5d396d7e.webp?fmt=avif" alt="设备详情" /></p></div><div class="tab-pane" id="tab_1-5"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda75443b5e.webp?fmt=avif" alt="温度显示" /></p></div><div class="tab-pane" id="tab_1-6"><p><img src="https://onep.hzchu.top/mount/pic/2023/12/16/657da564382fb.webp?fmt=avif" alt="history_index.webp" /></p></div></div></div><h2 id="部署"><a class="markdownIt-Anchor" href="#部署"></a> 部署</h2><blockquote><p>小米路由器是基于Openwrt的，故下文Openwrt仅指小米路由器<br />附：<br />​<img src="https://onep.hzchu.top/mount/pic/2023/08/28/64ec662280acf.webp?fmt=avif" alt="" /></p></blockquote><div class="tag-plugin tabs" align="center"id="tab_2"><div class="nav-tabs"><div class="tab active"><a href="#tab_2-1">Windows</a></div><div class="tab"><a href="#tab_2-2">Openwrt</a></div><div class="tab"><a href="#tab_2-3">Docker</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_2-1"><p>从<a href="https://github.com/thun888/mirouter-ui/releases/">Release</a>下载对应的架构的发行版</p><blockquote><p>64位：amd64，32位：i386，arm: arm</p><p>可访问<a href="https://h5ai.hzchu.top/Mirouter-ui/">镜像站</a>以获取更快的速度</p></blockquote><p>然后运行，程序会自动下载配置文件，在其中填上密码即可。配置文件中其它条目在下面</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64ed9a2394601.gif" alt="" /></p><p>再次运行，等待下载页面静态文件，若能支持获取token即为成功</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64ed9a23945b0.gif" alt="" /></p><blockquote><p>部分设备出现无法运行&amp;无法找到配置文件可使用“不使用upx压缩”版本（即带<code>_noupx</code>后缀的版本）</p></blockquote></div><div class="tab-pane" id="tab_2-2"><p>从<a href="https://d.hzchu.top/e">Release</a>复制对应的架构的发行版的下载链接</p><blockquote><p>使用<code>uname –a</code>查看架构（如果为<code>armv7l</code>，考虑使用<code>armv5</code>版本）</p></blockquote><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64ed9b78dbe91.webp?fmt=avif" alt="R1D" /></p><p>运行：</p><blockquote><p>curl –L yourlink –o mirouterui</p><p>chmod 777 mirouterui</p><p>./mirouterui</p></blockquote><p>程序会自动下载配置文件，在其中填上密码即可。配置文件中其它条目在下面。.</p><p>再次运行，等待下载页面静态文件</p><p>若能支持获取token即为成功</p><p><strong>常见问题：</strong></p><ol><li>无法下载配置文件，<s>路由器太老了</s></li></ol><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64ed9e59288c3.webp?fmt=avif" alt="" /></p><blockquote><p>使用 <code>curl https://mruiapi.hzchu.top/downloadconfig -o config.json</code> 手动下载</p></blockquote><ol start="2"><li>无法下载静态文件</li></ol><p>从<a href="https://d.hzchu.top/d">Mirouterui/static: 前端静态文件 (github.com)</a>下载，并解压到<code>static</code>目录</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda04788f04.webp?fmt=avif" alt="" /></p></div><div class="tab-pane" id="tab_2-3"><p>命令：</p><blockquote><p>docker run -d -p 6789:6789 -v $(pwd):/app/data --name mirouter-ui --restart=always thun888/mirouter-ui</p></blockquote><p>新建一个文件夹，并在该文件夹里运行上述命令，程序会在该文件夹里生成配置文件，修改即可</p><p>修改完成后重启该容器（或等待自动重启）</p></div></div></div><p>最后命令窗口中会显示网页的访问端口，使用设备的<code>ip地址+端口号(6789)</code>访问面板</p><h3 id="常见问题"><a class="markdownIt-Anchor" href="#常见问题"></a> 常见问题</h3><ol><li><p>密码正确，但无法登陆：尝试获取自己路由器的key，可参考<a href="https://d.hzchu.top/c">视频</a>或使用<a href="https://d.hzchu.top/b">自动工具</a></p></li><li><p>CPU占用为0： 受api限制，新版路由器无法正常获取，可尝试将其部署在路由器上</p></li><li><p>温度显示： 目前API模式只支持R1D,R2D,命令模式只支持红米AX6和R1D</p></li><li><p>设备显示不全： 当设备过多时，首页只会显示当前有网络活动的设备，请进入设备详细列表查看</p></li><li><p>在线前端无法使用： 受浏览器安全限制，需关闭访问私有ip限制</p></li></ol><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda267463b1.webp?fmt=avif" alt="Chrome" /></p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda26a747a5.webp?fmt=avif" alt="Edge" /></p><h3 id="配置项"><a class="markdownIt-Anchor" href="#配置项"></a> 配置项</h3><p><img src="https://onep.hzchu.top/mount/pic/2023/12/16/657da76badee9.webp?fmt=avif" alt="config" /></p><table><thead><tr><th>配置名</th><th>默认值</th><th>解释</th></tr></thead><tbody><tr><td>dev</td><td>[]</td><td>路由器信息，参阅<code>dev项</code></td></tr><tr><td>history</td><td>[]</td><td>历史记录相关功能，参阅<code>history项</code></td></tr><tr><td>tiny</td><td>false</td><td>启用后，不再下载静态文件，需搭配<a href="http://mrui.hzchu.top:8880/">在线前端</a>使用</td></tr><tr><td>netdata_routerid</td><td>0</td><td>调用netdata api时返回的路由器（对应dev项中第n个）</td></tr><tr><td>flushTokenTime</td><td>1800</td><td>刷新token时间间隔(s)</td></tr><tr><td>port</td><td>6789</td><td>网页页面端口号</td></tr><tr><td>debug</td><td>true</td><td>debug模式，建议在测试正常后关闭</td></tr></tbody></table><p><strong>dev</strong>项：</p><table><thead><tr><th>配置名</th><th>默认值</th><th>解释</th></tr></thead><tbody><tr><td>password</td><td></td><td>路由器管理后台密码</td></tr><tr><td>key</td><td>a2ffa5c9be07488bbb04a3a47d3c5f6a</td><td>路由器管理后台key</td></tr><tr><td>ip</td><td>192.168.31.1</td><td>路由器IP</td></tr><tr><td>routerunit</td><td>false</td><td>启用后，程序通过<code>gopsutil</code>库获取CPU占用</td></tr></tbody></table><p><strong>history</strong>项：</p><table><thead><tr><th>配置名</th><th>默认值</th><th>解释</th></tr></thead><tbody><tr><td>enable</td><td>false</td><td>是否启用历史数据统计</td></tr><tr><td>sampletime</td><td>300</td><td>采样时间间隔(s)</td></tr><tr><td>maxsaved</td><td>8640</td><td>最多记录条数</td></tr></tbody></table><p>命令行参数：</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–config</td><td>配置文件路径，默认为“./config.json”</td></tr><tr><td>–basedirectory</td><td>基础目录路径，在里面存放静态文件</td></tr><tr><td>–databasepath</td><td>数据库路径，默认为“./database.db”</td></tr></tbody></table><h3 id="后台运行"><a class="markdownIt-Anchor" href="#后台运行"></a> 后台运行</h3><p>注册为系统服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/mrui.service</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=mrui</span><br><span class="line"><span class="attr">After</span>=network.target network-<span class="literal">on</span>line.target</span><br><span class="line"><span class="attr">Requires</span>=network-<span class="literal">on</span>line.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">ExecStart</span>=/pathto/mrui</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>设置开机自启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> mrui</span><br></pre></td></tr></table></figure><p>管理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看状态：systemctl status mrui</span><br><span class="line">启动：sudo systemctl start mrui</span><br><span class="line">停止：sudo systemctl stop mrui</span><br><span class="line">重启：sudo systemctl restart mrui</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/fps2tao/p/16433588.html">windows守护进程工具–nssm详解  - 博客园 (cnblogs.com)</a></p><h2 id="todo"><a class="markdownIt-Anchor" href="#todo"></a> TODO</h2><ul><li>[x] 历史数据统计</li><li>[x] 深色模式</li><li>[x] 多路由支持</li><li>[x] 快捷更新</li><li>[ ] 设备小工具</li><li>[x] netdata，api形式兼容</li></ul><p><a href="https://bbs.hzchu.top/d/2-mruikai-fa-gui-hua">MRUI开发规划</a></p><blockquote><p>主要功能已完成开发,接下来随缘更新😶‍🌫️</p></blockquote><h2 id="更新日志"><a class="markdownIt-Anchor" href="#更新日志"></a> 更新日志</h2><div class="tag-plugin timeline ds-timeline" api="https://cfproxy.hzchu.top/https://api.github.com/repos/Mirouterui/mirouter-ui/releases?per_page=3"></div><h2 id="stars~"><a class="markdownIt-Anchor" href="#stars~"></a> Stars~</h2><p><img src="https://starchart.cc/mirouterui/mirouter-ui.svg" alt="Stars~" /></p><p>感谢各位😘</p><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">1-100</span><span class="empty"></span></p></div><div class="tag-plugin users-wrap"><div class="ds-friends"  api="https://cfproxy.hzchu.top/https://api.github.com/repos/Mirouterui/mirouter-ui/stargazers?per_page=100&page=1"><div class="grid-box"></div></div></div>]]></content>
    
    
    <summary type="html">基于小米路由器API的展示面板</summary>
    
    
    
    
    <category term="Mirouterui" scheme="https://blog.hzchu.top/tags/Mirouterui/"/>
    
  </entry>
  
  <entry>
    <title>基于Onedrive的高可用性图床</title>
    <link href="https://blog.hzchu.top/2023/photoononedrive/"/>
    <id>https://blog.hzchu.top/2023/photoononedrive/</id>
    <published>2023-07-31T11:53:17.000Z</published>
    <updated>2023-07-31T11:53:17.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h3><div class="tag-plugin colorful note" color="yellow"><div class="body"><p>重写中。。。</p></div></div><p>一直以来，我都在尝试各种图片存储方案，一开始便是经典的Github+jsd，但考虑到违反了tos后面就用了cf+b2，但速度不尽人意。后来用了vercel反代gh和一些杂七杂八的，但换汤不换药嘛，还是不靠谱。</p><span id="more"></span><p>在差不多一年前，我在捣鼓网心云时想到个主意：何不用家里电脑作为图片存储，通过非标准端口访问绕过备案要求。于是在<a href="https://notes.hzchu.top/">随记</a>上提出个简易pcdn的想法</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/cf1/2022/08/29/630c0d1c1087e.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/cf1/2022/08/29/630c0d1c1087e.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>不过像我这种小站没必要搞那么重量级了，于是改进了下</p><h3 id="思路"><a class="markdownIt-Anchor" href="#思路"></a> 思路</h3><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/01/64c90aaccffac.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/08/01/64c90aaccffac.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>首先，本质上是个缓存服务，存储在OneDrive（下文简称od），通过各个节点分发图片，<s>就是给od套了个CDN嘛</s>。</p><p>因为我这网站也没多少流量，并发不高，我更倾向葫芦娃救爷爷式的单节点当主力，挂了再切换到其它节点的方式。</p><p>最后就是轻量，加上安全性问题总不能把od下放到每个节点吧。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatneutral.png"/></span></p><p>故：</p><ol><li>设立一个“主服务器”，用来将od的内容分发到节点，可以用无服务器函数，也可以直接和”图床服务器“合并。同时因为服务器间同步有延时，在”图床服务器“要留个口直接下载刚刚上传的图片。</li><li>设立一个”副服务器“，负责检测节点状况和跳转到对应节点。</li><li>”图床服务器“：使用lsky-pro作为图床程序，将od使用rclone挂载到对应的存储策略文件夹上。</li><li>节点：获取访问的链接，检查本地有无缓存，有就返回，没有就下载再返回。考虑到要用php的话配置起来麻烦，直接用py了。</li></ol><h3 id="准备"><a class="markdownIt-Anchor" href="#准备"></a> 准备</h3><ol><li>服务器 &gt;=1台，最好是访问速度快的</li><li>一个微软账户（我这里用的是E5订阅账户）</li><li><em>有公网IP的家庭宽带（可选）</em></li></ol><p>在od中新建<code>/share/mount</code>目录，若自行更改请注意将下文涉及的地方一起修改</p><p>推荐使用Linux，如果使用Windows下文操作将有所不同，需自行更改</p><h3 id="安装图床服务器"><a class="markdownIt-Anchor" href="#安装图床服务器"></a> 安装（图床服务器）</h3><p>首先完成“图床服务器”的搭建。</p><h4 id="前置"><a class="markdownIt-Anchor" href="#前置"></a> 前置</h4><h5 id="libfuse"><a class="markdownIt-Anchor" href="#libfuse"></a> libfuse</h5><p>安装<code>meson ninja</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install meson ninja</span><br></pre></td></tr></table></figure><a class="tag-plugin colorful hashtag" color="red" href="https://blog.csdn.net/qq_38980655/article/details/86579348"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>安装pip的三种方法</span></a><p>从 <a href="https://github.com/libfuse/libfuse/releases">https://github.com/libfuse/libfuse/releases</a> 下载libfuse的源码</p><p>解压，创建一个（临时）构建目录，然后 运行<code>meson</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar xzf fuse-3.15.1.tar.gz; <span class="built_in">cd</span> fuse-3.15.1/</span><br><span class="line"><span class="built_in">mkdir</span> build; <span class="built_in">cd</span> build</span><br><span class="line">meson setup ..</span><br></pre></td></tr></table></figure><blockquote><p>3.15.1 替换为对应的releases版本</p></blockquote><p>运行<code>ninja</code>进行安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ninja install</span><br></pre></td></tr></table></figure><h5 id="rclone"><a class="markdownIt-Anchor" href="#rclone"></a> rclone</h5><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://rclone.org/install.sh | sudo bash</span><br></pre></td></tr></table></figure><blockquote><p>同时在本地也要安装，用来获取token</p></blockquote><p>在本地运行rclone config进行配置</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c78ef1d6bdd.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c78ef1d6bdd.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>把token复制出来备用（token包括两端的{}）</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c78ee02488b.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c78ee02488b.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>在服务端进行同样的操作，但在<code>Edit advanced config</code>中填<code>y</code></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c78d2be701c.webp?fmt=avif" alt="image-20230731182953894" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20230731182953894" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c78d2be701c.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20230731182953894</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c78d6802369.webp?fmt=avif" alt="image-20230731183101473" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20230731183101473" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c78d6802369.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20230731183101473</span></div></div><p>然后一路回车，在<code>Already have a token - refresh?</code>填<code>n</code></p><p>然后按要求填写</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c790cd11e2f.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c790cd11e2f.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><blockquote><p>会自动获取drive_id,drive_type，不要回车太快按过了</p></blockquote><p>挂载试试吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> mount</span><br><span class="line">rclone mount one:/share/mount/ ./mount/</span><br></pre></td></tr></table></figure><p>不出意外你能看见这个报错<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/blobcatbox.png"/></span></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c791e12d260.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c791e12d260.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>打开报错涉及的文件，取消注释，保存</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c791ad2e565.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c791ad2e565.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>再试下，如果没报错就可以了</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7b69648695.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c7b69648695.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><blockquote><p>新建的mount文件夹在下文没有作用，建议删除~</p><p>使用fusermount -qzu mount 卸载</p></blockquote><h5 id="lnmp"><a class="markdownIt-Anchor" href="#lnmp"></a> LNMP</h5><p>不用多说</p><h4 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h4><h5 id="图床本体"><a class="markdownIt-Anchor" href="#图床本体"></a> 图床本体</h5><p>我这里用的是<a href="https://docs.lsky.pro/docs/free/v2/quick-start/installation.html">Lsky Pro</a>作为图床程序，其他大同小异</p><p>按照文档安装好后，新建一个<strong>本地</strong>存储策略，访问地址指向“副服务器”，并在后面加上<code>/mount</code>，存储路径根据自己的网站路径来，如<code>/www/wwwroot/pic.hzchu.top/</code>就填<code>/www/wwwroot/pic.hzchu.top/storage/app/mount/</code></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7bd10e5167.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c7bd10e5167.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><blockquote><p>记得更改&amp;新建相应目录</p></blockquote><h5 id="rclone-2"><a class="markdownIt-Anchor" href="#rclone-2"></a> Rclone</h5><p>rclone需要持久化运行，我这里建议的是Supervisor或系统自带的systemd，windows使用nssm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone mount one:/share/mount/ /www/wwwroot/pic.hzchu.top/storage/app/mount/ --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --<span class="built_in">umask</span> 000 --vfs-cache-mode full --attr-timeout 15m --vfs-cache-max-age 240h --vfs-cache-max-size 1G --buffer-size 100M</span><br></pre></td></tr></table></figure><div class="tag-plugin tabs" align="center"id="tab_3"><div class="nav-tabs"><div class="tab active"><a href="#tab_3-1">supervisor</a></div><div class="tab"><a href="#tab_3-2">systemd</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_3-1"><p>以宝塔面板为例</p><p>打开<code>软件商店</code>，搜索并安装<code>进程守护管理器</code>：</p><p>点击<code>添加守护进程</code>，如图所示</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c05cc5077.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c05cc5077.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div></div><div class="tab-pane" id="tab_3-2"><p>运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/rclone-one.service</span><br></pre></td></tr></table></figure><p>​写入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=rclone-one</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=rclone mount one:/share/mount/ /www/wwwroot/pic.hzchu.top/storage/app/mount/ --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --<span class="built_in">umask</span> 000 --vfs-cache-mode full --attr-timeout 15m --vfs-cache-max-age 240h --vfs-cache-max-size 1G --buffer-size 100M</span><br><span class="line">ExecReload=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">Restart=on-abnormal</span><br><span class="line">RestartSec=5s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></div></div></div><h3 id="安装主服务器"><a class="markdownIt-Anchor" href="#安装主服务器"></a> 安装（主服务器）</h3><p>可以用无服务器函数，这里使用<a href="https://github.com/spencerwooo/onedrive-vercel-index">onedrive-vercel-index</a>作为OneDrive的直链解析，<a href="https://ovi.swo.moe/zh/docs/getting-started">这里</a>是它的文档</p><p>将<code>baseDirectory</code>设为<code>/share</code></p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c4a67fdad.webp?fmt=avif" alt="1690813605718.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1690813605718.webp" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c4a67fdad.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1690813605718.webp</span></div></div><p>由于原作者的应用程序已过期，需要自行配置，参考<a href="https://ovi.swo.moe/zh/docs/advanced#%E4%BD%BF%E7%94%A8%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84-client-id-%E4%B8%8E-secret">高级 - OneDrive Vercel Index (swo.moe)</a>进行调整</p><blockquote><p>由于<code>vercel.app</code>在国内污染严重，请绑定你的域名</p></blockquote><h3 id="中途-开香槟-测试"><a class="markdownIt-Anchor" href="#中途-开香槟-测试"></a> 中途 <s>开香槟</s> 测试</h3><ol><li>在图床中上传一张图片，查看是否上传成功，若出现错误，则检查图床服务器</li><li>等待5分钟后访问<code>https://yourdomain.top/zh-CN/mount/</code>，查看是否出现<code>pic</code>文件夹，并根据<code>年/月/日</code>进入子文件夹查看能否访问图片</li></ol><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c5eaae480.webp?fmt=avif" alt="1690813930882.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1690813930882.webp" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c5eaae480.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1690813930882.webp</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c61147819.webp?fmt=avif" alt="image-20230731223247351" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20230731223247351" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c61147819.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20230731223247351</span></div></div><h3 id="安装副服务器"><a class="markdownIt-Anchor" href="#安装副服务器"></a> 安装（副服务器）</h3><p>需要安装redis，故不推荐使用虚拟主机，但非要用可以使用Vercel的<a href="https://vercel.com/dashboard/stores">Durable Redis</a></p><blockquote><p><strong>注：</strong></p><p>jumpurl为该节点的对外访问地址</p><p>apiurl 为“副服务器”的对外访问地址</p><p>backupurl 为“图床服务器“的对外访问地址</p><p>mainurl 为“主服务器“的对外访问地址</p></blockquote><div class="tag-plugin tabs" align="center"id="tab_4"><div class="nav-tabs"><div class="tab active"><a href="#tab_4-1">PHP版本</a></div><div class="tab"><a href="#tab_4-2">Python版本</a></div><div class="tab"><a href="#tab_4-3">解析</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_4-1"><blockquote><p>需要修改redis连接地址，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>s</mi><mi>e</mi><msub><mi>r</mi><mi>t</mi></msub><mi>o</mi><mi>k</mi><mi>e</mi><mi>n</mi><mtext>和</mtext></mrow><annotation encoding="application/x-tex">user_token和</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">和</span></span></span></span>mainurl</p></blockquote><p>Code:</p><pre><code>&lt;div class=&quot;tag-plugin ds-coding&quot; id=&quot;coding-2erv488as&quot;&gt;&lt;/div&gt;&lt;script&gt;addEventListener(&quot;load&quot;,function(){  console.log('[hexo-dynamic-codeblock]start load：coding-2erv488as' );  utils.jq(() =&gt; {    $(function () {      const el = document.getElementById('coding-2erv488as');        utils.request(el, &quot;https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2FMNSLXOD%2Fmain%2Fjump%2Fphp%2Findex.php&amp;lang=php&amp;usejson=true&quot;, function (data) {          $(el).append(data.result);          addCopyButtons('coding-2erv488as');        });      });  });});&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css&quot;&gt;</code></pre><p>伪静态配置:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$args</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_4-2"><p>Code:</p><blockquote><p>需要修改redis连接地址，user_token和mainurl</p></blockquote><p>安装依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask flask_limiter hypercorn flask_cors</span><br></pre></td></tr></table></figure><pre><code>&lt;div class=&quot;tag-plugin ds-coding&quot; id=&quot;coding-a1bw5cjet&quot;&gt;&lt;/div&gt;&lt;script&gt;addEventListener(&quot;load&quot;,function(){  console.log('[hexo-dynamic-codeblock]start load：coding-a1bw5cjet' );  utils.jq(() =&gt; {    $(function () {      const el = document.getElementById('coding-a1bw5cjet');        utils.request(el, &quot;https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2FMNSLXOD%2Fmain%2Fjump%2Fpy%2Fmain.py&amp;lang=python&amp;usejson=true&quot;, function (data) {          $(el).append(data.result);          addCopyButtons('coding-a1bw5cjet');        });      });  });});&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css&quot;&gt;</code></pre></div><div class="tab-pane" id="tab_4-3"><p>运行逻辑：</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca059284ed4.webp?fmt=avif" alt="image-20230802152803639" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20230802152803639" href="https://onep.hzchu.top/mount/pic/2023/08/02/64ca059284ed4.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20230802152803639</span></div></div><pre class="mermaid">flowchart TDid0([访问]) --> id1["判断路径是否为'/_api/update'"]id1 --> |是| id2["读取相关数据计入redis"]id1 --> |否| id3["设初始值为n(n₀=1,<6)，读取redis中'jump_n'"]id3 --> |值不存在| id4["n+1"]id4 --> id3id3 ---> |值存在| id5["读取相应值，与访问路径拼接后重定向"]id3 ---> |值均不存在| id6["将'主服务器'地址与访问路径拼接后重定向"]</pre><ol><li>接受服务器状态：相比于主动检测，被动式显然更简单。通过向<code>/_api/update</code>发送<code>POST</code>请求(json)，内容包括<code>token,server_id,url</code>，server_id是阿拉伯数字，url是节点的对外访问地址，将存入redis中，20分钟过期</li><li><code>/*</code>の跳转：在请求图片时，会把1-5的数字往挨个请求[如果有更多节点可以更改]，如果有值，则取该值与访问地址拼接后，返回重定向请求。如果无节点在线，则将主服务器地址与访问地址拼接再返回。</li><li>均有访问速率限制，防止被人打到爆炸，可以根据实际情况调节上限。</li></ol></div></div></div><p>在搭建完成后，测试访问之前上传的图片，如果能返回图片即ok</p><h3 id="节点"><a class="markdownIt-Anchor" href="#节点"></a> 节点</h3><p>考虑到php部署起来麻烦，这里用python解决一切</p><div class="tag-plugin colorful note" child="tabs"><div class="title"><strong>后期吐槽</strong></div><div class="body"><p>在arm设备上配环境配半天，一气之下用go重写了主要逻辑，编译成二进制文件到处丢太爽了</p></div></div><div class="tag-plugin tabs" align="center"id="tab_5"><div class="nav-tabs"><div class="tab active"><a href="#tab_5-1">Python</a></div><div class="tab"><a href="#tab_5-2">解析</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_5-1"><p>下载数据库到程序同目录：<a href="https://raw.hzchu.top/thun888/MNSLXOD/main/node/data.db">[点击下载]</a></p><p>安装依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask flask_limiter hypercorn flask_cors</span><br></pre></td></tr></table></figure><p>Code:</p><pre><code>&lt;div class=&quot;tag-plugin ds-coding&quot; id=&quot;coding-1kppdfx6j&quot;&gt;&lt;/div&gt;&lt;script&gt;addEventListener(&quot;load&quot;,function(){  console.log('[hexo-dynamic-codeblock]start load：coding-1kppdfx6j' );  utils.jq(() =&gt; {    $(function () {      const el = document.getElementById('coding-1kppdfx6j');        utils.request(el, &quot;https://hightlight-code-api.hzchu.top/api/v1/generate?url=https%3A%2F%2Fraw.githubusercontent.com%2Fthun888%2FMNSLXOD%2Fmain%2Fnode%2Fmain.py&amp;lang=python&amp;usejson=true&quot;, function (data) {          $(el).append(data.result);          addCopyButtons('coding-1kppdfx6j');        });      });  });});&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://jsd.hzchu.top/gh/thun888/assets@master/files/pygments-css/default.css&quot;&gt;</code></pre><blockquote><p>节点附带了两个简易api用于查看该节点运行情况</p><p>实际部署中可能需要自行配置ssl证书以使开启了https的网站可以正常访问</p><p>如果外部不套反向代理建议自定义10000-65535的端口</p><p>进程同样需要持久化，可以参考rclone部分</p></blockquote></div><div class="tab-pane" id="tab_5-2"><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca3aef2cf43.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/08/02/64ca3aef2cf43.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><pre class="mermaid">flowchart TD    id0([访问]) --> id1["判断路径是否为'/_api/...'"]    id1 --> |是| id2["读取相关数据返回"]    id1 --> |否| id3["检查本地有无对应文件缓存"]    id3 ---> |文件存在| id4["读取文件返回"]    id3 ---> |文件不存在| id5["将'主服务器'地址与访问路径拼接后请求，下载文件后返回"]    id6(["定时器（15min）"]) --> id7(["清理缓存"]) --> id8["检查缓存目录大小"] --> |>5GB| id9["清理一天前缓存"]    id8 --> |"≦5GB"| id10["不动作"]    id6 --> id11(["上报服务器消息"])</pre></div></div></div><h3 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h3><div class="tag-plugin tabs" align="center"id="tab_6"><div class="nav-tabs"><div class="tab active"><a href="#tab_6-1">直接访问OneDrive目录程序</a></div><div class="tab"><a href="#tab_6-2">正常访问效果</a></div><div class="tab"><a href="#tab_6-3">直接访问家宽节点</a></div><div class="tab"><a href="#tab_6-4">搭配Nginx缓存</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_6-1"><p>低并发</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/01/64c85bab42978.webp?fmt=avif" alt="1690852265630.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1690852265630.webp" href="https://onep.hzchu.top/mount/pic/2023/08/01/64c85bab42978.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1690852265630.webp</span></div></div><p>高并发</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/01/64c85bceda8cc.webp?fmt=avif" alt="1690852301797.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="1690852301797.webp" href="https://onep.hzchu.top/mount/pic/2023/08/01/64c85bceda8cc.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">1690852301797.webp</span></div></div></div><div class="tab-pane" id="tab_6-2"><p>低并发</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/01/64c85ada80fe5.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/08/01/64c85ada80fe5.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>高并发</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca4417e3b0d.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/08/02/64ca4417e3b0d.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div></div><div class="tab-pane" id="tab_6-3"><p>低并发</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c747d041a.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c747d041a.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>高并发</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca523d745c7.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/08/02/64ca523d745c7.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div></div><div class="tab-pane" id="tab_6-4"><p>高并发</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2024/01/31/65b9a7ebb16cc.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2024/01/31/65b9a7ebb16cc.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div></div></div></div><h3 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h3><p>对应这个项目，我感觉就是：<code>易上手，易扩展</code>同时可以薅到各大厂商的羊毛（怎么薅就看各位的了），既可以把一些不稳定的服务利用起来，又不用担心出问题时全部拉闸，并且背靠微软不用担心无良厂商跑路数据丢失，当然，在目前只能算的上是一个高可用性的小型cdn，比起pcdn还有不少不足，但个人使用足以。</p><p>而关于利用国内宽带在未备案情况下提供网络服务的问题，我想联通与其抓我这1个月200MB上传的小服务，不如去抓那些狗大户，更重要的是图床时自用的，不用担心因为有人上传违法色情的图片被请去喝茶。</p><p>该项目也可以用在别的地方，自行发挥啦<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://static.hzchu.top/waline-blobcatemojis@1.0/blobs/ablobcatattentionreverse.png"/></span></p><p>项目开源地址：</p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/MNSLXOD"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=MNSLXOD&theme=dark&show_owner=true"/></a></div><p>ps：</p><p>从4月份到现在为od节省了17倍的数据</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca32eb1fac5.webp?fmt=avif" alt="image-20230802183846133.webp" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" download="image-20230802183846133.webp" href="https://onep.hzchu.top/mount/pic/2023/08/02/64ca32eb1fac5.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div><div class="image-meta"><span class="image-caption center">image-20230802183846133.webp</span></div></div><p>从4月份到现在的日志</p><div class="tag-plugin image"><div class="image-bg"><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c72c298f397.webp?fmt=avif" data-fancybox="true"/><a class="image-download blur" style="opacity:0" target="_blank" href="https://onep.hzchu.top/mount/pic/2023/07/31/64c72c298f397.webp"><svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3734"><path d="M561.00682908 685.55838913a111.03077546 111.03077546 0 0 1-106.8895062 0L256.23182837 487.72885783a55.96309219 55.96309219 0 0 1 79.13181253-79.18777574L450.70357448 523.88101491V181.55477937a55.96309219 55.96309219 0 0 1 111.92618438 0v344.06109173l117.07478902-117.07478901a55.96309219 55.96309219 0 0 1 79.13181252 79.18777574zM282.81429711 797.1487951h447.70473912a55.96309219 55.96309219 0 0 1 0 111.92618438H282.81429711a55.96309219 55.96309219 0 0 1 0-111.92618438z" p-id="3735"></path></svg></a></div></div><p>共480多条，大多数都是爬虫的贡献</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h3&gt;
&lt;div class=&quot;tag-plugin colorful note&quot; color=&quot;yellow&quot;&gt;&lt;div class=&quot;body&quot;&gt;&lt;p&gt;重写中。。。&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;一直以来，我都在尝试各种图片存储方案，一开始便是经典的Github+jsd，但考虑到违反了tos后面就用了cf+b2，但速度不尽人意。后来用了vercel反代gh和一些杂七杂八的，但换汤不换药嘛，还是不靠谱。&lt;/p&gt;</summary>
    
    
    
    
    <category term="MNSLXOD" scheme="https://blog.hzchu.top/tags/MNSLXOD/"/>
    
  </entry>
  
</feed>
