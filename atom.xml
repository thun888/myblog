<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Thun888</title>
  
  <subtitle>夏日当空，心如深渊 | Thun888&#39;s Blog</subtitle>
  <link href="https://blog.hzchu.top/atom.xml" rel="self"/>
  
  <link href="https://blog.hzchu.top/"/>
  <updated>2024-04-20T15:11:40.000Z</updated>
  <id>https://blog.hzchu.top/</id>
  
  <author>
    <name>thun888</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>为小米路由器加上屏幕</title>
    <link href="https://blog.hzchu.top/2024/%E4%B8%BA%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8A%A0%E4%B8%8A%E5%B1%8F%E5%B9%95-%E7%94%A8%E5%B0%8F%E7%94%B5%E8%A7%86-SD2-%E7%9B%91%E6%8E%A7%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    <id>https://blog.hzchu.top/2024/%E4%B8%BA%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8A%A0%E4%B8%8A%E5%B1%8F%E5%B9%95-%E7%94%A8%E5%B0%8F%E7%94%B5%E8%A7%86-SD2-%E7%9B%91%E6%8E%A7%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8/</id>
    <published>2024-04-20T15:11:40.000Z</published>
    <updated>2024-04-20T15:11:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前在<code>bbs.hzchu.top</code>写过，不过没多少人看，迁回博客里</p><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><h3 id="搭建MRUI"><a href="#搭建MRUI" class="headerlink" title="搭建MRUI"></a>搭建MRUI</h3><p>顺手集成到自己项目里了，自己用起来也方便<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatcoffee.png"/></span></p><p>搭建参阅<a href="/2023/howtorunmrui/">Mirouterui简要部署指南</a></p><h3 id="修改部分程序代码"><a href="#修改部分程序代码" class="headerlink" title="修改部分程序代码"></a>修改部分程序代码</h3><p>由于默认获取一次信息间隔太短，会对路由器造成不小的负担，最好改为5s获取一次<br><img src="https://onep.hzchu.top/mount/pic/2024/01/12/65a10d998d683.webp" alt="1705053582589.webp"><br>同时程序不支持http0.1,要把发送请求处代码修改为http1.1<br><img src="https://onep.hzchu.top/mount/pic/2023/12/31/6590caaa36915.webp" alt="1703987881404.webp"></p><h2 id="展示"><a href="#展示" class="headerlink" title="展示"></a>展示</h2><div class="tag-plugin swiper fancybox" id="swiper-api" effect="cards"><div class="swiper-wrapper"><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2023/12/31/6590c9dc1e6f1.webp" alt="IMG_20231230_103045.webp"></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2023/12/31/6590cbaed9f8a.webp" alt="IMG_20231230_103045.webp"></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2023/12/31/6590cb5e87c0b.webp" alt="1703988060977.webp"></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev blur"></div><div class="swiper-button-next blur"></div></div><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><h3 id="自定义显示"><a href="#自定义显示" class="headerlink" title="自定义显示"></a>自定义显示</h3><p>你可以参照下面的图片中的“传感器”名称，对代码中获取传感器数据的地方进行修改。如我就将温度改为了在线设备数</p><h3 id="HA"><a href="#HA" class="headerlink" title="HA"></a>HA</h3><p>同时兼容HA的netdata集成<br><img src="https://onep.hzchu.top/mount/pic/2024/01/01/659222d20746e.webp" alt="1704075984628.webp"><br><img src="https://onep.hzchu.top/mount/pic/2024/01/01/659223056c85c.webp" alt="1704076036821.webp"><br>示例配置：<br><img src="https://onep.hzchu.top/mount/pic/2024/01/01/6592231bdd188.webp" alt="1704076059450.webp"></p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>感觉他程序有点不如人意，特别是我照着readme写完时发现用的api已经弃用了，重写完发现每秒发送5个请求直接把路由器的cpu占用干到80%+的时候<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatneutral.png"/></span></p><p>当然也有我的锅，现在调用netdata的api默认会有两秒的缓存</p>]]></content>
    
    
    <summary type="html">通过MRUI构造网络请求来用小电视(SD2)监控小米路由器</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Mirouterui" scheme="https://blog.hzchu.top/tags/Mirouterui/"/>
    
  </entry>
  
  <entry>
    <title>为小米MIX2s更换音量排线及电池的最优方法</title>
    <link href="https://blog.hzchu.top/2024/%E4%B8%BA%E5%B0%8F%E7%B1%B3MIX2s%E6%9B%B4%E6%8D%A2%E9%9F%B3%E9%87%8F%E6%8E%92%E7%BA%BF%E5%8F%8A%E7%94%B5%E6%B1%A0%E7%9A%84%E6%9C%80%E4%BC%98%E6%96%B9%E6%B3%95/"/>
    <id>https://blog.hzchu.top/2024/%E4%B8%BA%E5%B0%8F%E7%B1%B3MIX2s%E6%9B%B4%E6%8D%A2%E9%9F%B3%E9%87%8F%E6%8E%92%E7%BA%BF%E5%8F%8A%E7%94%B5%E6%B1%A0%E7%9A%84%E6%9C%80%E4%BC%98%E6%96%B9%E6%B3%95/</id>
    <published>2024-04-20T09:57:40.000Z</published>
    <updated>2024-04-20T09:57:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>两三个月前吧，我发现音量下键和开关键时灵时不灵的，特别是开关键软趴趴的，时不时卡住就循环重启。直到半个月前，它终于圆满的离开了—彻底按不动了，锁屏都得下滑通知栏，点按钮才关得上。然后一寻思，反正都要拆开了，顺便换个电池吧（软件统计剩余容量2000多毫安时，待机一晚上都挺不过去<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatfacepalm.png"/></span>）</p><h2 id="买零件"><a href="#买零件" class="headerlink" title="买零件"></a>买零件</h2><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>我这里买的是中电的扩容电池，因为电池配着工具包所以音量排线买一个三块钱左右的也够了（虽然我忘了这茬<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatt.png"/></span></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66236c3bdeec7.webp" alt="IMG_20240420_101135.webp"></p>    </div>    </div><h2 id="准备材料"><a href="#准备材料" class="headerlink" title="准备材料"></a>准备材料</h2><ol><li>热风枪</li><li>耐热垫板</li><li>镊子</li></ol><blockquote><p>若没有热风枪，可使用电吹风</p></blockquote><p>零件全家福：</p><p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/6623725117296.webp" alt="IMG_20240419_171503.webp"></p><p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662378a301bac.webp" alt="IMG_20240419_171523.webp"></p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol><li>将手机电量用尽</li><li>关机</li></ol><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><ol><li>取出卡托</li></ol><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="2"><li>将手机背面朝上放置在隔热垫板上，使用热风枪来回加热尾部边缘地区</li></ol><p>我比较暴力啊直接500°C吹了40多秒，一开始用电吹风折腾了十几分钟没搞开<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatdead.png"/></span></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662379e57f7ba.webp" alt="1713600995917.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="3"><li>放好热风枪，迅速将吸盘吸在尾部（确认吸盘完全吸附，尽量不要探到手机外部），右手食指和拇指按住手机两侧尾部（中框处），往外拉吸盘</li><li>拉开缝后就容易了，用附赠的卡片卡住即可（如果来不及可以先用指甲顶上<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatmeltthumb.png"/></span>）</li></ol>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66237c258bed3.webp" alt="IMG_20240419_174028.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="5"><li>在这基础上，可以尝试直接使用划开，如果不行就用拨片。如果划不动不妨翘一翘</li></ol><div class="tag-plugin colorful note" color="red"><div class="title">注意</div><div class="body"><p>最好逆时针刮，毕竟指纹排线在音量键旁边</p></div></div>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66237e34a5c81.webp" alt="跑焦了"></p>    </div>    </div><div class="tag-plugin colorful note" color="yellow"><div class="title">注意</div><div class="body"><p>为防止摄像头进灰，最好拿胶布贴一下</p></div></div><p><strong>打开后</strong></p><p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66237f27423c3.webp" alt="IMG_20240419_174441.webp"></p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <blockquote><p>顺便提一嘴，无线充电是放在电池上的，没有下胶水，感动~</p></blockquote>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66237fcc8d7d8.webp" alt="IMG_20240419_174550.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="6"><li>拆下标记处螺丝，取下无线充&amp;NFC线圈</li></ol>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/6623803f65b52.webp" alt="IMG_20240419_174614.webp"></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662380f394c47.webp" alt="IMG_20240419_174801.webp"></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662382eb16441.webp" alt="IMG_20240419_174810.webp"></p>    </div>    </div><h3 id="拆音量排线🪡"><a href="#拆音量排线🪡" class="headerlink" title="拆音量排线🪡"></a>拆音量排线🪡</h3><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="7"><li>因为换音量排线要拆主板，先拆下所有排线&amp;螺丝，取出主板</li></ol><blockquote><p>中间铜箔注意取下</p><p>对于细微操作建议使用镊子</p></blockquote><div class="tag-plugin colorful note" color="yellow"><div class="title">要不你试试：</div><div class="body"><p>事后复盘时看图片好像也不用拆主板，可以试试看</p></div></div>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/6623883f1d521.webp" alt="1713604675750.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <ol start="8"><li>由内向外顶出音量排线底板，取出来后将替换件的底板上的胶撕开放进去，再用螺丝刀从外向内顶一下，使底板的胶与手机充分接触</li><li>将主板装回即可</li></ol>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66238c7e4e319.webp" alt="IMG_20240419_182603.webp"></p>    </div>    </div><h3 id="拆电池🪄"><a href="#拆电池🪄" class="headerlink" title="拆电池🪄"></a>拆电池🪄</h3><p>我看中电官方的视频教程里电池胶一抽就出来了，我的可能比较腼腆啊一抽就断<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcat0_0.png"/></span></p><p>那没办法了，只能上螺丝刀了</p><div class="tag-plugin colorful note" color="red"><div class="title">警告</div><div class="body"><p>还记得准备工作中的放电吗，该操作100%破坏电池，若电量充足可能会造成不堪设想的后果</p></div></div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>因为下面有排线，建议在图中圈圈处入刀，然后沿着上部分滑动，“挤开”电池</p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662393045e7b1.webp" alt="1713607423583.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>拆下来的电池</p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662394407ef95.webp" alt="IMG_20240419_180328.webp"></p>    </div>    </div><p>随后安装新电池，因为是扩容电池的原因，排线有亿点难走，最好先大致掰一掰形状，再接上排线，最后装到电池槽内</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/66239559f35fe.webp" alt="IMG_20240419_180423.webp"></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662394ac4c87f.webp" alt="IMG_20240419_180512.webp"></p>    </div>    </div><p>到这一步了可以试下能不能开机了，测试完成后复原所有排线，螺丝及无线充电模块</p><h3 id="打胶🧪"><a href="#打胶🧪" class="headerlink" title="打胶🧪"></a>打胶🧪</h3><p>先用镊子清理残胶，随后用附赠的b7000涂一圈，把后壳扣好。家里没有橡皮筋我干脆就拿手肘压了十几分钟，反正都是带手机套用的也不在意那点缝隙。</p><h2 id="主观体验"><a href="#主观体验" class="headerlink" title="主观体验"></a>主观体验</h2><p>一个字——沉。不带手机套净重219g，差不多半斤了，<del>虽然按照百度百科的数据才重了30g</del></p><p>续航方面大大提升，原本要一直插着电用（防止要带着走时没电），现在电力自由了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatphoto.png"/></span></p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/662399124e3c2.webp" alt="IMG_1.webp"></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/myself/2024/04/6623990c31570.webp" alt="IMG_2.webp"></p>    </div>    </div><h2 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h2><ol><li>用吸盘吸时没抓好，受力点集中在屏幕上，直接让我屏幕又碎了几条小裂纹</li><li>看到有一个教程一个劲的从里面推音量排线的底板，害得我直接把电源键上的塑料垫整掉了，费了半天劲才给他塞回去，还搞得现在还是软趴趴的手感</li><li>撬电池的时候没看见下面有排线，直接创到屏幕排线上了，幸好没有坏</li></ol>]]></content>
    
    
    <summary type="html">被网上的视频坑了好几回，总结下过程</summary>
    
    
    
    <category term="瞎折腾" scheme="https://blog.hzchu.top/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="DIY" scheme="https://blog.hzchu.top/tags/DIY/"/>
    
  </entry>
  
  <entry>
    <title>主题改动小记</title>
    <link href="https://blog.hzchu.top/2024/%E4%B8%BB%E9%A2%98%E6%94%B9%E5%8A%A8%E5%B0%8F%E8%AE%B0/"/>
    <id>https://blog.hzchu.top/2024/%E4%B8%BB%E9%A2%98%E6%94%B9%E5%8A%A8%E5%B0%8F%E8%AE%B0/</id>
    <published>2024-04-19T21:05:29.000Z</published>
    <updated>2024-04-20T08:05:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>很久之前，为了在主题中新增功能还是改主题文件实现的，不过因为没有用Git进行管理，后面带来一个很严重的问题：<mark class="tag-plugin colorful mark" color="blue">升级十分困难</mark>。</p><p>当然，即便早已摆脱了那种想升级又不敢升级的困境，我还是不喜欢对主题进行过多的侵入式修改，在前几个月我陆陆续续将主题中一些自定义的部分阉掉或通过外部注入实现，但随之而来又有一个问题：<mark class="tag-plugin colorful mark" color="blue">可自定义程度低</mark>。</p><p>罢了罢了，我自己写一篇文章来记录改动吧。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatnotlikethis.png"/></span></p><div class="tag-plugin colorful note" color="red"><div class="title">叠甲</div><div class="body"><p>本文仅用作记录，不具备任何教程性质，仅供参考</p></div></div><h2 id="非直接修改主题"><a href="#非直接修改主题" class="headerlink" title="非直接修改主题"></a>非直接修改主题</h2><h3 id="烟花特效-运行时间-复制提醒-超链接图标"><a href="#烟花特效-运行时间-复制提醒-超链接图标" class="headerlink" title="烟花特效&amp;运行时间&amp;复制提醒&amp;超链接图标"></a>烟花特效&amp;运行时间&amp;复制提醒&amp;超链接图标</h3><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/source/js/extra.js&lang=js"></script><p><code>烟花特效&amp;运行时间</code>来自网络</p><h3 id="加载动画"><a href="#加载动画" class="headerlink" title="加载动画"></a>加载动画</h3><p>通过<code>injector</code>实现</p><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/scripts/headend.js&lang=js"></script><p>对应的js</p><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/source/js/load.js&lang=js"></script><h3 id="哔哔广场"><a href="#哔哔广场" class="headerlink" title="哔哔广场"></a>哔哔广场</h3><p>与其说是广场，<del>不如说是个人独秀</del>（毕竟我这也不是正经的Memos</p><p>魔改自<a href="https://immmmm.com/bbs/">哔哔广场-木木木木木 (immmmm.com)</a></p><figure class="highlight markdown"><figcaption><span>source\bb\index.md</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 哔哔</span><br><span class="line">date: 2021-07-10 19:06:52</span><br><span class="line">description: 闲来无事，哔哔两句</span><br><span class="line">layout: post</span><br><span class="line"><span class="section">comments: false</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;memos&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;memo-list&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.css&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.staticfile.org/animate.css/4.1.1/animate.min.css&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://memobbs.app/grid.css&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://memobbs.app/memos.css&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/marked/7.0.5/marked.min.js&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/lozad.js/1.16.0/lozad.min.js&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/memos.js&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span></span><br><span class="line">  var memosMyList = [</span><br><span class="line"><span class="code">    &#123;</span></span><br><span class="line"><span class="code">      &quot;creatorName&quot; : &quot;Thun888&quot;,</span></span><br><span class="line"><span class="code">      &quot;website&quot; : &quot;https://blog.hzchu.top&quot;,</span></span><br><span class="line"><span class="code">      &quot;link&quot; : &quot;https://get-tg-channel-api.hzchu.top&quot;,</span></span><br><span class="line"><span class="code">      &quot;creatorId&quot; : &quot;101&quot;,</span></span><br><span class="line"><span class="code">      &quot;avatar&quot; : &quot;/img/avatar.webp&quot;,</span></span><br><span class="line"><span class="code">      &quot;artalk&quot; : &quot;https://artalk.hzchu.top&quot;,</span></span><br><span class="line"><span class="code">      &quot;artSite&quot; : &quot;Blog&quot;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">  ]</span></span><br><span class="line"><span class="code">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>对应的js</p><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/source/js/memos.js&lang=js"></script><h2 id="直接修改主题"><a href="#直接修改主题" class="headerlink" title="直接修改主题"></a>直接修改主题</h2><h3 id="字数统计"><a href="#字数统计" class="headerlink" title="字数统计"></a>字数统计</h3><figure class="highlight js"><figcaption><span>themes\stellar\layout\_partial\main\footer.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// footer</span></span><br><span class="line">  el += <span class="string">&#x27;&lt;div class=&quot;text&quot;&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (content) &#123;</span><br><span class="line">      el += <span class="title function_">markdown</span>(content)</span><br><span class="line">    &#125;</span><br><span class="line">    el += <span class="string">&#x27;&lt;script&gt; var allpostscount = &quot;&#x27;</span> + site.<span class="property">posts</span>.<span class="property">length</span> + <span class="string">&#x27;&quot; ;var allpostswords = &quot;&#x27;</span> + <span class="title function_">totalcount</span>(site) + <span class="string">&#x27;&quot;;gtime_days = Math.floor((new Date() - new Date(&#x27;</span> + page.<span class="property">updated</span> + <span class="string">&#x27;)) / 1000 / 60 / 60 / 24);&lt;/script&gt;&#x27;</span></span><br><span class="line">    el += <span class="string">&#x27;&lt;/div&gt;&lt;/footer&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> el</span><br><span class="line">  &#125;</span><br><span class="line">  %&gt;</span><br><span class="line">  &lt;%- <span class="title function_">layoutDiv</span>() %&gt;</span><br></pre></td></tr></table></figure><p>将字数信息引入到变量中供调用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;timeDate&quot;</span>&gt;</span>载入天数...<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>&amp;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;times&quot;</span>&gt;</span>载入时分秒...<span class="tag">&lt;/<span class="name">span</span>&gt;</span>，共发表了<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;all-posts-count&quot;</span>&gt;</span>load<span class="tag">&lt;/<span class="name">span</span>&gt;</span>篇文章，总计<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;all-post-words&quot;</span>&gt;</span>load<span class="tag">&lt;/<span class="name">span</span>&gt;</span>字</span><br></pre></td></tr></table></figure><p>相关js参阅<a href="#%E7%83%9F%E8%8A%B1%E7%89%B9%E6%95%88-%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4-%E5%A4%8D%E5%88%B6%E6%8F%90%E9%86%92-%E8%B6%85%E9%93%BE%E6%8E%A5%E5%9B%BE%E6%A0%87">#烟花特效-运行时间-复制提醒-超链接图标</a></p><p><strong>文章内字数统计</strong></p><figure class="highlight js"><figcaption><span>themes\stellar\layout\_partial\main\navbar\article_banner.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="comment">// 3.left.bottom</span></span><br><span class="line">  el += <span class="title function_">partial</span>(<span class="string">&#x27;dateinfo&#x27;</span>)</span><br><span class="line">  <span class="comment">//字数显示</span></span><br><span class="line">  el += <span class="string">&#x27;&lt;div class=&quot;flex-row&quot; id=&quot;page-words&quot;&gt;&lt;span&gt;&amp;nbsp;本文字数：&#x27;</span> + page.<span class="property">content</span>.<span class="property">length</span> + <span class="string">&#x27;字&lt;/span&gt;&lt;/div&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="文章内过期提醒"><a href="#文章内过期提醒" class="headerlink" title="文章内过期提醒"></a>文章内过期提醒</h3><p>变量获取一并放在<code>footer</code>里了</p><figure class="highlight js"><figcaption><span>themes\stellar\layout\page.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  el += <span class="string">`&lt;article class=&quot;<span class="subst">$&#123;articleClass()&#125;</span>&quot;&gt;`</span></span><br><span class="line">  <span class="comment">//过期提醒容器</span></span><br><span class="line">  el +=<span class="string">`&lt;div id=&quot;gtime&quot;&gt;&lt;/div&gt;`</span></span><br></pre></td></tr></table></figure><p>相关js参阅<a href="#%E7%83%9F%E8%8A%B1%E7%89%B9%E6%95%88-%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4-%E5%A4%8D%E5%88%B6%E6%8F%90%E9%86%92-%E8%B6%85%E9%93%BE%E6%8E%A5%E5%9B%BE%E6%A0%87">#烟花特效-运行时间-复制提醒-超链接图标</a></p><p>css:</p><figure class="highlight css"><figcaption><span>source\mcss\mcss.css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 文章过期提醒 */</span></span><br><span class="line"><span class="selector-class">.old-message</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#e2e2e2</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">5px</span> solid <span class="number">#ed8e13</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="文章内标签显示"><a href="#文章内标签显示" class="headerlink" title="文章内标签显示"></a>文章内标签显示</h3><p>紧跟在<code>文章内字数统计</code>下方</p><figure class="highlight js"><figcaption><span>themes\stellar\layout\_partial\main\navbar\article_banner.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//标签显示</span></span><br><span class="line"><span class="keyword">if</span> (page.<span class="property">layout</span> == <span class="string">&quot;post&quot;</span> &amp;&amp; page.<span class="property">tags</span> &amp;&amp; page.<span class="property">tags</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  el += <span class="string">&#x27;&lt;div class=&quot;flex-row&quot; id=&quot;tag&quot;&gt;&#x27;</span>; <span class="comment">// 将标签容器的创建移动到条件内部</span></span><br><span class="line">  el += <span class="string">&#x27; &lt;span&gt;&amp;nbsp标签：&lt;/span&gt;&#x27;</span>;</span><br><span class="line">  el += <span class="title function_">list_categories</span>(page.<span class="property">tags</span>, &#123;</span><br><span class="line">    <span class="attr">class</span>: <span class="string">&quot;cap breadcrumb&quot;</span>,</span><br><span class="line">    <span class="attr">show_count</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">separator</span>: <span class="string">&#x27;&amp;nbsp; &#x27;</span>,</span><br><span class="line">    <span class="attr">style</span>: <span class="string">&quot;none&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  el += <span class="string">&#x27;&amp;nbsp&lt;/div&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="显示Artalk最近评论"><a href="#显示Artalk最近评论" class="headerlink" title="显示Artalk最近评论"></a>显示Artalk最近评论</h3><figure class="highlight js"><figcaption><span>themes\stellar\source\js\services\artalk.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">utils.<span class="title function_">jq</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> els = <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;ds-artalk&#x27;</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; els.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> el = els[i];</span><br><span class="line">        <span class="keyword">const</span> limit = <span class="built_in">parseInt</span>(el.<span class="title function_">getAttribute</span>(<span class="string">&#x27;limit&#x27;</span>)) || <span class="number">10</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">const</span> api = el.<span class="title function_">getAttribute</span>(<span class="string">&#x27;api&#x27;</span>) + <span class="string">&#x27;&amp;limit=&#x27;</span> + limit;</span><br><span class="line">        <span class="keyword">if</span> (api == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        utils.<span class="title function_">request</span>(el, api, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">          data = data.<span class="property">data</span> || [];</span><br><span class="line">          data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, i</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> cell = <span class="string">&#x27;&lt;div class=&quot;timenode&quot; index=&quot;&#x27;</span> + i + <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">            cell += <span class="string">&#x27;&lt;div class=&quot;header&quot;&gt;&#x27;</span>;</span><br><span class="line">            cell += <span class="string">&#x27;&lt;div class=&quot;user-info&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="comment">// cell += &#x27;&lt;img src=&quot;https://cravatar.cn/avatar/&#x27; + (item.email_encrypted) + &#x27;?d=mp&amp;s=240&quot;&gt;&#x27;;</span></span><br><span class="line">            cell += <span class="string">&#x27;&lt;span&gt;&#x27;</span> + item.<span class="property">nick</span> + <span class="string">&#x27;&lt;/span&gt;&#x27;</span>;</span><br><span class="line">            cell += <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">            cell += <span class="string">&#x27;&lt;span&gt;&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>(item.<span class="property">date</span>).<span class="title function_">toLocaleString</span>() + <span class="string">&#x27;&lt;/span&gt;&#x27;</span>;</span><br><span class="line">            cell += <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">            cell += <span class="string">&#x27;&lt;a class=&quot;body&quot; href=&quot;&#x27;</span> + item.<span class="property">page_url</span> + <span class="string">&#x27;#atk-comment-&#x27;</span> + item.<span class="property">id</span> + <span class="string">&#x27;&quot; target=&quot;_blank&quot; rel=&quot;external nofollow noopener noreferrer&quot;&gt;&#x27;</span>;</span><br><span class="line">            cell += item.<span class="property">content_marked</span>;</span><br><span class="line">            cell += <span class="string">&#x27;&lt;/a&gt;&#x27;</span>;</span><br><span class="line">            cell += <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">            $(el).<span class="title function_">append</span>(cell);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>组件引入：</p><figure class="highlight yaml"><figcaption><span>source\_data\widgets.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">new_comment:</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="string">timeline</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">最新评论</span></span><br><span class="line">  <span class="attr">api:</span> <span class="string">https://artalk.hzchu.top/api/v2/stats/latest_comments?site_name=Thun888</span> <span class="comment"># 此处为 Artalk API 地址，末尾为站点名称</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">artalk</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10</span> <span class="comment"># 限制获取数量，默认为 10</span></span><br></pre></td></tr></table></figure><h3 id="部分用语改动"><a href="#部分用语改动" class="headerlink" title="部分用语改动"></a>部分用语改动</h3><figure class="highlight yaml"><figcaption><span>themes\stellar\languages\zh-CN.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meta:</span></span><br><span class="line">  <span class="attr">related_posts:</span> <span class="string">这些怎么样（￣︶￣）↗</span>　</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">记录下更改</summary>
    
    
    
    <category term="瞎折腾" scheme="https://blog.hzchu.top/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="Blog" scheme="https://blog.hzchu.top/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>用Gemini，实现AI摘要</title>
    <link href="https://blog.hzchu.top/2024/%E7%94%A8Gemini%E5%AE%9E%E7%8E%B0AI%E6%91%98%E8%A6%81/"/>
    <id>https://blog.hzchu.top/2024/%E7%94%A8Gemini%E5%AE%9E%E7%8E%B0AI%E6%91%98%E8%A6%81/</id>
    <published>2024-03-09T19:31:16.000Z</published>
    <updated>2024-03-09T19:31:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>很久之前，我网上surfing的时候发现好多网站都有「AI摘要」，了解了一下发现是「<a href="https://docs_s.tianli0.top/">TianliGPT</a>」，好是好，<del>但两位数的价格还是打动不了我当时勉强三位数的存款。</del>所以，我使用了一种笨方法<del>（为了撑场子没考虑太多）</del>，手动向「BingAI」发送摘要文本，获取摘要后存储在kv中，通过cfw返回。可行，但太痛苦了（这也是它叫DolGPT的原因之一），前几天看到Gemini开放了api可以免费调用，这不直接起飞<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/ablobcatrainbow.png"/></span></p><h2 id="获取GEMINI-KEY"><a href="#获取GEMINI-KEY" class="headerlink" title="获取GEMINI_KEY"></a>获取GEMINI_KEY</h2><p>首先登录<a href="https://ai.google.dev/">ai.google.dev</a>，左上角点击<code>Get API key</code>，再在中间点<code>Create API key</code>，随便选个项目即可</p><details class="tag-plugin colorful folding" color="yellow"><summary><span>没听懂就看图片吧</span></summary><div class="body"><p><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523988ddc.webp" alt="Snipaste_2024-03-09_10-17-37.webp"><br><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523fecbfa.webp" alt="Snipaste_2024-03-09_10-18-14.webp"><br><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523933f1c.webp" alt="Snipaste_2024-03-09_10-22-37.webp"><br><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec523a4e8b3.webp" alt="Snipaste_2024-03-09_10-23-59.webp"><br><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec52371bf18.webp" alt="Snipaste_2024-03-09_10-22-25.webp"></p></div></details><h2 id="后端程序"><a href="#后端程序" class="headerlink" title="后端程序"></a>后端程序</h2><p>因为Stellar已经配置了TianliGPT的css了，所以我也懒得另起炉灶，直接按TianliGPT的格式返回，所以理论上讲和其它的使用TianliGPT的服务也兼容</p><p>仓库：<a href="https://github.com/thun888/ai-summary/">thun888&#x2F;ai-summary</a></p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/ai-summary"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=ai-summary&&show_owner=true"/></a></div><p>新建一个<code>Cloudflare Worker</code>，复制<a href="https://github.com/thun888/ai-summary/blob/master/src/index.js">&#x2F;src&#x2F;index.js</a>的代码粘贴进去</p><p>随后修改环境变量，填入可信来源（即只有这个域名才能调用ai摘要，如不需要可设置为<code>*</code>）（<code>ALLOWED_ORIGINS</code>）以及你的key（<code>GEMINI_KEY</code>）</p><p><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec508eb0684.webp" alt="1709985925369.webp"></p><p>接着新建一个kv，并绑定到程序上</p><blockquote><p>kv的名字随意，但<strong>Variable name</strong> 必须为 <code>KV</code></p></blockquote><p><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec565254bdb.webp" alt="1709987402272.webp"></p><p>最后可以尝试访问，有输出且刷新不变即为成功</p><p><img src="https://onep.hzchu.top/mount/pic/2024/03/09/65ec54a03e7a9.webp" alt="1709986972903.webp"></p><div class="tag-plugin colorful note" color="yellow"><div class="body"><p>该程序只实现了ai摘要生成，对于其他网站矩阵之类的功能，其实自己用哪里要得上这么多功能嘛</p></div></div><h2 id="前端程序修改"><a href="#前端程序修改" class="headerlink" title="前端程序修改"></a>前端程序修改</h2><p>理论上，直接替换summary.tianli0.top为你对应域名即可，但在很多情况下，你还需要额外删减一些无关api调用，如openid生成</p><p>这是我修改后的程序，可以参考</p><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/source/js/chuckle-post-ai.js&lang=js"></script><p>修改完后引入到主题</p><blockquote><p>以下为针对Stellar主题</p></blockquote><figure class="highlight yaml"><figcaption><span>config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AI 摘要</span></span><br><span class="line"><span class="comment"># https://github.com/qxchuckle/Post-Summary-AI</span></span><br><span class="line"><span class="attr">tianli_gpt:</span> </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">js:</span> <span class="string">/js/chuckle-post-ai.js</span> <span class="comment">#改为对应路径</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span> </span><br><span class="line">  <span class="attr">key:</span> <span class="string">5Q5mpqRK5DkwT1X9Gi5e</span></span><br><span class="line">  <span class="attr">total_length:</span> <span class="number">3500</span> </span><br><span class="line">  <span class="attr">typewriter:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">summary_directly:</span> <span class="literal">true</span> </span><br><span class="line">  <span class="attr">rec_method:</span> <span class="string">all</span> </span><br><span class="line">  <span class="attr">hide_shuttle:</span> <span class="literal">true</span> </span><br><span class="line">  <span class="attr">summary_toggle:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">interface:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">AI摘要</span></span><br><span class="line">    <span class="attr">introduce:</span> <span class="string">&#x27;我是文章辅助AI: Gemini，点击下方的按钮，让我生成本文简介、推荐相关文章等。&#x27;</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">Gemini</span></span><br><span class="line">    <span class="attr">button:</span> [<span class="string">&quot;介绍自己&quot;</span>, <span class="string">&quot;推荐文章&quot;</span>, <span class="string">&quot;生成摘要&quot;</span>, <span class="string">&quot;矩阵穿梭&quot;</span>]</span><br></pre></td></tr></table></figure><blockquote><p>如果无效可以自己在<code>\stellar\layout\_partial\plugins\tianli_gpt.ejs</code>里修改</p></blockquote><h2 id="效果演示"><a href="#效果演示" class="headerlink" title="效果演示"></a>效果演示</h2><p><img src="https://onep.hzchu.top/mount/pic/2024/04/05/660f969dca9d3.webp" alt="1712297627948.webp"></p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>其表现我个人感觉跌宕起伏，有时不如ChatGPT，有时有吊打Bing，反正免费的要什么自行车<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatmeltthumb.png"/></span></p><p>记得之前看还叫Bard，还不支持中文，没想到现在这么厉害了<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/ablobcatreachrev.png"/></span></p>]]></content>
    
    
    <summary type="html">使用Cloudflare Worker，借助Gemini，平替TianliGPT</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Blog" scheme="https://blog.hzchu.top/tags/Blog/"/>
    
    <category term="Stellar" scheme="https://blog.hzchu.top/tags/Stellar/"/>
    
    <category term="CFW" scheme="https://blog.hzchu.top/tags/CFW/"/>
    
  </entry>
  
  <entry>
    <title>记一次排查js文件后门</title>
    <link href="https://blog.hzchu.top/2024/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%8E%92%E6%9F%A5js%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8/"/>
    <id>https://blog.hzchu.top/2024/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%8E%92%E6%9F%A5js%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8/</id>
    <published>2024-03-08T20:49:57.000Z</published>
    <updated>2024-03-08T20:49:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>今天调试博客时猛地发现电脑卡的不像样，排除后发现是控制台的问题，再一看控制台里全是网络请求，这可不是好事啊</p><p><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0a705f003.webp"></p><p><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0a8cca150.webp" alt="Snipaste_2024-03-08_20-40-38.webp"></p><h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>起初，因为我回档了所有更改依然有这种情况，我猜是浏览器插件问题，但关闭了所有插件后依然如此</p><p>然后，我查看了异常js引入的时间点，并往上挨个检查</p><p><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0b8bee889.webp" alt="Snipaste_2024-03-08_20-37-33.webp"></p><p>最初的异常引入在<code>sdk.html</code>，随后在js文件里依次搜索，最后定位到<code>lazyload.min.js</code></p><p><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c1adbc32.webp" alt="Snipaste_2024-03-08_20-37-04.webp"></p><p>但是嘛，当我<code>在新标签页里打开</code>时，显示的又是正常的js，对比发现请求ip不同，在改hosts后成功获取到带后门的js文件</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>不正常的</strong></p><p><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c872af1b.webp" alt="Snipaste_2024-03-08_20-39-35.webp"></p>    </div>    <div class="cell" style="">    <p><strong>正常的</strong></p><p><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c89ba6b9.webp" alt="Snipaste_2024-03-08_20-39-25.webp"></p>    </div>    </div><p><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0c88232e2.webp" alt="Snipaste_2024-03-08_20-42-50.webp"></p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>将<code>https://cdn.bootcdn.net/ajax/libs</code>全部替换为<code>https://cdn.staticfile.net</code></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/03/08/65eb0d141a263.webp" alt="Snipaste_2024-03-08_20-48-17.webp"></p>    </div>    </div>]]></content>
    
    
    <summary type="html">被bootcdn捅了一刀</summary>
    
    
    
    
    <category term="Blog" scheme="https://blog.hzchu.top/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>把Tg Channel接入到Stellar时间线</title>
    <link href="https://blog.hzchu.top/2024/%E6%8A%8ATg-Channel%E6%8E%A5%E5%85%A5%E5%88%B0Stellar%E6%97%B6%E9%97%B4%E7%BA%BF/"/>
    <id>https://blog.hzchu.top/2024/%E6%8A%8ATg-Channel%E6%8E%A5%E5%85%A5%E5%88%B0Stellar%E6%97%B6%E9%97%B4%E7%BA%BF/</id>
    <published>2024-02-25T13:19:01.000Z</published>
    <updated>2024-02-25T14:43:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前调CW时发现<a href="https://blog.eurekac.cn/">Cyan</a>加上了TG频道说说，因为已经有<code>Memos</code>了所以没有在意，昨天在<a href="https://xaoxuu.com/wiki/stellar/articles.html">Stellar 探索号</a>看到有<a href="https://blog.lvbyte.top/posts/11214/">stellar主题集成Telegram Channel说说</a>的教程，忽然灵光一闪，这拿来放草稿&#x2F;想法挺合适的嘛</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>首先新建一个频道，并记下频道ID</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/25/65dad341bacfd.webp" alt="1708839745065.webp"></p><p>新建一个<code>Cloudflare Worker</code>，复制下面的代码粘贴进去</p><blockquote><p>为了兼容Stellar的时间线，我在lvbyte的基础上改了点代码</p></blockquote><script src="https://faster-gist.hzchu.top/thun888/67d8cdf1296d8dc252e9fc5607e4daf6.js"></script><p>并修改顶部配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ChannelNameList</span> = [<span class="string">&#x27;thun888sthinks&#x27;</span>]; <span class="comment">//频道ID，可添加多个</span></span><br><span class="line"><span class="keyword">const</span> deniedRegion = [<span class="string">&quot;&quot;</span>]; 屏蔽区域，如<span class="variable constant_">CN</span>,<span class="variable constant_">US</span></span><br><span class="line"><span class="keyword">const</span> baseproxyurl=<span class="string">&quot;https://get-tg-channel-api.hzchu.top/?proxy=&quot;</span> <span class="comment">//将中间域名替换为你为worker绑定的域名</span></span><br></pre></td></tr></table></figure><p>随后按照使用Memos时间线形式使用即可</p><h2 id="可传入参数"><a href="#可传入参数" class="headerlink" title="可传入参数"></a>可传入参数</h2><table><thead><tr><th>参数</th><th>参数名</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>cid</td><td>频道id</td><td>0</td><td>指在代码里配置的第n个频道，并不是上文所述频道id</td></tr><tr><td>mid</td><td>信息id</td><td>&#x2F;</td><td>指定后只返回该信息，信息id可在发送后查看</td></tr><tr><td><strong>tag</strong></td><td>标签名</td><td>DefaultTag</td><td>筛选传入的标签返回</td></tr><tr><td>limit</td><td>获取条数</td><td>&#x2F;</td><td>&#x2F;</td></tr><tr><td>offset</td><td>获取信息偏移量</td><td>&#x2F;</td><td>如果有一条信息<code>id</code>为<code>80</code>的信息，那么当传入<code>80</code>时将返回这条信息之前的所有信息</td></tr><tr><td>showtag</td><td>是否展示标签</td><td>true</td><td>&#x2F;</td></tr><tr><td>showview</td><td>是否展示访问量</td><td>false</td><td>启用时会在末尾附上(views:number)</td></tr><tr><td>usemd</td><td>是否使用Markdown</td><td>true</td><td>开启后返回未被tg解析过的md语法</td></tr></tbody></table><blockquote><p>众所周知，<code>0</code>是第一个自然数，所以cid传入<code>0</code>时表示获取第1个频道</p><p> tag为空时默认返回#DefaultTag的数据，可在代码中自行更改</p><p><code>tag</code>原版是<code>#SFCN</code>,一开始没想明白是什么意思，现在明白了：Suitable For China，可以有别的玩法o(￣▽￣)ｄ</p></blockquote><h2 id="在Stellar中的使用"><a href="#在Stellar中的使用" class="headerlink" title="在Stellar中的使用"></a>在Stellar中的使用</h2><div class="tag-plugin tabs" align="center"id="tab_7"><div class="nav-tabs"><div class="tab active"><a href="#tab_7-1">在独立页面内使用</a></div><div class="tab"><a href="#tab_7-2">添加为小部件</a></div><div class="tab"><a href="#tab_7-3">进阶（使用数据服务插件）</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_7-1"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?tag=DTA&limit=3" user="thun888sthinks"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:thun888sthinks api:https://get-tg-channel-api.hzchu.top/?tag=DTA&amp;limit=3 type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><p>user为频道ID，api为你为CFW绑定的域名，type填memos</p><p>碍于篇幅限制，只展示前3条</p>    </div>    </div></div><div class="tab-pane" id="tab_7-2"><figure class="highlight yaml"><figcaption><span>/source/_data/widgets.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">timeline:</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="string">timeline</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">近期动态</span></span><br><span class="line">  <span class="attr">api:</span> <span class="string">https://get-tg-channel-api.hzchu.top/?tag=DTA&amp;limit=3</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">memos</span></span><br><span class="line">  <span class="attr">hide:</span> <span class="string">user,footer</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_7-3"><p>有一些功能在默认的设计线下不能很好的实现，但是通过数据插件就可以实现了，比如动态加载更多内容，回应显示，访问量显示等</p><p>有空再写（挖坑.webp</p></div></div></div><h2 id="其它用法"><a href="#其它用法" class="headerlink" title="其它用法"></a>其它用法</h2><div class="tag-plugin tabs" align="center"id="tab_8"><div class="nav-tabs"><div class="tab active"><a href="#tab_8-1">获取其它频道</a></div><div class="tab"><a href="#tab_8-2">指定获取某条信息</a></div><div class="tab"><a href="#tab_8-3">展示访问量</a></div><div class="tab"><a href="#tab_8-4">使用Markdown</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_8-1"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?cid=1&tag=DTA&limit=3" user="Thun888sDraftArticles"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:Thun888sDraftArticles api:https://get-tg-channel-api.hzchu.top/?cid=1&amp;tag=DTA&amp;limit=3 type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure>    </div>    </div></div><div class="tab-pane" id="tab_8-2"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?cid=1&tag=Test&mid=52&showtag=false" user="Thun888sDraftArticles"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:Thun888sDraftArticles api:https://get-tg-channel-api.hzchu.top/?cid=1&amp;tag=Test&amp;mid=52&amp;showtag=false type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><p>可以用在很多地方获取某些信息，作为某种接口来使用。在这一基础上，你甚至可以修改代码，改为只返回图片，在某种意义上实现图床的效果，不过滥用可不太好啊<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatpolice.png"/></span></p>    </div>    </div></div><div class="tab-pane" id="tab_8-3"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?cid=1&tag=Test&showview=true" user="Thun888sDraftArticles"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:Thun888sDraftArticles api:https://get-tg-channel-api.hzchu.top/?cid=1&amp;tag=Test&amp;showview=true type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure>    </div>    </div></div><div class="tab-pane" id="tab_8-4"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <div class="tag-plugin timeline ds-memos" api="https://get-tg-channel-api.hzchu.top/?cid=1&tag=Test&usemd=true" user="Thun888sDraftArticles"></div>    </div>    <div class="cell" style="">    <p><strong>代码：</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline user:Thun888sDraftArticles api:https://get-tg-channel-api.hzchu.top/?cid=1&amp;tag=Test&amp;usemd=true type:memos %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><p>在默认情况下，tg会解析md语法，对于不支持的语法会转义，从而导致前端无法正常解析md语法，在使用该参数后程序会将解析后的文本还原为正常md语法并返回。默认开启</p>    </div>    </div></div></div></div><p>相关配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ChannelNameList</span> = [<span class="string">&#x27;thun888sthinks&#x27;</span>,<span class="string">&#x27;Thun888sDraftArticles&#x27;</span>];</span><br></pre></td></tr></table></figure><h2 id="Todo"><a href="#Todo" class="headerlink" title="Todo"></a>Todo</h2><ul><li><input checked="" disabled="" type="checkbox"> 可在请求时选择过滤哪个tag</li><li><input checked="" disabled="" type="checkbox"> 完善Emoji支持</li><li><input checked="" disabled="" type="checkbox"> 前端传入标签名</li><li><input checked="" disabled="" type="checkbox"> 可选显示标签名及访问量</li><li><input checked="" disabled="" type="checkbox"> 获取指定信息</li><li><input checked="" disabled="" type="checkbox"> 多频道支持</li><li><input disabled="" type="checkbox"> 表情包标签解析</li><li><input disabled="" type="checkbox"> 自定义是否显示引用</li><li><input disabled="" type="checkbox"> 可传入需要返回的名称</li><li><input disabled="" type="checkbox"> 可选使用tg自带分类</li></ul><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>它可以使静态博客进一步动态化，加强可玩性，也可在很多地方使用。</p><p>如果你有一些像<code>多频道融合</code>，<code>多标签获取</code>的功能建议，那就大可不必了，毕竟它一开始只是一个说说程序啊<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/ablobcatrainbow.png"/></span></p>]]></content>
    
    
    <summary type="html">使用Cloudflare Worker，获取Tg频道内容，并接入到Stellar时间线</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Stellar" scheme="https://blog.hzchu.top/tags/Stellar/"/>
    
  </entry>
  
  <entry>
    <title>使用Homebox实现家用物品管理</title>
    <link href="https://blog.hzchu.top/2024/%E4%BD%BF%E7%94%A8Homebox%E5%AE%9E%E7%8E%B0%E5%AE%B6%E7%94%A8%E7%89%A9%E5%93%81%E7%AE%A1%E7%90%86/"/>
    <id>https://blog.hzchu.top/2024/%E4%BD%BF%E7%94%A8Homebox%E5%AE%9E%E7%8E%B0%E5%AE%B6%E7%94%A8%E7%89%A9%E5%93%81%E7%AE%A1%E7%90%86/</id>
    <published>2024-02-12T22:41:07.000Z</published>
    <updated>2024-02-17T09:30:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>很久之前，家里面有三把电动螺丝刀，然而前些阵子我想找一把来用都得找半天……  <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatcaged.png"/></span></p><p>假期回家，桌面太乱了一直被我妈批斗…… <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatflip.png"/></span></p><p>思来想去这样也不行啊，上网找一下，发现了「<a href="https://d.hzchu.top/9x7up">Homebox</a>」这个程序，开始干活吧。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>仓库中也有二进制文件，我这里直接用Docker部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run the image</span></span><br><span class="line">$ docker run -d \</span><br><span class="line">  --name homebox \</span><br><span class="line">  --restart unless-stopped \</span><br><span class="line">  --publish 3100:7745 \</span><br><span class="line">  --<span class="built_in">env</span> TZ=Europe/Bucharest \</span><br><span class="line">  --volume /path/to/data/folder/:/data \</span><br><span class="line">  ghcr.io/hay-kot/homebox:latest</span><br></pre></td></tr></table></figure><p>或用<code>Docker-Compose</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.4&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">homebox:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/hay-kot/homebox:latest</span></span><br><span class="line"><span class="comment">#   image: ghcr.io/hay-kot/homebox:latest-rootless</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">homebox</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HBOX_LOG_LEVEL=info</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HBOX_LOG_FORMAT=text</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HBOX_WEB_MAX_UPLOAD_SIZE=10</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">homebox-data:/data/</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3100</span><span class="string">:7745</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">   <span class="attr">homebox-data:</span></span><br><span class="line">     <span class="attr">driver:</span> <span class="string">local</span></span><br></pre></td></tr></table></figure><p>因为还有可能给家里人用，干脆就nginx一条龙服务安排上，搭配家里面ADG上dns重写，家里人直接访问<code>wms.hzchu.top</code>就ok了</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0304ed4e06.webp" alt="1708142670501.webp"></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d039c6a395f.webp" alt="1708145094118.webp"></p>    </div>    </div><blockquote><p>部署完成进去后注册一个账号登录即可</p></blockquote><h2 id="HomeBox简单介绍"><a href="#HomeBox简单介绍" class="headerlink" title="HomeBox简单介绍"></a>HomeBox简单介绍</h2><p>知道它的功能才好干活嘛</p><p>相比于「GreaterWMS」，「ModernWMS」等专门用于仓库管理的软件，「<a href="https://github.com/hay-kot/homebox">Homebox</a>」主打一个家用，因此它的操作也简单不少，在进去后可以看到这样的页面</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0714ba9aca.webp" alt="1708159306854.webp"></p><h3 id="Create–创建"><a href="#Create–创建" class="headerlink" title="Create–创建"></a>Create–创建</h3><p>在点开那个<mark class="tag-plugin colorful mark" color="green">抹茶绿</mark>的按钮后，可以看到里面包括 <code>Item/Asset</code>,<code>Location</code>,<code>Label</code> 三个选项</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>Item&#x2F;Asset：</strong><code>新建物品</code>，即存入物品相关信息到程序里，里面包括以下填充项</p><blockquote><p>在填写完成后，若只新建单个物品，则会跳转至对应物品详情，可以做详细修改</p></blockquote>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d079ec36954.webp" alt="1708161509640.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>Location：</strong> <code>新建位置</code>，即存入某个物品存放处（如书桌）的相关信息到程序里，里面包括以下填充项</p><p>在“父位置”中，可以设置其它已新建的”位置“，表示该位置属于某位置，比如这样<br><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d07cd0526a0.webp" alt="1708162255778.webp"></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d07c7458c53.webp" alt="1708162163736.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>Label：</strong><code>新建类别</code>，即存入某个物品类别（如电子产品）的相关信息到程序里，里面包括以下填充项</p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d07d6a352db.webp" alt="1708162409464.webp"></p>    </div>    </div><h3 id="Home–主页"><a href="#Home–主页" class="headerlink" title="Home–主页"></a>Home–主页</h3><p>在加载完成时便是主页了，图片上面有，主要显示了<code>物品总金额</code>，<code>物品、位置、类别总数</code>，<code>近期添加的5个物品</code>，<code>位置、类别列表</code></p><h3 id="Locations–位置（树）"><a href="#Locations–位置（树）" class="headerlink" title="Locations–位置（树）"></a>Locations–位置（树）</h3><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>根据创建物品&#x2F;位置时的父位置，程序会构建出一个层级树，简明地展现出它们之间的从属关系</p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0897a5f3d3.webp" alt="1708165497793.webp"></p>    </div>    </div><h3 id="Search–搜索"><a href="#Search–搜索" class="headerlink" title="Search–搜索"></a>Search–搜索</h3><p>顾名思义</p><h3 id="Profile–用户设置"><a href="#Profile–用户设置" class="headerlink" title="Profile–用户设置"></a>Profile–用户设置</h3><p>直接上图片</p><div class="tag-plugin swiper fancybox" id="swiper-api" ><div class="swiper-wrapper"><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0910f6ac67.webp" alt="1708167438646.webp"></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d092acdc522.webp" alt="1708167851852.webp"></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev blur"></div><div class="swiper-button-next blur"></div></div><h3 id="Tools–工具"><a href="#Tools–工具" class="headerlink" title="Tools–工具"></a>Tools–工具</h3><p>包括<code>标签生成器</code>，<code>生成BOM表</code>，导<code>入导出CSV</code>及一些<code>修复工具</code></p><p>我主要用的是<code>标签生成器</code>，可以直接生成二维码贴在物品表面</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0cc5ba2019.webp" alt="1708182617875.webp"></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d094a2d831a.webp" alt="1708168353440.webp"></p>    </div>    </div><blockquote><p>调好参数右键打印即可</p></blockquote><h3 id="物品详情"><a href="#物品详情" class="headerlink" title="物品详情"></a>物品详情</h3><p>很详细，但我除了数量和描述都用不上</p><div class="tag-plugin swiper fancybox" id="swiper-api" ><div class="swiper-wrapper"><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0d75c667cc.webp" alt="1708185435353.webp"></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0d762bef44.webp" alt="1708185441662.webp"></div><div class="swiper-slide"><img no-lazy src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0d76b8cc90.webp" alt="1708185450333.webp"></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev blur"></div><div class="swiper-button-next blur"></div></div><blockquote><p>存在页面切换bug，刷新即可解决</p></blockquote><h2 id="基本逻辑"><a href="#基本逻辑" class="headerlink" title="基本逻辑"></a>基本逻辑</h2><p> 为了能准确快速地找到对应存放处，我定了一套基本原则：</p><ol><li>将几个房间用A&#x2F;B…大写英文字母命名</li><li>存放处使用所属房间加数字命名</li><li>以房间门为起点，向右统计入库</li><li>对应垂直堆叠的存放处，从上往下（优先）</li></ol><p>对应物品本体：</p><ol><li>对与中等大小物品，使用上文提到的二维码标签，</li><li>小物品用一维码标签，</li><li>再小就不贴标签，改用荧光笔加胶布或直接跳过</li><li>整理时从俯视角度，按入库顺序从左往右，从上到下排列（可选）</li><li>对已有唯一标识码（sn码）的物品直接使用</li></ol><p>程序内列了四个类别（感觉除了日后忘了物品名称关键词，用来筛选物品外其实没啥用）：大物件，小物件，收纳盒，电子产品</p><h2 id="实际实施"><a href="#实际实施" class="headerlink" title="实际实施"></a>实际实施</h2><p>  因为一开始没发现自带的<code>标签生成器</code>，所以用了「<a href="https://d.hzchu.top/d4a5q">E-Label</a>」来生成一维码，单页85个标签</p><p>其中，A&#x2F;B…表示该物品原属房间</p><p>标签内容填入物品描述中</p><div class="tag-plugin link dis-select"><a class="link-card rich" title="相关文件" href="https://pan.hzchu.top/s/q8SJ" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon,desc"><div class="top"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div><span class="cap link footnote">https://pan.hzchu.top/s/q8SJ</span></div><div class="bottom"><span class="title">相关文件</span><span class="cap desc footnote"></span></div></a></div><blockquote><p>还可以把文字缩掉，但考虑到一维码水平方向易被损坏还是留着吧</p></blockquote><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0bf9185724.webp" alt="1708179344734.webp"></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c4802d0ff.webp" alt="1708180607272.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>打印完标签贴到物品上，我这里先用胶布凑合以下，注意要同时覆盖字符及一部分条形码（如图片荧光标准所示）</p><blockquote><p>注：图示条形码为第一版</p></blockquote>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c2b702e65.webp" alt="1708179885315.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>不过还是太麻烦，所以我打算用这种带有不干胶的纸替代，不过因为春节还没到货<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatcry.png"/></span></p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0c6028e723.webp" alt="1708180983135.webp"></p>    </div>    </div><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>​那么，工期呢？要对小到一颗纽扣电池进行统计本身就不是一件快事，整理一个小时才勉强整理完一张桌子，想全部整理完必然是一个大工程，慢慢来。但全部整理一次确实大有益处，比如我就找到了8年前在某购物广场办的会员卡（前一天才因为没有实体会员卡不给兑积分<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatangry.png"/></span>，这波雪中送炭），因为中途方案改变，要等这个打印纸，就先搁置下来了，<del>才不是因为帕鲁太好玩了</del></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/17/65d0cbae30c5d.webp" alt="导弹喵"></p><h2 id="续"><a href="#续" class="headerlink" title="续"></a>续</h2><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>自带的标签生成器中页面中仍有大量留白，实用性欠佳，有空想办法搓个更好用的</p><blockquote><p>打印机过个回南天病情恶化了，不是不能用（</p></blockquote>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/24/65d9e74ecd25b.webp" alt="1708779215832.webp"></p>    </div>    </div><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p>可根据物品大小裁剪，在默认情况下规格约为48x21mm</p>    </div>    <div class="cell" style="">    <p><img src="https://onep.hzchu.top/mount/pic/2024/02/24/65d9e756bd973.webp" alt="1708779215823.webp"></p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"></div>    </div>    <div class="cell" style="">    <p>实际使用</p>     </div>    <div class="cell" style="">    <div id="player_6cc3e893806c4850"></div><script type="text/javascript" src="https://player.dogecloud.com/js/loader"></script><script type="text/javascript">var player = new DogePlayer({    container: document.getElementById('player_6cc3e893806c4850'),    userId: 4322,    vcode: '6cc3e893806c4850',    autoPlay: false});</script>    </div>    </div>]]></content>
    
    
    <summary type="html">唉，家里太乱了，该整理一下了</summary>
    
    
    
    <category term="日常生活" scheme="https://blog.hzchu.top/categories/%E6%97%A5%E5%B8%B8%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="Homebox" scheme="https://blog.hzchu.top/tags/Homebox/"/>
    
    <category term="家用" scheme="https://blog.hzchu.top/tags/%E5%AE%B6%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>峰间云海服务器技术分析</title>
    <link href="https://blog.hzchu.top/2024/%E5%B3%B0%E9%97%B4%E4%BA%91%E6%B5%B7%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90/"/>
    <id>https://blog.hzchu.top/2024/%E5%B3%B0%E9%97%B4%E4%BA%91%E6%B5%B7%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90/</id>
    <published>2024-02-08T22:00:12.000Z</published>
    <updated>2024-02-12T22:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​2023年的暑假，在我百般聊赖之际，网上冲浪时刷到了一个 mc服务器的视频。于是呼，心里萌发了一个想法——建立一个属于自己的服务器。在考虑的各种因素后，我选择了“纯生存”这个主题（之前都是玩命令的，很少沉下心来好好玩玩生存，也算是圆个心愿吧）。然后嘛，路走窄了，因为<code>时机不恰当，稳定性欠佳，玩法单调</code>等致命负面因素，好嘛，<del>它没了</del>（还活着，但在线玩家数量≤3罢了）。毕竟玩家数量跟投入的预算完全不成正比，没啥动力开，让我不禁想起了之前和酷安上一个老哥「<a href="https://d.hzchu.top/yhe5t">Ifkn_271</a>」合作，结果也是这样消失在互联网茫茫大海之中。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatumm.png"/></span></p><p>​不过话说回来，还是有投入了很多精力在上面的，时至今日，随着「go-cqhttp」项目寿终正寝，加上自己硬盘爆炸带来的数据库丢失，目前只剩下核心的游戏服务端还能用了，今天写一篇文章来<del>追悼</del>怀念一下吧。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatread.png"/></span></p><h2 id="内容索引"><a href="#内容索引" class="headerlink" title="内容索引"></a>内容索引</h2><ol><li><a href="#%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF">MCDR插件及部分服务端配置</a></li><li><a href="#Dynmap">Dynmap设置MySQL存储及使用独立Web服务器</a></li><li><a href="#%E5%9C%A8%E7%BA%BF%E6%9C%8D%E5%8A%A1">在线服务平台程序解析及部分代码片段</a></li><li><a href="#QQ-BOT">QQ机器人中自动添加离线用户白名单、聊天信息同步及图片上传</a></li><li><a href="#%E6%9D%82%E9%A1%B9">杂项</a></li></ol><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>​关于服务器的信息在<a href="/wiki/fcloud/">这里</a>可以看<br>​当然，在上面没有涉及到技术部分。总的来说，一共涉及到了「服务端主体及相应插件」，「网页前端、后端」 ，「QQ机器人」， 「Dynmap」这几个部分，大体架构如下</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c60196f2896.webp" alt="Snipaste_2024-02-09_11-13-44.webp"></p><p>以上，听我慢慢道来</p><h2 id="游戏服务端"><a href="#游戏服务端" class="headerlink" title="游戏服务端"></a>游戏服务端</h2><p>这方面大家各有不同，我这也不是最优选，就一笔带过</p><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">外围服务</span><span class="empty"></span></p></div><p>​由于当时没找到使用于fabric的登录插件，被迫增加了BC和一个独立的登录服务端。在前者我用了「Geyser」和「PixelMOTD」，一个用于转换be版于java版的通信协议，另一个用来处理motd请求，看起来更加高大上。后者用了雪之樱的整合包，并加了<code>BungeeAutoJoinServer</code>模组，在<code>Authme</code>登录事件结束后自动进入服务器。</p><p>​虽然臃肿了点，但也有好处，比如<code>防假人压测，motd攻击</code>之类。</p><a class="tag-plugin colorful hashtag" color="orange" href="https://d.hzchu.top/libmr"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>Geyser</span></a><a class="tag-plugin colorful hashtag" color="yellow" href="https://d.hzchu.top/cwlew"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>PixelMOTD</span></a><a class="tag-plugin colorful hashtag" color="green" href="https://d.hzchu.top/i8gan"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>BungeeAutoJoinServer</span></a><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">MCDR</span><span class="empty"></span></p></div><p>不懂Java，但又得对服务端运行做出干涉，这就得请出<code>MCDReforged</code>了</p><a class="tag-plugin colorful hashtag" color="cyan" href="https://d.hzchu.top/uumvr"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>MCDReforged</span></a><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c5cd66b7da9.webp" alt="1707461988568.webp"></p><ol><li>清除掉落物</li></ol><figure class="highlight python"><figcaption><span>\mcdr_server\plugins\cleandrops.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PLUGIN_METADATA = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;cleanitem&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;1.0.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;扫地僧&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mcdreforged.api.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clear_drops</span>(<span class="params">server: PluginServerInterface</span>):</span><br><span class="line">    server.execute(<span class="string">&#x27;tellraw @a &#123;&quot;text&quot;:&quot;30秒后清除掉落物&quot;,&quot;color&quot;:&quot;yellow&quot;&#125;&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">30</span>)</span><br><span class="line">    server.execute(<span class="string">&#x27;kill @e[type=item]&#x27;</span>)</span><br><span class="line">    server.execute(<span class="string">&#x27;tellraw @a &#123;&quot;text&quot;:&quot;掉落物已清除!&quot;,&quot;color&quot;:&quot;yellow&quot;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_info</span>(<span class="params">server: PluginServerInterface, info: Info</span>):</span><br><span class="line">    <span class="keyword">if</span> info.content == <span class="string">&#x27;!!cleardrops&#x27;</span>:</span><br><span class="line">        clear_drops(server)</span><br><span class="line"></span><br><span class="line"><span class="meta">@new_thread(<span class="params">PLUGIN_METADATA[<span class="string">&#x27;id&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_load</span>(<span class="params">server, old</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        clear_drops(server)</span><br><span class="line">        time.sleep(<span class="number">86400</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>插件运行在新的线程中，<del>可以放心睡</del>。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/ablobcatreachrev.png"/></span>当然，最好还是用「<a href="https://modrinth.com/mod/cleardespawn">ClearDespawn</a>」</p><ol start="2"><li>聊天记录统计</li></ol><figure class="highlight python"><figcaption><span>\mcdr_server\plugins\talk.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">PLUGIN_METADATA = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;talksave&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;1.0.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;记录玩家聊天记录&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置区域</span></span><br><span class="line">DATABASE = &#123;</span><br><span class="line">    <span class="string">&#x27;host&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database&#x27;</span>: <span class="string">&#x27;database&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"><span class="keyword">from</span> mcdreforged.api.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># def on_load(server, old):</span></span><br><span class="line"><span class="comment">#     server.logger.info(&#x27;Hello world!&#x27;)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_user_info</span>(<span class="params">server: PluginServerInterface, info: Info</span>):</span><br><span class="line">    <span class="comment"># 获取玩家名和聊天消息内容</span></span><br><span class="line">    player = info.player</span><br><span class="line">    message = info.content</span><br><span class="line">    <span class="comment">#server.logger.info(f&#x27;&#123;player&#125; 发送了消息：&#123;message&#125;&#x27;)</span></span><br><span class="line">    <span class="keyword">if</span> player <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> message <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> message.startswith(<span class="string">&#x27;!!MCDR&#x27;</span>) <span class="keyword">or</span> message.startswith(<span class="string">&#x27;!!plp&#x27;</span>) <span class="keyword">or</span> message.startswith(<span class="string">&#x27;!!day&#x27;</span>) <span class="keyword">or</span> message ==<span class="string">&quot;stop&quot;</span> <span class="keyword">or</span> message ==<span class="string">&quot;&quot;</span> <span class="keyword">or</span> message.startswith(<span class="string">&#x27;!!qb&#x27;</span>) <span class="keyword">or</span> message.startswith(<span class="string">&#x27;tellraw&#x27;</span>) <span class="keyword">or</span> message.startswith(<span class="string">&#x27;list&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># 此部分判断是否为MCDR命令，可根据自己插件不同调整</span></span><br><span class="line">    <span class="comment"># 也可与nb联动，同步信息到qq，不过我手抖把代码删了</span></span><br><span class="line">    conn= mysql.connector.connect(**DATABASE)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    sql = <span class="string">&quot;INSERT INTO chat (playername, msg, time) VALUES (%s, %s, NOW())&quot;</span></span><br><span class="line">    val = (player, message)</span><br><span class="line">    cursor.execute(sql, val)</span><br><span class="line">    conn.commit()</span><br><span class="line">    cursor.close()</span><br></pre></td></tr></table></figure><p>记录聊天记录到数据库，日后可以查询</p><ol start="3"><li>「银行」</li></ol><p>用下界合金为货币，存储到数据库中，本想和商店搭配使用的，没写完就不放了</p><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">服务端本体</span><span class="empty"></span></p></div><ol><li>既然是生存，必然绕不开一些生电类机器，<del>无脑投入carpet的怀抱</del></li></ol><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c5f68769fba.webp" alt="已修改的Carpet选项"></p><ol start="2"><li>Tab玩家列表用<code>styledplayerlist</code>微调了下</li></ol><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c5f7ea88e5e.webp" alt="还行吧"></p><figure class="highlight json"><figcaption><span>\server\config\styledplayerlist\styles\default.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;style_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Default&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;update_tick_time&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;list_header&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;&lt;gr:#ff6c00:#ff6c00&gt;&lt;bold&gt;峰间云海&lt;/bold&gt;&lt;/gr&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;&lt;color:#555555&gt;&lt;strikethrough&gt;        &lt;/strikethrough&gt;[ &lt;/color&gt;&lt;color:#FF5555&gt;%server:online%&lt;color:#6666676&gt;/&lt;/color&gt;%server:max_players%&lt;/color&gt;&lt;color:#555555&gt; ]&lt;strikethrough&gt;        &lt;/strikethrough&gt;&lt;/color&gt;&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;list_footer&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;&lt;color:#555555&gt;&lt;strikethrough&gt;                          &lt;/strikethrough&gt;&lt;/color&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;&lt;gray&gt;TPS: %server:tps_colored% &lt;dark_gray&gt;|&lt;/dark_gray&gt;&lt;gray&gt; MSPT: %server:mspt_colored% &lt;dark_gray&gt;|&lt;/dark_gray&gt; &lt;gray&gt;RAM: &lt;color:#54fc54&gt;%server:used_ram%/%server:max_ram%MB&lt;/color&gt; &lt;dark_gray&gt;|&lt;/dark_gray&gt; &lt;gray&gt;Ping: &lt;color:#ffba26&gt;%player:ping%ms&lt;/color&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;&lt;gray&gt;游戏时间：%world:time% &lt;dark_gray&gt;|&lt;/dark_gray&gt; &lt;gray&gt;现实时间：%server:time% &lt;dark_gray&gt;|&lt;/dark_gray&gt; &lt;gray&gt;实体数量：%world:mob_count%&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hidden_in_commands&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>Simple Voice Chat</li></ol><p>平时还有几条frp线路备用，而SVC默认使用<code>当前连接的ip+24454</code>进行连接，导致使用frp线路时无法使用，只好在配置里指定连接host</p><figure class="highlight properties"><figcaption><span>\config\voicechat\voicechat-server.properties:29</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The host name that clients should use to connect to the voice chat</span></span><br><span class="line"><span class="comment"># This may also include a port, e.g. &#x27;example.com:24454&#x27;</span></span><br><span class="line"><span class="comment"># Don&#x27;t change this value if you don&#x27;t know what you are doing</span></span><br><span class="line"><span class="attr">voice_host</span>=<span class="string">mcvoice.hzchu.top\:24454</span></span><br><span class="line"><span class="comment"># 其它设置无需调整</span></span><br></pre></td></tr></table></figure><p>其它就没什么改动了，添加的插件列表在<a href="/wiki/fcloud/">这里</a></p><h2 id="外围应用"><a href="#外围应用" class="headerlink" title="外围应用"></a>外围应用</h2><div class="tag-plugin quot"><h3 class="content" id="Dynmap" type="icon"><a href="#Dynmap" class="headerlink" title="Dynmap"></a><img class="icon prefix" src="https://onep.hzchu.top/mount/pic/2024/02/09/65c648ae99185.webp" /><span class="text">Dynmap</span><span class="empty"></span></h3></div><p>如官方简介里说的一样，这是一个<code>Google Maps-like map for your Minecraft server</code>，可以把服务器存档渲染成像谷歌地图般的在线网页供其他人查看</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/09/65c64a1aabf74.webp" alt="无奖竞猜生物群落"></p><p>通常情况下，大部分人装好就直接用了，可能再反代一下默认的8123端口，定个自定义路径访问。不过聪明的你从上面的架构图中应该已经发现了不同。没看清？再看一次</p><pre class="mermaid">flowchart LR    A[User] <-->|visit or talk| B[Dynmap Forestage]    B <--> C(MySQL)    C <--> D[Dynmap Backstage]</pre><p>为了实现上述访问流程，需要对原有设置做出一定调整</p><p>我参考了这篇文章，国内好像还没人写过，我就当个搬运工，<del>绝对不是水字数</del>。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/cdn-x/emoji/tieba/滑稽.png"/></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </p><div class="tag-plugin link dis-select"><a class="link-card rich" title="" href="https://bleepcoder.com/cn/dynmap/493645860/tutorial-setting-up-a-standalone-web-server-with-mysql" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="title,desc"><div class="top"><div class="lazy img" data-bg="https://onep.hzchu.top/mount/pic/2024/02/17/65d0215f11a29.webp"></div><span class="cap link footnote">https://bleepcoder.com/cn/dynmap/493645860/tutorial-setting-up-a-standalone-web-server-with-mysql</span></div><div class="bottom"><span class="title">https://bleepcoder.com/cn/dynmap/493645860/tutorial-setting-up-a-standalone-web-server-with-mysql</span><span class="cap desc footnote"></span></div></a></div><ol><li><p>首先先新建一个数据库，如果能设置允许访问范围的话最好只包括本机和服务端的ip</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c6d4d801cf7.webp" alt="1707529430723.webp"></p></li><li><p>修改以下配置</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>更改前</strong></p><div class="tag-plugin colorful note" color="red" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:28</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="comment"># Filetree storage (standard tree of image files for maps)</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">filetree</span></span><br><span class="line">  <span class="comment"># SQLite db for map storage (uses dbfile as storage location)</span></span><br><span class="line">  <span class="comment">#type: sqlite</span></span><br><span class="line">  <span class="comment">#dbfile: dynmap.db</span></span><br><span class="line">  <span class="comment"># MySQL DB for map storage (at &#x27;hostname&#x27;:&#x27;port&#x27; with flags &quot;flags&quot; in database &#x27;database&#x27; using user &#x27;userid&#x27; password &#x27;password&#x27; and table prefix &#x27;prefix&#x27;)</span></span><br><span class="line">  <span class="comment">#type: mysql</span></span><br><span class="line">  <span class="comment">#hostname: localhost</span></span><br><span class="line">  <span class="comment">#port: 3306</span></span><br><span class="line">  <span class="comment">#database: dynmap</span></span><br><span class="line">  <span class="comment">#userid: dynmap</span></span><br><span class="line">  <span class="comment">#password: dynmap</span></span><br><span class="line">  <span class="comment">#prefix: &quot;&quot;</span></span><br></pre></td></tr></table></figure></div></div>    </div>    <div class="cell" style="">    <p><strong>更改后</strong></p><div class="tag-plugin colorful note" color="green" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:28</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="comment"># Filetree storage (standard tree of image files for maps)</span></span><br><span class="line">  <span class="comment">#type: filetree &lt;- DONT FORGET TO COMMENT THIS OUT</span></span><br><span class="line">  <span class="comment"># SQLite db for map storage (uses dbfile as storage location)</span></span><br><span class="line">  <span class="comment">#type: sqlite</span></span><br><span class="line">  <span class="comment">#dbfile: dynmap.db</span></span><br><span class="line">  <span class="comment"># MySQL DB for map storage (at &#x27;hostname&#x27;:&#x27;port&#x27; with flags &quot;flags&quot; in database &#x27;database&#x27; using user &#x27;userid&#x27; password &#x27;password&#x27; and table prefix &#x27;prefix&#x27;)</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">hostname:</span> <span class="string">&lt;mysql_ip&gt;</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">&lt;mysql_port&gt;</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">&lt;mysql_database&gt;</span></span><br><span class="line">  <span class="attr">userid:</span> <span class="string">&lt;dynmap_mysql_user&gt;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&lt;dynmap_mysql_password&gt;</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">&quot;&quot;</span> <span class="comment"># Can add prefix for tables if you want</span></span><br></pre></td></tr></table></figure></div></div>    </div>    </div></li></ol><div class="tag-plugin colorful note" color="blue"><div class="body"><p>如果使用SQLite取消对应注释即可，路径可写绝对路径，把数据库放到硬盘空间充足的地方</p></div></div><p>随后，注释掉<code>- class: org.dynmap.InternalClientUpdateComponent</code>所有内容并<strong>取消</strong>注释<code>- class: org.dynmap.JsonFileClientUpdateComponent</code>所有内容</p><details class="tag-plugin colorful folding" ><summary><span>title 所修改内容</span></summary><div class="body"><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>更改前</strong></p><div class="tag-plugin colorful note" color="red" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:54</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">class:</span> <span class="string">org.dynmap.InternalClientUpdateComponent</span></span><br><span class="line">  <span class="attr">sendhealth:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sendposition:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">allowwebchat:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">webchat-interval:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">hidewebchatip:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">trustclientname:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">includehiddenplayers:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># (optional) if true, color codes in player display names are used</span></span><br><span class="line">  <span class="attr">use-name-colors:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># (optional) if true, player login IDs will be used for web chat when their IPs match</span></span><br><span class="line">  <span class="attr">use-player-login-ip:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># (optional) if use-player-login-ip is true, setting this to true will cause chat messages not matching a known player IP to be ignored</span></span><br><span class="line">  <span class="attr">require-player-login-ip:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># (optional) block player login IDs that are banned from chatting</span></span><br><span class="line">  <span class="attr">block-banned-player-chat:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Require login for web-to-server chat (requires login-enabled: true)</span></span><br><span class="line">  <span class="attr">webchat-requires-login:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If set to true, users must have dynmap.webchat permission in order to chat</span></span><br><span class="line">  <span class="attr">webchat-permissions:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Limit length of single chat messages</span></span><br><span class="line">  <span class="attr">chatlengthlimit:</span> <span class="number">256</span></span><br><span class="line"><span class="comment">#  # Optional - make players hidden when they are inside/underground/in shadows (#=light level: 0=full shadow,15=sky)</span></span><br><span class="line"><span class="comment">#  hideifshadow: 4</span></span><br><span class="line"><span class="comment">#  # Optional - make player hidden when they are under cover (#=sky light level,0=underground,15=open to sky)</span></span><br><span class="line"><span class="comment">#  hideifundercover: 14</span></span><br><span class="line"><span class="comment">#  # (Optional) if true, players that are crouching/sneaking will be hidden </span></span><br><span class="line">  <span class="attr">hideifsneaking:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If true, player positions/status is protected (login with ID with dynmap.playermarkers.seeall permission required for info other than self)</span></span><br><span class="line">  <span class="attr">protected-player-info:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If true, hide players with invisibility potion effects active</span></span><br><span class="line">  <span class="attr">hide-if-invisiblity-potion:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If true, player names are not shown on map, chat, list</span></span><br><span class="line">  <span class="attr">hidenames:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#- class: org.dynmap.JsonFileClientUpdateComponent</span></span><br><span class="line"><span class="comment">#  writeinterval: 1</span></span><br><span class="line"><span class="comment">#  sendhealth: true</span></span><br><span class="line"><span class="comment">#  sendposition: true</span></span><br><span class="line"><span class="comment">#  allowwebchat: true</span></span><br><span class="line"><span class="comment">#  webchat-interval: 5</span></span><br><span class="line"><span class="comment">#  hidewebchatip: false</span></span><br><span class="line"><span class="comment">#  includehiddenplayers: false</span></span><br><span class="line"><span class="comment">#  use-name-colors: false</span></span><br><span class="line"><span class="comment">#  use-player-login-ip: false</span></span><br><span class="line"><span class="comment">#  require-player-login-ip: false</span></span><br><span class="line"><span class="comment">#  block-banned-player-chat: true</span></span><br><span class="line"><span class="comment">#  hideifshadow: 0</span></span><br><span class="line"><span class="comment">#  hideifundercover: 0</span></span><br><span class="line"><span class="comment">#  hideifsneaking: false</span></span><br><span class="line"><span class="comment">#  # Require login for web-to-server chat (requires login-enabled: true)</span></span><br><span class="line"><span class="comment">#  webchat-requires-login: false</span></span><br><span class="line"><span class="comment">#  # If set to true, users must have dynmap.webchat permission in order to chat</span></span><br><span class="line"><span class="comment">#  webchat-permissions: false</span></span><br><span class="line"><span class="comment">#  # Limit length of single chat messages</span></span><br><span class="line"><span class="comment">#  chatlengthlimit: 256</span></span><br><span class="line"><span class="comment">#  hide-if-invisiblity-potion: true</span></span><br><span class="line"><span class="comment">#  hidenames: false</span></span><br></pre></td></tr></table></figure></div></div>    </div>    <div class="cell" style="">    <p><strong>更改后</strong></p><div class="tag-plugin colorful note" color="green" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:54</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - class: org.dynmap.InternalClientUpdateComponent</span></span><br><span class="line">   <span class="comment">#sendhealth: true</span></span><br><span class="line">   <span class="comment">#sendposition: true</span></span><br><span class="line">   <span class="comment">#allowwebchat: true</span></span><br><span class="line">   <span class="comment">#webchat-interval: 5</span></span><br><span class="line">   <span class="comment">#hidewebchatip: false</span></span><br><span class="line">   <span class="comment">#trustclientname: false</span></span><br><span class="line">   <span class="comment">#includehiddenplayers: false</span></span><br><span class="line">   <span class="comment"># (optional) if true, color codes in player display names are used</span></span><br><span class="line">   <span class="comment">#use-name-colors: false</span></span><br><span class="line">   <span class="comment"># (optional) if true, player login IDs will be used for web chat when their IPs match</span></span><br><span class="line">   <span class="comment">#use-player-login-ip: true</span></span><br><span class="line">   <span class="comment"># (optional) if use-player-login-ip is true, setting this to true will cause chat messages not matching a known player IP to be ignored</span></span><br><span class="line">   <span class="comment">#require-player-login-ip: false</span></span><br><span class="line">   <span class="comment"># (optional) block player login IDs that are banned from chatting</span></span><br><span class="line">   <span class="comment">#block-banned-player-chat: true</span></span><br><span class="line">   <span class="comment"># Require login for web-to-server chat (requires login-enabled: true)</span></span><br><span class="line">   <span class="comment">#webchat-requires-login: false</span></span><br><span class="line">   <span class="comment"># If set to true, users must have dynmap.webchat permission in order to chat</span></span><br><span class="line">   <span class="comment">#webchat-permissions: false</span></span><br><span class="line">   <span class="comment"># Limit length of single chat messages</span></span><br><span class="line">   <span class="comment">#chatlengthlimit: 256</span></span><br><span class="line"> <span class="comment">#  # Optional - make players hidden when they are inside/underground/in shadows (#=light level: 0=full shadow,15=sky)</span></span><br><span class="line"> <span class="comment">#  hideifshadow: 4</span></span><br><span class="line"> <span class="comment">#  # Optional - make player hidden when they are under cover (#=sky light level,0=underground,15=open to sky)</span></span><br><span class="line"> <span class="comment">#  hideifundercover: 14</span></span><br><span class="line"> <span class="comment">#  # (Optional) if true, players that are crouching/sneaking will be hidden </span></span><br><span class="line">   <span class="comment">#hideifsneaking: false</span></span><br><span class="line">   <span class="comment"># If true, player positions/status is protected (login with ID with dynmap.playermarkers.seeall permission required for info other than self)</span></span><br><span class="line">   <span class="comment">#protected-player-info: false</span></span><br><span class="line">   <span class="comment"># If true, hide players with invisibility potion effects active</span></span><br><span class="line">   <span class="comment">#hide-if-invisiblity-potion: true</span></span><br><span class="line">   <span class="comment"># If true, player names are not shown on map, chat, list</span></span><br><span class="line">   <span class="comment">#hidenames: false</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">org.dynmap.JsonFileClientUpdateComponent</span></span><br><span class="line">   <span class="attr">writeinterval:</span> <span class="number">1</span></span><br><span class="line">   <span class="attr">sendhealth:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">sendposition:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">allowwebchat:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">webchat-interval:</span> <span class="number">5</span></span><br><span class="line">   <span class="attr">hidewebchatip:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">includehiddenplayers:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">use-name-colors:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">use-player-login-ip:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">require-player-login-ip:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">block-banned-player-chat:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">hideifshadow:</span> <span class="number">0</span></span><br><span class="line">   <span class="attr">hideifundercover:</span> <span class="number">0</span></span><br><span class="line">   <span class="attr">hideifsneaking:</span> <span class="literal">false</span></span><br><span class="line"> <span class="comment">#  # Require login for web-to-server chat (requires login-enabled: true)</span></span><br><span class="line">   <span class="attr">webchat-requires-login:</span> <span class="literal">false</span></span><br><span class="line"> <span class="comment">#  # If set to true, users must have dynmap.webchat permission in order to chat</span></span><br><span class="line">   <span class="attr">webchat-permissions:</span> <span class="literal">false</span></span><br><span class="line"> <span class="comment">#  # Limit length of single chat messages</span></span><br><span class="line">   <span class="attr">chatlengthlimit:</span> <span class="number">256</span></span><br><span class="line">   <span class="attr">hide-if-invisiblity-potion:</span> <span class="literal">true</span></span><br><span class="line">   <span class="attr">hidenames:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></div></div>    </div>    </div></div></details><p>然后找到<code>disable-webserver</code>并将值从<code>false</code>更改为 <code>true</code> 以禁用内部网页服务器</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c6dcbe8e7e7.webp" alt="1707531452723.webp"></p><p>再修改相应的请求地址（<code>url:</code>）</p><div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">    <p><strong>更改前</strong></p><div class="tag-plugin colorful note" color="red" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:441</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url:</span></span><br><span class="line">    <span class="comment"># configuration URL</span></span><br><span class="line">    <span class="comment">#configuration: &quot;up/configuration&quot;</span></span><br><span class="line">    <span class="comment"># update URL</span></span><br><span class="line">    <span class="comment">#update: &quot;up/world/&#123;world&#125;/&#123;timestamp&#125;&quot;</span></span><br><span class="line">    <span class="comment"># sendmessage URL</span></span><br><span class="line">    <span class="comment">#sendmessage: &quot;up/sendmessage&quot;</span></span><br><span class="line">    <span class="comment"># login URL</span></span><br><span class="line">    <span class="comment">#login: &quot;up/login&quot;</span></span><br><span class="line">    <span class="comment"># register URL</span></span><br><span class="line">    <span class="comment">#register: &quot;up/register&quot;</span></span><br><span class="line">    <span class="comment"># tiles base URL</span></span><br><span class="line">    <span class="comment">#tiles: &quot;tiles/&quot;</span></span><br><span class="line">    <span class="comment"># markers base URL</span></span><br><span class="line">    <span class="comment">#markers: &quot;tiles/&quot;</span></span><br></pre></td></tr></table></figure></div></div>    </div>    <div class="cell" style="">    <p><strong>MySQL</strong></p><div class="tag-plugin colorful note" color="green" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:441</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url:</span></span><br><span class="line">    <span class="comment"># configuration URL</span></span><br><span class="line">    <span class="attr">configuration:</span> <span class="string">&quot;standalone/MySQL_configuration.php&quot;</span></span><br><span class="line">    <span class="comment"># update URL</span></span><br><span class="line">    <span class="attr">update:</span> <span class="string">&quot;standalone/MySQL_update.php?world=&#123;world&#125;&amp;ts=&#123;timestamp&#125;&quot;</span></span><br><span class="line">    <span class="comment"># sendmessage URL</span></span><br><span class="line">    <span class="attr">sendmessage:</span> <span class="string">&quot;standalone/MySQL_sendmessage.php&quot;</span></span><br><span class="line">    <span class="comment"># login URL</span></span><br><span class="line">    <span class="attr">login:</span> <span class="string">&quot;standalone/MySQL_login.php&quot;</span></span><br><span class="line">    <span class="comment"># register URL</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">&quot;standalone/MySQL_register.php&quot;</span></span><br><span class="line">    <span class="comment"># tiles base URL</span></span><br><span class="line">    <span class="attr">tiles:</span> <span class="string">&quot;standalone/MySQL_tiles.php?tile=&quot;</span></span><br><span class="line">    <span class="comment"># markers base URL</span></span><br><span class="line">    <span class="attr">markers:</span> <span class="string">&quot;standalone/MySQL_markers.php?marker=&quot;</span></span><br></pre></td></tr></table></figure></div></div>    </div>    <div class="cell" style="">    <p><strong>SQLite</strong></p><div class="tag-plugin colorful note" color="green" child="codeblock"><div class="body"><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:441</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url:</span></span><br><span class="line">    <span class="comment"># configuration URL</span></span><br><span class="line">    <span class="attr">configuration:</span> <span class="string">&quot;standalone/configuration.php&quot;</span></span><br><span class="line">    <span class="comment"># update URL</span></span><br><span class="line">    <span class="attr">update:</span> <span class="string">&quot;standalone/update.php?world=&#123;world&#125;&amp;ts=&#123;timestamp&#125;&quot;</span></span><br><span class="line">    <span class="comment"># sendmessage URL</span></span><br><span class="line">    <span class="attr">sendmessage:</span> <span class="string">&quot;standalone/sendmessage.php&quot;</span></span><br><span class="line">    <span class="comment"># login URL</span></span><br><span class="line">    <span class="attr">login:</span> <span class="string">&quot;standalone/login.php&quot;</span></span><br><span class="line">    <span class="comment"># register URL</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">&quot;standalone/register.php&quot;</span></span><br><span class="line">    <span class="comment"># tiles base URL</span></span><br><span class="line">    <span class="attr">tiles:</span> <span class="string">&quot;standalone/tiles.php?tile=&quot;</span></span><br><span class="line">    <span class="comment"># markers base URL</span></span><br><span class="line">    <span class="attr">markers:</span> <span class="string">&quot;standalone/markers.php?marker=&quot;</span></span><br></pre></td></tr></table></figure></div></div>    </div>    </div><div class="tag-plugin colorful note" color="blue"><div class="title">Dynmap还支持MariaDB、PostgreSQL及S3存储。使用MariaDB的话将</div><div class="body"><p><code>type: mysql</code> 改为 <code>type: mariadb</code> ，PostgreSQL 改为 <code>type: postgres</code> 并将 <code>url:</code> 中的 <code>MySQL_</code> 替换为 <code>PostgreSQL_</code> 。至于S3，太豪气了应该没人用吧，自建当我没说（小声bb</p></div></div><p>最后修改一下配置文件中前端的地址（会在游戏中显示）</p><figure class="highlight yaml"><figcaption><span>\dynmap\configuration.txt:478</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Published public URL for Dynmap server (allows users to use &#x27;dynmap url&#x27; command to get public URL usable to access server</span></span><br><span class="line"><span class="comment"># If not set, &#x27;dynmap url&#x27; will not return anything.  URL should be fully qualified (e.g. https://mc.westeroscraft.com/)</span></span><br><span class="line"><span class="attr">publicURL:</span> <span class="string">https://yourdomain.com/</span></span><br></pre></td></tr></table></figure><ol start="3"><li>安装用于MySQL的java驱动包<div class="tag-plugin colorful note" color="yellow"><div class="body"><p>非MySQL存储可跳过</p></div></div><div class="tag-plugin link dis-select"><a class="link-card plain" title="MySQL_JDBC_(Fabric/Forge)" href="https://www.curseforge.com/minecraft/mc-mods/mysql-jdbc/files" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill=""><div class="left"><span class="title">MySQL_JDBC_(Fabric/Forge)</span><span class="cap link footnote">https://www.curseforge.com/minecraft/mc-mods/mysql-jdbc/files</span></div><div class="right"><div class="lazy img" data-bg="https://static-beta.curseforge.com/images/favicon.ico"></div></div></a></div></li></ol><p>下载后放入 <code>mods</code> 文件夹</p><ol start="4"><li>试运行</li></ol><p>​开启服务端，观察日志输出中有无报错，同时检查数据库中是否有数据表生成</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c6f4896779f.webp" alt="1707537542036.webp"></p><ol start="5"><li>成功运行后配置网页前端。先安装PHP-7.4（实测8.0会存在bug无法登录），将<code>...\dynmap\web</code>下所有文件复制到网页根目录即可。（模组在启动后会自动完成配置，以配置mysql为存储为例，配置会写入 <code>\standalone\config.js</code>和 <code>\web\standalone\MySQL_config.php</code>）如果数据库无法访问可尝试手动设置<code>$dbhost</code>为<code>127.0.0.1</code></li></ol><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c7326a8ff9a.webp" alt="1707553384528.webp"></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c7327ca274f.webp" alt="1707553403171.webp"></p><ol start="6"><li>打开看看吧~ 哦？一片漆黑，因为这时候还没有执行渲染命令，dynmap还没工作<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatcoffee.png"/></span>，因此我们可以执行 <code>/dynmap radiusrender world 0 0 10</code>来对主世界出生点周围进行渲染，并查看中有无数据写入到<code>tiles</code>表中</li></ol><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c7349bafa98.webp" alt="例子"></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c735c561384.webp" alt="1707554242561.webp"></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c7382b5d84f.webp" alt="出来了"></p><p>初步测试完成后就可以执行 <code>/dynmap fullrender world</code> 渲染整个世界了。</p><p>前端我做了一定修改，有兴趣可以下载看看：</p><div class="tag-plugin link dis-select"><a class="link-card rich" title="" href="https://pan.hzchu.top/s/MWU7?password=uzyj8y" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="title,icon,desc"><div class="top"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div><span class="cap link footnote">https://pan.hzchu.top/s/MWU7?password=uzyj8y</span></div><div class="bottom"><span class="title">https://pan.hzchu.top/s/MWU7?password=uzyj8y</span><span class="cap desc footnote"></span></div></a></div><div class="tag-plugin colorful note" color="yellow"><div class="body"><p>注意：该地图会对性能及带宽占用上造成一定影响，请参考网上其他调优资料，根据自身实际情况调整</p></div></div><div class="tag-plugin quot"><h3 class="content" id="在线服务" type="icon"><a href="#在线服务" class="headerlink" title="在线服务"></a><img class="icon prefix" src="https://mcweb.hzchu.top/favicon.ico" /><span class="text">在线服务</span><span class="empty"></span></h3></div><p><img src="https://onep.hzchu.top/mount/pic/2024/02/10/65c73dfd4c862.webp" alt="相关图片"></p><blockquote><p><a href="https://d.hzchu.top/xznnj">峰间云海 (hzchu.top)</a></p></blockquote><p>与其叫做官网，倒不如说是一个 <code>综合服务平台</code> ， 当初想着与其整个花里胡哨的页面，不如整个有用的。虽然事实证明还是花哨的好。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatsadreach.png"/></span></p><ol><li>前端</li></ol><p>因为当时赶工期， 从头学各种框架来不及，用Py写了个拼凑html的程序，基本能用，后面MRUI也延续了这套，后续如果有空改进下。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatpeek2.png"/></span></p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/mcweb"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=mcweb&&show_owner=true"/></a></div><p>基本是开箱即用了</p><p>功能在后面混着讲</p><ol start="2"><li>后端</li></ol><p><strong>首页：</strong>状态检测使用了<code>mcstatus</code>库，具体操作可以参考<a href="https://d.hzchu.top/a4zaw">mcstatus · PyPI</a>。公告用了Artalk，<del>歪门邪道</del></p><p><strong>聊天记录：</strong></p><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/msg&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getmsg</span>():</span><br><span class="line">    num = request.args.get(<span class="string">&#x27;num&#x27;</span>, default=<span class="number">0</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    <span class="comment"># 限制访问前200条记录</span></span><br><span class="line">    <span class="keyword">if</span> num &gt; <span class="number">160</span>:</span><br><span class="line">        messages = []</span><br><span class="line">        message = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;playername&#x27;</span>: <span class="string">&quot;Null&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;200条后不予查看&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;time&#x27;</span>: <span class="string">&quot;Null&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        messages.append(message)</span><br><span class="line">        <span class="keyword">return</span> jsonify(messages), <span class="number">200</span></span><br><span class="line">    conn= mysql.connector.connect(**DATABASE)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    sql = <span class="string">&quot;SELECT id, playername, msg, time FROM chat ORDER BY id DESC LIMIT %s, %s&quot;</span></span><br><span class="line">    cursor.execute(sql, (num, <span class="number">40</span>))</span><br><span class="line">    result = cursor.fetchall()</span><br><span class="line">    cursor.close()</span><br><span class="line"></span><br><span class="line">    messages = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> result:</span><br><span class="line">        message = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: row[<span class="number">0</span>],</span><br><span class="line">            <span class="string">&#x27;playername&#x27;</span>: row[<span class="number">1</span>],</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>: row[<span class="number">2</span>],</span><br><span class="line">            <span class="string">&#x27;time&#x27;</span>: row[<span class="number">3</span>].strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        messages.append(message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(messages), <span class="number">200</span></span><br></pre></td></tr></table></figure><p>在前端页面中，我是直接用了表格的形式显示，不够好看，原草稿大概是这样，<del>可惜没时间</del></p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/11/65c8dc3376bd8.webp" alt="1707662385052.webp"></p><p>用于当时忘了xss处理，要在前端补上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// msg.textContent = dexss(player.msg);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dexss</span>(<span class="params">str, kwargs</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">&#x27;&#x27;</span> + str)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&amp;/g</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>) <span class="comment">// DEC=&gt; &amp;#60; HEX=&gt; &amp;#x3c; Entity=&gt; &amp;lt;</span></span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&quot;/g</span>, <span class="string">&#x27;&amp;quot;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/&#x27;/g</span>, <span class="string">&#x27;&amp;#x27;&#x27;</span>) <span class="comment">// &amp;apos; 不推荐，因为它不在HTML规范中</span></span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/\//g</span>, <span class="string">&#x27;&amp;#x2F;&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>相册：</strong></p><p>这部分与前者差不多，前端网上随便找了个改了改，现在想想直接用Lsky pro的画廊就行了</p><blockquote><p>此部分仅为读取，写入的部分由QQ机器人负责</p></blockquote><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/photo&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    num = request.args.get(<span class="string">&#x27;num&#x27;</span>, default=<span class="number">0</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    </span><br><span class="line">    conn= mysql.connector.connect(**DATABASE)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        query = <span class="string">&quot;SELECT id, nickname, author, time, url FROM photo ORDER BY id DESC LIMIT %s, %s&quot;</span></span><br><span class="line">        cursor.execute(query, (num, <span class="number">24</span>))</span><br><span class="line">        results = cursor.fetchall()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 将查询结果转换为字典列表</span></span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> results:</span><br><span class="line">            data.append(&#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: row[<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;nickname&#x27;</span>: row[<span class="number">1</span>],</span><br><span class="line">                <span class="string">&#x27;author&#x27;</span>: row[<span class="number">2</span>],</span><br><span class="line">                <span class="string">&#x27;time&#x27;</span>: row[<span class="number">3</span>],</span><br><span class="line">                <span class="string">&#x27;url&#x27;</span>: row[<span class="number">4</span>]</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jsonify(data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="built_in">str</span>(e)&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        cursor.close()</span><br><span class="line">        conn.close()</span><br></pre></td></tr></table></figure><p><strong>坐标&amp;反馈：</strong>缩水了，用Artalk替代了，只能说与我计划中差的有亿点多</p><p><strong>排行榜：</strong></p><p>​这就有点意思了，为了实现这些数据统计，我在游戏中新建了<code>若干的计分板</code>+一些在常加载区块里的<code>命令方块</code>，随后每隔一段时间读取存档里的存储着计分板数据的文件（\world\data\scoreboard.dat），将数值计入数据库。（起初使用Rcon执行命令显示该玩家所有计分板数据并使用正则表达式提取再存入，前期还好，到后来影响太大被迫改进）</p><p>​游戏里的命令就不说了，需求不一定相同，网上一大把教程</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="" href="https://www.bilibili.com/read/cv12839156/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="title,icon"><div class="left"><span class="title">https://www.bilibili.com/read/cv12839156/</span><span class="cap link footnote">https://www.bilibili.com/read/cv12839156/</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><p>​在实际程序中，为了简化主程序的复杂程度（拉侧边滚动条都拉出火花了），我把新定义的函数放在<code>extra.py</code>里</p><figure class="highlight python"><figcaption><span>extra.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"><span class="keyword">import</span> python_nbt.nbt <span class="keyword">as</span> nbt</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_scoreboard</span>(<span class="params">scoreboard_name</span>):</span><br><span class="line"><span class="comment"># 将字符串转换为 Python 对象</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    file = nbt.read_from_nbt_file(<span class="string">&quot;D:\MCC\mcdr_server\server\world\data\scoreboard.dat&quot;</span>)</span><br><span class="line">    string_data = <span class="built_in">str</span>(file)</span><br><span class="line">    <span class="comment"># print(string_data)</span></span><br><span class="line">    python_object = ast.literal_eval(string_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将 Python 对象转换为 JSON 字符串</span></span><br><span class="line">    json_data = json.dumps(python_object)</span><br><span class="line">    data = json.loads(json_data)</span><br><span class="line">    <span class="comment"># print(json_data)</span></span><br><span class="line">    <span class="comment"># print(data[&quot;value&quot;][&quot;data&quot;][&quot;value&quot;][&quot;PlayerScores&quot;][&quot;value&quot;])</span></span><br><span class="line">    data = data[<span class="string">&quot;value&quot;</span>][<span class="string">&quot;data&quot;</span>][<span class="string">&quot;value&quot;</span>][<span class="string">&quot;PlayerScores&quot;</span>][<span class="string">&quot;value&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="string">&quot;Objective&quot;</span>][<span class="string">&quot;value&quot;</span>] == scoreboard_name:</span><br><span class="line">            name = i[<span class="string">&quot;Name&quot;</span>][<span class="string">&quot;value&quot;</span>]</span><br><span class="line">            score = i[<span class="string">&quot;Score&quot;</span>][<span class="string">&quot;value&quot;</span>]</span><br><span class="line">            <span class="comment">#print(name,&quot;:&quot;,score)</span></span><br><span class="line">            conn= mysql.connector.connect(**DATABASE)</span><br><span class="line">            cursor = conn.cursor()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                insert_query = <span class="string">&quot;INSERT INTO scoreboard (player, &#123;&#125;) VALUES (%s, %s) ON DUPLICATE KEY UPDATE &#123;&#125; = %s&quot;</span>.<span class="built_in">format</span>(scoreboard_name, scoreboard_name)</span><br><span class="line">                data = (name, score, score)</span><br><span class="line">                cursor.execute(insert_query, data)</span><br><span class="line"></span><br><span class="line">                conn.commit()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(e))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                cursor.close()</span><br><span class="line">                conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 记录结束时间</span></span><br><span class="line">    end_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算执行时间</span></span><br><span class="line">    execution_time = end_time - start_time</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打印执行时间</span></span><br><span class="line">    <span class="keyword">return</span>(execution_time)</span><br></pre></td></tr></table></figure><p>​该函数回返回执行时间，不过没用错误处理，虽然一般情况下不会发生错误，不过最好也改进下再用</p><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> extra</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">updatabase</span>():</span><br><span class="line">    time_used = extra.get_scoreboard(<span class="string">&quot;pickaxe_total&quot;</span>)</span><br><span class="line">    time_used = time_used + extra.get_scoreboard(<span class="string">&quot;gametime&quot;</span>)</span><br><span class="line">    time_used = time_used + extra.get_scoreboard(<span class="string">&quot;Kills&quot;</span>)</span><br><span class="line">    time_used = time_used + extra.get_scoreboard(<span class="string">&quot;fish&quot;</span>)</span><br><span class="line">    time_used = time_used + extra.get_scoreboard(<span class="string">&quot;xp&quot;</span>)</span><br><span class="line">    time_used =<span class="string">&quot; &#123;:.3f&#125;&quot;</span>.<span class="built_in">format</span>(time_used)</span><br><span class="line">    <span class="comment">#msg_type = &quot;System-AutoTasks&quot;</span></span><br><span class="line">    <span class="comment">#msg_value = &quot;计分板同步成功，耗时:&quot; + str(time_used) + &quot;秒&quot;</span></span><br><span class="line">    <span class="comment">#extra.eventssave(msg_type,msg_value)</span></span><br><span class="line">    <span class="comment"># 用于日志保存，可去掉</span></span><br><span class="line">                          </span><br><span class="line">                  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_timer</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 每2h执行一次</span></span><br><span class="line">        <span class="comment"># 简单粗暴，实际使用请使用schedule库</span></span><br><span class="line">        time.sleep(<span class="number">2</span>* <span class="number">60</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="comment"># 在后台线程中执行需要定时执行的函数</span></span><br><span class="line">        threading.Thread(target=updatabase).start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过以下路由返回数据</p><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/scoreboard&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_scoreboard</span>():</span><br><span class="line">    cnx = mysql.connector.connect(**DATABASE)</span><br><span class="line">    cursor = cnx.cursor()</span><br><span class="line">    query = <span class="string">&quot;SELECT * FROM scoreboard&quot;</span></span><br><span class="line">    cursor.execute(query)</span><br><span class="line">    data = [&#123;<span class="string">&#x27;playername&#x27;</span>: row[<span class="number">0</span>], <span class="string">&#x27;pickaxe_total&#x27;</span>: row[<span class="number">1</span>], <span class="string">&#x27;gametime&#x27;</span>: row[<span class="number">2</span>], <span class="string">&#x27;Kills&#x27;</span>: row[<span class="number">3</span>], <span class="string">&#x27;fish&#x27;</span>: row[<span class="number">4</span>], <span class="string">&#x27;xp&#x27;</span>: row[<span class="number">5</span>]&#125; <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall()]</span><br><span class="line">    cursor.close()</span><br><span class="line">    <span class="keyword">return</span> jsonify(data)</span><br></pre></td></tr></table></figure><p>前端用了AI帮忙，太折磨人了。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatumm.png"/></span></p><details class="tag-plugin colorful folding" ><summary><span>默认折叠</span></summary><div class="body"><figure class="highlight javascript"><figcaption><span>list.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scoreboardUrl = <span class="string">&#x27;https://***************/user/scoreboard&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyPickaxe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-pickaxe&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyKills = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-kills&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyFish = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-fish&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyGametime = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-gametime&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> scoreboardBodyxp = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scoreboard-body-xp&#x27;</span>);</span><br><span class="line"><span class="title function_">fetch</span>(scoreboardUrl)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">scoreboard</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//定义一个比较函数，按照pickaxe_total的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByPickaxe</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">pickaxe_total</span> - a.<span class="property">pickaxe_total</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个比较函数，按照Kills的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByKills</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">Kills</span> - a.<span class="property">Kills</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个比较函数，按照fish的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByFish</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">fish</span> - a.<span class="property">fish</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个比较函数，按照gametime的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByGametime</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">gametime</span> - a.<span class="property">gametime</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个比较函数，按照xp的大小从高到低排序</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">compareByxp</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b.<span class="property">xp</span> - a.<span class="property">xp</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉pickaxe_total为0的玩家</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByPickaxe</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">pickaxe_total</span> &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉Kills为null的玩家</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByKills</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">Kills</span> != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉fish为null的玩家</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByFish</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">fish</span> != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉gametime为null的玩家</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByGametime</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">gametime</span> != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义一个过滤函数，排除掉xp为null的玩家 </span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filterByxp</span>(<span class="params">a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.<span class="property">xp</span> != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//对scoreboard数组进行过滤</span></span><br><span class="line">        scoreboard = scoreboard.<span class="title function_">filter</span>(filterByPickaxe);</span><br><span class="line">        <span class="comment">// 参照最初版重写！！！！</span></span><br><span class="line">        <span class="comment">//创建一个副本数组，按照pickaxe_total排序</span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByPickaxe = [...scoreboard];</span><br><span class="line">        scoreboardByPickaxe.<span class="title function_">sort</span>(compareByPickaxe);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(scoreboardByPickaxe)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个副本数组，按照Kills排序，并过滤掉null值</span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByKills = [...scoreboard];</span><br><span class="line">        scoreboardByKills.<span class="title function_">sort</span>(compareByKills);</span><br><span class="line">        scoreboardByKills = scoreboardByKills.<span class="title function_">filter</span>(filterByKills);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个副本数组，按照fish排序，并过滤掉null值</span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByFish = [...scoreboard];</span><br><span class="line">        scoreboardByFish.<span class="title function_">sort</span>(compareByFish);</span><br><span class="line">        scoreboardByFish = scoreboardByFish.<span class="title function_">filter</span>(filterByFish);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个副本数组，按照gametime排序，并过滤掉null值</span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByGametime = [...scoreboard];</span><br><span class="line">        scoreboardByGametime.<span class="title function_">sort</span>(compareByGametime);</span><br><span class="line">        scoreboardByGametime = scoreboardByGametime.<span class="title function_">filter</span>(filterByGametime);</span><br><span class="line">        <span class="comment">//创建一个副本数组，按照xp排序，并过滤掉null值 </span></span><br><span class="line">        <span class="keyword">let</span> scoreboardByXp = [...scoreboard];</span><br><span class="line">        scoreboardByXp.<span class="title function_">sort</span>(compareByxp);</span><br><span class="line">        scoreboardByXp = scoreboardByXp.<span class="title function_">filter</span>(filterByxp);</span><br><span class="line">        <span class="comment">//遍历按照pickaxe_total排序的数组，创建表格行和单元格，并添加到对应的表格中</span></span><br><span class="line">        scoreboardByPickaxe.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> pickaxeTotal = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            pickaxeTotal.<span class="property">textContent</span> = player.<span class="property">pickaxe_total</span>;</span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(pickaxeTotal);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyPickaxe.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历按照Kills排序的数组，创建表格行和单元格，并添加到对应的表格中</span></span><br><span class="line">        scoreboardByKills.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> kills = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            kills.<span class="property">textContent</span> = player.<span class="property">Kills</span>;</span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(kills);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyKills.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历按照fish排序的数组，创建表格行和单元格，并添加到对应的表格中</span></span><br><span class="line">        scoreboardByFish.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> fish = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            fish.<span class="property">textContent</span> = player.<span class="property">fish</span>;</span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(fish);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyFish.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历按照gametime排序的数组，创建表格行和单元格，并添加到对应的表格中</span></span><br><span class="line">        scoreboardByGametime.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> gametime = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            gametime.<span class="property">textContent</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(player.<span class="property">gametime</span> / <span class="number">60</span> / <span class="number">60</span>) + <span class="string">&quot;h&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(gametime);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyGametime.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//遍历按照xp排序的数组，创建表格行和单元格，并添加到对应的表格中 </span></span><br><span class="line">        scoreboardByXp.<span class="title function_">forEach</span>(<span class="function">(<span class="params">player, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> rank = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> playerName = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> xp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            rank.<span class="property">textContent</span> = index + <span class="number">1</span>;</span><br><span class="line">            playerName.<span class="property">textContent</span> = player.<span class="property">playername</span>;</span><br><span class="line">            xp.<span class="property">textContent</span> = <span class="title function_">getLevel</span>(player.<span class="property">xp</span>);</span><br><span class="line"></span><br><span class="line">            row.<span class="title function_">appendChild</span>(rank);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(playerName);</span><br><span class="line">            row.<span class="title function_">appendChild</span>(xp);</span><br><span class="line"></span><br><span class="line">            scoreboardBodyxp.<span class="title function_">appendChild</span>(row);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">// 定义一个函数，参数为原始经验值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLevel</span>(<span class="params">exp</span>) &#123;</span><br><span class="line">    <span class="comment">// 定义一个变量，存储经验等级</span></span><br><span class="line">    <span class="keyword">let</span> level = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 定义一个变量，存储升级所需的经验值</span></span><br><span class="line">    <span class="keyword">let</span> expToNext = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 使用循环，不断更新经验等级和升级所需的经验值，直到原始经验值不足以升级为止</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 根据公式，计算升级所需的经验值</span></span><br><span class="line">        <span class="keyword">if</span> (level &lt;= <span class="number">15</span>) &#123;</span><br><span class="line">            expToNext = <span class="number">2</span> * level + <span class="number">7</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (level &lt;= <span class="number">30</span>) &#123;</span><br><span class="line">            expToNext = <span class="number">5</span> * level - <span class="number">38</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            expToNext = <span class="number">9</span> * level - <span class="number">158</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断原始经验值是否足够升级</span></span><br><span class="line">        <span class="keyword">if</span> (exp &gt;= expToNext) &#123;</span><br><span class="line">            <span class="comment">// 如果足够，减去升级所需的经验值，增加经验等级</span></span><br><span class="line">            exp -= expToNext;</span><br><span class="line">            level++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果不足，跳出循环</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回经验等级</span></span><br><span class="line">    <span class="keyword">return</span> level;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></details><p><strong>管理：</strong></p><p>如果内建账号密码登录，要增加一些工作量，所以我借鉴了一下之前某个AIGC平台的做法，向qq机器人发信息以获取有效期一周的token用于登录，这样安全性大大提高，而且写起来也不用顾虑太多。<span class="tag-plugin emoji"></span>在初次打开时网页会发送鉴权请求判断是否有效，后续请求也都带上这个token。以下是部分代码片段</p><figure class="highlight python"><figcaption><span>封禁玩家</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/banplayer&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">banplayer</span>():</span><br><span class="line">    playername = request.json.get(<span class="string">&#x27;playername&#x27;</span>)</span><br><span class="line">    reason = request.json.get(<span class="string">&#x27;reason&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">if</span> reason == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        reason = <span class="string">&quot;未记录原因的封禁，请联系管理员&quot;</span></span><br><span class="line"></span><br><span class="line">    command = <span class="string">&#x27;kick &#x27;</span> + playername + <span class="string">&#x27; &#x27;</span> + reason</span><br><span class="line">    response = extra.sendcommand(command)</span><br><span class="line">    command = <span class="string">&#x27;ban &#x27;</span> + playername + <span class="string">&#x27; &#x27;</span> + reason</span><br><span class="line">    response = extra.sendcommand(command)</span><br><span class="line">    conn = mysql.connector.connect(**DATABASE)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;response&#x27;</span>: response&#125;), <span class="number">200</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>extra.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mcrcon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主机 密码 端口</span></span><br><span class="line">client = mcrcon.MCRcon(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;*-*-*-*&#x27;</span>, <span class="number">2</span>****<span class="number">5</span>)</span><br><span class="line">client.connect()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendcommand</span>(<span class="params">command</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> command:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;No command provided&#x27;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    response = client.command(command)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>解除封禁</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/debanplayer&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debanplayer</span>():</span><br><span class="line">    playername = request.json.get(<span class="string">&#x27;playername&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">    command = <span class="string">&#x27;pardon &#x27;</span> + playername</span><br><span class="line">    response = extra.sendcommand(command)</span><br><span class="line">    conn = mysql.connector.connect(**DATABASE)</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;response&#x27;</span>: response&#125;), <span class="number">200</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>获取用户信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ipdb</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/getaccount&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getaccount</span>():</span><br><span class="line">    accountinfo = request.json.get(<span class="string">&#x27;accountinfo&#x27;</span>)</span><br><span class="line">    mode = <span class="built_in">int</span>(request.json.get(<span class="string">&#x27;mode&#x27;</span>))</span><br><span class="line">...</span><br><span class="line">    conn = mysql.connector.connect(**DATABASE)</span><br><span class="line">    c = conn.cursor()</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="number">1</span>:</span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `qq_user` where qq_id = %s&quot;</span>, (accountinfo,))</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="number">2</span>:</span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `qq_user` where user_name = %s&quot;</span>, (accountinfo,))</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="number">3</span>:</span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `qq_user` where be_name = %s&quot;</span>, (accountinfo,))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `qq_user` where qq_id = %s&quot;</span>, (accountinfo,))</span><br><span class="line">    acc_result = c.fetchall()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> acc_result:</span><br><span class="line">        <span class="keyword">if</span> acc_result[<span class="number">0</span>][<span class="number">5</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            be_name = <span class="string">&quot;!未绑定!&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            be_name = acc_result[<span class="number">0</span>][<span class="number">5</span>]</span><br><span class="line">        playername = acc_result[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># 用的MySQL数据库，Authme和该服务共用一个数据库，因此直接调用其获取IP</span></span><br><span class="line">        c.execute(<span class="string">&quot;SELECT * FROM `authme` where realname = %s or username = %s&quot;</span>, (playername,playername,))</span><br><span class="line">        ip_result = c.fetchall()</span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="comment">#嵌套有点多，整活部分可以改掉</span></span><br><span class="line">        <span class="keyword">if</span> ip_result:</span><br><span class="line">            ip = ip_result[<span class="number">0</span>][<span class="number">4</span>]</span><br><span class="line">            <span class="keyword">if</span> ipaddress.ip_address(ip).is_private:</span><br><span class="line">                ip = <span class="string">&quot;内网地址&quot;</span></span><br><span class="line">                country=<span class="string">&quot;南极洲&quot;</span></span><br><span class="line">                city=<span class="string">&quot;中山站&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ipinfo=db.find_map(ip, <span class="string">&quot;CN&quot;</span>)</span><br><span class="line">                country=ipinfo[<span class="string">&quot;country_name&quot;</span>]</span><br><span class="line">                city= ipinfo[<span class="string">&quot;region_name&quot;</span>]+<span class="string">&quot;，&quot;</span>+ipinfo[<span class="string">&quot;city_name&quot;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ip = <span class="string">&quot;!未记录在数据库!&quot;</span></span><br><span class="line">            country=<span class="string">&quot;北极点&quot;</span></span><br><span class="line">            city=<span class="string">&quot;鹦鹉螺号&quot;</span></span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;qq&#x27;</span>: acc_result[<span class="number">0</span>][<span class="number">0</span>],<span class="string">&#x27;user_name&#x27;</span>: playername,<span class="string">&#x27;bind_time&#x27;</span>: acc_result[<span class="number">0</span>][<span class="number">2</span>],<span class="string">&#x27;group&#x27;</span>: acc_result[<span class="number">0</span>][<span class="number">3</span>],<span class="string">&#x27;status&#x27;</span>: acc_result[<span class="number">0</span>][<span class="number">4</span>],<span class="string">&#x27;be_name&#x27;</span>: be_name,<span class="string">&#x27;ip&#x27;</span>: ip,<span class="string">&#x27;country&#x27;</span>:country,<span class="string">&#x27;city&#x27;</span>:city&#125;), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">1000</span>,<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;没有相应玩家消息&#x27;</span>&#125;), <span class="number">200</span></span><br></pre></td></tr></table></figure><div class="tag-plugin quot"><h3 class="content" id="QQ-BOT" type="icon"><a href="#QQ-BOT" class="headerlink" title="QQ-BOT"></a><img class="icon prefix" src="https://onep.hzchu.top/mount/pic/2024/02/11/65c8e5059a363.webp" /><span class="text">QQ-BOT</span><span class="empty"></span></h3></div><p>在整个规划中，它承担了相当重要的责任，譬如自动添加白名单（绑定）</p><p><img src="https://onep.hzchu.top/mount/pic/2024/02/11/65c8e69a32833.webp" alt="绑定与解绑"></p><p> <img src="https://onep.hzchu.top/mount/pic/2024/02/12/65c9acd876283.webp" alt="目录结构"></p><p><strong>绑定：</strong>一开始我使用了一个极为简单的绑定方式：通过Rcon连接到服务器执行 <code>whitelist add playername</code>，按理来说这没问题，但是后面来的玩家基本都在抱怨进不去服务器。错误截图都一样，不在白名单内。最后发现uuid不一致，有些人的离线用户名与某些正版用户名重复了，导致服务端直接沿用正版用户的uuid，过不去后续校验。所以我这里就直接计算离线用户的uuid写入到<code>whitelist.json</code>内</p><figure class="highlight python"><figcaption><span>mchelper\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@bind.handle()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_first_receive</span>(<span class="params">matcher: Matcher, args: Message = CommandArg(<span class="params"></span>)</span>):</span><br><span class="line">    plain_text = args.extract_plain_text()  <span class="comment"># 首次发送命令时跟随的参数，例：/绑定 username，则args为username</span></span><br><span class="line">    <span class="keyword">if</span> plain_text:</span><br><span class="line">        matcher.set_arg(<span class="string">&quot;username&quot;</span>, args)  <span class="comment"># 如果用户发送了参数则直接赋值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@bind.got(<span class="params"><span class="string">&quot;username&quot;</span>, prompt=<span class="string">&quot;请输入你的用户名&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_username</span>(<span class="params">event: GroupMessageEvent, username: Message = Arg(<span class="params"></span>), username_str: <span class="built_in">str</span> = ArgPlainText(<span class="params"><span class="string">&quot;username&quot;</span></span>)</span>):</span><br><span class="line">    username = <span class="built_in">str</span>(username)</span><br><span class="line">    user_id = event.user_id</span><br><span class="line"></span><br><span class="line">    pattern = <span class="string">r&#x27;^[a-zA-Z0-9_]+$&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> re.<span class="keyword">match</span>(pattern, username):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        extra.settimeout()</span><br><span class="line">        <span class="keyword">await</span> bind.finish(<span class="string">f&quot;用户名只可以包括英文字母，数字，下划线&quot;</span>)</span><br><span class="line">...</span><br><span class="line">    binduser(username)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> bind.finish(<span class="string">f&quot;<span class="subst">&#123;username&#125;</span> 绑定成功（若仍无法进入服务器，可尝试发送“正常流程绑定”）&quot;</span>)</span><br><span class="line">    <span class="comment"># 即用whitelist add</span></span><br><span class="line">            </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binduser</span>(<span class="params">playername</span>):</span><br><span class="line">    offline_uuid = <span class="built_in">str</span>(extra.touuid(playername))</span><br><span class="line">    <span class="comment">#offline_uuid = offline_uuid_raw[:8] + &quot;-&quot; + offline_uuid_raw[8:12] + &quot;-&quot; + offline_uuid_raw[12:16] + &quot;-&quot; + offline_uuid_raw[16:20] + &quot;-&quot; + offline_uuid_raw[20:]</span></span><br><span class="line">    <span class="comment">#读取 ***\whitelist.json,找到playername对应的uuid，用offline_uuid替换</span></span><br><span class="line">    whitelist_file_path = <span class="string">r&quot;Z:\server\whitelist.json&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(whitelist_file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 先尝试是否能找到对应玩家名称的条目，并替换uuid字段，如果没有，则新增</span></span><br><span class="line">    found = <span class="literal">False</span> <span class="comment"># 定义一个变量，用来标记是否找到了对应的玩家条目</span></span><br><span class="line">    <span class="keyword">for</span> player <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> player[<span class="string">&quot;name&quot;</span>] == playername:</span><br><span class="line">            player[<span class="string">&quot;uuid&quot;</span>] = offline_uuid <span class="comment"># 替换uuid字段</span></span><br><span class="line">            found = <span class="literal">True</span> <span class="comment"># 将变量设为True，表示找到了对应的玩家条目</span></span><br><span class="line">            <span class="keyword">break</span> <span class="comment"># 跳出循环，不再继续查找</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found: <span class="comment"># 如果变量为False，表示没有找到对应的玩家条目</span></span><br><span class="line">        data.append(&#123;<span class="string">&quot;name&quot;</span>: playername, <span class="string">&quot;uuid&quot;</span>: offline_uuid&#125;) <span class="comment"># 在data列表中添加一个新的字典，包含玩家的名字和uuid</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将修改后的内容写回whitelist.json文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(whitelist_file_path, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(data, f)</span><br><span class="line">    <span class="comment"># 调用外部命令来重载白名单</span></span><br><span class="line">    client.connect()</span><br><span class="line">    command = <span class="string">&quot;whitelist reload&quot;</span></span><br><span class="line">    response = client.command(command)</span><br><span class="line">    client.disconnect()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>mchelper\extra.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="comment">#该函数用于计算离线用户的uuid</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">touuid</span>(<span class="params">name</span>):</span><br><span class="line">    name = <span class="string">&quot;OfflinePlayer:&quot;</span> + name</span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(name.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    md5_bytes = md5.digest()</span><br><span class="line"></span><br><span class="line">    md5_bytes = <span class="built_in">bytearray</span>(md5_bytes) </span><br><span class="line"></span><br><span class="line">    md5_bytes[<span class="number">6</span>] &amp;= <span class="number">0x0f</span></span><br><span class="line">    md5_bytes[<span class="number">6</span>] |= <span class="number">0x30</span></span><br><span class="line">    md5_bytes[<span class="number">8</span>] &amp;= <span class="number">0x3f</span></span><br><span class="line">    md5_bytes[<span class="number">8</span>] |= <span class="number">0x80</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> uuid.UUID(<span class="built_in">bytes</span>=<span class="built_in">bytes</span>(md5_bytes))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>解绑：</strong>其实差不了多少</p><figure class="highlight python"><figcaption><span>mchelper\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">debinduser</span>(<span class="params">playername</span>):</span><br><span class="line">    offline_uuid = <span class="built_in">str</span>(extra.touuid(playername))</span><br><span class="line">    whitelist_file_path = <span class="string">r&quot;Z:\server\whitelist.json&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(whitelist_file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> player <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> player[<span class="string">&quot;name&quot;</span>] == playername:</span><br><span class="line">            data.remove(player) <span class="comment"># 移除该条目</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将修改后的内容写回whitelist.json文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(whitelist_file_path, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(data, f)</span><br><span class="line">    <span class="comment"># 调用外部命令来重载白名单</span></span><br><span class="line">    client.connect()</span><br><span class="line">    command = <span class="string">&quot;whitelist reload&quot;</span></span><br><span class="line">    response = client.command(command)</span><br><span class="line">    client.disconnect()</span><br></pre></td></tr></table></figure><p><strong>图片上传：</strong></p><pre class="mermaid">flowchart LR    A[User] -->|"@BOT+图片"| B["nb2-mchelper"]    B <-->|"upgit"| C("pic.hzchu.top(lysk pro)")    B --> D["MySQL"]</pre><figure class="highlight python"><figcaption><span>mchelper\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">upphoto = on_message(rule=to_me(), priority=<span class="number">5</span>, block=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@upphoto.handle()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_upphoto</span>(<span class="params">bot: Bot, event: GroupMessageEvent, state: T_State</span>):</span><br><span class="line">    user_id = event.user_id</span><br><span class="line">    message = <span class="built_in">str</span>(event.get_message())</span><br><span class="line">    conn = mysql.connector.connect(**DATABASE)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(message)</span></span><br><span class="line">    <span class="keyword">if</span> message:</span><br><span class="line">        <span class="keyword">if</span> matches:</span><br><span class="line">            pattern = <span class="string">r&quot;\[CQ:image,file=\w+\.image,subType=\d+,url=(https?://\S+?)]&quot;</span></span><br><span class="line">            matches = re.findall(pattern, message)</span><br><span class="line">            current_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime(time.time()))</span><br><span class="line">            <span class="comment"># print(matches)</span></span><br><span class="line">            <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">                <span class="comment"># print(match)</span></span><br><span class="line">                </span><br><span class="line">                file_name =  <span class="built_in">str</span>(user_id) + <span class="built_in">str</span>(time.time() * <span class="number">1000</span>)+<span class="string">&quot;.jpg&quot;</span></span><br><span class="line">                save_path = <span class="string">&#x27;./tmp/&#x27;</span> + file_name</span><br><span class="line">                response = requests.get(<span class="keyword">match</span>, stream=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(save_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                        <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(<span class="number">1024</span>):</span><br><span class="line">                            file.write(chunk)</span><br><span class="line">                    path = <span class="string">&quot;Z:\\nb2\\mc\\tmp\\&quot;</span> + file_name</span><br><span class="line">                    response = extra.upload_image(path)</span><br><span class="line">                    <span class="keyword">if</span> response.startswith(<span class="string">&quot;https://&quot;</span>):</span><br><span class="line">                        url = response</span><br><span class="line">                        c = conn.cursor()</span><br><span class="line">                        c.execute(<span class="string">&quot;INSERT INTO photo VALUES (%s,%s,%s,%s,%s)&quot;</span>, (<span class="literal">None</span>, <span class="built_in">str</span>(event.sender.card),user_id, current_time, url))</span><br><span class="line">                        conn.commit()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        conn.disconnect()</span><br><span class="line">                        <span class="keyword">await</span> upphoto.finish(<span class="string">&quot;上传失败（调用上传工具错误）&quot;</span>)</span><br><span class="line">                    os.remove(path)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    conn.disconnect()</span><br><span class="line">                    <span class="keyword">await</span> upphoto.finish(<span class="string">&quot;上传失败(请求图片错误)&quot;</span>)</span><br><span class="line">            conn.disconnect()</span><br><span class="line">            <span class="keyword">await</span> upphoto.finish(<span class="string">&quot;上传成功&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            conn.disconnect()</span><br><span class="line">            <span class="keyword">return</span>  <span class="comment"># 没有图片链接，不执行回复操作</span></span><br></pre></td></tr></table></figure><p><strong>聊天记录同步：</strong></p><figure class="highlight python"><figcaption><span>send\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nonebot <span class="keyword">import</span> on_message, logger</span><br><span class="line"><span class="keyword">from</span> nonebot.adapters.onebot.v11 <span class="keyword">import</span> GroupMessageEvent, Bot,MessageSegment</span><br><span class="line"><span class="keyword">from</span> nonebot.rule <span class="keyword">import</span> startswith</span><br><span class="line"><span class="keyword">from</span> nonebot <span class="keyword">import</span> get_driver</span><br><span class="line"><span class="keyword">import</span> mcrcon</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msg_matcher = on_message(priority=<span class="number">10</span>, block=<span class="literal">False</span>)</span><br><span class="line">client = mcrcon.MCRcon(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;******&#x27;</span>, <span class="number">2</span>***<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendcommand</span>(<span class="params">command</span>):</span><br><span class="line">    response = client.command(command)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@msg_matcher.handle()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_</span>(<span class="params">bot: Bot, event: GroupMessageEvent</span>):</span><br><span class="line">    <span class="keyword">if</span> event.group_id == <span class="number">790118052</span>:</span><br><span class="line">        nick = <span class="built_in">str</span>(event.sender.card)</span><br><span class="line">        <span class="keyword">if</span> nick == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            nick = <span class="built_in">str</span>(event.sender.nickname)</span><br><span class="line">        msg = nick+<span class="string">&quot;:&quot;</span>+replace(event.message)</span><br><span class="line">        qqqq = <span class="string">&quot;[Q群]&quot;</span></span><br><span class="line">        msg =<span class="string">f&#x27;[&#123;&#123;&quot;text&quot;:&quot;<span class="subst">&#123;qqqq&#125;</span>&quot;,&quot;color&quot;:&quot;gold&quot;&#125;&#125;,&#123;&#123;&quot;text&quot;:&quot;<span class="subst">&#123;msg&#125;</span>&quot;,&quot;color&quot;:&quot;white&quot;&#125;&#125;]&#x27;</span></span><br><span class="line">        command=<span class="string">f&quot;tellraw @a [<span class="subst">&#123;msg&#125;</span>]&quot;</span></span><br><span class="line">        <span class="comment"># print(command)</span></span><br><span class="line">        sendcommand(command)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个函数，接受一个文本参数，返回替换后的文本</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">replace</span>(<span class="params">text</span>):</span><br><span class="line">  text = <span class="built_in">str</span>(text)</span><br><span class="line"></span><br><span class="line">  image_pattern = <span class="string">r&quot;\[CQ:image,file=.+?image,subType=0,url=.+?\]&quot;</span></span><br><span class="line"></span><br><span class="line">  at_pattern = <span class="string">r&quot;\[CQ:at,qq=\d+\]&quot;</span></span><br><span class="line"></span><br><span class="line">  picface_pattern = <span class="string">r&quot;\[CQ:image,file=.+?image,subType=1,url=.+?\]&quot;</span></span><br><span class="line">  face_pattern = <span class="string">r&quot;\[CQ:face,id=.+?]&quot;</span></span><br><span class="line"></span><br><span class="line">  record_pattern = <span class="string">r&quot;\[CQ:record,file=.+?amr,url=.+?\]&quot;</span></span><br><span class="line">  redbag_pattern = <span class="string">r&quot;\[CQ:redbag,title=.+?\]&quot;</span></span><br><span class="line">  shit_pattern = <span class="string">r&quot;请使用最新版手机QQ体验新功能&quot;</span></span><br><span class="line"></span><br><span class="line">  result = re.sub(image_pattern, <span class="string">&quot;[图片]&quot;</span>, text)</span><br><span class="line"></span><br><span class="line">  result = re.sub(picface_pattern, <span class="string">&quot;[图片表情]&quot;</span>, result)</span><br><span class="line">  result = re.sub(face_pattern, <span class="string">&quot;[表情]&quot;</span>, result)</span><br><span class="line">  result = re.sub(at_pattern, <span class="string">&quot;@&quot;</span>, result)</span><br><span class="line"></span><br><span class="line">  result = re.sub(record_pattern, <span class="string">&quot;[语音]&quot;</span>, result)</span><br><span class="line"></span><br><span class="line">  result = re.sub(redbag_pattern, <span class="string">&quot;[红包]&quot;</span>, result)</span><br><span class="line"></span><br><span class="line">  result = re.sub(shit_pattern, <span class="string">&quot;不支持的信息类型&quot;</span>, result)</span><br><span class="line">  result = result.replace(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;《&quot;</span>).replace(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;》&quot;</span>)</span><br><span class="line">  <span class="comment"># 返回替换后的结果</span></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connectagain</span>():</span><br><span class="line">    client.connect()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_timer</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 每5分钟执行一次</span></span><br><span class="line">        time.sleep(<span class="number">5</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="comment"># 在后台线程中执行需要定时执行的函数</span></span><br><span class="line">        threading.Thread(target=connectagain).start()</span><br><span class="line"><span class="comment"># 避免重复执行使得后台刷屏</span></span><br><span class="line">connectagain()</span><br><span class="line">timer_thread = threading.Thread(target=run_timer)</span><br><span class="line">timer_thread.daemon = <span class="literal">True</span></span><br><span class="line">timer_thread.start()</span><br></pre></td></tr></table></figure><div class="tag-plugin quot"><h3 class="content" id="杂项" type="icon"><a href="#杂项" class="headerlink" title="杂项"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" /><span class="text">杂项</span><span class="empty"></span></h3></div><ol><li>备份相关：</li></ol><p>由于之前存档炸过一次，相关的备份措施也随之建立起来。可分为主动式和被动式。主动式嘛，好说，不就是手动关掉自动保存然后压缩到一个独立硬盘嘛</p><p>被动的话就是用Syncthing进行单向同步，目前，我设置了2台设备用于备份</p><pre class="mermaid">flowchart LR    A[Game Server] -->|"有更改时同步"| B("B Server")    A[Game Server] -->|"2h全部同步"| C    C("A Server")-->|"有更改时同步"|B</pre><p>也用过git，但同步太耗性能了，遂放弃</p><ol start="2"><li>自动节能</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> mcstatus <span class="keyword">import</span> JavaServer</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">BALANCE = <span class="string">&#x27;381b4222-f694-41f0-9685-ff5bb260df2e&#x27;</span></span><br><span class="line">HIGH_PERFORMANCE = <span class="string">&#x27;8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c&#x27;</span></span><br><span class="line">ENERGY_SAVER = <span class="string">&#x27;a1841308-3541-4fab-bc81-f71556f20b4a&#x27;</span></span><br><span class="line">redis_client = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">server = JavaServer.lookup(<span class="string">&quot;127.0.0.1:26565&quot;</span>)</span><br><span class="line">people = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_power_plan</span>(<span class="params">plan</span>):</span><br><span class="line">    subprocess.run(<span class="string">f&#x27;powercfg /S <span class="subst">&#123;plan&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_power_plan</span>():</span><br><span class="line">    output = subprocess.run(<span class="string">&quot;powercfg /GETACTIVESCHEME&quot;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE).stdout.decode(<span class="string">&quot;GBK&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> output.split(<span class="string">&quot; &quot;</span>)[-<span class="number">3</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">what_power_plan</span>(<span class="params">plan</span>):</span><br><span class="line">    <span class="keyword">if</span> plan == BALANCE:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BALANCE&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> plan == ENERGY_SAVER:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ENERGY_SAVER&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> plan == HIGH_PERFORMANCE:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HIGH_PERFORMANCE&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">what_power_planid</span>(<span class="params">plan</span>):</span><br><span class="line">    <span class="keyword">if</span> plan == <span class="string">&quot;BALANCE&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> BALANCE</span><br><span class="line">    <span class="keyword">elif</span> plan == <span class="string">&quot;ENERGY_SAVER&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> ENERGY_SAVER</span><br><span class="line">    <span class="keyword">elif</span> plan == <span class="string">&quot;HIGH_PERFORMANCE&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> HIGH_PERFORMANCE</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    current_time = time.strftime(<span class="string">&quot;%H:%M:%S&quot;</span>, time.localtime())</span><br><span class="line">    plan = get_power_plan()</span><br><span class="line">    mcserve_plan = redis_client.get(<span class="string">&#x27;powerplan&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> mcserve_plan <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        cpu_percent = psutil.cpu_percent()</span><br><span class="line">        status = server.status()</span><br><span class="line">        hour = <span class="built_in">int</span>(current_time.split(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> hour &gt;= <span class="number">0</span> <span class="keyword">and</span> hour &lt;= <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">if</span> plan != ENERGY_SAVER:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：切换到节能模式&quot;</span>)</span><br><span class="line">                change_power_plan(ENERGY_SAVER)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> status.players.online &gt; <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> plan != HIGH_PERFORMANCE:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：多人，切换到高性能模式&quot;</span>)</span><br><span class="line">                change_power_plan(HIGH_PERFORMANCE)</span><br><span class="line">        <span class="keyword">elif</span> status.players.online &gt; people:</span><br><span class="line">            <span class="keyword">if</span> plan != BALANCE:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：有人，切换到平衡模式&quot;</span>)</span><br><span class="line">                change_power_plan(BALANCE)</span><br><span class="line">        <span class="keyword">elif</span> cpu_percent &gt; <span class="number">70</span>:</span><br><span class="line">            <span class="keyword">if</span> plan != HIGH_PERFORMANCE:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：CPU占用过高，切换到平衡模式&quot;</span>)</span><br><span class="line">                change_power_plan(BALANCE)</span><br><span class="line">        <span class="keyword">elif</span> status.players.online &lt;= people:</span><br><span class="line">            <span class="keyword">if</span> plan != ENERGY_SAVER:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：无人，切换到节能模式&quot;</span>)</span><br><span class="line">                change_power_plan(ENERGY_SAVER)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> plan != BALANCE:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：切换到平衡模式&quot;</span>)</span><br><span class="line">                change_power_plan(BALANCE)</span><br><span class="line">    <span class="keyword">if</span> mcserve_plan <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        decoded_mcserve_plan = mcserve_plan.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> what_power_plan(plan) == decoded_mcserve_plan:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            power_plan_id = what_power_planid(decoded_mcserve_plan)</span><br><span class="line">            change_power_plan(power_plan_id)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(current_time) + <span class="string">&quot;：MCSERVE覆盖配置，切换到&quot;</span> + decoded_mcserve_plan + <span class="string">&quot;计划&quot;</span>)</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">300</span>)</span><br></pre></td></tr></table></figure><pre class="mermaid">graph TB    A["开始"]    B{"获取mcserve_plan"}    C{"mcserve_plan为空"}    D["获取当前时间、电源计划、CPU占用率和服务器状态"]    E{"时间在0-5点"}    F{"在线人数大于3"}    G{"在线人数大于1"}    H{"CPU占用率大于70%"}    I{"在线人数小于等于1"}    J["切换到节能模式"]    K["切换到高性能模式"]    L["切换到平衡模式"]    M["切换到节能模式"]    N["切换到平衡模式"]    O{"mcserve_plan不为空"}    Q["根据mcserve_plan切换电源计划"]    R["结束"]    A-->B    B-->C    C--是-->D    D-->E    E--是-->J    E--否-->F    F--是-->K    F--否-->G    G--是-->L    G--否-->H    H--"是（后来临时修改）"-->L    H--否-->I    I--是-->M    I--否-->N    C--否-->O    O--是-->R    O--否-->Q    Q-->R</pre><blockquote><p>注：在部分情况下（如E5）使用高性能模式会使单核最高睿频下降，反而不利，可自行抉择</p></blockquote><ol start="3"><li>未开发完成功能</li></ol><ul><li><strong>[WEB]小黑屋：</strong> 在实行<code>白名单</code>后破坏性外挂直接绝迹，直接鸽了。</li><li><strong>[WEB]假人管理：</strong>后来人也绝迹了，鸽</li><li><strong>[WEB]成就：</strong>鸽</li><li><strong>[WEB]自检：</strong> 用于检查一开始结构图中各个部分的运行情况，后来发现都正常的很，遂鸽.</li><li><strong>[MCDR]实体追踪器：</strong>鸽</li></ul><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>​逝去的事物，只是换了个形式陪伴在你我身边。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatheart.png"/></span></p><p>​<strong>相册（多图预警）</strong></p><div class="tag-plugin gallery grid-box" size="mix" ratio="square"><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/06/22/6494658d39c93.webp" alt="THEOSMANTHUSWINE()_1687446921569.9314.webp"/><div class="image-meta"><span class="image-caption">THEOSMANTHUSWINE()_1687446921569.9314.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/06/22/6494678037ccc.webp" alt="H_Skippy（原Yangyyx）()_1687447421090.0547.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447421090.0547.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/06/22/649467851b891.webp" alt="H_Skippy（原Yangyyx）()_1687447425470.0432.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447425470.0432.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/06/22/649467889d7bc.webp" alt="H_Skippy（原Yangyyx）()_1687447430099.4773.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447430099.4773.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/06/22/6494678b7dfa4.webp" alt="H_Skippy（原Yangyyx）()_1687447433416.5522.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447433416.5522.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/06/22/6494678e5d823.webp" alt="H_Skippy（原Yangyyx）()_1687447436391.867.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447436391.867.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/06/22/649467915a61f.webp" alt="H_Skippy（原Yangyyx）()_1687447439140.172.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447439140.172.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/06/22/64946794e9347.webp" alt="H_Skippy（原Yangyyx）()_1687447442236.669.webp"/><div class="image-meta"><span class="image-caption">H_Skippy（原Yangyyx）()_1687447442236.669.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9ed6c50c22.webp" alt="2644.webp"/><div class="image-meta"><span class="image-caption">2644.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9ed9c3ad38.webp" alt="726.webp"/><div class="image-meta"><span class="image-caption">726.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9ed9f54362.webp" alt="821.webp"/><div class="image-meta"><span class="image-caption">821.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9eda62b4d3.webp" alt="192.webp"/><div class="image-meta"><span class="image-caption">192.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/09/64a9eda98c3bd.webp" alt="1228.webp"/><div class="image-meta"><span class="image-caption">1228.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/09/64aa6b4872aab.webp" alt="5107.webp"/><div class="image-meta"><span class="image-caption">5107.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/09/64aa6b4e18551.webp" alt="2917.webp"/><div class="image-meta"><span class="image-caption">2917.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/09/64aa966c95dda.webp" alt="8945.webp"/><div class="image-meta"><span class="image-caption">8945.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/16/64b3d29485703.webp" alt="1045.webp"/><div class="image-meta"><span class="image-caption">1045.webp</span></div></div><div class="grid-cell"><img data-fancybox="gallery-1" src="https://onep.hzchu.top/mount/pic/2023/07/18/64b6a0da75e70.webp" alt="9756.webp"/><div class="image-meta"><span class="image-caption">9756.webp</span></div></div></div>]]></content>
    
    
    <summary type="html">纪念一下~</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.hzchu.top/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="python" scheme="https://blog.hzchu.top/tags/python/"/>
    
    <category term="MC" scheme="https://blog.hzchu.top/tags/MC/"/>
    
  </entry>
  
  <entry>
    <title>Mirouterui简要部署指南</title>
    <link href="https://blog.hzchu.top/2023/howtorunmrui/"/>
    <id>https://blog.hzchu.top/2023/howtorunmrui/</id>
    <published>2023-08-28T15:25:56.000Z</published>
    <updated>2023-08-28T15:25:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>该项目是由于我厌倦了管理后台和APP的卡顿而写的，因此项目开发之初就<strong>不考虑集成在管理后台</strong>，做成一个<strong>独立</strong>的页面，并实现跨平台。</p><p>并且，调用的都是小米路由器<strong>独有</strong>的api接口，与Openwrt<strong>完全不兼容</strong>。</p><p>用于测试的只有r1d和r4a，对于别的型号的支持，还得看大家的反馈才能完善。</p><p>感谢<code>YSC6666，黑衣剑士z，Super丶聪(@bilibili)</code>的帮助</p><p>代码开源在 <a href="https://github.com/Mirouterui/">https://github.com/Mirouterui/</a> ，欢迎 star&amp;提prヾ(≧▽≦*)o</p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/Mirouterui/mirouter-ui"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=Mirouterui&repo=mirouter-ui&theme=white&show_owner=true"/></a></div><blockquote><p>碍于实际需求，拿一台瘦客户机装了个ikuai，这个项目先鸽了</p></blockquote><h2 id="面板展示"><a href="#面板展示" class="headerlink" title="面板展示"></a>面板展示</h2><div class="tag-plugin tabs" align="center"id="tab_1"><div class="nav-tabs"><div class="tab active"><a href="#tab_1-1">首页</a></div><div class="tab"><a href="#tab_1-2">路由器详情</a></div><div class="tab"><a href="#tab_1-3">设备列表</a></div><div class="tab"><a href="#tab_1-4">设备详情</a></div><div class="tab"><a href="#tab_1-5">温度显示（仅支持部分设备）</a></div><div class="tab"><a href="#tab_1-6">历史数据统计</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_1-1"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda7065545f.webp" alt="首页"></p></div><div class="tab-pane" id="tab_1-2"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda5d44eefa.webp" alt="路由器详情"></p></div><div class="tab-pane" id="tab_1-3"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda5d0ed93e.webp" alt="设备列表"></p></div><div class="tab-pane" id="tab_1-4"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda5d396d7e.webp" alt="设备详情"></p></div><div class="tab-pane" id="tab_1-5"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda75443b5e.webp" alt="温度显示"></p></div><div class="tab-pane" id="tab_1-6"><p><img src="https://onep.hzchu.top/mount/pic/2023/12/16/657da564382fb.webp" alt="history_index.webp"></p></div></div></div><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><blockquote><p>小米路由器是基于Openwrt的，故下文Openwrt仅指小米路由器<br>附：<br>​<img src="https://onep.hzchu.top/mount/pic/2023/08/28/64ec662280acf.webp"></p></blockquote><div class="tag-plugin tabs" align="center"id="tab_2"><div class="nav-tabs"><div class="tab active"><a href="#tab_2-1">Windows</a></div><div class="tab"><a href="#tab_2-2">Openwrt</a></div><div class="tab"><a href="#tab_2-3">Docker</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_2-1"><p>从<a href="https://github.com/thun888/mirouter-ui/releases/">Release</a>下载对应的架构的发行版</p><blockquote><p>64位：amd64，32位：i386，arm: arm</p><p>可访问<a href="https://h5ai.hzchu.top/Mirouter-ui/">镜像站</a>以获取更快的速度</p></blockquote><p>然后运行，程序会自动下载配置文件，在其中填上密码即可。配置文件中其它条目在下面</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64ed9a2394601.gif"></p><p>再次运行，等待下载页面静态文件，若能支持获取token即为成功</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64ed9a23945b0.gif"></p><blockquote><p>部分设备出现无法运行&amp;无法找到配置文件可使用“不使用upx压缩”版本（即带<code>_noupx</code>后缀的版本）</p></blockquote></div><div class="tab-pane" id="tab_2-2"><p>从<a href="https://d.hzchu.top/e">Release</a>复制对应的架构的发行版的下载链接</p><blockquote><p>使用<code>uname –a</code>查看架构（如果为<code>armv7l</code>，考虑使用<code>armv5</code>版本）</p></blockquote><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64ed9b78dbe91.webp" alt="R1D"></p><p>运行：</p><blockquote><p>curl –L yourlink –o mirouterui</p><p>chmod 777 mirouterui</p><p>.&#x2F;mirouterui</p></blockquote><p>程序会自动下载配置文件，在其中填上密码即可。配置文件中其它条目在下面。.</p><p>再次运行，等待下载页面静态文件</p><p>若能支持获取token即为成功</p><p><strong>常见问题：</strong></p><ol><li>无法下载配置文件，<del>路由器太老了</del></li></ol><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64ed9e59288c3.webp"></p><blockquote><p>使用 <code>curl https://mruiapi.hzchu.top/downloadconfig -o config.json</code> 手动下载</p></blockquote><ol start="2"><li>无法下载配置文件</li></ol><p>从<a href="https://d.hzchu.top/d">Mirouterui&#x2F;static: 前端静态文件 (github.com)</a>下载，并解压到<code>static</code>目录</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda04788f04.webp"></p></div><div class="tab-pane" id="tab_2-3"><p>命令：</p><blockquote><p>docker run -d -p 6789:6789 -v $(pwd):&#x2F;app&#x2F;data –name mirouter-ui –restart&#x3D;always thun888&#x2F;mirouter-ui</p></blockquote><p>新建一个文件夹，并在该文件夹里运行上述命令，程序会在该文件夹里生成配置文件，修改即可</p><p>修改完成后重启该容器（或等待自动重启）</p></div></div></div><p>最后命令窗口中会显示网页的访问端口，使用设备的<code>ip地址+端口号(6789)</code>访问面板</p><h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><ol><li><p>密码正确，但无法登陆：尝试获取自己路由器的key，可参考<a href="https://d.hzchu.top/c">视频</a>或使用<a href="https://d.hzchu.top/b">自动工具</a></p></li><li><p>CPU占用为0： 受api限制，新版路由器无法正常获取，可尝试将其部署在路由器上</p></li><li><p>温度显示： 目前API模式只支持R1D,R2D,命令模式只支持红米AX6和R1D</p></li><li><p>设备显示不全： 当设备过多时，首页只会显示当前有网络活动的设备，请进入设备详细列表查看</p></li><li><p>在线前端无法使用： 受浏览器安全限制，需关闭访问私有ip限制</p></li></ol><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda267463b1.webp" alt="Chrome"></p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/29/64eda26a747a5.webp" alt="Edge"></p><h3 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h3><p><img src="https://onep.hzchu.top/mount/pic/2023/12/16/657da76badee9.webp" alt="config"></p><table><thead><tr><th>配置名</th><th>默认值</th><th>解释</th></tr></thead><tbody><tr><td>dev</td><td>[]</td><td>路由器信息，参阅<code>dev项</code></td></tr><tr><td>history</td><td>[]</td><td>历史记录相关功能，参阅<code>history项</code></td></tr><tr><td>tiny</td><td>false</td><td>启用后，不再下载静态文件，需搭配<a href="http://mrui.hzchu.top:8880/">在线前端</a>使用</td></tr><tr><td>netdata_routerid</td><td>0</td><td>调用netdata api时返回的路由器（对应dev项中第n个）</td></tr><tr><td>flushTokenTime</td><td>1800</td><td>刷新token时间间隔(s)</td></tr><tr><td>port</td><td>6789</td><td>网页页面端口号</td></tr><tr><td>debug</td><td>true</td><td>debug模式，建议在测试正常后关闭</td></tr></tbody></table><p><strong>dev</strong>项：</p><table><thead><tr><th>配置名</th><th>默认值</th><th>解释</th></tr></thead><tbody><tr><td>password</td><td></td><td>路由器管理后台密码</td></tr><tr><td>key</td><td>a2ffa5c9be07488bbb04a3a47d3c5f6a</td><td>路由器管理后台key</td></tr><tr><td>ip</td><td>192.168.31.1</td><td>路由器IP</td></tr><tr><td>routerunit</td><td>false</td><td>启用后，程序通过<code>gopsutil</code>库获取CPU占用</td></tr></tbody></table><p><strong>history</strong>项：</p><table><thead><tr><th>配置名</th><th>默认值</th><th>解释</th></tr></thead><tbody><tr><td>enable</td><td>false</td><td>是否启用历史数据统计</td></tr><tr><td>sampletime</td><td>300</td><td>采样时间间隔(s)</td></tr><tr><td>maxsaved</td><td>8640</td><td>最多记录条数</td></tr></tbody></table><p>命令行参数：</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–config</td><td>配置文件路径，默认为“.&#x2F;config.json”</td></tr><tr><td>–basedirectory</td><td>基础目录路径，在里面存放静态文件</td></tr><tr><td>–databasepath</td><td>数据库路径，默认为“.&#x2F;database.db”</td></tr></tbody></table><h3 id="后台运行"><a href="#后台运行" class="headerlink" title="后台运行"></a>后台运行</h3><p>注册为系统服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/mrui.service</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=mrui</span><br><span class="line"><span class="attr">After</span>=network.target network-<span class="literal">on</span>line.target</span><br><span class="line"><span class="attr">Requires</span>=network-<span class="literal">on</span>line.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">ExecStart</span>=/pathto/mrui</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>设置开机自启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> mrui</span><br></pre></td></tr></table></figure><p>管理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看状态：systemctl status mrui</span><br><span class="line">启动：sudo systemctl start mrui</span><br><span class="line">停止：sudo systemctl stop mrui</span><br><span class="line">重启：sudo systemctl restart mrui</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/fps2tao/p/16433588.html">windows守护进程工具–nssm详解  - 博客园 (cnblogs.com)</a></p><h2 id="Stars"><a href="#Stars" class="headerlink" title="Stars~"></a>Stars~</h2><p><a href="https://d.hzchu.top/7"><img src="https://starchart.cc/mirouterui/mirouter-ui.svg" alt="Stars~"></a></p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ul><li><input checked="" disabled="" type="checkbox"> 历史数据统计</li><li><input checked="" disabled="" type="checkbox"> 深色模式</li><li><input checked="" disabled="" type="checkbox"> 多路由支持</li><li><input checked="" disabled="" type="checkbox"> 快捷更新</li><li><input disabled="" type="checkbox"> 设备小工具</li><li><input checked="" disabled="" type="checkbox"> netdata，api形式兼容</li></ul><p><a href="https://bbs.hzchu.top/d/2-mruikai-fa-gui-hua">MRUI开发规划</a></p><blockquote><p>主要功能已完成开发,接下来随缘更新😶‍🌫️</p></blockquote><h2 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h2><div class="tag-plugin timeline ds-timeline" api="https://cfproxy.hzchu.top/https://api.github.com/repos/Mirouterui/mirouter-ui/releases?per_page=3"></div>]]></content>
    
    
    <summary type="html">基于小米路由器API的展示面板</summary>
    
    
    
    
    <category term="Mirouterui" scheme="https://blog.hzchu.top/tags/Mirouterui/"/>
    
  </entry>
  
  <entry>
    <title>基于Onedrive的高可用性图床</title>
    <link href="https://blog.hzchu.top/2023/photoononedrive/"/>
    <id>https://blog.hzchu.top/2023/photoononedrive/</id>
    <published>2023-07-31T11:53:17.000Z</published>
    <updated>2023-07-31T11:53:17.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><div class="tag-plugin colorful note" color="yellow"><div class="body"><p>重写中。。。</p></div></div><p>一直以来，我都在尝试各种图片存储方案，一开始便是经典的Github+jsd，但考虑到违反了tos后面就用了cf+b2，但速度不尽人意。后来用了vercel反代gh和一些杂七杂八的，但换汤不换药嘛，还是不靠谱。</p><span id="more"></span><p>在差不多一年前，我在捣鼓网心云时想到个主意：何不用家里电脑作为图片存储，通过非标准端口访问绕过备案要求。于是在<a href="https://notes.hzchu.top/">随记</a>上提出个简易pcdn的想法</p><p><img src="https://onep.hzchu.top/mount/pic/cf1/2022/08/29/630c0d1c1087e.webp"></p><p>不过像我这种小站没必要搞那么重量级了，于是改进了下</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p><img src="https://onep.hzchu.top/mount/pic/2023/08/01/64c90aaccffac.webp"></p><p>首先，本质上是个缓存服务，存储在OneDrive（下文简称od），通过各个节点分发图片，<del>就是给od套了个CDN嘛</del>。</p><p>因为我这网站也没多少流量，并发不高，我更倾向葫芦娃救爷爷式的单节点当主力，挂了再切换到其它节点的方式。</p><p>最后就是轻量，总不能把od下放到每个节点吧。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatneutral.png"/></span></p><p>故：</p><ol><li>设立一个“主服务器”，用来将od的内容分发到节点，可以用无服务器函数，也可以直接和”图床服务器“合并。同时因为服务器间同步有延时，在”图床服务器“要留个口直接下载刚刚上传的图片。</li><li>设立一个”副服务器“，负责检测节点状况和跳转到对应节点。</li><li>”图床服务器“：使用lsky-pro作为图床程序，将od使用rclone挂载到对应的存储策略文件夹上。</li><li>节点：获取访问的链接，检查本地有无缓存，有就返回，没有就下载再返回。考虑到要用php的话配置起来麻烦，直接用py了。</li></ol><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><ol><li>服务器 &gt;&#x3D;1台，最好是访问速度快的</li><li>一个微软账户（我这里用的是E5订阅账户）</li><li><em>有公网IP的家庭宽带（可选）</em></li></ol><p>在od中新建<code>/share/mount</code>目录，若自行更改请注意将下文涉及的地方一起修改</p><p>推荐使用Linux，如果使用Windows下文操作将有所不同，需自行更改</p><h3 id="安装（图床服务器）"><a href="#安装（图床服务器）" class="headerlink" title="安装（图床服务器）"></a>安装（图床服务器）</h3><p>首先完成“图床服务器”的搭建。</p><h4 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h4><h5 id="libfuse"><a href="#libfuse" class="headerlink" title="libfuse"></a>libfuse</h5><p>安装<code>meson ninja</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install meson ninja</span><br></pre></td></tr></table></figure><a class="tag-plugin colorful hashtag" color="red" href="https://blog.csdn.net/qq_38980655/article/details/86579348"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>安装pip的三种方法</span></a><p>从 <a href="https://github.com/libfuse/libfuse/releases">https://github.com/libfuse/libfuse/releases</a> 下载libfuse的源码</p><p>解压，创建一个（临时）构建目录，然后 运行<code>meson</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar xzf fuse-3.15.1.tar.gz; <span class="built_in">cd</span> fuse-3.15.1/</span><br><span class="line"><span class="built_in">mkdir</span> build; <span class="built_in">cd</span> build</span><br><span class="line">meson setup ..</span><br></pre></td></tr></table></figure><blockquote><p>3.15.1 替换为对应的releases版本</p></blockquote><p>运行<code>ninja</code>进行安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ninja install</span><br></pre></td></tr></table></figure><h5 id="rclone"><a href="#rclone" class="headerlink" title="rclone"></a>rclone</h5><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://rclone.org/install.sh | sudo bash</span><br></pre></td></tr></table></figure><blockquote><p>同时在本地也要安装，用来获取token</p></blockquote><p>在本地运行rclone config进行配置</p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c78ef1d6bdd.webp"></p><p>把token复制出来备用（token包括两端的{}）</p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c78ee02488b.webp"></p><p>在服务端进行同样的操作，但在<code>Edit advanced config</code>中填<code>y</code></p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c78d2be701c.webp" alt="image-20230731182953894"></p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c78d6802369.webp" alt="image-20230731183101473"></p><p>然后一路回车，在<code>Already have a token - refresh?</code>填<code>n</code></p><p>然后按要求填写</p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c790cd11e2f.webp"></p><blockquote><p>会自动获取drive_id,drive_type，不要回车太快按过了</p></blockquote><p>挂载试试吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> mount</span><br><span class="line">rclone mount one:/share/mount/ ./mount/</span><br></pre></td></tr></table></figure><p>不出意外你能看见这个报错<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatbox.png"/></span></p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c791e12d260.webp"></p><p>打开报错涉及的文件，取消注释，保存</p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c791ad2e565.webp"></p><p>再试下，如果没报错就可以了</p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7b69648695.webp"></p><blockquote><p>新建的mount文件夹在下文没有作用，建议删除~</p><p>使用fusermount -qzu mount 卸载</p></blockquote><h5 id="LNMP"><a href="#LNMP" class="headerlink" title="LNMP"></a>LNMP</h5><p>不用多说</p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><h5 id="图床本体"><a href="#图床本体" class="headerlink" title="图床本体"></a>图床本体</h5><p>我这里用的是<a href="https://docs.lsky.pro/docs/free/v2/quick-start/installation.html">Lsky Pro</a>作为图床程序，其他大同小异</p><p>按照文档安装好后，新建一个<strong>本地</strong>存储策略，访问地址指向“副服务器”，并在后面加上<code>/mount</code>，存储路径根据自己的网站路径来，如<code>/www/wwwroot/pic.hzchu.top/</code>就填<code>/www/wwwroot/pic.hzchu.top/storage/app/mount/</code></p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7bd10e5167.webp"></p><blockquote><p>记得更改&amp;新建相应目录</p></blockquote><h5 id="Rclone"><a href="#Rclone" class="headerlink" title="Rclone"></a>Rclone</h5><p>rclone需要持久化运行，我这里建议的是Supervisor或系统自带的systemd，windows使用nssm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone mount one:/share/mount/ /www/wwwroot/pic.hzchu.top/storage/app/mount/ --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --<span class="built_in">umask</span> 000 --vfs-cache-mode full --attr-timeout 15m --vfs-cache-max-age 240h --vfs-cache-max-size 1G --buffer-size 100M</span><br></pre></td></tr></table></figure><div class="tag-plugin tabs" align="center"id="tab_3"><div class="nav-tabs"><div class="tab active"><a href="#tab_3-1">supervisor</a></div><div class="tab"><a href="#tab_3-2">systemd</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_3-1"><p>以宝塔面板为例</p><p>打开<code>软件商店</code>，搜索并安装<code>进程守护管理器</code>：</p><p>点击<code>添加守护进程</code>，如图所示</p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c05cc5077.webp"></p></div><div class="tab-pane" id="tab_3-2"><p>运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/rclone-one.service</span><br></pre></td></tr></table></figure><p>​写入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=rclone-one</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=rclone mount one:/share/mount/ /www/wwwroot/pic.hzchu.top/storage/app/mount/ --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --<span class="built_in">umask</span> 000 --vfs-cache-mode full --attr-timeout 15m --vfs-cache-max-age 240h --vfs-cache-max-size 1G --buffer-size 100M</span><br><span class="line">ExecReload=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">Restart=on-abnormal</span><br><span class="line">RestartSec=5s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></div></div></div><h3 id="安装（主服务器）"><a href="#安装（主服务器）" class="headerlink" title="安装（主服务器）"></a>安装（主服务器）</h3><p>可以用无服务器函数，这里使用<a href="https://github.com/spencerwooo/onedrive-vercel-index">onedrive-vercel-index</a>作为OneDrive的直链解析，<a href="https://ovi.swo.moe/zh/docs/getting-started">这里</a>是它的文档</p><p>将<code>baseDirectory</code>设为<code>/share</code></p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c4a67fdad.webp" alt="1690813605718.webp"></p><p>由于原作者的应用程序已过期，需要自行配置，参考<a href="https://ovi.swo.moe/zh/docs/advanced#%E4%BD%BF%E7%94%A8%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84-client-id-%E4%B8%8E-secret">高级 - OneDrive Vercel Index (swo.moe)</a>进行调整</p><blockquote><p>由于<code>vercel.app</code>在国内污染严重，请绑定你的域名</p></blockquote><h3 id="中途-开香槟-测试"><a href="#中途-开香槟-测试" class="headerlink" title="中途 开香槟 测试"></a>中途 <del>开香槟</del> 测试</h3><ol><li>在图床中上传一张图片，查看是否上传成功，若出现错误，则检查图床服务器</li><li>等待5分钟后访问<code>https://yourdomain.top/zh-CN/mount/</code>，查看是否出现<code>pic</code>文件夹，并根据<code>年/月/日</code>进入子文件夹查看能否访问图片</li></ol><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c5eaae480.webp" alt="1690813930882.webp"></p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c61147819.webp" alt="image-20230731223247351"></p><h3 id="安装（副服务器）"><a href="#安装（副服务器）" class="headerlink" title="安装（副服务器）"></a>安装（副服务器）</h3><p>需要安装redis，故不推荐使用虚拟主机，但非要用可以使用Vercel的<a href="https://vercel.com/dashboard/stores">Durable Redis</a></p><blockquote><p><strong>注：</strong></p><p>jumpurl为该节点的对外访问地址</p><p>apiurl 为“副服务器”的对外访问地址</p><p>backupurl 为“图床服务器“的对外访问地址</p><p>mainurl 为“主服务器“的对外访问地址</p></blockquote><div class="tag-plugin tabs" align="center"id="tab_4"><div class="nav-tabs"><div class="tab active"><a href="#tab_4-1">PHP版本</a></div><div class="tab"><a href="#tab_4-2">Python版本</a></div><div class="tab"><a href="#tab_4-3">解析</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_4-1"><blockquote><p>需要修改redis连接地址，$user_token和$mainurl</p></blockquote><p>Code:</p><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/MNSLXOD/main/jump/php/index.php&lang=php"></script><p>伪静态配置:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$args</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_4-2"><p>Code:</p><blockquote><p>需要修改redis连接地址，user_token和mainurl</p></blockquote><p>安装依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask flask_limiter hypercorn flask_cors</span><br></pre></td></tr></table></figure><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/MNSLXOD/main/jump/py/main.py&lang=python"></script></div><div class="tab-pane" id="tab_4-3"><p>运行逻辑：</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca059284ed4.webp" alt="image-20230802152803639"></p><pre class="mermaid">flowchart TDid0([访问]) --> id1["判断路径是否为'/_api/update'"]id1 --> |是| id2["读取相关数据计入redis"]id1 --> |否| id3["设初始值为n(n₀=1,<6)，读取redis中'jump_n'"]id3 --> |值不存在| id4["n+1"]id4 --> id3id3 ---> |值存在| id5["读取相应值，与访问路径拼接后重定向"]id3 ---> |值均不存在| id6["将'主服务器'地址与访问路径拼接后重定向"]</pre><ol><li>接受服务器状态：相比于主动检测，被动式显然更简单。通过向<code>/_api/update</code>发送<code>POST</code>请求(json)，内容包括<code>token,server_id,url</code>，server_id是阿拉伯数字，url是节点的对外访问地址，将存入redis中，20分钟过期</li><li><code>/*</code>の跳转：在请求图片时，会把1-5的数字往挨个请求[如果有更多节点可以更改]，如果有值，则取该值与访问地址拼接后，返回重定向请求。如果无节点在线，则将主服务器地址与访问地址拼接再返回。</li><li>均有访问速率限制，防止被人打到爆炸，可以根据实际情况调节上限。</li></ol></div></div></div><p>在搭建完成后，测试访问之前上传的图片，如果能返回图片即ok</p><h3 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h3><p>考虑到php部署起来麻烦，这里用python解决一切</p><div class="tag-plugin colorful note" child="tabs"><div class="title"><strong>后期吐槽</strong></div><div class="body"><p>在arm设备上配环境配半天，一气之下用go重写了主要逻辑，编译成二进制文件到处丢太爽了</p></div></div><div class="tag-plugin tabs" align="center"id="tab_5"><div class="nav-tabs"><div class="tab active"><a href="#tab_5-1">Python</a></div><div class="tab"><a href="#tab_5-2">解析</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_5-1"><p>下载数据库到程序同目录：<a href="https://raw.hzchu.top/thun888/MNSLXOD/main/node/data.db">[点击下载]</a></p><p>安装依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask flask_limiter hypercorn flask_cors</span><br></pre></td></tr></table></figure><p>Code:</p><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/MNSLXOD/main/node/main.py&lang=python"></script><blockquote><p>节点附带了两个简易api用于查看该节点运行情况</p><p>实际部署中可能需要自行配置ssl证书以使开启了https的网站可以正常访问</p><p>如果外部不套反向代理建议自定义10000-65535的端口</p><p>进程同样需要持久化，可以参考rclone部分</p></blockquote></div><div class="tab-pane" id="tab_5-2"><p><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca3aef2cf43.webp"></p><pre class="mermaid">flowchart TD    id0([访问]) --> id1["判断路径是否为'/_api/...'"]    id1 --> |是| id2["读取相关数据返回"]    id1 --> |否| id3["检查本地有无对应文件缓存"]    id3 ---> |文件存在| id4["读取文件返回"]    id3 ---> |文件不存在| id5["将'主服务器'地址与访问路径拼接后请求，下载文件后返回"]    id6(["定时器（15min）"]) --> id7(["清理缓存"]) --> id8["检查缓存目录大小"] --> |>5GB| id9["清理一天前缓存"]    id8 --> |"≦5GB"| id10["不动作"]    id6 --> id11(["上报服务器消息"])</pre></div></div></div><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><div class="tag-plugin tabs" align="center"id="tab_6"><div class="nav-tabs"><div class="tab active"><a href="#tab_6-1">直接访问OneDrive目录程序</a></div><div class="tab"><a href="#tab_6-2">正常访问效果</a></div><div class="tab"><a href="#tab_6-3">直接访问家宽节点</a></div><div class="tab"><a href="#tab_6-4">搭配Nginx缓存</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_6-1"><p>低并发</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/01/64c85bab42978.webp" alt="1690852265630.webp"></p><p>高并发</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/01/64c85bceda8cc.webp" alt="1690852301797.webp"></p></div><div class="tab-pane" id="tab_6-2"><p>低并发</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/01/64c85ada80fe5.webp"></p><p>高并发</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca4417e3b0d.webp"></p></div><div class="tab-pane" id="tab_6-3"><p>低并发</p><p><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c7c747d041a.webp"></p><p>高并发</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca523d745c7.webp"></p></div><div class="tab-pane" id="tab_6-4"><p>高并发</p><p><img src="https://onep.hzchu.top/mount/pic/2024/01/31/65b9a7ebb16cc.webp"></p></div></div></div><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>对应这个项目，我感觉就是：<code>易上手，易扩展</code>同时可以薅到各大厂商的羊毛（怎么薅就看各位的了），既可以把一些不稳定的服务利用起来，又不用担心出问题时全部拉闸，并且背靠微软不用担心无良厂商跑路数据丢失，当然，在目前只能算的上是一个高可用性的小型cdn，比起pcdn还有不少不足，但个人使用足以。</p><p>而关于利用国内宽带在未备案情况下提供网络服务的问题，我想联通与其抓我这1个月200MB上传的小服务，不如去抓那些狗大户，更重要的是图床时自用的，不用担心因为有人上传违法色情的图片被请去喝茶。</p><p>该项目也可以用在别的地方，自行发挥啦<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/ablobcatattentionreverse.png"/></span></p><p>项目开源地址：</p><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/MNSLXOD"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=MNSLXOD&theme=dark&show_owner=true"/></a></div><p>ps：</p><p>从4月份到现在为od节省了17倍的数据</p><p><img src="https://onep.hzchu.top/mount/pic/2023/08/02/64ca32eb1fac5.webp" alt="image-20230802183846133.webp"></p><p>从4月份到现在的日志<br><img src="https://onep.hzchu.top/mount/pic/2023/07/31/64c72c298f397.webp"><br>共480多条，大多数都是爬虫的贡献</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;div class=&quot;tag-plugin colorful note&quot; color=&quot;yellow&quot;&gt;&lt;div class=&quot;body&quot;&gt;&lt;p&gt;重写中。。。&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;一直以来，我都在尝试各种图片存储方案，一开始便是经典的Github+jsd，但考虑到违反了tos后面就用了cf+b2，但速度不尽人意。后来用了vercel反代gh和一些杂七杂八的，但换汤不换药嘛，还是不靠谱。&lt;/p&gt;</summary>
    
    
    
    
    <category term="MNSLXOD" scheme="https://blog.hzchu.top/tags/MNSLXOD/"/>
    
  </entry>
  
  <entry>
    <title>Windows下的电源计划自动控制</title>
    <link href="https://blog.hzchu.top/2023/auto-control-power-plan/"/>
    <id>https://blog.hzchu.top/2023/auto-control-power-plan/</id>
    <published>2023-01-17T19:07:20.000Z</published>
    <updated>2023-01-17T19:38:20.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h3><p>之前搞了一套E5扔在角落里吃灰，这几天想起来准备当nas用。不过在最高频率下运行功率实在恐怖（140w+），在Windows下限制CPU频率最简单的就是电源计划了，话不多说<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/ablobcatattentionreverse.png"/></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">BALANCE=<span class="string">&#x27;381b4222-f694-41f0-9685-ff5bb260df2e&#x27;</span></span><br><span class="line">HIGH_PERFORMANCE=<span class="string">&#x27;8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c&#x27;</span></span><br><span class="line">ENERGY_SAVER=<span class="string">&#x27;a1841308-3541-4fab-bc81-f71556f20b4a&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_power_plan</span>(<span class="params">plan</span>):</span><br><span class="line">    subprocess.run(<span class="string">f&#x27;powercfg /S <span class="subst">&#123;plan&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_power_plan</span>():</span><br><span class="line">    output = subprocess.run(<span class="string">&quot;powercfg /GETACTIVESCHEME&quot;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE).stdout.decode(<span class="string">&quot;GBK&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> output.split(<span class="string">&quot; &quot;</span>)[-<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    cpu_percent = psutil.cpu_percent(interval=<span class="number">1</span>)</span><br><span class="line">    current_time = time.localtime().tm_hour</span><br><span class="line">    plan = get_power_plan()</span><br><span class="line">    <span class="comment">#print(plan)</span></span><br><span class="line">    <span class="keyword">if</span> current_time &gt;= <span class="number">23</span> <span class="keyword">or</span> current_time &lt;= <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">if</span> plan != ENERGY_SAVER:</span><br><span class="line">            <span class="built_in">print</span>(current_time+<span class="string">&quot;：切换到节能模式&quot;</span>)</span><br><span class="line">            change_power_plan(ENERGY_SAVER)</span><br><span class="line">    <span class="keyword">elif</span> cpu_percent &gt; <span class="number">90</span>:</span><br><span class="line">        <span class="keyword">if</span> plan != HIGH_PERFORMANCE:</span><br><span class="line">            <span class="built_in">print</span>(current_time+<span class="string">&quot;：切换到高性能模式&quot;</span>)</span><br><span class="line">            change_power_plan(HIGH_PERFORMANCE)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> plan != BALANCE:</span><br><span class="line">            <span class="built_in">print</span>(current_time+<span class="string">&quot;：切换到平衡模式&quot;</span>)</span><br><span class="line">            change_power_plan(BALANCE)</span><br><span class="line">    time.sleep(<span class="number">60</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中，这一部分需要自己获取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BALANCE=<span class="string">&#x27;381b4222-f694-41f0-9685-ff5bb260df2e&#x27;</span></span><br><span class="line">HIGH_PERFORMANCE=<span class="string">&#x27;8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c&#x27;</span></span><br><span class="line">ENERGY_SAVER=<span class="string">&#x27;a1841308-3541-4fab-bc81-f71556f20b4a&#x27;</span></span><br></pre></td></tr></table></figure><p>使用<code>powercfg /GETACTIVESCHEME</code>获取电源计划GUID并填入</p><p><img src="https://onep.hzchu.top/mount/pic/2023/01/17/63c685e3ca534.webp" alt="image-20230117191532293"></p><p>当时间晚于11点或早于6点时，设置为节能</p><p>当CPU占用大于90时，调为高性能</p><p>其余时间为平衡</p><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p>为了演示，这里将时间间隔调整为1s</p><p><img src="https://onep.hzchu.top/mount/pic/2023/01/17/63c6873160cb1.gif" alt="1113.gif"></p><p>有负载时</p><p><img src="https://onep.hzchu.top/mount/pic/2023/01/17/63c6873d0f2cb.gif" alt="1114.gif"></p><p>PS：电源计划中限制频率的方法</p><p><img src="https://onep.hzchu.top/mount/pic/2023/01/17/63c687e21db58.webp" alt="1673955297733.webp"></p>]]></content>
    
    
    <summary type="html">之前搞了一套E5扔在角落里吃灰，这几天想起来准备当nas用。不过在最高频率下运行功率实在恐怖（140w+），在Windows下限制CPU频率心理有频率最简单的就是电源计划了</summary>
    
    
    
    
    <category term="Windows" scheme="https://blog.hzchu.top/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>定语从句要点复习（笔记）</title>
    <link href="https://blog.hzchu.top/2022/definite-clause-point-review/"/>
    <id>https://blog.hzchu.top/2022/definite-clause-point-review/</id>
    <published>2022-12-31T17:16:23.000Z</published>
    <updated>2022-12-31T17:16:23.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="要点一：判断"><a href="#要点一：判断" class="headerlink" title="要点一：判断"></a>要点一：判断</h3><p>1.位于名词或者代词之后：</p><p>2.可翻译为“……<mark class="tag-plugin colorful mark" color="orange">的</mark>”；</p><p>3.前后句有重叠部分</p><h3 id="要点二：关系代词和关系副词的选择"><a href="#要点二：关系代词和关系副词的选择" class="headerlink" title="要点二：关系代词和关系副词的选择"></a>要点二：关系代词和关系副词的选择</h3><p>关系代词：that&#x2F;which&#x2F;who&#x2F;whom&#x2F;whose&#x2F;<mark class="tag-plugin colorful mark" color="orange">as</mark></p><p>关系副词：when&#x2F;where&#x2F;why  （&#x3D;介词+which）</p><p>1.成分分析法：</p><p>​定语从句<mark class="tag-plugin colorful mark" color="orange">缺主语或宾语</mark>，用关系<mark class="tag-plugin colorful mark" color="orange">代词</mark>：</p><p>​定语从句<mark class="tag-plugin colorful mark" color="orange">完整</mark>，<mark class="tag-plugin colorful mark" color="orange">不缺主宾</mark>，用关系<mark class="tag-plugin colorful mark" color="orange">副词</mark>。</p><ol start="2"><li>代入法：</li></ol><p>​将先行词代入到定语从句中，若<mark class="tag-plugin colorful mark" color="orange">刚好完整</mark>用关系<mark class="tag-plugin colorful mark" color="orange">代词</mark>；</p><p>​若<mark class="tag-plugin colorful mark" color="orange">需要补充介词才完整</mark>，则用关系<mark class="tag-plugin colorful mark" color="orange">副词</mark>;</p><p>有关习题<br><img src="https://onep.hzchu.top/mount/pic/2022/12/31/63afff94ebba3.webp" alt="0d3ac79c-d33e-45b6-a1d8-4a3a4756b270.webp"><br><img src="https://onep.hzchu.top/mount/pic/2022/12/31/63affe4269583.webp" alt="dfc44830-58e2-4fd5-b0db-4e31a063f594.webp"></p><h3 id="要点三：that-v-s-which"><a href="#要点三：that-v-s-which" class="headerlink" title="要点三：that v.s which"></a>要点三：that v.s which</h3><p>在<mark class="tag-plugin colorful mark" color="orange">指物</mark>的情况下（毕竟which不能指人），that和which一般是可以互换的，但是以下情况不能互换。</p><h4 id="用that不用which的四种情况："><a href="#用that不用which的四种情况：" class="headerlink" title="用that不用which的四种情况："></a>用that不用which的四种情况：</h4><p>​1.先行词为指物的不定代词或被不定代词修饰：<br>​<br>​2.先行词被最高级或者序数词修饰；<br>​<br>​3.先行词被the very，the only或者just the修饰：<br>​<br>​4.先行词中既有人又有物。</p><h4 id="用which不用that的三种情况："><a href="#用which不用that的三种情况：" class="headerlink" title="用which不用that的三种情况："></a>用which不用that的三种情况：</h4><p>​1.<mark class="tag-plugin colorful mark" color="orange">非限制性</mark>定语从句（<mark class="tag-plugin colorful mark" color="orange">有逗号</mark>）；<br>​<br>​2.以<mark class="tag-plugin colorful mark" color="orange">整个句子</mark>作为先行词（<mark class="tag-plugin colorful mark" color="orange">非限制性</mark>定从）；<br>​<br>​3.<mark class="tag-plugin colorful mark" color="orange">介词</mark>后的关系代词。</p><blockquote><p>多写that</p></blockquote><h3 id="要点四：who-v-s-that"><a href="#要点四：who-v-s-that" class="headerlink" title="要点四：who v.s that"></a>要点四：who v.s that</h3><p>在<mark class="tag-plugin colorful mark" color="orange">指人</mark>的情况下，who和that一般是可以互换的，但是如果<mark class="tag-plugin colorful mark" color="orange">先行词是某些代词</mark>，比如<mark class="tag-plugin colorful mark" color="orange">he,anyone,those</mark>等，这时的关系代词应该<mark class="tag-plugin colorful mark" color="orange">用who</mark>，不用that。</p><mark class="tag-plugin colorful mark" color="green">eg: 谁能笑到最后,才是笑得最好: He who laughs last laughs best.</mark><h3 id="要点五：介词后关系代词的选择"><a href="#要点五：介词后关系代词的选择" class="headerlink" title="要点五：介词后关系代词的选择"></a>要点五：介词后关系代词的选择</h3><p>介词+（指<mark class="tag-plugin colorful mark" color="orange">物</mark>）<mark class="tag-plugin colorful mark" color="orange">which</mark></p><p>介词+（指<mark class="tag-plugin colorful mark" color="orange">人</mark>）<mark class="tag-plugin colorful mark" color="orange">whom</mark></p><blockquote><p>介词后不是加which，就是加whom</p></blockquote><h3 id="要点六：-whose-n"><a href="#要点六：-whose-n" class="headerlink" title="要点六： whose + n.*"></a>要点六： whose + n.*</h3><p>（指<mark class="tag-plugin colorful mark" color="orange">物</mark>）whose+n.&#x3D;<mark class="tag-plugin colorful mark" color="orange">of which</mark> + the + n.&#x3D;the + n. + of which</p><p>（指<mark class="tag-plugin colorful mark" color="orange">人</mark>）whose+n.&#x3D;<mark class="tag-plugin colorful mark" color="orange">of whom</mark> + the + n.&#x3D;the + n. + of whom</p><p>of 可表所属关系，抽象点理解可以得到第二种</p><mark class="tag-plugin colorful mark" color="orange">whose father = the father of whom</mark><mark class="tag-plugin colorful mark" color="orange">若挖空 ------- the n.则不考虑whose</mark><h3 id="要点七：as引导的定语从句"><a href="#要点七：as引导的定语从句" class="headerlink" title="要点七：as引导的定语从句"></a>要点七：as引导的定语从句</h3><mark class="tag-plugin colorful mark" color="orange">**as是关系代词**</mark><h4 id="限制性定语从句："><a href="#限制性定语从句：" class="headerlink" title="限制性定语从句："></a>限制性定语从句：</h4><p>当先行词被<mark class="tag-plugin colorful mark" color="orange">such/so/as/the same</mark>等修饰（<mark class="tag-plugin colorful mark" color="orange">结构</mark>类）</p><h4 id="非限制性定语从句："><a href="#非限制性定语从句：" class="headerlink" title="非限制性定语从句："></a>非限制性定语从句：</h4><mark class="tag-plugin colorful mark" color="orange">as以整个句子作为先行词，翻译为“**正如**”</mark><p>as is known（众所周知）, &#x2F; as is said（据说）,&#x2F; as is reported（据报道）,as is announced（据宣布）,&#x2F;as is expected（据期待）,&#x2F;as we know（正如我们知道的那样）, as we expect（正如我们期待的那样）,&#x2F;as often happens（正如经常发生的那样）,&#x2F;as is often the case（正如通常情况下）,…</p><h3 id="要点八：the-way-作为先行词的定语从句"><a href="#要点八：the-way-作为先行词的定语从句" class="headerlink" title="要点八：the way 作为先行词的定语从句*"></a>要点八：the way 作为先行词的定语从句*</h3><p>I don’t like <mark class="tag-plugin colorful mark" color="orange">the way</mark> <u>that/in which/省略</u> you speak to your Mom.</p><mark class="tag-plugin colorful mark" color="orange">通常为that</mark><h3 id="要点九：定语从句的主谓一致问题"><a href="#要点九：定语从句的主谓一致问题" class="headerlink" title="要点九：定语从句的主谓一致问题"></a>要点九：定语从句的主谓一致问题</h3><p>1.定语从句的谓语动词的单复数取决于<mark class="tag-plugin colorful mark" color="orange">先行词</mark>；</p><p>2.当先行词被<mark class="tag-plugin colorful mark" color="orange">one of</mark>修饰，定从谓语用<mark class="tag-plugin colorful mark" color="orange">复数</mark>；</p><p>   当先行词被<mark class="tag-plugin colorful mark" color="orange">the only one of</mark>修饰，定从谓语用<mark class="tag-plugin colorful mark" color="orange">单数</mark>；</p><p>3.<mark class="tag-plugin colorful mark" color="orange">as和which以整个句子作为先行词</mark>，定从谓语用<mark class="tag-plugin colorful mark" color="orange">单数</mark>；</p><blockquote><p>理解</p></blockquote><h3 id="要点十：特殊名词作为先行词的定语从句"><a href="#要点十：特殊名词作为先行词的定语从句" class="headerlink" title="要点十：特殊名词作为先行词的定语从句"></a>要点十：特殊名词作为先行词的定语从句</h3><p>situation&#x2F;case&#x2F;scene&#x2F;spot&#x2F;point（地步）&#x2F;stage   —<mark class="tag-plugin colorful mark" color="orange">关系副词用where</mark></p><p>occasion（时机）—<mark class="tag-plugin colorful mark" color="orange">关系副词用when</mark></p>]]></content>
    
    
    <summary type="html">网课内容：定语从句要点复习</summary>
    
    
    
    
    <category term="笔记" scheme="https://blog.hzchu.top/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>更便利地操控表彰大会--AHK</title>
    <link href="https://blog.hzchu.top/2022/Easier-Control-of-Recognition-Conferences-AHK/"/>
    <id>https://blog.hzchu.top/2022/Easier-Control-of-Recognition-Conferences-AHK/</id>
    <published>2022-12-25T14:44:07.000Z</published>
    <updated>2022-12-25T14:44:07.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>前几个月考完月考，第1次月考的时候因为主持人不懂按ppt.经过我舍友一番吹水，给我拉了上去，虽然威风，但我只负责按下一页和播放颁奖曲。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatsadreach.png"/></span></p><p>然鹅，放歌的重任着实有点难为我手上的翻页笔，导致我只能反反复复地从后台门旁跑到电脑旁，毕竟不能挡着队伍的道（谢天谢地，那台笔记本的键盘还有多媒体键<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/blobcatbox.png"/></span>）</p><p><img src="https://onep.hzchu.top/mount/pic/2022/12/25/63a7f3c180d9b.webp" alt="img"></p><p>那么，在尴尬了3个小时后，为了应对期中后表彰大会同样的情况，还是要想个对策</p><h4 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h4><p>翻页笔，说白了就是个小键盘（宏），上下翻页自然是上下键，“黑屏”即为B键，再高级的就不是单纯的键盘了。当然，我手上这支来自于我勤俭持家的英语老师，只有下图这几个键</p><p><img src="https://onep.hzchu.top/mount/pic/2022/12/25/63a7f3afa43d8.webp" alt="img"></p><blockquote><p>图片在某宝找了个同款</p></blockquote><p>环顾一圈，只有Enter键是用不上的，那不就可以搞一波按键映射，让它成为播放&#x2F;暂停键</p><h4 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h4><p>按键映射还得是老大哥<em>——</em>Autohotkey(AHK)</p><p>根据AHK的语法，下面的“句子”便可以实现，复制写入一个文档里并改后缀名为.ahk，导入即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enter::Media_Play_Pause</span><br></pre></td></tr></table></figure><p>我这里为了方便将其导出为一个独立程序</p><p><img src="https://onep.hzchu.top/mount/pic/2022/12/25/63a7f3994f0f5.webp" alt="img"></p><p>事实证明，效果不错，让我还能在里面摸鱼<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/norevi/waline-blobcatemojis@1.0/blobs/ablobcatrainbow.png"/></span></p>]]></content>
    
    
    <summary type="html">在尴尬了3个小时后，为了应对期中后表彰大会同样的情况，还是要想个对策</summary>
    
    
    
    
    <category term="AHK" scheme="https://blog.hzchu.top/tags/AHK/"/>
    
  </entry>
  
  <entry>
    <title>使用Python半自动生成Altium原理图封装</title>
    <link href="https://blog.hzchu.top/2022/ptyhon-with-altium-designer/"/>
    <id>https://blog.hzchu.top/2022/ptyhon-with-altium-designer/</id>
    <published>2022-07-14T12:29:32.000Z</published>
    <updated>2022-07-14T12:29:32.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>放长假了，想搞点钱，对我而言来钱最快的就是帮别人画原理图PCB图了。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/cdn-x/emoji/aru-l/87.gif"/></span></p><p>不过画了几天发现一个问题：一直以来都自己画自己的，而现在帮别人画，客户发的很多原理图的封装都没有，基本上每画一个图都要画两三个，碰到一些小的还好几分钟就能画完，碰到一些大点的芯片引脚多的很的，自己画一个（配上电脑拉跨debuff）还要十几分钟，在立创EDA上面找的又经常有错，很是不爽<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/cdn-x/emoji/aru-l/34.gif"/></span></p><p>不过得益于AD高版本可以以成文本形式保存原理图文件，使用程序完成任务也就成为了可能。</p><h3 id="历程"><a href="#历程" class="headerlink" title="历程"></a>历程</h3><p>随便新建一个原理图以ASCII保存。打开来可以看见这么一份”模板“，<br><img src="https://k.hzchu.top/2022/08/23/63043cea7eada.webp"></p><details class="tag-plugin colorful folding" color="yellow" child="codeblock"><summary><span>模板</span></summary><div class="body"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">|<span class="variable constant_">HEADER</span>=<span class="title class_">Protel</span> <span class="keyword">for</span> <span class="title class_">Windows</span> - <span class="title class_">Schematic</span> <span class="title class_">Capture</span> <span class="title class_">Ascii</span> <span class="title class_">File</span> <span class="title class_">Version</span> <span class="number">5.0</span>|<span class="variable constant_">WEIGHT</span>=<span class="number">38</span></span><br><span class="line">|<span class="variable constant_">ISBOC</span>=T|<span class="variable constant_">RECORD</span>=<span class="number">31</span>|<span class="variable constant_">VISIBLEGRIDON</span>=T|<span class="variable constant_">VISIBLEGRIDSIZE</span>=<span class="number">10</span>|<span class="variable constant_">DISPLAY_UNIT</span>=<span class="number">4</span>|<span class="variable constant_">CUSTOMY</span>=<span class="number">950</span>|<span class="variable constant_">BORDERON</span>=T|<span class="variable constant_">HOTSPOTGRIDON</span>=T|<span class="variable constant_">CUSTOMX</span>=<span class="number">1500</span>|<span class="variable constant_">CUSTOMMARGINWIDTH</span>=<span class="number">20</span>|<span class="title class_">SIZE1</span>=<span class="number">10</span>|<span class="variable constant_">SHEETNUMBERSPACESIZE</span>=<span class="number">4</span>|<span class="variable constant_">CUSTOMYZONES</span>=<span class="number">4</span>|<span class="variable constant_">USEMBCS</span>=T|<span class="variable constant_">FONTIDCOUNT</span>=<span class="number">1</span>|<span class="variable constant_">SNAPGRIDSIZE</span>=<span class="number">10</span>|<span class="variable constant_">SHEETSTYLE</span>=<span class="number">5</span>|<span class="variable constant_">SYSTEMFONT</span>=<span class="number">1</span>|<span class="variable constant_">HOTSPOTGRIDSIZE</span>=<span class="number">4</span>|<span class="title class_">FONTNAME1</span>=<span class="title class_">Times</span> <span class="title class_">New</span> <span class="title class_">Roman</span>|<span class="variable constant_">TITLEBLOCKON</span>=T|<span class="variable constant_">AREACOLOR</span>=<span class="number">16317695</span>|<span class="variable constant_">SNAPGRIDON</span>=T|<span class="variable constant_">CUSTOMXZONES</span>=<span class="number">6</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">CurrentTime</span>|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">WFYPTBEC</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">CurrentDate</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">1</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">KRGPTHWR</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Time</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">2</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">APNVELVY</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Date</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">3</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">DOFGRYNH</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">DocumentFullPathAndName</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">4</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">XTILODYM</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">DocumentName</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">5</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">CIXOCUKW</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">ModifiedDate</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">6</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">CYVLOLHC</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">ApprovedBy</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">7</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">UKLMMPSH</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">CheckedBy</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">8</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">LGBVFHBI</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Author</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">9</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">NNMPOPVS</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">CompanyName</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">10</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">ROXAGALI</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">DrawnBy</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">11</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">GSEQEJEE</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Engineer</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">12</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">NMEAIFPG</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Organization</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">13</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">CHTRTWQS</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Address1</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">14</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">SLYDDXDR</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Address2</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">15</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">JNHWHKQI</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Address3</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">16</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">MIQKOJUC</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Address4</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">17</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">TBHPRINX</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Title</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">18</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">JRIVAVFH</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">DocumentNumber</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">19</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">SJJFVEJY</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Revision</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">20</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">TPPALWNV</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">SheetNumber</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">21</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">IXCDWQOY</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">SheetTotal</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">22</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">WLJMRBEM</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">Rule</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">23</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">SGMPJKTU</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">ImagePath</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">24</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">CDHEMVMP</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">NAME</span>=<span class="title class_">ProjectName</span>|<span class="variable constant_">TEXT</span>=*|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">25</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">FMWVHCEF</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">HEADER</span>=<span class="title class_">Icon</span> storage</span><br><span class="line">|<span class="variable constant_">HEADER</span>=<span class="title class_">Protel</span> <span class="keyword">for</span> <span class="title class_">Windows</span> - <span class="title class_">Schematic</span> <span class="title class_">Capture</span> <span class="title class_">Ascii</span> <span class="title class_">File</span> <span class="title class_">Version</span> <span class="number">5.0</span></span><br></pre></td></tr></table></figure></div></details><blockquote><p>文本是OLE复合文档,有开发需要可以在这个仓库里查看。</p></blockquote><div class="tag-plugin link dis-select"><a class="link-card plain" title="Altium schematic file format" href="https://github.com/vadmium/python-altium/blob/master/format.md" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill=""><div class="left"><span class="title">Altium schematic file format</span><span class="cap link footnote">https://github.com/vadmium/python-altium/blob/master/format.md</span></div><div class="right"><div class="lazy img" data-bg="/img/icons/08a41b181ce68.svg"></div></div></a></div><p>测试放置一个3PIN可以看到多了这么一部分</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">1</span>|<span class="variable constant_">PARTIDLOCKED</span>=T|<span class="variable constant_">COLOR</span>=<span class="number">128</span>|<span class="variable constant_">SOURCELIBRARYNAME</span>=<span class="title class_">Miscellaneous</span> <span class="title class_">Devices</span>.<span class="property">SchLib</span>|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">DISPLAYMODECOUNT</span>=<span class="number">1</span>|<span class="variable constant_">INDEXINSHEET</span>=<span class="number">26</span>|<span class="variable constant_">DESIGNITEMID</span>=3PIN|<span class="variable constant_">PARTCOUNT</span>=<span class="number">2</span>|<span class="variable constant_">LIBREFERENCE</span>=3PIN|<span class="variable constant_">LIBRARYPATH</span>=*|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">AREACOLOR</span>=<span class="number">11599871</span>|<span class="variable constant_">TARGETFILENAME</span>=*|<span class="variable constant_">CURRENTPARTID</span>=<span class="number">1</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">450</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">JDTBOSLP</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">14</span>|<span class="variable constant_">ISNOTACCESIBLE</span>=T|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">CORNER</span>.<span class="property">Y</span>=<span class="number">450</span>|<span class="variable constant_">ISSOLID</span>=T|<span class="variable constant_">OWNERPARTID</span>=<span class="number">1</span>|<span class="variable constant_">OWNERINDEX</span>=<span class="number">27</span>|<span class="variable constant_">CORNER</span>.<span class="property">X</span>=<span class="number">470</span>|<span class="variable constant_">COLOR</span>=<span class="number">128</span>|<span class="variable constant_">AREACOLOR</span>=<span class="number">11599871</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">410</span></span><br><span class="line">|<span class="variable constant_">DESIGNATOR</span>=<span class="number">1</span>|<span class="variable constant_">RECORD</span>=<span class="number">2</span>|<span class="variable constant_">NAME</span>=<span class="number">1</span>|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">PINLENGTH</span>=<span class="number">20</span>|<span class="variable constant_">OWNERPARTID</span>=<span class="number">1</span>|<span class="variable constant_">PINCONGLOMERATE</span>=<span class="number">42</span>|<span class="variable constant_">ELECTRICAL</span>=<span class="number">4</span>|<span class="variable constant_">OWNERINDEX</span>=<span class="number">27</span>|<span class="variable constant_">FORMALTYPE</span>=<span class="number">1</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">440</span>|<span class="variable constant_">SWAPIDPIN</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">NAME</span>=<span class="title class_">PinUniqueId</span>|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">OWNERINDEX</span>=<span class="number">29</span>|<span class="variable constant_">TEXT</span>=<span class="variable constant_">BNSVPWEQ</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">440</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">DESIGNATOR</span>=<span class="number">2</span>|<span class="variable constant_">RECORD</span>=<span class="number">2</span>|<span class="variable constant_">NAME</span>=<span class="number">2</span>|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">PINLENGTH</span>=<span class="number">20</span>|<span class="variable constant_">OWNERPARTID</span>=<span class="number">1</span>|<span class="variable constant_">PINCONGLOMERATE</span>=<span class="number">42</span>|<span class="variable constant_">ELECTRICAL</span>=<span class="number">4</span>|<span class="variable constant_">OWNERINDEX</span>=<span class="number">27</span>|<span class="variable constant_">FORMALTYPE</span>=<span class="number">1</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">430</span>|<span class="variable constant_">SWAPIDPIN</span>=<span class="number">2</span></span><br><span class="line">|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">NAME</span>=<span class="title class_">PinUniqueId</span>|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">OWNERINDEX</span>=<span class="number">30</span>|<span class="variable constant_">TEXT</span>=<span class="variable constant_">DQCSMDTO</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">430</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">DESIGNATOR</span>=<span class="number">3</span>|<span class="variable constant_">RECORD</span>=<span class="number">2</span>|<span class="variable constant_">NAME</span>=<span class="number">3</span>|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">PINLENGTH</span>=<span class="number">20</span>|<span class="variable constant_">OWNERPARTID</span>=<span class="number">1</span>|<span class="variable constant_">PINCONGLOMERATE</span>=<span class="number">42</span>|<span class="variable constant_">ELECTRICAL</span>=<span class="number">4</span>|<span class="variable constant_">OWNERINDEX</span>=<span class="number">27</span>|<span class="variable constant_">FORMALTYPE</span>=<span class="number">1</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">420</span>|<span class="variable constant_">SWAPIDPIN</span>=<span class="number">3</span></span><br><span class="line">|<span class="variable constant_">ISHIDDEN</span>=T|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">NAME</span>=<span class="title class_">PinUniqueId</span>|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">OWNERINDEX</span>=<span class="number">31</span>|<span class="variable constant_">TEXT</span>=<span class="variable constant_">TFWBGGDS</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">420</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">34</span>|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">NAME</span>=<span class="title class_">Designator</span>|<span class="variable constant_">TEXT</span>=P?|<span class="variable constant_">OWNERINDEX</span>=<span class="number">27</span>|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388408</span>|<span class="variable constant_">INDEXINSHEET</span>=-<span class="number">1</span>|<span class="variable constant_">READONLYSTATE</span>=<span class="number">1</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">450</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">RECORD</span>=<span class="number">41</span>|<span class="variable constant_">LOCATION</span>.<span class="property">X</span>=<span class="number">440</span>|<span class="variable constant_">NAME</span>=<span class="title class_">Comment</span>|<span class="variable constant_">TEXT</span>=3PIN|<span class="variable constant_">OWNERINDEX</span>=<span class="number">27</span>|<span class="variable constant_">OWNERPARTID</span>=-<span class="number">1</span>|<span class="variable constant_">COLOR</span>=<span class="number">8388608</span>|<span class="variable constant_">INDEXINSHEET</span>=-<span class="number">1</span>|<span class="variable constant_">UNIQUEID</span>=<span class="variable constant_">SIFBYFRD</span>|<span class="variable constant_">LOCATION</span>.<span class="property">Y</span>=<span class="number">400</span>|<span class="variable constant_">FONTID</span>=<span class="number">1</span></span><br><span class="line">|<span class="variable constant_">OWNERINDEX</span>=<span class="number">27</span>|<span class="variable constant_">RECORD</span>=<span class="number">44</span></span><br></pre></td></tr></table></figure><p>可以看出</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">RECORD</span> = </span><br><span class="line"><span class="number">1</span>：器件开始</span><br><span class="line"><span class="number">2</span>: 引脚</span><br><span class="line"><span class="number">14</span>：长方形（背景）</span><br><span class="line"><span class="number">34</span>：元件标号</span><br><span class="line"><span class="number">41</span>：脚注</span><br><span class="line"><span class="number">44</span>：器件结束</span><br><span class="line"><span class="variable constant_">DESIGNATOR</span>：管脚标号</span><br></pre></td></tr></table></figure><p>还有像xy坐标，NAME，COLOR等不必多说</p><p>接着就是写个python脚本把它们拼起来辣</p><script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/altium-helper/master/packager.py&lang=python"></script><div class="tag-plugin ghcard"><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/thun888/altium-helper"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=thun888&repo=altium-helper&theme=dark&show_owner=true"/></a></div><p>再生成原理图库复制到自己的库就行了</p><p><img src="https://k.hzchu.top/2022/08/23/63043a58d9141.webp" alt="Snipaste_2022-07-17_09-13-24"></p><h3 id="小说明"><a href="#小说明" class="headerlink" title="小说明"></a>小说明</h3><h4 id="放置类型"><a href="#放置类型" class="headerlink" title="放置类型"></a>放置类型</h4><table><thead><tr><th>И</th><th>凵(常用)</th><th>Z</th></tr></thead><tbody><tr><td><img src="https://k.hzchu.top/2022/08/23/63043a2dd7177.webp" alt="Snipaste_2022-07-15_12-01-30"></td><td><img src="https://k.hzchu.top/2022/08/23/63043a72e7aa3.webp" alt="Snipaste_2022-07-15_12-02-37"></td><td><img src="https://k.hzchu.top/2022/08/23/63043a851122a.webp" alt="Snipaste_2022-07-15_12-03-26"></td></tr></tbody></table><h3 id="执行效果"><a href="#执行效果" class="headerlink" title="执行效果"></a>执行效果</h3><p><img src="https://k.hzchu.top/2022/08/22/6303717c45a8a.webp" alt="Snipaste_2022-07-14_19-18-29"></p><h3 id="值得注意的点"><a href="#值得注意的点" class="headerlink" title="值得注意的点"></a>值得注意的点</h3><p>1. 在“模板”的头部中，<code>WEIGHT</code>代表着剩余的部件量，如果设置的太小当AD读取完后就不会往下读了，就会导致缺这缺那</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|<span class="variable constant_">HEADER</span>=<span class="title class_">Protel</span> <span class="keyword">for</span> <span class="title class_">Windows</span> - <span class="title class_">Schematic</span> <span class="title class_">Capture</span> <span class="title class_">Ascii</span> <span class="title class_">File</span> <span class="title class_">Version</span> <span class="number">5.0</span>|<span class="variable constant_">WEIGHT</span>=<span class="number">38</span></span><br></pre></td></tr></table></figure><p>2.同样在“模板”的头部中，第二行中包括了纸张大小等的定义，如果遇到🐞可以适当修改</p><p><img src="https://k.hzchu.top/2022/08/23/63043a9b1224c.webp" alt="image"></p><p>3.引脚方向依据<code>PINCONGLOMERATE</code>的值，连接方向向右时为56，从此每逆时针旋转90°加一</p><p><img src="https://k.hzchu.top/2022/08/23/63043af131a4c.webp" alt="Snipaste_2022-07-14_08-55-25"></p><p>4.xy坐标必须为不带小数的整数，不然它立马扑街给你看<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/cdn-x/emoji/aru-l/160.gif"/></span></p>]]></content>
    
    
    <summary type="html">直接一套组合拳</summary>
    
    
    
    
    <category term="python" scheme="https://blog.hzchu.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>2021旧年总结</title>
    <link href="https://blog.hzchu.top/2022/2021%E6%97%A7%E5%B9%B4%E6%80%BB%E7%BB%93/"/>
    <id>https://blog.hzchu.top/2022/2021%E6%97%A7%E5%B9%B4%E6%80%BB%E7%BB%93/</id>
    <published>2022-01-31T21:37:15.000Z</published>
    <updated>2022-02-01T12:54:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2021-has-ended-but-2022-begins"><a href="#2021-has-ended-but-2022-begins" class="headerlink" title="2021 has ended but 2022 begins"></a>2021 has ended but 2022 begins</h2><p>新年伊始，又是新的一年。做个年终总结吧。<del>证明我还活着</del></p><p>先看看曾经定的Todo list</p><ul><li><p><input checked="" disabled="" type="checkbox"> 进到实验班。</p></li><li><p><input checked="" disabled="" type="checkbox"> 设立导航</p></li><li><p><input disabled="" type="checkbox"> 被百度收录。看淡了，我把站点地图怼它脸上，写个脚本每4分钟提交一次，还没收录，<del>百度是神马东西</del></p></li><li><p><input checked="" disabled="" type="checkbox"> 写个基于cfw的工具。写了不少</p></li><li><p><input checked="" disabled="" type="checkbox"> Golang入门。大概吧</p></li></ul><p>过去的一年，好像时间变快了不少，不知不觉就过去了。6月份往前都在备考生地，放个暑假回来后又是各种考试，<del>两周一休算了算回家的次数好像还不到10次</del></p><p>学会了很多，也见证了不少（省略数千字）</p><blockquote><p>定个目标</p></blockquote><ul><li><p><input disabled="" type="checkbox"> 考上一中!   （和学校有约~</p></li><li><p><input checked="" disabled="" type="checkbox"> 最好再进实验班</p></li></ul><h4 id="附"><a href="#附" class="headerlink" title="附"></a>附</h4><p>因为没啥时间，也没有写到什么实质上的内容，不过也有2200+的小伙伴来访~<br><img src="https://raw.hzchu.top/thun888/asstes/master/img/202202011232766.png" alt="Snipaste_2022-01-31_19-35-02"><br><img src="https://raw.hzchu.top/thun888/asstes/master/img/202202011231533.png" alt="Snipaste_2022-01-31_19-35-28"><br><img src="https://raw.hzchu.top/thun888/asstes/master/img/202202011232299.png" alt="大家梯子地区真广（划掉）"></p><hr><p>祝各位虎年大吉，虎虎生威<img src="https://raw.hzchu.top/thun888/asstes/master/img/202202011237099.jpg" alt="e0752da35b9e7a4b089f962442192898"></p>]]></content>
    
    
    <summary type="html">2021 has ended but 2022 begins</summary>
    
    
    
    
    <category term="yearreport" scheme="https://blog.hzchu.top/tags/yearreport/"/>
    
  </entry>
  
  <entry>
    <title>把玩intel的开发服务器</title>
    <link href="https://blog.hzchu.top/2021/%E6%8A%8A%E7%8E%A9intel%E7%9A%84%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://blog.hzchu.top/2021/%E6%8A%8A%E7%8E%A9intel%E7%9A%84%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2021-08-08T13:59:03.000Z</published>
    <updated>2021-08-08T13:59:03.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h4><p>打开<a href="https://d.hzchu.top/3">Intel® DevCloud</a>，有账号登录，没账号注册，</p><p><img src="https://k.hzchu.top/2022/08/18/62fddfdb4a480.png" alt="image-20210808145043855"></p><p>拉下来找到<code>Intel® DevCloud for the Edge</code>点进去</p><p><img src="https://k.hzchu.top/2022/08/18/62fddff130630.png" alt="62fddff130630"></p><blockquote><p>注意邮箱</p></blockquote><p><img src="https://k.hzchu.top/2022/08/18/62fde00c0c138.png" alt="image-20210808145254426"></p><p><img src="https://k.hzchu.top/2022/08/18/62fde01dcd877.png" alt="image-20210808145347119"></p><p><img src="https://k.hzchu.top/2022/08/18/62fde02c21ac7.png" alt="image-20210808145438494"></p><p><img src="https://k.hzchu.top/2022/08/18/62fde03a076a0.png" alt="image-20210808145505189"></p><p><img src="https://k.hzchu.top/2022/08/18/62fde04eb6364.png" alt="image-20210808145523053"></p><p>在看到<code>Server not running</code>这个话前基本都500错误或者点了没反应，等半个小时就好(也可以切换网络环境等)</p><div class="tag-plugin swiper fancybox" id="swiper-api" width="25"><div class="swiper-wrapper"><div class="swiper-slide"><img no-lazy src="https://k.hzchu.top/2022/08/18/62fde05e2fbdc.png" alt="Snipaste_2021-08-07_17-49-13"></div><div class="swiper-slide"><img no-lazy src="https://k.hzchu.top/2022/08/18/62fde0a76a277.png" alt="Snipaste_2021-08-07_18-35-16"></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev blur"></div><div class="swiper-button-next blur"></div></div><p><img src="https://k.hzchu.top/2022/08/18/62fde0b9b553c.png" alt="image-20210808145540103"></p><p>打开终端</p><p><img src="https://k.hzchu.top/2022/08/18/62fde0c967b48.png" alt="Snipaste_2021-08-07_18-11-33"></p><p>然后就可以<del>为所欲为了</del><u>没有root</u>的啦<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://jsd.hzchu.top/gh/cdn-x/emoji/aru-l/11.gif"/></span></p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>80核，256g( ‵▽′)ψ，（共用）</p><p><img src="https://k.hzchu.top/2022/08/18/62fde0d94e6ff.png" alt="Snipaste_2021-08-07_18-21-17"></p><p><img src="https://k.hzchu.top/2022/08/18/62fde0e87a505.png" alt="Snipaste_2021-08-07_18-28-07"></p><p>proot容器内测试</p><p><img src="https://k.hzchu.top/2022/08/18/62fde0f84f77e.png" alt="image-20210808150809533"></p><h4 id="网速"><a href="#网速" class="headerlink" title="网速"></a>网速</h4><p>Asia</p><p><img src="https://k.hzchu.top/2022/08/18/62fde10b1cf7b.png" alt="image-20210808151147629"></p><p>Another</p><p><img src="https://k.hzchu.top/2022/08/18/62fde11867eea.png" alt="image-20210808151132419"></p><p><img src="https://k.hzchu.top/2022/08/18/62fde16b1e5df.png" alt="image-20210808151201095"></p><h4 id="伪获取root权限"><a href="#伪获取root权限" class="headerlink" title="伪获取root权限"></a>伪获取root权限</h4><p>在终端内复制粘贴以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://share.hzchu.top/%E8%BD%AF%E4%BB%B6/root.sh</span><br><span class="line"><span class="built_in">chmod</span> 777 root.sh</span><br><span class="line">./root.sh</span><br></pre></td></tr></table></figure><p><img src="https://k.hzchu.top/2022/08/18/62fde19fc8cae.png" alt="image-20210808140827984"></p><p>当$变为#就ok</p><p>不过wget,curl这些都没有，所以还要自行安装</p><p>PS:可以开新一个终端下载一些必要依赖包（deb）再离线安装</p><blockquote><p><a href="https://packages.debian.org/">https://packages.debian.org</a></p></blockquote><p><img src="https://k.hzchu.top/2022/08/18/62fde1ab782d3.png" alt="image-20210808143134070"></p><blockquote><p>该服务器使用时间只有10小时，但10小时后还可以再来一次<span class="tag-plugin emoji"></span></p></blockquote>]]></content>
    
    
    <summary type="html">如今，人们白嫖起了牙膏厂~</summary>
    
    
    
    
    <category term="Intel" scheme="https://blog.hzchu.top/tags/Intel/"/>
    
  </entry>
  
  <entry>
    <title>解决Cloudflare Wrangler无法获取授权</title>
    <link href="https://blog.hzchu.top/2021/%E8%A7%A3%E5%86%B3Cloudflare-Wrangler%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E6%8E%88%E6%9D%83/"/>
    <id>https://blog.hzchu.top/2021/%E8%A7%A3%E5%86%B3Cloudflare-Wrangler%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E6%8E%88%E6%9D%83/</id>
    <published>2021-07-29T18:18:05.000Z</published>
    <updated>2021-07-29T18:18:05.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>昨天，因为要本地提交点东西到worker就装了Wrangler，没想到啊，它就这么卡着不动了（在waiting for api token那里我等了半个世纪）<img src="https://k.hzchu.top/2022/08/18/62fde84075a94.png" alt="Snipaste_2021-07-26_20-36-47"></p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul><li><p>在刚刚的授权页面点击<code>API令牌</code></p><p><img src="https://k.hzchu.top/2022/08/18/62fde825cdbed.png" alt="llll"></p></li><li><p>点<code>投放</code>–<code>copy</code></p><p><img src="https://k.hzchu.top/2022/08/18/62fde5fd96553.png" alt="Snipaste_2021-07-26_20-38-00"></p><p><img src="https://k.hzchu.top/2022/08/18/62fde60f90dc8.png" alt="Snipaste_2021-07-26_20-38-15"></p></li><li><p>输入<code>wrangler config</code>,粘贴刚刚copy的token</p></li></ul><p><img src="https://k.hzchu.top/2022/08/18/62fde61b32b17.png" alt="Snipaste_2021-07-26_20-37-15"></p><ul><li><p>回车后看到sucess就好了</p><p><img src="https://k.hzchu.top/2022/08/18/62fde62d8262c.png" alt="Snipaste_2021-07-26_20-38-30"></p></li></ul><h4 id="后"><a href="#后" class="headerlink" title="后"></a>后</h4><p>写的时侯为了截图换了个账号，然后它能用了~~~~</p><p><img src="https://k.hzchu.top/2022/08/18/62fde6529a01d.png" alt="Snipaste_2021-07-29_18-26-37"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;昨天，因为要本地提交点东西到worker就装了Wrangler，没想到啊，它就这么卡着不动了（在waiting for api token那</summary>
      
    
    
    
    
    <category term="Cloudflare" scheme="https://blog.hzchu.top/tags/Cloudflare/"/>
    
  </entry>
  
  <entry>
    <title>解决VSCode安装Go扩展报错</title>
    <link href="https://blog.hzchu.top/2021/%E8%A7%A3%E5%86%B3VSCode%E5%AE%89%E8%A3%85Go%E6%89%A9%E5%B1%95%E6%8A%A5%E9%94%99/"/>
    <id>https://blog.hzchu.top/2021/%E8%A7%A3%E5%86%B3VSCode%E5%AE%89%E8%A3%85Go%E6%89%A9%E5%B1%95%E6%8A%A5%E9%94%99/</id>
    <published>2021-07-26T18:37:56.000Z</published>
    <updated>2021-07-26T18:37:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>不多哔哔，直入主题</p><p>先转到新建环境变量这里（图示为win11</p><p><img src="https://k.hzchu.top/2022/08/18/62fde67a827da.png"></p><p>新建2个（如图）</p><p><img src="https://k.hzchu.top/2022/08/18/62fde685a8fe8.png" alt="image-20210726184350014"></p><table><thead><tr><th>变量名</th><th>变量值</th></tr></thead><tbody><tr><td>GOPROXY</td><td><a href="https://goproxy.io/">https://goproxy.io</a></td></tr><tr><td>GO111MODULE</td><td>on</td></tr></tbody></table><p>点确定后<strong>重启</strong>再进VSCode里选择<code>install all</code>安装就好</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;不多哔哔，直入主题&lt;/p&gt;
&lt;p&gt;先转到新建环境变量这里（图示为win11&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://k.hzchu.top/2022/08/18/62fde67a827da.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;新建2个（如图）&lt;/p&gt;
&lt;p&gt;&lt;img src</summary>
      
    
    
    
    
    <category term="Go" scheme="https://blog.hzchu.top/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>为Stellar主题添加HPP的&quot;说说&quot;功能</title>
    <link href="https://blog.hzchu.top/2021/%E4%B8%BAStellar%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0HPP%E8%AF%B4%E8%AF%B4%E5%8A%9F%E8%83%BD/"/>
    <id>https://blog.hzchu.top/2021/%E4%B8%BAStellar%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0HPP%E8%AF%B4%E8%AF%B4%E5%8A%9F%E8%83%BD/</id>
    <published>2021-07-15T20:09:32.000Z</published>
    <updated>2021-07-15T20:09:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>HPP,即<code>HexoPlusPlus</code>,其中自带了”说说”功能，但我正在用的Stellar不支持，那就自己加吧</p><blockquote><p>与某个页面合并了</p></blockquote><h4 id="选址"><a href="#选址" class="headerlink" title="选址"></a>选址</h4><p>纵观全局，我看到了左侧栏的”文章”，加了进去，却成了这个鸟样子（橙框为我手动框出来的）</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715185701431.png" alt="image-20210715185701431"></p><p>再品，放这里不就好了😎</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715185830748.png" alt="image-20210715185830748"></p><h4 id="开工"><a href="#开工" class="headerlink" title="开工"></a>开工</h4><p>因为主题在不同语言时有不同显示，所以先从语言文件下手</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715190020030.png" alt="image-20210715190020030"></p><p>找到”归档”对应的是<code>archives</code>，再用<code>everything</code>在主题文件中搜索</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715190202563.png" alt="image-20210715190202563"></p><p>前4个是语言文件，第5个是生成归档页面的，那第6个就有很大嫌疑了，打开看看</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715190356447.png" alt="image-20210715190356447"></p><p>啊没错，就是它，而且类名也对的上（当初直接查类名更快啊＞﹏＜）</p><p>格式就像这样</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (site.posts &amp;&amp; site.posts.length &gt; 0) &#123; %&gt;</span><br><span class="line">  &lt;% if (is_archive()) &#123; %&gt;</span><br><span class="line">    &lt;a class=&#x27;active&#x27; href=&#x27;&lt;%- url_for(config.archive_dir) %&gt;&#x27;&gt;&lt;%- __(&#x27;btn.archives&#x27;) %&gt;&lt;/a&gt;</span><br><span class="line">  &lt;% &#125; else &#123; %&gt;</span><br><span class="line">    &lt;a href=&#x27;&lt;%- url_for(config.archive_dir) %&gt;&#x27;&gt;&lt;%- __(&#x27;btn.archives&#x27;) %&gt;&lt;/a&gt;</span><br><span class="line">  &lt;% &#125; %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>添加上去后把所有<code>archives</code>给替换成了<code>htalk</code>,但是一运行那报错和放鞭炮没什么不同(。﹏。)</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715203736270.png" alt="image-20210715203736270"></p><p>从代码上说，这句是判断当前是什么页面的，我翻了亿下没找到它的定义在哪个文件，就先改回posts（只是影响了按钮底色，问题不大(❁´◡`❁)）</p><p>在<code>\themes\stellar\layout</code>下新建<code>htalk.ejs</code>,从隔壁<code>tag.ejs</code>借鉴点代码过来，除了site.tags.length其他都改为htalk</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715204525167.png" alt="image-20210715204525167"></p><p>可以看出第11行到21行都是页面中可以显示出来的部分~~（不太严谨的样子~~</p><p>把HPP文档中的”引入部分”插到里面</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715205153957.png" alt="image-20210715205153957"></p><p>¯_(ツ)_&#x2F;¯</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715204930656.png" alt="image-20210715204930656"></p><p>加个题目</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&#x27;list-title h3&#x27;</span>&gt;</span>说说（瞎扯）<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715205203844.png" alt="image-20210715205203844"></p><hr><p>承 接 前 文，看着”说说”按钮选中时没有底色还是有点不爽，回到前面</p><p>把判定部分<del>都删了</del>删到只剩下一个基础的判定（虽然没用但删了就报错），给它加上<code>id=&quot;nav-bb&quot;</code>的属性</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715210320086.png" alt="image-20210715210320086"></p><p>再在htalk.ejs中加上</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;nav-bb&#x27;</span>).<span class="property">className</span>=<span class="string">&#x27;active&#x27;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>( •̀ ω •́ )✧</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715205705037.png" alt="image-20210715205705037"></p><h4 id="最终代码"><a href="#最终代码" class="headerlink" title="最终代码"></a>最终代码</h4><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/image-20210715205828548.png" alt="image-20210715205828548"></p><p>!!!  warning<br>1.记得使用<code>hexo new page htalk</code>并在<code>layout</code>中改为<code>htalk</code><br><br>2.在博客根目录下的<code>_config.yml</code>中要指明<code>htalk_dir: htalk</code></p>]]></content>
    
    
    <summary type="html">HPP,即`HexoPlusPlus`,其中自带了&quot;说说&quot;功能，但我正在用的Stellar不支持，那就自己加吧</summary>
    
    
    
    
    <category term="Blog" scheme="https://blog.hzchu.top/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>优化Oneindex的nexmoe主题的加载速度</title>
    <link href="https://blog.hzchu.top/2021/%E4%BC%98%E5%8C%96Oneindex%E7%9A%84nexmoe%E4%B8%BB%E9%A2%98%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6/"/>
    <id>https://blog.hzchu.top/2021/%E4%BC%98%E5%8C%96Oneindex%E7%9A%84nexmoe%E4%B8%BB%E9%A2%98%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6/</id>
    <published>2021-06-10T14:37:59.000Z</published>
    <updated>2021-06-10T14:37:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>在一些带宽小的机子上部署Oneindex又用nexmoe主题，就算套了cdn也慢（深有体会）</p><p>在学校开来给同学下电影开了十几秒愣是没加载出来<img src="https://raw.hzchu.top/thun888/jian/master/coolapk_emotion_42_diaoxie.png" style="zoom:25%;" /></p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p>定位到网址目录下的&#x2F;view&#x2F;nexmoe</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/20210610144611.png" alt="image-20210610144610288"></p><p>将框选的（第7行的第11行）</p><p>进行替换</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/20210610145355.png" alt="image-20210610145355484"></p><p>第7行</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;//npm.elemecdn.com/mdui@1.0.1/dist/css/mdui.min.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第11行</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//raw.githubusercontent.com/thun888/tuku/master/img/mdui.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>like this</p><p><img src="https://raw.hzchu.top/thun888/tuku/master/img/20210610145809.png" alt="image-20210610145809885"></p><h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><p>修改前</p><img src="https://raw.hzchu.top/thun888/tuku/master/img/20210610150256.png" alt="image-20210610150255933" style="zoom:67%;" /><p>修改后</p><img src="https://raw.hzchu.top/thun888/tuku/master/img/20210610150015.png" alt="image-20210610150015253" style="zoom:67%;" />]]></content>
    
    
    <summary type="html">在一些带宽小的机子上部署Oneindex又用nexmoe主题，在学校开来给同学下电影开了十几秒愣是没加载出来</summary>
    
    
    
    
    <category term="oneindex" scheme="https://blog.hzchu.top/tags/oneindex/"/>
    
    <category term="web" scheme="https://blog.hzchu.top/tags/web/"/>
    
  </entry>
  
</feed>
